var biovizNamespace = {};
(function(ns) {
var z,ba=[];function ca(e){return function(){return ba[e].apply(this,arguments)}}var ha="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},ka=function ia(){if(this.constructor===ia)throw Error("Can't instanciate abstract class BiovizMap");};z=ka.prototype;z.set=function(){throw Error("Trying to call an abstract method");};
z.get=function(){throw Error("Trying to call an abstract method");};z.remove=function(){throw Error("Trying to call an abstract method");};z.Zc=function(){throw Error("Trying to call an abstract method");};z.keys=function(){throw Error("Trying to call an abstract method");};z.values=function(){throw Error("Trying to call an abstract method");};z.clear=function(){throw Error("Trying to call an abstract method");};z.yd=ca(2);function Ca(){ka.call(this);this.ka=new Map;this.qd=new Map}Ca.prototype=Object.create(ka.prototype);
z=Ca.prototype;z.constructor=Ca;z.set=function(e,f){var g=Fa(e);this.ka.set(g,f);this.qd.set(g,e)};z.get=function(e){e=Fa(e);return this.Zc(e)?this.ka.get(e):null};z.remove=function(e){e=Fa(e);if(this.Zc(e)){var f=this.ka.get(e);this.ka["delete"](e);this.qd["delete"](e);return f}return null};z.Zc=function(e){e=Fa(e);return this.ka.has(e)};
z.keys=function(){var e=[],f=!0,g=!1,h=void 0;try{for(var k=this.ka.keys()[Symbol.iterator](),m;!(f=(m=k.next()).done);f=!0)e.push(m.value)}catch(l){g=!0,h=l}finally{try{!f&&k["return"]&&k["return"]()}finally{if(g)throw h;}}return e};z.values=function(){var e=[],f=!0,g=!1,h=void 0;try{for(var k=this.ka.values()[Symbol.iterator](),m;!(f=(m=k.next()).done);f=!0)e.push(m.value)}catch(l){g=!0,h=l}finally{try{!f&&k["return"]&&k["return"]()}finally{if(g)throw h;}}return e};
z.clear=function(){this.ka.clear();this.qd.clear()};z.yd=ca(1);function Fa(e){if(e instanceof Array){e=[];for(var f=e.length,g=0;g<f;g++)e.push(e[g].Bb());return e.join("")}return e instanceof Object?e.Bb():e}function Ja(){ka.call(this);this.ka=[]}function Oa(e,f){this.key=e;this.value=f}Ja.prototype=Object.create(ka.prototype);z=Ja.prototype;z.constructor=Ja;
z.set=function(e,f){if(void 0===e)throw"ERROR: key cannot be undefined";var g;a:if(void 0!==e.uf)g=this.ka[e.uf];else{for(g in this.ka)if(this.ka[g].key===e){g=this.ka[g];break a}g=void 0}void 0===g?"object"===("undefined"===typeof e?"undefined":ha(e))&&(e.uf=this.ka.push(new Oa(e,f))-1):g.value=f};z.get=function(e){if(void 0!==e.uf)return this.ka[e.uf].value;for(var f in this.ka)if(this.ka[f].key===e)return this.ka[f].value};z.keys=function(){var e=[],f;for(f in this.ka)e.push(this.ka[f].key);return e};
z.Zc=function(e){return-1!==this.keys().indexOf(e)};z.values=function(){var e=[],f;for(f in this.ka)e.push(this.ka[f].value);return e};z.remove=function(e){var f=-1,g;for(g in this.ka)if(this.ka[g].key===e){f=g;break}return 0<=f?this.ka.splice(f,1)[0].value:null};z.clear=function(){this.ka=[]};z.yd=ca(0);

function Va(e){e.ka=new Map(JSON.parse(e.ka));e.qd=new Map(JSON.parse(e.qd))}function Wa(){this.pos=new THREE.Vector3;this.ca=this.Ja=this.bc=this.u=this.v=this.qc=this.ea=this.symbol=this.wa=this.ja=this.td=this.name=this.id=this.type=null}z=Wa.prototype;z.ta=function(){return this.id};z.ib=function(){return this.Ja};function ab(e,f){e.u!==f&&(e.u=f,null!==e.Ja&&e.Ja.lc(f))}z.Wa=function(){return this.pos};
z.tc=function(){if(null===this.ca){var e=parseFloat(bb(this.symbol)[7]),f=new THREE.Vector3(-e,-e,-e),e=new THREE.Vector3(e,e,e);this.ca=new kb(f,e)}return this.ca};z.radius=function(){return parseFloat(bb(this.symbol)[7])};z.xb=function(){return this.bc};function wb(e,f){if(e.bc!==f&&(e.bc=f,null!=e.Ja)){var g=e.Ja,h=e.bc;if(g.bc!=h){g.bc=h;for(var k=g.u.length,m=0;m<k;m++)wb(g.u[m],h)}}}z.Lc=function(){return this.qc};z.Ve=function(e){this.qc!=e&&(this.qc=e,null!==this.Ja&&this.Ja.Ve(e))};
z.Wf=function(){return this.v};z.je=function(e){this.v!==e&&(this.v=e,null!==this.Ja&&this.Ja.je(e))};z.toString=function(){return this.symbol+":"+this.id};z.Mc=function(){return this.Ja.Mc()+":"+this.toString()};z.Bb=function(){return this.symbol+":"+this.id+":"+this.v};z.distanceTo=function(e){return e instanceof Wa?this.pos.distanceTo(e.pos):this.pos.distanceTo(e)};z.distanceToSquared=function(e){return e instanceof Wa?this.pos.distanceToSquared(e.pos):this.pos.distanceToSquared(e)};
z.sub=function(e){return e instanceof Wa?new THREE.Vector3(this.pos.x-e.pos.x,this.pos.y-e.pos.y,this.pos.z-e.pos.z):new THREE.Vector3(this.pos.x-e.x,this.pos.y-e.y,this.pos.z-e.z)};z.add=function(e){return e instanceof Wa?new THREE.Vector3(this.pos.x+e.pos.x,this.pos.y+e.pos.y,this.pos.z+e.pos.z):new THREE.Vector3(this.pos.x+e.x,this.pos.y+e.y,this.pos.z+e.z)};z.clone=function(){return new THREE.Vector3(this.pos.x,this.pos.y,this.pos.z)};
function xb(){this.ja=null;this.u=new yb;this.ca=[];this.wa=this.v=this.ea=null}z=xb.prototype;z.uc=function(){return this.ja};z.We=function(e){this.ja=e;e=this.ca.length;for(var f=0;f<e;f++)f.We(this.ja)};z.add=function(e){if(e instanceof Wa)return e=this.u.Mf(e),zb(this),e;e instanceof Nb?((null!==e.Ib&&e.Ib!==this||e.Ib===this)&&console.warn("ERROR: ",e,"already belongs to",e.Ib),null===e.Ib&&(this.ca.push(e),e.We(this.ja),e.Ib=this,zb(this))):console.warn("ERROR : a is not an atom or a molecule")};
z.remove=function(e){e instanceof Wa?(e=this.u.findNode(atom),-1<e&&(delete this.u[e],zb(this))):e instanceof Nb&&(null===molecule&&console.warn("molecule null in function remove in model"),molecule.Ib===this&&(this.ca.splice(this.ca.Qa(molecule),1),molecule.We(null),molecule.Ib=null,zb(this)))};z.Aa=function(){return this.u.values()};
z.Qb=function(){if(!this.wa){this.u.ak();this.v=this.tc();for(var e=new Sb(this.v.Ke(),this.v.Je(),32),f=this.Aa(),g=0,h=f.length;g<h;g++)e.add(new gc(f[g]));e.optimize();h=f.length;for(g=0;g<h;g++)for(var k=f[g],m=k.symbol,m=m.charAt(0).toUpperCase()+m.slice(1).toLowerCase(),l=parseFloat(bb(m)[6]),q=e.lh(k.pos,5),r=q.length,t=0;t<r;t++){var x=q[t].getPoint();if(x!==k){var m=x.symbol,m=m.charAt(0).toUpperCase()+m.slice(1).toLowerCase(),w=parseFloat(bb(m)[6]),m=l+w-.4,w=l+w+.4,B=k.distanceTo(x);B>=
m&&B<=w&&(m=k,w=this.u.findNode(m),B=this.u.findNode(x),void 0!==w&&void 0!==B||console.warn("Couldn't find atoms ",m," and/or ",x," in model ",this),w.jj(B)||this.u.Rg(w,B).setAttribute("BondType","SIMPLE"))}}this.wa=!0}return this.u};function zb(e){e.ea=null;e.v=null;e.wa=!1}z.Wa=function(){if(null===this.ea){this.ea=new THREE.Vector3;for(var e=this.Aa(),f=0,g=0,h=0,k=e.length,m=0;m<k;m++)var l=e[m].pos,f=f+parseInt(l.x),g=g+parseInt(l.y),h=h+parseInt(l.z);this.ea.set(f/k,g/k,h/k)}return this.ea};
z.tc=function(){if(null===this.v){for(var e=new THREE.Vector3(Infinity,Infinity,Infinity),f=new THREE.Vector3(-Infinity,-Infinity,-Infinity),g=this.Aa(),h=0,k=g.length;h<k;h++){var m=g[h].pos;e.x=Math.min(e.x,m.x);e.y=Math.min(e.y,m.y);e.z=Math.min(e.z,m.z);f.x=Math.max(f.x,m.x);f.y=Math.max(f.y,m.y);f.z=Math.max(f.z,m.z)}this.v=new kb(e,f)}return this.v};function Nb(e){this.id=e;this.Ib=this.ea=this.type=null;this.ga=[];this.v=this.ca=this.u=null;this.Lf=!1}z=Nb.prototype;z.ta=function(){return this.id};
z.Qb=function(){return this.Ib.Qb()};z.lc=function(e){if(this.id!==e){this.id=e;for(var f=0;f<this.ga.length;f++)this.ga[f].je(e)}};z.uc=function(){return this.ea};z.We=function(e){this.ea=e};z.add=function(e){null==e&&console.warn("residue is null in Molecule");null!==e.Fa&&e.Fa!==this&&console.warn(e," already belongs to ",e.Fa);null===e.Fa&&(this.ga.push(e),hc(e,this),ic(this))};
z.remove=function(e){null===e&&console.warn("residue is null in Molecule");e.Fa===this&&(this.ga.remove(e),hc(e,null),ic(this))};z.ib=function(e){for(var f=0;f<this.ga.length;f++){var g=this.ga[f];if(g.ta()==e)return g}return null};z.Aa=function(){for(var e=[],f=this.ga.length,g=0;g<f;g++)e=e.concat(this.ga[g].Aa());return e};z.size=function(){return this.ga.length};z.isEmpty=function(){return 0===this.size};function ic(e){e.u=null;e.ca=null;null!==e.Ib&&zb(e.Ib)}
z.Wa=function(){if(null===this.u){this.u=new THREE.Vector3;for(var e=this.Aa(),f=e.length,g=0;g<f;g++){var h=e[g].pos;this.u.x+=h.x;this.u.y+=h.y;this.u.z+=h.z}this.u.x/=f;this.u.y/=f;this.u.z/=f}return this.u};
z.tc=function(){if(null===this.ca){for(var e=new THREE.Vector3(Infinity,Infinity,Infinity),f=new THREE.Vector3(-Infinity,-Infinity,-Infinity),g=this.Aa(),h=g.length,k=0;k<h;k++){var m=g[k].pos;e.x=Math.min(e.x,m.x);e.y=Math.min(e.y,m.y);e.z=Math.min(e.z,m.z);f.x=Math.max(f.x,m.x);f.y=Math.max(f.y,m.y);f.z=Math.max(f.z,m.z)}this.ca=new kb(e,f)}return this.ca};z.toString=function(){return this.type+":"+this.id};z.Bb=function(){return this.toString()};z.Mc=function(){return this.ea.Mc()+":"+this.toString()};
z.Pi=function(){if(null!==this.type&&"Protein"===this.type&&!this.Lf){if(null===this.v){var e=this.ga,f=e.length;this.v=new yb;for(var g=1;g<f;g++){var h=e[g-1],k=e[g],m=this.v.findNode(k);null==m&&(m=this.v.Tg(k.toString(),k));var l=k.jc("CA"),q=k.jc("N"),r=k.jc("H");if(h.ta()+h.xb().charCodeAt(0)===k.ta()+k.xb().charCodeAt(0)-1&&"PRO"!==h.ca){r=h.jc("C");h=h.jc("O");if(null==r||null==h)continue;r=r.sub(h);r=r.normalize();h=q.add(r);r=new Wa;r.name="H";r.symbol="H";r.pos.x=h.x;r.pos.y=h.y;r.pos.z=
h.z}if(null!=r)for(h=0;h<f;h++)if(h!=g&&h!=g-1){var t=e[h],k=this.v.findNode(t);null==k&&(k=this.v.Tg(t.toString(),t));var x=t.jc("CA"),w=t.jc("C"),B=t.jc("O");if(null!=x&&null!=w&&null!=B&&!(9<x.distanceTo(l))){var x=r.distanceTo(B),t=r.distanceTo(w),B=q.distanceTo(B),D=q.distanceTo(w),w=-9.9;.5>x||.5>t||.5>B||.5>D||(w=27.888/B,w+=27.888/t,w-=27.888/x,w-=27.888/D,-9.9>w&&(w=-9.9));if(-.5>w){var x=m.Ck(k),E;null!=x?E=x.getAttribute("eH"):E=0;w<E&&(this.v.Rg(m,k,!0).setAttribute("eH",w),null!=x&&this.v.wl(x))}}}}}e=
this.ga.length;for(f=0;f<e;f++)this.ga[f].mb=null;f=1;for(l=4;f+l<e;f++)if(pc(this,this.ga[f-1],this.ga[f-1+l])&&pc(this,this.ga[f],this.ga[f+l]))for(g=f;g<f+l;g++)this.ga[g].mb=F.u;for(f=1;f+1<e;f++)for(g=f+3;g+1<e;g++)if(m=this.ga[f],l=this.ga[g],null===m.mb&&null===l.mb)if(pc(this,this.ga[f-1],l)&&pc(this,l,this.ga[f+1])||pc(this,this.ga[g-1],m)&&pc(this,m,this.ga[g+1]))m.mb=F.v,l.mb=F.v;else if(pc(this,m,l)&&pc(this,l,m)||pc(this,this.ga[f-1],this.ga[g+1])&&pc(this,this.ga[g-1],this.ga[f+1]))m.mb=
F.ea,l.mb=F.ea;f=1;for(l=3;f+l<e;f++)if(pc(this,this.ga[f-1],this.ga[f-1+l])&&pc(this,this.ga[f],this.ga[f+l])){m=!0;for(g=f;g<f+l;g++)if(null!=this.ga[g]){m=!1;break}for(g=f;g<f+l;g++)this.ga[g].mb=m?F.u:F.ja}f=1;for(l=5;f+l<e;f++)if(pc(this,this.ga[f-1],this.ga[f-1+l])&&pc(this,this.ga[f],this.ga[f+l])){m=!0;for(g=f;g<f+l;g++)if(null!=this.ga[g]){m=!1;break}for(g=f;g<f+l;g++)this.ga[g].mb=m?F.u:F.ja}for(l=3;5>=l;l++)for(f=0;f+l<e;f++)if(pc(this,this.ga[f],this.ga[f+l]))for(g=f+1;g<f+l;g++)m=this.ga[g].mb,
null==m&&(this.ga[g].mb=F.ja);for(f=0;f<e;f++)m=this.ga[f].mb,null==m&&(this.ga[f].mb=F.ca);this.Lf=!0}};z.Ll=function(e){if(e.length!=this.ga.length)for(var f=0,g=this.ga.length;f<g;f++){var h=tc[e[this.ga[f]._id-1]];this.ga[f].mb=null!=h?h:F.ca}else for(f=0,g=this.ga.length;f<g;f++)h=tc[e[f]],this.ga[f].mb=null!=h?h:F.ca;this.Lf=!0};function pc(e,f,g){f=e.v.findNode(f);return null==f?!1:f.Kk(e.v.findNode(g))}
z.be=function(e){void 0===e&&(e=!0);for(var f="",g=this.ga,h=0,k="\x00",m=this.Bd()?"X":this.Me()?"N":"-",l=g.length,q=0;q<l;q++){var r=g[q];if(e&&0!=q)for(h=r.ta()-h+r.xb().charCodeAt(0)-k.charCodeAt(0);1<h--;)f+=m;f+=r.ij();h=r.ta();k=r.xb()}return f};z.Me=function(){return"DNA"==this.type||"RNA"==this.type};z.Bd=function(){return"Protein"==this.type||"Peptide"==this.type||"Small Peptide"==this.type};z.tj=function(){return this.Me()||this.Bd()};z.sj=function(){return"Ligand"===this.type};
z.Oj=function(e){var f=new uc,g=[];g.push(new vc(this.toString(),this.be(!1)));g.push(new vc("ExternalSequence",e));f=f.align(g);e=f.be("ExternalSequence");f=f.be(this.toString());console.log(e,f);this.sk=f;console.log(f.ja())};
function Ac(e){for(var f=[],g=0,h=e.ga,k=0,m=0;m<h.length;m++){var l=h[m];if(null===l.type)k++;else{var q=f[l.type];void 0===q&&(q=0,f[l.type]=q,g++);f[l.type]++}}if(0!==g){var g=Infinity,r;for(q in f)h=f[q],0!==h&&h<g?(g=h,r=q):h===g&&q<r&&(r=q);g>=k&&("Protein"==r?(f=e.size(),e.type=20>f?"Small Peptide":60>f?"Peptide":"Protein"):e.type=r)}else e.type="Unknown"}
function Gc(){this._id=this.ea=this.qc=this.Fa=this.mb=this.type=this.ca=null;this.bc="\x00";this.u=[];this.wa=new Ca;this.Ha=this.ja=this.v=null}function Hc(e,f){e.ea=f.Vb;e._id=f.vb;e.bc=f.Xb}z=Gc.prototype;z.Qb=function(){return this.Fa.Qb()};function hc(e,f){e.Fa=f;null!==f&&void 0!==f&&e.je(f.ta())}z.ta=function(){return this._id};z.lc=function(e){if(this._id!=e){this._id=e;for(var f=0;f<this.u.length;f++)ab(this.u[f],e)}};z.xb=function(){return this.bc};z.Lc=function(){return this.qc};
z.Ve=function(e){if(this.qc!=e){this.qc=e;for(var f=this.u.length,g=0;g<f;g++)g.Ve(e)}};z.Wf=function(){return this.ea};z.je=function(e){if(this.ea!=e){this.ea=e;null!==this.Fa&&this.Fa.lc(e);for(var f=this.u.length,g=0;g<f;g++)g.je(e)}};
z.add=function(e){null===e&&console.warn("atom = null in Residue");null!==e.ib()&&e.ib()!==this&&console.warn(e," already belongs to ",e.ib());if(null===e.ib()){this.u.push(e);var f=new Ic(e.name,e.td);this.wa.Zc(f)||this.wa.set(f,e);e.Ja=this;null!==this&&(ab(e,e.Ja.ta()),wb(e,e.Ja.xb()),e.Ve(e.Ja.Lc()),e.je(e.Ja.Wf()))}};z.remove=function(e){null===e&&console.warn("atom = null in Residue");e.ib()===this&&(this.u.remove(e),e=new this.Fb(e.name,e.td),this.wa.remove(e))};z.Aa=function(){return this.u};
z.gj=function(e){for(var f=0;f<this.u.length;f++){var g=this.u[f];if(g.ta()==e)return g}return null};z.jc=function(e){var f=void 0;void 0===f&&(f="\x00");e=this.wa.get((new Ic(e,f)).toString());if(null!==e)return e};z.Wa=function(){if(null==this.v){this.v=new THREE.Vector3;for(var e=this.u.length,f=0;f<e;f++){var g=this.u[f].pos;this.v.x+=g.x;this.v.y+=g.y;this.v.z+=g.z}this.v.x/=e;this.v.y/=e;this.v.z/=e}return this.v};
z.nh=function(){if(null==this.ja)for(var e=this.u.length,f=0;f<e;f++){var g=this.u[f];if("CA"===g.name){this.ja=g.pos.clone();break}}if(null==this.ja){for(var h=this.Wa(),k=this.u[0],m=h.distanceTo(k.pos),e=this.u.length,f=0;f<e;f++){var g=this.u[f],l=h.distanceTo(g.pos);l<m&&(k=g,m=l)}this.ja=k.clone()}return this.ja};
z.tc=function(){if(null===this.Ha){for(var e=new THREE.Vector3(Infinity,Infinity,Infinity),f=new THREE.Vector3(-Infinity,-Infinity,-Infinity),g=this.u.length,h=0;h<g;h++){var k=this.u[h];e.x=Math.min(e.x,k.pos.x);e.y=Math.min(e.y,k.pos.y);e.z=Math.min(e.z,k.pos.z);f.x=Math.max(f.x,k.pos.x);f.y=Math.max(f.y,k.pos.y);f.z=Math.max(f.z,k.pos.z)}this.Ha=new kb(e,f)}return this.Ha};z.Me=function(){return"DNA"==this.type||"RNA"==this.type};
z.Bd=function(){return"Protein"==this.type||"Peptide"==this.type||"Small Peptide"==this.type};
z.ij=function(){switch(null!==this.ca?this.ca:this.qc){case "GLY":return"G";case "ALA":return"A";case "VAL":return"V";case "LEU":return"L";case "ILE":return"I";case "PRO":return"P";case "PHE":return"F";case "MET":return"M";case "TRP":return"W";case "SER":return"S";case "THR":return"T";case "ASN":return"N";case "GLN":return"Q";case "ASP":return"D";case "GLU":return"E";case "CYS":return"C";case "TYR":return"Y";case "HIS":return"H";case "LYS":return"K";case "ARG":return"R";case "ASX":return"B";case "GLX":return"Z";
case "A":case "DA":case "+A":return"A";case "C":case "DC":case "+C":return"C";case "G":case "DG":case "+G":return"G";case "T":case "DT":case "+T":return"T";case "U":case "DU":case "+U":return"U";case "I":case "DI":case "+I":return"I"}return null!=this.Fa.type&&"Protein"===this.Fa.type?"X":null==this.Fa.type||"RNA"!==this.Fa.type&&"DNA"!==this.Fa.type?"?":"N"};z.toString=function(){return this.qc+":"+this._id};z.Bb=function(){return this.qc+":"+this._id+":"+this.ea};
z.Mc=function(){return this.Fa.Mc()+":"+this.toString()};function Ic(e,f){this.name=e;this.td=f}Ic.prototype.toString=function(){return this.name+":"+this.td};Ic.prototype.Bb=function(){return this.name+":"+this.td};
function Jc(e,f){null===e.ca&&console.warn("Error : stdResName must be set before guessing residue type");if(-1!==Kc.indexOf(e.ca))e.type="DNA";else if(-1!==Qc.indexOf(e.ca))e.type="RNA";else if(-1!==Rc.indexOf(e.ca))e.type="Protein";else if(-1!==Vc.indexOf(e.Lc()))e.type="Solvent";else if(-1!==Wc.indexOf(e.Lc()))e.type=null;else{var g=f.get(e.ta());null!=g&&g.name.endsWith(" ION")&&(e.type="Ion");e.type="Ligand"}}
var Rc="GLY ALA VAL LEU ILE PRO PHE MET TRP SER THR ASN GLN ASP GLU CYS TYR HIS LYS ARG".split(" "),Qc=["A","C","G","U","I"],Kc="DA DC DG DT DI DU +A +C +G +T +I +U T".split(" "),Wc="UNK ASX GLX N DN UNL UNX".split(" "),Vc=["HOH","DOD","GOL","EDO"];
function cd(e,f,g){null===e&&console.warn("chainId null in Residue.Id");this.Vb=e;this.vb=f;this.Xb=g;this.toString=function(){return"\x00"!==this.Xb.charCodeAt(0)?this.Vb+":"+this.vb+":"+this.Xb:this.Vb+":"+this.vb};this.Bb=function(){return"\x00"!==this.Xb.charCodeAt(0)?this.Vb+":"+this.vb+":"+this.Xb:this.Vb+":"+this.vb}}function F(e,f){this.name=e;this.code=f}F.ca=new F("Coil"," ");F.ja=new F("Turn","T");F.u=new F("Helix","H");F.v=new F("Strand","x");F.ea=new F("Strand","X");
var tc={G:F.u,H:F.u,I:F.u,B:F.v,E:F.v,T:F.ja,S:F.ca,C:F.ca,X:F.ca};F.prototype.toString=function(){return name};function dd(){this.el=!0;this._id=this.Og=null;this.Hi=NaN;this.Gi=null;this.ca=[];this.Ai=[];this.Vd=new Ca;this.Td=new Ca;this.Ec=new Ca;this.wi=[];this.v=[];this.ea=new Ca;this.u=null}z=dd.prototype;
z.Wa=function(){if(null===this.u){this.u=new THREE.Vector3;for(var e=this.v[0].ca,f=0;f<e.length;f++){var g=e[f].Wa();this.u.x+=g.x;this.u.y+=g.y;this.u.z+=g.z}this.u.x/=e.length;this.u.y/=e.length;this.u.z/=e.length}return this.u};z.Qb=function(){return this.v[0].Qb()};z.ta=function(){return this._id};z.lc=function(e){null==this._id&&(this.Og=e);this._id=e};z.Ml=function(e){this.Hi=e};z.Yh=function(){};z.setDate=function(){};z.$h=function(e){this.Gi=e};z.Kl=function(){};
z.Ji=function(e,f){null==(null==e?this.ca:this.ca[e])&&(this.ca[e]=f)};z.Il=function(e){this.Ai=e};z.add=function(e){null===e&&console.warn("Error on adding model to structure : model = NULL");null!=e.uc()&&e.uc()!=this&&console.warn(e," already belongs to ",e.uc());null==e.uc()&&(this.v.push(e),e.We(this))};z.remove=function(e){null===e&&console.warn("Error on removing structure");e.uc()==this&&(this.v.remove(e),e.We(null))};z.Yf=function(){return this.v[0]};z.toString=function(){return this._id};
z.Bb=function(){return this.toString()};z.Mc=function(){return this.toString()};
z.kk=function(e){this.Vd.__proto__=Ca.prototype;Va(this.Vd);this.Ec.__proto__=Ca.prototype;Va(this.Ec);this.Td.__proto__=Ca.prototype;Va(this.Td);for(var f=e.length,g=0;g<f;g++){var h=new xb;this.add(h);for(var k=e[g],m=k.length,l=0;l<m;l++){var q=new Wa;q.type=k[l][0];q.id=k[l][1];q.name=k[l][2];q.td=k[l][3];q.Ve(k[l][4]);q.je(k[l][5]);ab(q,k[l][6]);wb(q,k[l][7]);q.pos.x=k[l][8];q.pos.y=k[l][9];q.pos.z=k[l][10];q.ja=k[l][11];q.wa=k[l][12];q.symbol=k[l][13];q.ea=k[l][14];h.add(q)}}ed(this)};
function ed(e){var f=e.Vd,g=e.Td,h=e.Ec,k=e.v,m=!1,l,q=k.length,r=new Ca;for(l=0;l<q;l++){for(var t=k[l],x=[],w=t.Aa(),B=w.length,D=0;D<B;D++){var E=w[D],I=void 0,H=new cd(E.Wf(),E.u,E.xb()),I=r.get(H);if(null==I){I=new Gc;Hc(I,H);I.Ve(E.Lc());var K=f.get(H);I.ca=K?K.vg:I.Lc();Jc(I,g);K=h.get(H);null!=K?(m||(m=!0),I.mb=K):I.mb=F.ca;x.push([I,H]);r.set(H,I)}I.add(E)}E=void 0;for(I=0;I<x.length;I++){w=x[I][0];B=x[I][1];I=w;for(D=[];void 0!==I&&null!==I&&-1===D.indexOf(B)&&!I.Bd()&&!I.Me();)if(D.push(B),
E=e.ea.get(B),null!=E){for(var E=E.Qa.Vb===B.Vb&&E.Qa.vb===B.vb&&E.Qa.Xb===B.Xb?E.vc:E.Qa,G,I=0;I<x.length;I++)H=x[I],E.Vb===H.Vb&&E.vb===H.vb&&E.Xb===H.Xb&&(G=I);I=x[G][0]}void 0!==I&&I.type!==w.type&&(w.type=I.type)}w=new Map;for(I=0;I<x.length;I++)B=x[I][0],D=B.Wf(),E=B.type+" "+D,H=w.get(E),void 0===H&&(H=new Nb(D),t.add(H),w.set(E,H)),H.add(B),H.Lf=m;t=function(e,f){return e.Kg<f.Kg?-1:e.Kg>f.Kg?1:e._id<f._id?-1:e._id>f._id?1:e.bc<f.bc?-1:e.bc>f.bc?1:0};x=!0;I=!1;B=void 0;try{for(var L=w.values()[Symbol.iterator](),
P;!(x=(P=L.next()).done);x=!0){var Q=P.value;Q.ga.sort(t);Ac(Q)}}catch(V){I=!0,B=V}finally{try{!x&&L["return"]&&L["return"]()}finally{if(I)throw B;}}}};

function fd(e,f){return ba[e]=f}ka.prototype.yd=fd(2,function(){throw Error("Trying to call an abstract method");});Ca.prototype.yd=fd(1,function(e){var f=!0,g=!1,h=void 0;try{for(var k=this.ka.keys()[Symbol.iterator](),m;!(f=(m=k.next()).done);f=!0){var l=m.value;if(this.ka.get(l)===e)return l}}catch(q){g=!0,h=q}finally{try{!f&&k["return"]&&k["return"]()}finally{if(g)throw h;}}});Ja.prototype.yd=fd(0,function(e){for(var f in this.ka)if(this.ka[f].value===e)return this.ka[f].key});
function gd(e){var f=[],g=!0,h=!1,k=void 0;try{for(var m=e.qd.keys()[Symbol.iterator](),l;!(g=(l=m.next()).done);g=!0)f.push(l.value)}catch(q){h=!0,k=q}finally{try{!g&&m["return"]&&m["return"]()}finally{if(h)throw k;}}return f}var ha="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},jd=jd||{};jd.Cb=jd.Cb||{};jd.Cb.Uj=function(){return this.Jf||this.If};
jd.Cb.Rj=function(){if(this.Jf)return document.webkitIsFullScreen;if(this.If)return document.mozFullScreen;console.assert(!1)};jd.Cb.request=function(e){e=e||document.body;this.Jf?e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):this.If?e.mozRequestFullScreen():console.assert(!1)};jd.Cb.cancel=function(){this.Jf?document.webkitCancelFullScreen():this.If?document.mozCancelFullScreen():console.assert(!1)};jd.Cb.Jf="webkitCancelFullScreen"in document?!0:!1;
jd.Cb.If="mozCancelFullScreen"in document?!0:!1;jd.Cb.toggle=function(e,f){jd.Cb.Rj()?(kd(e),null!=e.Tf?e.contextMenu.moveTo(e.Tf):e.contextMenu.moveTo(e.eh),jd.Cb.cancel()):(kd(e),null!=e.Tf&&e.contextMenu.moveTo(e.eh),jd.Cb.request(f))};
jd.Cb.Vj=function(e){e=e||{};var f=e.charCode||102,g=void 0!==e.dblclick?e.dblclick:!1,h=e.element,k=e.ba;document.addEventListener("keypress",function(e,f){return function(){return e.apply(f,arguments)}}(function(e){e.which===f&&jd.Cb.toggle(k,h)},this),!1);g&&document.addEventListener("dblclick",toggle,!1)};jd=jd||{};
jd.Vc=function(e,f,g,h){function k(){var k=null,r=null;null==f?(k=window.v,r=window.u):(k=f.width(),r=f.height());if(m!==k||l!==r)m=k,l=r,e.setSize(m,l),null!=g&&(g instanceof THREE.PerspectiveCamera?(g.aspect=m/l,g.fov=ld(h,g),g.updateProjectionMatrix()):g instanceof THREE.OrthographicCamera?(g.left=-m/2,g.right=m/2,g.top=l/2,g.bottom=-l/2,g.updateProjectionMatrix()):console.warn("Unknown camera type"))}var m,l;window.addEventListener("resize",k,!1);return{stop:function(){window.removeEventListener("resize",
k)}}};jd.Vc.bind=function(e,f,g,h){return jd.Vc(e,f,g,h)};jd=jd||{};
jd.rm=function(){var e=document.createElement("div");e.style.cssText="width:80px;opacity:0.9;cursor:pointer";var f=document.createElement("div");f.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#200;";e.appendChild(f);var g=document.createElement("div");g.style.cssText="color:#f00;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px";g.innerHTML="WebGLRenderer";f.appendChild(g);for(var h=[],g=0;9>g;g++)h[g]=document.createElement("div"),h[g].style.cssText=
"color:#f00;background-color:#311;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",f.appendChild(h[g]),h[g].innerHTML="-";var k=Date.now();return{domElement:e,update:function(e){console.assert(e instanceof THREE.WebGLRenderer);if(!(Date.now()-k<1E3/30)){k=Date.now();var f=0;h[f++].textContent="== Memory =====";h[f++].textContent="Programs: "+e.info.memory.programs;h[f++].textContent="Geometries: "+e.info.memory.geometries;h[f++].textContent="Textures: "+e.info.memory.textures;
h[f++].textContent="== Render =====";h[f++].textContent="Calls: "+e.info.render.calls;h[f++].textContent="Vertices: "+e.info.render.vertices;h[f++].textContent="Faces: "+e.info.render.faces;h[f++].textContent="Points: "+e.info.render.points}}}};
var md={atom:"#F5A99580",residue:"#CCFF00",molecule:"#FF66CC"},nd={A:"#2424DC",B:"#AABDC0",C:"#00C500",D:"#5A00C1",E:"#96640A",F:"#F5A995",G:"#2EF7F0",H:"#C1C1BC",I:"#E8A432",J:"#0AFA0A",K:"#49C8C8",L:"#C8C80A",M:"#64C864",N:"#CB70BB",O:"#960096",P:"#531966",Q:"#173232",R:"#AA4664",S:"#7B7B7B",T:"#189A8F",U:"#F57B15",V:"#EA22EA",W:"#82B4BE",X:"#828282",Y:"#505050",Z:"#323232",0:"#7B7B7B",1:"#189A8F",2:"#F57B15",3:"#EA22EA",4:"#82B4BE",5:"#828282",6:"#505050",7:"#323232",8:"#A050FA",9:"#1EEA20"},od=
{A:"#FF3232",T:"#0A32FF",C:"#FFFF32",G:"#0AFF0A",U:"#FF32FF",DA:"#FF3232",DT:"#0A32FF",DC:"#FFFF32",DG:"#0AFF0A",DU:"#FF32FF"},pd={SER:"#DAD0CC",LEU:"#008CB1",GLY:"#D6E9E5",ALA:"#69A0AC",LYS:"#DD524A",VAL:"#799CB4",THR:"#D0C2B0",ASP:"#82C56B",GLU:"#4EC4A4",PRO:"#315E87",ASN:"#E5E3DA",ARG:"#A73638",PHE:"#315E87",ILE:"#61818A",GLN:"#CFD0CD",TYR:"#72896E",CYS:"#72896E",HIS:"#6C6C67",MET:"#C8DBE8",TRP:"#356B84"},qd={H:"#FFFFFF",He:"#FADEC5",Li:"#7F3C3D",Be:"#000000",B:"#229262",C:"#AFAFAF",N:"#385E96",
O:"#B83839",F:"#FB9B27",Ne:"#000000",Na:"#38608E",Mg:"#72896E",Al:"#82C56B",Si:"#000000",P:"#FB9B27",S:"#F7B848",Cl:"#28FE28",Ar:"#000000",K:"#FADEC5",Ca:"#6C6C67",Sc:"#6C6C67",Ti:"#72896E",V:"#000000",Cr:"#6C6C67",Mn:"#6C6C67",Fe:"#FB9B27",Co:"#AAB844",Ni:"#6B5248",Cu:"#6B5248",Zn:"#6B5248"},rd={Hydrophobic:"#FF0000",Hydrophilic:"#0000FF"},sd={"First residue":"#00FF00","Last residue":"#0000FF"},Bd={Coil:"#B4B4B4",Turn:"#FFB419",Helix:"#FF1919",Strand:"#1919FF"},Cd={AA_AROMATIC:"#CDCD4B",AA_CHARGED_NEG:"#FF1919",
AA_CHARGED_PLUS:"#1919FF",AA_CYSTEINE:"#FF7D0F",AA_GLYCINE:"#9696FF",AA_HYDROPHOB:"#AFAFAF",AA_POLAR_NEG:"#9B3737",AA_POLAR_PLUS:"#37379B",AA_PROLINE:"#FF9B9B",AccessibleSurface:"#C8641E",ALL_ATOMS:"#000000",ALL_RESIDUES:"#000000",ALL_SSE:"#000000",AlphaShapeSurface:"#C8641E",Antiparallel_Strand:"#1919FF",APOLAIRE:"#CFD0CD",ATOM_CARBON_CHAIN:"#AFAFAF",ATOM_CARBON_CYCLE:"#AFAF4B",ATOM_CHARGED_NEG:"#1919FF",ATOM_CHARGED_PLUS:"#1919FF",ATOM_POLAR_NEG:"#9B1919",ATOM_POLAR_PLUS:"#19199B",ATOM_S:"#FFFFFF",
AXIS:"#FFFFFF",BACKBONE:"#A0B4FA",Background:"#000000",BOND:"#1EEA2066",CHARGE_NEG:"#0000FF99",CHARGE_NEUTRAL:"#FFFFFF99",CHARGE_POS:"#FF000099",Coil:"#B4B4B4",CORE:"#FF6464",C_TERM:"#A73638",DELTA_NEG:"#0000B499",DELTA_POS:"#B4000099",FIX:"#315E87",FLEXIBLE:"#C8DBE8",HELIX_2:"#32B432",Helix:"#FF1919",HYDROGEN_BOND:"#FFFFFF33",INTERFACE:"#FFFFFF",MolecularSurface:"#C8641E",N_TERM:"#315E87",Parallel_Strand:"#1919FF",PCORE:"#3C321E",PE:"#F7B848B3",PLANE:"#FFFFFF1A",POLAIRE_F_AB_ANIONIQUE:"#38608E",
POLAIRE_F_AB_CATIONIQUE:"#A73638",POLAIRE_F_AB_NEUTRE:"#F6F7F0",POLAIRE_SANS_F_AB:"#F9B58F",PSURFACE:"#141496",RIM:"#1428FF",SELECTION:"#FDB45D",SSE_B:"#6A68E6",SSE:"#FB9B27",SSE_HA:"#DC5456",SSE_T:"#FAFAFA",STABLE:"#385E96",SURFACE:"#FF0000",Turn:"#FFB419",UNSTABLE:"#BA3938",VDW:"#008CB1E1",Void_mo:"#9BFAB4",Void_pi:"#BEFF64",Void_po:"#C8C8C8",Void_pp:"#787878",Void_pr:"#6464FF"},Dd={white:{r:1,g:1,b:1},black:{r:0,g:0,b:0},grey:{r:.5,g:.5,b:.5},lightgrey:{r:.7,g:.7,b:.7},darkgrey:{r:.3,g:.3,b:.3},
red:{r:1,g:0,b:0},darkred:{r:.5,g:0,b:0},lightred:{r:1,g:.5,b:.5},green:{r:0,g:1,b:0},darkgreen:{r:0,g:.5,b:0},lightgreen:{r:.5,g:1,b:.5},blue:{r:0,g:0,b:1},darkblue:{r:0,g:0,b:.5},lightblue:{r:.5,g:.5,b:1},yellow:{r:1,g:1,b:0},darkyellow:{r:.5,g:.5,b:0},lightyellow:{r:1,g:1,b:.5},cyan:{r:0,g:1,b:1},darkcyan:{r:0,g:.5,b:.5},lightcyan:{r:.5,g:1,b:1},magenta:{r:1,g:0,b:1},darkmagenta:{r:.5,g:0,b:.5},lightmagenta:{r:1,g:.5,b:1},orange:{r:1,g:.5,b:0},darkorange:{r:.5,g:.25,b:0},lightorange:{r:1,g:.75,
b:.5}},Ed={Ac:"Actinium 7Act 20 f 89 [227] 2.15 2".split(" "),Al:"Aluminium 3 13 p 13 26.982 1.21 2".split(" "),Am:"Americium 7Act 20 f 95 [243] 1.8 2".split(" "),Sb:"Antimony 5 15 p 51 121.76 1.39 2".split(" "),Ar:"Argon 3 18 p 18 39.948 1.51 1.88".split(" "),As:"Arsenic 4 15 p 33 74.922 1.21 1.85".split(" "),At:"Astatine 6 17 p 85 [210] 1.21 2".split(" "),Ba:"Barium 6 2 s 56 137.327 2.15 2".split(" "),Bk:"Berkelium 7Act 20 f 97 [247] 1.54 2".split(" "),Be:"Beryllium 2 2 s 4 9.012 0.96 2".split(" "),
Bi:"Bismuth 6 15 p 83 208.98 1.48 2".split(" "),Bh:"Bohrium 7 7 d 107 [264] 1.5 2".split(" "),B:"Boron 2 13 p 5 10.811 0.83 2".split(" "),Br:"Bromine 4 17 p 35 79.904 1.21 1.85".split(" "),Cd:"Cadmium 5 12 d 48 112.411 1.54 1.58".split(" "),Cs:"Caesium 6 1 s 55 132.905 2.44 2".split(" "),Ca:"Calcium 4 2 s 20 40.078 1.76 2".split(" "),Cf:"Californium 7Act 20 f 98 [251] 1.83 2".split(" "),C:"Carbon 2 14 p 6 12.011 0.68 1.7".split(" "),Ce:"Cerium 6Lan 19 f 58 140.116 2.04 2".split(" "),Cl:"Chlorine 3 17 p 17 35.453 0.99 1.75".split(" "),
Cr:"Chromium 4 6 d 24 51.996 1.39 2".split(" "),Co:"Cobalt 4 9 d 27 58.933 1.26 2".split(" "),Cu:"Copper 4 11 d 29 63.546 1.32 1.4".split(" "),Cm:"Curium 7Act 20 f 96 [247] 1.69 2".split(" "),Ds:"Darmstadtium 7 10 d 110 [271] 1.5 2".split(" "),Db:"Dubnium 7 5 d 105 [262] 1.5 2".split(" "),Dy:"Dysprosium 6Lan 19 f 66 162.5 1.92 2".split(" "),Es:"Einsteinium 7Act 20 f 99 [252] 1.5 2".split(" "),Er:"Erbium 6Lan 19 f 68 167.26 1.89 2".split(" "),Eu:"Europium 6Lan 19 f 63 151.964 1.98 2".split(" "),Fm:"Fermium 7Act 20 f 100 [257] 1.5 2".split(" "),
F:"Fluorine 2 17 p 9 18.998 0.64 1.47".split(" "),Fr:"Francium 7 1 s 87 [223] 2.6 2".split(" "),Gd:"Gadolinium 6Lan 19 f 64 157.25 1.96 2".split(" "),Ga:"Gallium 4 13 p 31 69.723 1.22 1.87".split(" "),Ge:"Germanium 4 14 p 32 72.61 1.17 2".split(" "),Au:"Gold 6 11 d 79 196.967 1.36 1.66".split(" "),Hf:"Hafnium 6 4 d 72 178.49 1.75 2".split(" "),Hs:"Hassium 7 8 d 108 [269] 1.5 2".split(" "),He:"Helium 1 18 p 2 4.003 1.5 1.4".split(" "),Ho:"Holmium 6Lan 19 f 67 164.93 1.92 2".split(" "),H:"Hydrogen 1 1 s 1 1.008 0.23 1.09".split(" "),
In:"Indium 5 13 p 49 114.818 1.42 1.93".split(" "),I:"Iodine 5 17 p 53 126.904 1.4 1.98".split(" "),Ir:"Iridium 6 9 d 77 192.217 1.41 2".split(" "),Fe:"Iron 4 8 d 26 55.845 1.52 2".split(" "),Kr:"Krypton 4 18 p 36 83.8 1.5 2.02".split(" "),La:"Lanthanum 6Lan 19 f 57 138.906 2.07 2".split(" "),"Lr (Lw)":"Lawrencium 7 3 d 103 [262] 1.5 2".split(" "),Lr:"Lawrencium 7 3 d 103 [262] 1.5 2".split(" "),Lw:"Lawrencium 7 3 d 103 [262] 1.5 2".split(" "),Pb:"Lead 6 14 p 82 207.2 1.46 2.02".split(" "),Li:"Lithium 2 1 s 3 6.941 1.28 1.82".split(" "),
Lu:"Lutetium 6 3 d 71 174.967 1.87 2".split(" "),Mg:"Magnesium 3 2 s 12 24.305 1.41 1.73".split(" "),Mn:"Manganese 4 7 d 25 54.938 1.61 2".split(" "),Mt:"Meitnerium 7 9 d 109 [268] 1.5 2".split(" "),Md:"Mendelevium 7Act 20 f 101 [258] 1.5 2".split(" "),Hg:"Mercury 6 12 d 80 200.59 1.32 1.55".split(" "),Mo:"Molybdenum 5 6 d 42 95.94 1.54 2".split(" "),Nd:"Neodymium 6Lan 19 f 60 144.24 2.01 2".split(" "),Ne:"Neon 2 18 p 10 20.18 1.5 1.54".split(" "),Np:"Neptunium 7Act 20 f 93 [237] 1.9 2".split(" "),
Ni:"Nickel 4 10 d 28 58.693 1.24 1.63".split(" "),Nb:"Niobium 5 5 d 41 92.906 1.64 2".split(" "),N:"Nitrogen 2 15 p 7 14.007 0.68 1.55".split(" "),No:"Nobelium 7Act 20 f 102 [259] 1.5 2".split(" "),Os:"Osmium 6 8 d 76 190.23 1.44 2".split(" "),O:"Oxygen 2 16 p 8 15.999 0.68 1.52".split(" "),Pd:"Palladium 5 10 d 46 106.42 1.39 1.63".split(" "),P:"Phosphorus 3 15 p 15 30.974 1.05 1.8".split(" "),Pt:"Platinum 6 10 d 78 195.078 1.36 1.72".split(" "),Pu:"Plutonium 7Act 20 f 94 [244] 1.87 2".split(" "),
Po:"Polonium 6 16 p 84 [210] 1.4 2".split(" "),K:"Potassium 4 1 s 19 39.098 2.03 2.75".split(" "),Pr:"Praseodymium 6Lan 19 f 59 140.908 2.03 2".split(" "),Pm:"Promethium 6Lan 19 f 61 [145] 1.99 2".split(" "),Pa:"Protactinium 7Act 20 f 91 231.036 2 2".split(" "),Ra:"Radium 7 2 s 88 [226] 2.21 2".split(" "),Rn:"Radon 6 18 p 86 [222] 1.5 2".split(" "),Re:"Rhenium 6 7 d 75 186.207 1.51 2".split(" "),Rh:"Rhodium 5 9 d 45 102.906 1.42 2".split(" "),Rb:"Rubidium 5 1 s 37 85.468 2.2 2".split(" "),Ru:"Ruthenium 5 8 d 44 101.07 1.46 2".split(" "),
Rf:"Rutherfordium 7 4 d 104 [261] 1.5 2".split(" "),Sm:"Samarium 6Lan 19 f 62 150.36 1.98 2".split(" "),Sc:"Scandium 4 3 d 21 44.956 1.7 2".split(" "),Sg:"Seaborgium 7 6 d 106 [266] 1.5 2".split(" "),Se:"Selenium 4 16 p 34 78.96 1.22 1.9".split(" "),Si:"Silicon 3 14 p 14 28.086 1.2 2.1".split(" "),Ag:"Silver 5 11 d 47 107.868 1.45 1.72".split(" "),Na:"Sodium 3 1 s 11 22.991 1.66 2.27".split(" "),Sr:"Strontium 5 2 s 38 87.62 1.95 2".split(" "),S:"Sulphur 3 16 p 16 32.066 1.02 1.8".split(" "),Ta:"Tantalum 6 5 d 73 180.948 1.7 2".split(" "),
Tc:"Technetium 5 7 d 43 [98] 1.47 2".split(" "),Te:"Tellurium 5 16 p 52 127.6 1.47 2.06".split(" "),Tb:"Terbium 6Lan 19 f 65 158.925 1.94 2".split(" "),Tl:"Thallium 6 13 p 81 204.383 1.45 1.96".split(" "),Th:"Thorium 7Act 20 f 90 232.038 2.06 2".split(" "),Tm:"Thulium 6Lan 19 f 69 168.934 1.9 2".split(" "),Sn:"Tin 5 14 p 50 118.71 1.39 2.17".split(" "),Ti:"Titanium 4 4 d 22 47.867 1.6 2".split(" "),W:"Tungsten 6 6 d 74 183.84 1.62 2".split(" "),U:"Uranium 7Act 20 f 92 238.029 1.96 1.86".split(" "),
V:"Vanadium 4 5 d 23 50.942 1.53 2".split(" "),Xe:"Xenon 5 18 p 54 131.29 1.5 2.16".split(" "),Yb:"Ytterbium 6Lan 19 f 70 173.04 1.87 2".split(" "),Y:"Yttrium 5 3 d 39 88.906 1.9 2".split(" "),Zn:"Zinc 4 12 d 30 65.39 1.22 1.39".split(" "),Zr:"Zirconium 5 4 d 40 91.224 1.75 2".split(" "),XXXX:["Unknown",null,null,null,null,null,"1.5","2"]};function bb(e){e=e[0].toUpperCase()+e.substr(1).toLowerCase();null==Ed[e]&&(e="XXXX");return Ed[e]}
function Fd(){Element.call(this);this.qj=!0;this.rc=this.Fc=null;this.Gf=!1}Fd.prototype=Object.create(Element.prototype);Fd.prototype.constructor=Fd;Fd.prototype.zd=function(){return this.rc};function Gd(e,f){if(e.Fc===f)return e.rc;if(e.rc===f)return e.Fc;console.warn(e.Fc,NaN+e.rc+":"+f);console.warn("Node "+f+" is not part of edge "+e.ta())}Fd.prototype.toString=function(){var e;e=""+this.Fc;e=this.Gf?e+"->":e+"--";return e+=this.rc};function Element(){this.Sd=this._id=null;this.Jg=[]}
Element.prototype.ta=function(){return this._id};Element.prototype.getAttributes=function(){return this.Jg};Element.prototype.getAttribute=function(e){return this.Jg[e]};Element.prototype.setAttribute=function(e,f){this.Jg[e]=f};function yb(){this.ca=this.ea=0;this.we=new Ca;this.u=new Ca;this.v=new Ca;this.od=new Ca}z=yb.prototype;z.clear=function(){this.we.clear();this.u.clear();this.v.clear();this.od.clear()};z.ak=function(){this.u.clear();this.od.clear()};
z.Tg=function(e,f){void 0===f&&(f=null);var g=new Node,h=f;void 0!==e&&(g._id=e);void 0!==this&&(g.Sd=this);void 0!==h&&null!==h&&(g.nd=h);null==g&&console.warn("Error : node undefined or null in Graph");g.Sd!==this&&console.warn("Error : node with id ",g," must belong to this in graph");h=this.we.get(g.ta());null!=h&&h!==g?console.warn("Error : node with id ",g.ta()," already exists in graph"):(this.we.set(g.ta(),g),this.v.Zc(g.nd)||this.v.set(g.nd,g));return g};
z.Mf=function(e){var f;do f=this.ea++;while(null!=this.we.get(f));return this.Tg(f,e)};z.values=function(){var e=[],f=!0,g=!1,h=void 0;try{for(var k=this.we.values()[Symbol.iterator](),m;!(f=(m=k.next()).done);f=!0)e.push(m.value.nd)}catch(l){g=!0,h=l}finally{try{!f&&k["return"]&&k["return"]()}finally{if(g)throw h;}}return e};z.findNode=function(e){return this.v.get(e)};
z.Rg=function(e,f,g){!0!==g&&(g=!1);var h;do h=this.ca++;while(null!=this.u.get(h));var k=g;!0!==k&&(k=!1);g=new Fd;void 0!==h&&(g._id=h);void 0!==this&&(g.Sd=this);this===e.Sd&&this===f.Sd||console.warn("Error : nodes ",g.Fc,", ",g.rc," and edge ",h," must all be part of same graph ",this);g.Fc=e;g.rc=f;!0!==k&&(k=!1);g.Gf=k;null===g&&console.warn("Error : edge is null in GRAPH");g.Sd!==this&&console.warn("Error : edge with id ",g," must belong to this in graph");e=this.u.get(g.ta());if(null!=e&&
e!==g)console.warn("Error : edge with id ",g.ta()," already exists in graph");else{this.u.set(g.ta(),g);e=[];e=e.concat(g.Fc);e=e.concat(g.rc);for(var m in e)f=this.od.get(e[m]),null===f&&(f=[],this.od.set(e[m],f)),f.push(g)}return g};z.wl=function(e){!0!==e.qj&&(e=this.u.get(e));var f=e;if(f.qj?null!==f&&this.u.get(f.ta())===f:null==this.u.get(f))this.u.remove(e.ta()),f=this.od.get(e.Fc),null!==f&&delete f[e],f=this.od.get(e.rc),null!==f&&delete f[e]};
z.bd=function(){var e=[],f=!0,g=!1,h=void 0;try{for(var k=this.u.values()[Symbol.iterator](),m;!(f=(m=k.next()).done);f=!0)e.push(m.value)}catch(l){g=!0,h=l}finally{try{!f&&k["return"]&&k["return"]()}finally{if(g)throw h;}}return e};function Node(){Element.call(this);this.nd=null}Node.prototype=Object.create(Element.prototype);z=Node.prototype;z.constructor=Node;z.bd=function(){return this.Sd.od.get(this)};
z.jj=function(e){a:{var f=this.bd();if(f)for(var g=f.length,h=0;h<g;h++)if(Gd(f[h],this)===e){e=h;break a}e=void 0}return void 0!==e};z.Kk=function(e){a:{var f=this.bd();if(f)for(var g=f.length,h=0;h<g;h++){var k=f[h];if(k.Gf&&k.Fc===e&&k.zd()===this){e=k;break a}}e=void 0}return void 0!==e};z.toString=function(){return this.ta()};z.Bb=function(){return this.ta()};z.Ck=function(e){var f=this.bd();if(f)for(var g=f.length,h=0;h<g;h++){var k=f[h];if(k.Gf&&k.Fc==this&&k.zd()==e)return k}};
function kb(e,f){this.u=Array(8);this.u[0]=new THREE.Vector3(e.x,e.y,e.z);this.u[1]=new THREE.Vector3(f.x,e.y,e.z);this.u[2]=new THREE.Vector3(e.x,f.y,e.z);this.u[3]=new THREE.Vector3(e.x,e.y,f.z);this.u[4]=new THREE.Vector3(f.x,f.y,e.z);this.u[5]=new THREE.Vector3(f.x,e.y,f.z);this.u[6]=new THREE.Vector3(e.x,f.y,f.z);this.u[7]=new THREE.Vector3(f.x,f.y,f.z)}z=kb.prototype;z.applyMatrix4=function(e){for(var f=this.u.length,g=0;g<f;g++)this.u[g].applyMatrix4(e);return this};
z.Ke=function(){for(var e=this.u[0].clone(),f=this.u.length,g=1;g<f;g++)e.min(this.u[g].clone());return e};z.Je=function(){for(var e=this.u[0].clone(),f=this.u.length,g=1;g<f;g++)e.max(this.u[g].clone());return e};function Hd(e){var f=e.Ke();e=e.Je();return f.add(e).multiplyScalar(.5)}z.length=function(){return Id(this).length()};function Id(e){var f=e.Ke();return e.Je().sub(f)}z.merge=function(e){var f=this.Ke(),g=this.Je();f.min(e.Ke());g.max(e.Je());return new kb(f,g)};
z.clone=function(){return new kb(this.Ke(),this.Je())};function Jd(e){this.u=new Ca;for(var f=e.length,g=0;g<f;g++){var h=e[g];this.u.set(h.getName(),h)}}Jd.prototype.be=function(e){return this.u.get(e)};function vc(e,f){this.ea=e;this.u=f;this.v=this.ca=null}function Kd(e,f){e.u=f;e.ca=null;e.v=null}vc.prototype.getName=function(){return this.ea};function Ld(e,f){if(null!==e.u&&(null===e.v&&Md(e),null!==e.v))return e.v[f];throw Error("Can't find index ",f," in sequence");}
vc.prototype.ja=function(){if(null!==this.u&&(null===this.ca&&Md(this),null!==this.ca))return this.ca[0];throw Error("Can't find index ",0," in sequence");};function Md(e){if(null!==e.u){var f=e.u.length;e.ca=Array(f);var g=0;e.v=Array(f);for(var h=0;h<f;h++){var k=e.u.charAt(h);"A"<=k&&"Z">=k||"a"<=k&&"z">=k?(e.ca[g]=h,e.v[h]=g,g++):e.v[h]=-1}e.ca=e.ca.slice(0,g)}else e.v=null}function uc(e){e?this.v=e:this.v=Nd;this.u=null;this.ea=this.ja=NaN}
var Pd=new Od("ABCDEFGHIKLMNPQRSTVWXYZ",[[24,0,5,-3,0,-23,5,-8,-8,-4,-12,-7,-3,3,-2,-6,11,6,1,-36,0,-22,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[5,0,115,-32,-30,-8,-20,-13,-11,-28,-15,-9,-18,-31,-24,-22,1,-5,0,-10,0,-5,0],[-3,0,-32,47,27,-45,1,4,-38,5,-40,-30,22,-7,9,-3,5,0,-29,-52,0,-28,0],[0,0,-30,27,36,-39,-8,4,-27,12,-28,-20,9,-5,17,4,2,-1,-19,-43,0,-27,0],[-23,0,-8,-45,-39,70,-52,-1,10,-33,20,16,-31,-38,-26,-32,-28,-22,1,36,0,51,0],[5,0,-20,1,-8,-52,66,-14,-45,-11,-44,-35,4,-16,-10,
-10,4,-11,-33,-40,0,-40,0],[-8,0,-13,4,4,-1,-14,60,-22,6,-19,-13,12,-11,12,6,-2,-3,-20,-8,0,22,0],[-8,0,-11,-38,-27,10,-45,-22,40,-21,28,25,-28,-26,-19,-24,-18,-6,31,-18,0,-7,0],[-4,0,-28,5,12,-33,-11,6,-21,32,-21,-14,8,-6,15,27,1,1,-17,-35,0,-21,0],[-12,0,-15,-40,-28,20,-44,-19,28,-21,40,28,-30,-23,-16,-22,-21,-13,18,-7,0,0,0],[-7,0,-9,-30,-20,16,-35,-13,25,-14,28,43,-22,-24,-10,-17,-14,-6,16,-10,0,-2,0],[-3,0,-18,22,9,-31,4,12,-28,8,-30,-22,38,-9,7,3,9,5,-22,-36,0,-14,0],[3,0,-31,-7,-5,-38,-16,
-11,-26,-6,-23,-24,-9,76,-2,-9,4,1,-18,-50,0,-31,0],[-2,0,-24,9,17,-26,-10,12,-19,15,-16,-10,7,-2,27,15,2,0,-15,-27,0,-17,0],[-6,0,-22,-3,4,-32,-10,6,-24,27,-22,-17,3,-9,15,47,-2,-2,-20,-16,0,-18,0],[11,0,1,5,2,-28,4,-2,-18,1,-21,-14,9,4,2,-2,22,15,-10,-33,0,-19,0],[6,0,-5,0,-1,-22,-11,-3,-6,1,-13,-6,5,1,0,-2,15,25,0,-35,0,-19,0],[1,0,0,-29,-19,1,-33,-20,31,-17,18,16,-22,-18,-15,-20,-10,0,34,-26,0,-11,0],[-36,0,-10,-52,-43,36,-40,-8,-18,-35,-7,-10,-36,-50,-27,-16,-33,-35,-26,142,0,41,0],[0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-22,0,-5,-28,-27,51,-40,22,-7,-21,0,-2,-14,-31,-17,-18,-19,-19,-11,41,0,78,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]),Qd=new Od("ARNBDCQZEGHILKMFPSTWYVX*",[[1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,
-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,
-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,
-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,
-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,
-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,0,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,
-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,0]]),Nd=Pd;
uc.prototype.align=function(e){if(0===e.length)return new Jd;for(var f=e.length,g=0;g<f;g++){var h=e[g];Kd(h,h.u.toUpperCase())}if(2===e.length){var f=e[0].u,g=e[1].u,k=this.v.clone(),h=0;this.v===Nd?h=10:this.v===Qd&&(h=100);for(var m=h,l=k.ob.length,q=0;q<l;q++)for(var r=k.ob[q].length,t=0;t<r;t++)k.ob[q][t]*=m;k=this.u=k;m=k.ob.length-1;l=0;q=k.ob.length;for(r=0;r<q;r++)for(t=0;t<=r;t++)r!==t&&(l+=k.ob[r][t]);this.ja=0>=-(l/((m*m-m)/2))?2*(10+Math.log(Math.min(f.length,g.length)))*h:2*(10+Math.log(Math.min(f.length,
g.length)));this.ea=.1*h;var h=f.length,k=g.length,x=this.ca(2,k),m=this.ca(h,k),w=[k];w.fill(0);for(var B=Number.MIN_VALUE,q=l=-1,r=0;r<h;r++){for(t=0;t<k;t++)if(0===r||0===t)x[1][t]=this.u.getValue(f.charAt(r),g.charAt(t)),0===r&&0!==t&&(x[1][t]-=Rd(this,r,h,2===w[t-1]),w[t]=2),0===t&&0!==r&&(x[1][t]-=Rd(this,t,k,1===w[t]),w[t]=1),m[r][t]=0;else{var D=x[0][t-1]+this.u.getValue(f.charAt(r),g.charAt(t)),E=x[1][t-1]-Rd(this,r,h,2===w[t-1]),I=x[0][t]-Rd(this,t,k,1===w[t]);x[1][t]=Math.max(Math.max(D,
E),I);if(x[1][t]===D)m[r][t]=1,w[t]=0;else if(x[1][t]===E)m[r][t]=3,w[t]=2;else if(x[1][t]===I)m[r][t]=2,w[t]=1;else throw"Error when filling traceback matrix";(r===h-1||t===k-1)&&x[1][t]>B&&(B=x[1][t],l=r,q=t)}t=x[0];x[0]=x[1];x[1]=t}w=x="";r=h-1;for(t=k-1;r>l&&0<=r;)x+=f.charAt(r),w+="-",r--;for(;t>q&&0<=t;)x+="-",w+=g.charAt(t),t--;for(;0<=r&&0<=t;)0<r&&3===m[r][t]?(x+="-",w+=g.charAt(t),t--):0<t&&2===m[r][t]?(x+=f.charAt(r),w+="-",r--):(x+=f.charAt(r),w+=g.charAt(t),r--,t--);for(;0<=r;)x+=f.charAt(r),
w+="-",r--;for(;0<=t;)x+="-",w+=g.charAt(t),t--;f=[x.split("").reverse().join(""),w.split("").reverse().join("")];Kd(e[0],f[0]);Kd(e[1],f[1]);e=new Jd(e)}else throw"Alignment must be computed with only 2 sequences, for advanced alignement, use Bioviz Java";return e};uc.prototype.ca=function(e){var f=Array(e||0),g=e;if(1<arguments.length)for(var h=Array.prototype.slice.call(arguments,1);g--;)f[e-1-g]=this.ca.apply(this,h);return f};function Rd(e,f,g,h){return 0===f||f===g-1?0:h?e.ea:e.ja}
function Od(e,f){this.v=e;this.u=new Ca;this.ob=f}Od.prototype.setValue=function(e){this.ob=e.slice(0)};Od.prototype.getValue=function(e,f){return this.u.Zc(e)&&this.u.Zc(f)?this.ob[this.u.get(e)][this.u.get(f)]:0};Od.prototype.clone=function(){var e=new Od;e.setValue(this.ob);var f=this.v;e.v=f;for(var g=f.length,h=0;h<g;h++)e.u.set(f[h],h);return e};function Sd(){this.ca=this.v=null;this.u=NaN}
Sd.prototype.align=function(e,f){this.ca=this.v=null;this.u=NaN;if(e&&f)if(e!==f){var g=e.Bd()?new uc:new uc(Qd),h=[];h.push(Td("SRC:",e));h.push(Td("DST:",f));this.v=g.align(h);var g=Ud(e,this.v.be("SRC:"+e.toString())),h=Ud(f,this.v.be("DST:"+f.toString())),k;if(null===g||null===h||g.length!==h.length)throw"Illegal argument exception";var m=[];k=[];for(var l=g.length,q=0;q<l;q++){var r=g[q],t=h[q];null!==r&&null!==t&&(m.push([r.x,r.y,r.z]),k.push([t.x,t.y,t.z]))}k=[m,k];m=k[0];k=k[1];if(3>g.length)console.error("Need at least 3 paired coordinates. Found only "+
g.length);else{k=numeric.transpose(k);k=numeric.dot(k,m);m=numeric.svd(k);k=[[1,0,0],[0,1,0],[0,0,Math.sign(numeric.det(k))]];k=numeric.dot(numeric.dot(m.V,k),numeric.transpose(m.U));m=new THREE.Matrix4;m.set(k[0][0],k[1][0],k[2][0],0,k[0][1],k[1][1],k[2][1],0,k[0][2],k[1][2],k[2][2],0,0,0,0,1);this.u=0;k=g.length;for(l=0;l<k;l++)r=g[l],q=h[l],null!==r&&null!==q&&(r=r.clone().applyMatrix4(m),q=q.clone(),this.u+=r.distanceToSquared(q));this.ca=m;this.u=Math.sqrt(this.u/g.length)}}else console.warn("Same src and dst molecule, resolving alignement"),
g=[],g.push(Td("SRC:",e)),g.push(Td("DST:",f)),this.v=new Jd(g),this.ca=new THREE.Matrix4,this.u=0;else console.error("Source ("+e+") or dest ("+f+") is not a polymer")};function Ud(e,f){for(var g=[],h=e.ga.slice(0),k=f.u,m=e.Wa(),l=e.Bd()?"CA":"C4'",q=k.length,r=0;r<q;r++)if("-"!=k.charAt(r)){var t=h[Ld(f,r)].jc(l);if(null!==t){var x=new THREE.Vector3;x.subVectors(t.pos,m);g.push(x)}else g.push(null)}else g.push(null);return g}
function Td(e,f){return new vc((null!==e?e:"")+f.toString(),f.be(!1))}function Sb(e,f,g){this.Ua=e;this.Sa=f;this.Xa=new THREE.Vector3((e.x+f.x)/2,(e.y+f.y)/2,(e.z+f.z)/2);this.Da=null;this.Dc=g;void 0===g&&(this.Dc=32);this.ob=[]}z=Sb.prototype;
z.add=function(e){if(e.bl){var f=e.Kf.pos;Vd(this,f)||console.warn("Error : "+f+" can't fit into [ "+this.Ua+" , "+this.Sa+" ]");if(null==this.Da){if(this.ob.push(e),this.ob.length>this.Dc){null!=this.Da&&console.warn("Error : This octant was already split ");this.Da=[];this.Da.push(new Sb(new THREE.Vector3(this.Ua.x,this.Ua.y,this.Ua.z),new THREE.Vector3(this.Xa.x,this.Xa.y,this.Xa.z),this.Dc));this.Da.push(new Sb(new THREE.Vector3(this.Xa.x,this.Ua.y,this.Ua.z),new THREE.Vector3(this.Sa.x,this.Xa.y,
this.Xa.z),this.Dc));this.Da.push(new Sb(new THREE.Vector3(this.Ua.x,this.Xa.y,this.Ua.z),new THREE.Vector3(this.Xa.x,this.Sa.y,this.Xa.z),this.Dc));this.Da.push(new Sb(new THREE.Vector3(this.Xa.x,this.Xa.y,this.Ua.z),new THREE.Vector3(this.Sa.x,this.Sa.y,this.Xa.z),this.Dc));this.Da.push(new Sb(new THREE.Vector3(this.Ua.x,this.Ua.y,this.Xa.z),new THREE.Vector3(this.Xa.x,this.Xa.y,this.Sa.z),this.Dc));this.Da.push(new Sb(new THREE.Vector3(this.Xa.x,this.Ua.y,this.Xa.z),new THREE.Vector3(this.Sa.x,
this.Xa.y,this.Sa.z),this.Dc));this.Da.push(new Sb(new THREE.Vector3(this.Ua.x,this.Xa.y,this.Xa.z),new THREE.Vector3(this.Xa.x,this.Sa.y,this.Sa.z),this.Dc));this.Da.push(new Sb(new THREE.Vector3(this.Xa.x,this.Xa.y,this.Xa.z),new THREE.Vector3(this.Sa.x,this.Sa.y,this.Sa.z),this.Dc));e=0;f=this.ob.length;a:for(;e<f;e++)for(var g=this.ob[e],h=g.Kf.pos,k=0,m=this.Da.length;k<m;k++){var l=this.Da[k];if(Vd(l,h)){l.add(g);continue a}}this.ob=[]}}else for(g=0,h=this.Da.length;g<h;g++)if(k=this.Da[g],
Vd(k,f)){k.add(e);break}}else if(0<e.length)for(g=0,h=e.length;g<h;g++)this.add(e[g])};z.optimize=function(){if(null!=this.Da){for(var e=0,f=0,g=this.Da.length;f<g;f++){var h=this.Da[f];h.optimize();h.isEmpty()&&null==h.Da&&(this.Da[f]=null,e++)}if(0!==e)if(e===this.Da.length)this.Da=[];else for(e=this.Da.slice(),this.Da=[],f=0,g=e.length;f<g;f++)h=e[f],null!=h&&this.Da.push(h)}};z.isEmpty=function(){return 0===this.ob.length};
function Vd(e,f){return f.x>=e.Ua.x&&f.y>=e.Ua.y&&f.z>=e.Ua.z&&f.x<=e.Sa.x&&f.y<=e.Sa.y&&f.z<=e.Sa.z}
z.lh=function(e,f,g){g=g||[];var h;if(h=!Vd(this,e)){var k=h=0,m=0;e.x<this.Ua.x?h=e.x-this.Ua.x:e.x>this.Sa.x&&(h=e.x-this.Sa.x);e.y<this.Ua.y?k=e.y-this.Ua.y:e.y>this.Sa.y&&(k=e.y-this.Sa.y);e.z<this.Ua.z?m=e.z-this.Ua.z:e.z>this.Sa.z&&(m=e.z-this.Sa.z);h=!(0<f*f-(h*h+k*k+m*m))}if(h)return g;if(null!=this.Da)for(h=0,k=this.Da.length;h<k;h++)this.Da[h].lh(e,f,g);else for(h=0,k=this.ob.length;h<k;h++)m=this.ob[h],m.getPoint().distanceToSquared(e)<=f*f&&g.push(m);return g};
z.trace=function(){var e=0;void 0===e&&(e=0);for(var f=0;f<e;f++)console.log(f==e-1?"\u2514-":"  ");console.log(this.toString()+": "+this.ob.length);if(null!=this.Da){e++;for(var g in this.Da)this.Da[g].trace(e)}};z.toString=function(){return"[("+this.Ua.x+","+this.Ua.y+","+this.Ua.z+"),("+this.Sa.x+","+this.Sa.y+","+this.Sa.z+")]"};function gc(e){this.bl=!0;this.Kf=e}gc.prototype.getPoint=function(){return this.Kf};gc.prototype.toString=function(){return this.Kf.toString()};
function Wd(e,f,g,h){this.ia=null;this.ee=f;this.em=e;this.dm=g;this.al=null!=h?h:!1;this.zg=new Worker("webworker.js");this.blob=null}Wd.prototype.load=function(){var e=this;return new Promise(function(f,g){e.zg.onmessage=function(h){h.Nf=e.dm;if(h.data instanceof Blob)e.blob=h.data;else{var k=JSON.parse(h.data);k.el?(k.__proto__=dd.prototype,e.ia=k,e.ia.blob=e.blob):"error"===k.type?g(Error(k.msg)):(e.ia.kk(k),null!=h.Nf&&e.ia.lc(h.Nf),e.zg.terminate(),f(e.ia))}};e.zg.postMessage([e.em,e.ee,e.al])})};
function Xd(e,f){this.eb=f;this.renderer=e;this.Hd=new THREE.WebGLRenderTarget(this.eb.width(),this.eb.height(),{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat});this.Hd.depthTexture=new THREE.DepthTexture;this.Hd.texture.generateMipmaps=!1;this.Hd.stencilBuffer=!1;this.Rd=new THREE.WebGLRenderTarget(this.eb.width(),this.eb.height(),{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat});this.Rd.depthTexture=new THREE.DepthTexture;
this.Rd.texture.generateMipmaps=!1;this.Rd.stencilBuffer=!1;jd.Vc.bind(this.Hd,this.eb);jd.Vc.bind(this.Rd,this.eb);this.dh=new THREE.ShaderMaterial({uniforms:{tOpaque:{type:"t",value:this.Hd.texture},tTransparent:{type:"t",value:this.Rd.texture},tOpaqueDepth:{type:"t",value:this.Hd.depthTexture},tTransparentDepth:{type:"t",value:this.Rd.depthTexture},cameraNear:{type:"f",value:null},cameraFar:{type:"f",value:null}},vertexShader:THREE.ShaderChunk.transparencyQuad_vert,fragmentShader:THREE.ShaderChunk.transparencyQuad_frag});
this.ul=new THREE.OrthographicCamera(-1,1,1,-1,0,1);this.yj=new THREE.Scene;this.yj.add(new THREE.Mesh(new THREE.PlaneGeometry(2,2),this.dh))}
Xd.prototype.render=function(e,f){this.renderer.clearTarget(this.Hd);this.renderer.clearTarget(this.Rd);var g=new Map;e.traverse(function(e){e.material&&(g.set(e.id,e.visible),e.material.transparent&&(e.visible=!1))});this.renderer.render(e,f,this.Hd);e.traverse(function(e){e.material&&(e.material.transparent||(e.visible=!1),e.material.transparent&&(e.visible=g.get(e.id)))});this.renderer.render(e,f,this.Rd);e.traverse(function(e){e.material&&!e.material.transparent&&(e.visible=g.get(e.id))});this.dh.uniforms.cameraNear.value=
f.near;this.dh.uniforms.cameraFar.value=f.far;this.renderer.render(this.yj,this.ul)};function Yd(e,f,g,h){var k=1;void 0!==h&&(k=h);var m=e.ad();h=e.ub().length()/2;var l=new THREE.Matrix4;l.copy(e.matrixWorld);e=new THREE.Matrix4;e.makeTranslation(m.x,m.y,m.z);l.multiply(e);e=new THREE.Matrix4;e.makeTranslation(-l.elements[12],-l.elements[13],-l.elements[14]);e.multiply(f.scene.matrix);e.elements[14]=g?e.elements[14]-(1/k*h*2-f.camera.position.z):f.scene.matrix.elements[14];return e}
function Zd(e,f){var g=new THREE.Vector4(e.x,e.y,e.z,1),h=new THREE.Vector4(f.normal.x,f.normal.y,f.normal.z,f.constant);return g.dot(h)}
function $d(e,f,g,h){if(0===f.length)return null;var k=new THREE.Raycaster;k.linePrecision=.2;k.params.Points.threshold=2.75;var m=e.Kh,l=e.kh;g=new THREE.Vector2(g,h);k.setFromCamera(g,e.camera);f=k.intersectObjects(f);if(g=f.length){e=null;h=Infinity;for(var q=0;q<g;q++){var r=f[q],t=r.object,x=r.distance,w=t.geometry,B=null!=r.index?r.index:r.face.a;if(t instanceof THREE.Points){var x=w.attributes.radius.array[B],D=w.attributes.position.array,E=new THREE.Vector3;E.fromArray(D,3*B);w=w.attributes.dir;
D=new THREE.Vector3;w&&D.fromArray(w.array,3*B);if(0===D.length())B=new THREE.Sphere(E,x),B.applyMatrix4(t.matrixWorld),t=k.ray.intersectSphere(B);else{B=new THREE.Dg(E,D,x);B.applyMatrix4(t.matrixWorld);t=k.ray;x=B;w=t.origin;E=t.direction;E.normalize();D=x.radius;B=x.ud;t=x.direction.length();x=x.direction.clone();x.normalize();var I=(new THREE.Vector3).crossVectors(E,x);if(1E-4>=I.length())console.warn("May need to resolve equation when cylinder direction and ray direction colinear"),t=null;else{var H=
I.clone().normalize(),K=(new THREE.Vector3).subVectors(w,B),G=Math.abs(K.dot(H));G>D?t=null:(I=-K.clone().cross(x).dot(H)/I.length(),H=(new THREE.Vector3).crossVectors(H,x),H.normalize(),G=Math.abs(Math.sqrt(D*D-G*G)/E.dot(H)),D=I-G,G=I+G,D>G&&(I=D,D=G,G=I),D=(new THREE.Vector3).addVectors(w,E.clone().multiplyScalar(D)),w=(new THREE.Vector3).addVectors(w,E.clone().multiplyScalar(G)),E=(new THREE.Vector3).subVectors(D,B).dot(x),B=(new THREE.Vector3).subVectors(w,B).dot(x),t=E<=t&&0<=E?D:B<=t&&0<=B?
w:null)}}!t||0>Zd(t,m)||0>Zd(t,l)||(t=t.distanceTo(k.ray.origin),t<h&&(e=r,h=t))}else!(0>Zd(r.point,m)||0>Zd(r.point,l))&&x<h&&(e=r,h=x)}if(e){k=e.object;w=k.geometry;if(w instanceof THREE.Geometry)return w.vertices[e.face.a].qa;if(w instanceof THREE.BufferGeometry)return k.Ia.ma[w.attributes.atomIndex.array[null!=e.index?e.index:e.face.a]];console.warn("Unknown type of geometry for raycasting real object")}}return null}
function ld(e,f){var g=NaN,h=Yd(e,e,!0),k=e.ub().clone(),g=Id(k).length(),h=Hd(k.applyMatrix4(h)),h=Math.abs(f.position.z-h.z)+.5*g,g=Math.max(Math.jh(2*Math.atan(g/(2*h))),Math.jh(2*Math.atan(Math.tan(2*Math.atan(g/(2*h))/2)/f.aspect)));isNaN(g)&&(g=Math.jh(2*Math.atan(Math.tan(Math.vl()/2)*f.aspect)));return g}
function ae(e,f){var g=new THREE.SpriteMaterial({map:e});g.depthTest=!1;g.depthWrite=!1;var h=g.map.image.width,k=g.map.image.height,g=new THREE.Sprite(g);g.position.set(f.x,f.y,f.z);g.scale.set(h/40,k/40,1);return g}function be(e){this.geometry=new THREE.BufferGeometry;this.pc=[];this.ff=e?[]:null;this.Lg=[];this.Pg=[];this.Wc=[];this.ue=null;this.Qg=new Map}
function ce(e,f,g,h,k,m){e.pc.push(f,g,h);f=null!=k?k:new THREE.Color(1,1,1);e.Lg.push(f.r,f.g,f.b);m=null!=m?m:new THREE.Vector2(0,1);e.Pg.push(m.x,m.y)}function de(e,f,g,h){null!=e.ff?e.ff.push(f,g,h):console.warn("This BufferGeometry is not indexed")}be.prototype.dd=function(){this.ue=Array(this.pc.length/3);this.ue.fill(0);return this.ue};
THREE.BufferGeometry.prototype.dd=function(){var e=Array(this.attributes.position.count);e.fill(0);e=new Float32Array(e);this.addAttribute("highlight",new THREE.BufferAttribute(e,1))};
function ee(e){null==e.ue&&e.dd();e.geometry.addAttribute("position",THREE.Float32Attribute(e.pc,3));e.pc=void 0;null!=e.ff&&(e.geometry.setIndex(THREE.Uint32Attribute(e.ff,1)),e.ff=void 0);var f=THREE.Float32Attribute(e.Lg,3);f.dynamic=!0;e.geometry.addAttribute("color",f);e.Lg=void 0;e.geometry.addAttribute("highlight",THREE.Float32Attribute(e.ue,1));e.ue=void 0;e.geometry.addAttribute("uv",THREE.Float32Attribute(e.Pg,2));e.Pg=void 0;e.geometry.addAttribute("atomIndex",THREE.Float32Attribute(e.Wc,
1));e.Wc=void 0;e.geometry.computeVertexNormals();e.geometry.normalizeNormals();return e.geometry}THREE.Dg=function(e,f,g){this.ud=void 0!==e?e:new THREE.Vector3;this.direction=void 0!==f?f:new THREE.Vector3;this.radius=void 0!==g?g:0};
THREE.Dg.prototype={constructor:THREE.Dg,set:function(e,f,g){this.ud.copy(e);this.direction.copy(f);this.radius=g;return this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.ud.copy(e.ud);this.direction.copy(e.direction);this.radius=e.radius;return this},empty:function(){return 0>=this.radius||0===this.direction.length()},containsPoint:function(){console.error("THREE.Cylinder.containsPoint not implemented yet")},distanceToPoint:function(){console.error("THREE.Cylinder.distanceToPoint not implemented yet")},
clampPoint:function(){console.error("THREE.Cylinder.clampPoint not implemented yet")},applyMatrix4:function(e){this.ud.applyMatrix4(e);var f=(new THREE.Matrix4).extractRotation(e);this.direction.applyMatrix4(f);this.radius=this.radius*e.getMaxScaleOnAxis();return this},translate:function(e){this.ud.add(e);return this},equals:function(e){return e.ud.equals(this.ud)&&e.radius===this.radius&&e.direction.equals(this.direction)}};
function fe(e){null===e.boundingSphere&&(e.boundingSphere=new THREE.Sphere);var f=new THREE.Box3,g=new THREE.Vector3,h=e.attributes.position;if(h){var h=h.array,k=e.attributes.radius.array,m=e.boundingSphere.center;f.setFromArray(h);f.center(m);for(var l=f=0,q=h.length;l<q;l+=3)g.fromArray(h,l),f=Math.max(f,m.distanceTo(g)+k[l/3]);e.boundingSphere.radius=f;isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',
e)}}Math.vl=function(){return 22.5*Math.PI/180};Math.jh=function(e){return 180*e/Math.PI};THREE.Vector3.prototype.Bb=function(){return this.x+":"+this.y+":"+this.z};function ge(e,f){var g=new THREE.Vector3;g.x=f.x*e.elements[0];g.y=f.x*e.elements[1];g.z=f.x*e.elements[2];g.x+=f.y*e.elements[4];g.y+=f.y*e.elements[5];g.z+=f.y*e.elements[6];g.x+=f.z*e.elements[8];g.y+=f.z*e.elements[9];g.z+=f.z*e.elements[10];return g}
function he(e,f,g,h,k){var m=Math.sqrt(g*g+h*h+k*k);0==m&&(m=.01);g/=m;h/=m;k/=m;m=Math.sin(f);f=Math.cos(f);var l=1-f;e.elements[0]=l*g*g+f;e.elements[4]=l*g*h-m*k;e.elements[8]=l*g*k+m*h;e.elements[1]=l*h*g+m*k;e.elements[5]=l*h*h+f;e.elements[9]=l*h*k-m*g;e.elements[2]=l*k*g-m*h;e.elements[6]=l*k*h+m*g;e.elements[10]=l*k*k+f;e.elements[3]=0;e.elements[7]=0;e.elements[11]=0;e.elements[12]=0;e.elements[13]=0;e.elements[14]=0;e.elements[15]=1}
THREE.Matrix4.prototype.lerp=function(e,f,g){var h=new THREE.Matrix4;h.copy(e);h.elements[12]=e.elements[12]+g*(f.elements[12]-e.elements[12]);h.elements[13]=e.elements[13]+g*(f.elements[13]-e.elements[13]);h.elements[14]=e.elements[14]+g*(f.elements[14]-e.elements[14]);this.copy(h)};
THREE.Matrix4.prototype.slerp=function(e,f,g){var h=ie(e),h=e.normalize(h);e=ie(f);e=f.normalize(e);var k=h[0]*e[0]+h[1]*e[1]+h[2]*e[2]+h[3]*e[3];0>k&&(e[0]=-e[0],e[1]=-e[1],e[2]=-e[2],e[3]=-e[3],k=-k);f=1-g;var m=g;.1<1-k&&(m=Math.acos(k),k=1/Math.sin(m),f=Math.sin((1-g)*m)*k,m=Math.sin(g*m)*k);g=[];g.push(f*h[0]+m*e[0]);g.push(f*h[1]+m*e[1]);g.push(f*h[2]+m*e[2]);g.push(f*h[3]+m*e[3]);this.setFromQuaternion(g)};
function ie(e){var f=e.elements[0]+e.elements[5]+e.elements[10],g,h,k;if(0<=f){var m=Math.sqrt(f+1);k=.5*m;m=.5/m;f=(e.elements[9]-e.elements[6])*m;g=(e.elements[2]-e.elements[8])*m;h=(e.elements[4]-e.elements[1])*m}else e.elements[0]>e.elements[5]&&e.elements[0]>e.elements[10]?(m=Math.sqrt(1+e.elements[0]-e.elements[5]-e.elements[10]),f=.5*m,m=.5/m,g=(e.elements[4]+e.elements[1])*m,h=(e.elements[2]+e.elements[8])*m,k=(e.elements[9]-e.elements[6])*m):e.elements[5]>e.elements[10]?(m=Math.sqrt(1+e.elements[5]-
e.elements[0]-e.elements[10]),g=.5*m,m=.5/m,f=(e.elements[4]+e.elements[1])*m,h=(e.elements[9]+e.elements[6])*m,k=(e.elements[2]-e.elements[8])*m):(m=Math.sqrt(1+e.elements[10]-e.elements[0]-e.elements[5]),h=.5*m,m=.5/m,f=(e.elements[2]+e.elements[8])*m,g=(e.elements[9]+e.elements[6])*m,k=(e.elements[4]-e.elements[1])*m);return[f,g,h,k]}
THREE.Matrix4.prototype.setFromQuaternion=function(e){this.setPosition(new THREE.Vector3(0,0,0));var f=je(e),f=1==f?2:0<f?2/f:0,g=e[0]*f,h=e[1]*f,k=e[2]*f,f=e[0]*g,m=e[0]*h,l=e[0]*k,g=e[3]*g,q=e[1]*h,r=e[1]*k,h=e[3]*h,t=e[2]*k;e=e[3]*k;this.elements[0]=1-(q+t);this.elements[1]=m-e;this.elements[2]=l+h;this.elements[4]=m+e;this.elements[5]=1-(f+t);this.elements[6]=r-g;this.elements[8]=l-h;this.elements[9]=r+g;this.elements[10]=1-(f+q)};
function je(e){return e[3]*e[3]+e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}THREE.Matrix4.prototype.normalize=function(e){var f=1/Math.sqrt(je(e));e[0]*=f;e[1]*=f;e[2]*=f;e[3]*=f;return e};THREE.Vector3.prototype.qb=function(e,f){return new THREE.Vector3(this.x+e.x*f,this.y+e.y*f,this.z+e.z*f)};
THREE.Vector3.u=function(e,f,g){if(e.yh&&f.yh&&g.yh){var h=new THREE.Vector3(f.x,f.y,f.z);h.sub(new THREE.Vector3(e.x,e.y,e.z));h.cross((new THREE.Vector3(g.x,g.y,g.z)).sub(new THREE.Vector3(f.x,f.y,f.z)))}else h=new THREE.Vector3,h.copy(f),h.sub(e),h.cross(g.clone().sub(f));return h};
THREE.Vector3.ca=function(e,f,g,h,k){var m=k*k,l=m*k;if(null===e||null===f||null===g||null===h)return null;var q=null,r=null,q=f.clone().sub(e).add(g.clone().sub(f)).multiplyScalar(.5),r=g.clone().sub(f).add(h.clone().sub(g)).multiplyScalar(.5);e=2*l-3*m+1;k=l-2*m+k;h=l-m;m=-2*l+3*m;return f.clone().multiplyScalar(e).qb(q,k).qb(r,h).qb(g,m)};THREE.Vector3.wc=function(e,f,g){return null===e|null===f?new THREE.Vector3:e.clone().multiplyScalar(1-g).qb(f,g)};
function ke(e,f,g){return Math.atan2(e.clone().dot(g),e.clone().dot(f))}THREE.Vector3.v=function(e,f,g){return e.clone().multiplyScalar(Math.cos(g)).qb(f,Math.sin(g))};function le(e){var f=Math.abs(e.x),g=Math.abs(e.y),h=Math.abs(e.z);return f<=g&&f<=h?e.clone().cross(new THREE.Vector3(1,0,0)).normalize():g<=f&&g<=h?e.clone().cross(new THREE.Vector3(0,1,0)).normalize():e.clone().cross(new THREE.Vector3(0,0,1)).normalize()}
function me(e,f,g,h){var k=le(e);e=e.clone().cross(k).normalize();var m=f.length(),l=g.length();f=ke(f,k,e);g=ke(g,k,e);Math.abs(f-g)>Math.PI&&(g<f?g+=2*Math.PI:f+=2*Math.PI);g=THREE.Math.wc(f,g,h);h=THREE.Math.wc(m,l,h);return THREE.Vector3.v(k,e,g).multiplyScalar(h)}THREE.Color.wc=function(e,f,g){return null===e|null===f?null:e.clone().multiplyScalar(1-g).qb(f,g)};THREE.Color.prototype.qb=function(e,f){return new THREE.Color(this.r+e.r*f,this.g+e.g*f,this.b+e.b*f)};
THREE.Math.wc=function(e,f,g){return e*(1-g)+f*g};THREE.GeometryUtils.qk=function(e,f,g,h,k,m,l,q,r,t,x,w,B,D,E,I){var H=k*f-e*m,K=r*f-e*t;e=B*f-e*D;f=r*m-k*t;k=B*m-k*D;r=B*t-r*D;return(r*l-k*x+f*E)*h-(r*g-e*x+K*E)*q+(k*g-e*l+H*E)*w-(f*g-K*l+H*x)*I};THREE.GeometryUtils.Wl=function(e,f,g,h){return THREE.GeometryUtils.Xl(e.x,e.y,e.z,e.weight,f.x,f.y,f.z,f.weight,g.x,g.y,g.z,g.weight,h.x,h.y,h.z,h.weight)};THREE.GeometryUtils.nf=function(e,f,g,h,k,m,l,q,r){return(e*k-h*f)*r-(e*q-l*f)*m+(h*q-l*k)*g};
THREE.GeometryUtils.$c=function(e,f,g,h){return e*h-g*f};
THREE.GeometryUtils.Xl=function(e,f,g,h,k,m,l,q,r,t,x,w,B,D,E,I){k=k-e;m=m-f;l=l-g;q=THREE.GeometryUtils.square(k)+THREE.GeometryUtils.square(m)+THREE.GeometryUtils.square(l)-q+h;r=r-e;t=t-f;x=x-g;w=THREE.GeometryUtils.square(r)+THREE.GeometryUtils.square(t)+THREE.GeometryUtils.square(x)-w+h;e=B-e;f=D-f;g=E-g;D=THREE.GeometryUtils.square(e)+THREE.GeometryUtils.square(f)+THREE.GeometryUtils.square(g)-I+h;I=THREE.GeometryUtils.nf(m,l,q,t,x,w,f,g,D);E=THREE.GeometryUtils.nf(k,l,q,r,x,w,e,g,D);q=THREE.GeometryUtils.nf(k,
m,q,r,t,w,e,f,D);k=THREE.GeometryUtils.nf(k,m,l,r,t,x,e,f,g);if(0===k)throw"den==0 in squared_radius_orthogonal_sphereC3_detailedParams";return(THREE.GeometryUtils.square(I)+THREE.GeometryUtils.square(E)+THREE.GeometryUtils.square(q))*THREE.GeometryUtils.square(.5/k)-h};THREE.GeometryUtils.square=function(e){return e*e};THREE.GeometryUtils.lj=function(e,f,g,h){return THREE.GeometryUtils.Wk(e.x,e.y,e.z,e.weight,f.x,f.y,f.z,f.weight,g.x,g.y,g.z,g.weight,h.x,h.y,h.z,h.weight)};
THREE.GeometryUtils.Wk=function(e,f,g,h,k,m,l,q,r,t,x,w,B,D,E,I){k=k-e;m=m-f;l=l-g;r=r-e;t=t-f;x=x-g;var H=THREE.GeometryUtils.square(k)+THREE.GeometryUtils.square(m)+THREE.GeometryUtils.square(l),K=THREE.GeometryUtils.square(r)+THREE.GeometryUtils.square(t)+THREE.GeometryUtils.square(x),G=k*r+m*t+l*x,L=H-q+h,P=K-w+h;w=THREE.GeometryUtils.$c(H,G,G,K);q=THREE.GeometryUtils.$c(L,G,P,K);H=THREE.GeometryUtils.$c(H,L,G,P);e=B-e;f=D-f;g=E-g;E=THREE.GeometryUtils.square(e)+THREE.GeometryUtils.square(f)+
THREE.GeometryUtils.square(g);if(0==w)throw"den==0 in in_sphere_detailedParams";return THREE.GeometryUtils.sign(w*(E-I+h)-q*(e*k+f*m+g*l)-H*(e*r+f*t+g*x))};THREE.GeometryUtils.sign=function(e){return 0<e?1:0>e?-1:0};
THREE.GeometryUtils.Zl=function(e,f,g,h,k,m,l,q,r,t,x,w){k=k-e;m=m-f;l=l-g;q=THREE.GeometryUtils.square(k)+THREE.GeometryUtils.square(m)+THREE.GeometryUtils.square(l)-q+h;e=r-e;f=t-f;g=x-g;var B=THREE.GeometryUtils.square(e)+THREE.GeometryUtils.square(f)+THREE.GeometryUtils.square(g)-w+h;t=m*g-l*f;r=l*e-k*g;var D=k*f-m*e;w=q*THREE.GeometryUtils.$c(f,g,r,D)-B*THREE.GeometryUtils.$c(m,l,r,D);x=q*THREE.GeometryUtils.$c(e,g,t,D)-B*THREE.GeometryUtils.$c(k,l,t,D);q=q*THREE.GeometryUtils.$c(e,f,t,r)-B*
THREE.GeometryUtils.$c(k,m,t,r);k=THREE.GeometryUtils.nf(k,m,l,e,f,g,t,r,D);if(0==k)throw"den==0";return(THREE.GeometryUtils.square(w)+THREE.GeometryUtils.square(x)+THREE.GeometryUtils.square(q))*THREE.GeometryUtils.square(.5/k)-h};THREE.GeometryUtils.Yl=function(e,f,g){return THREE.GeometryUtils.Zl(e.x,e.y,e.z,e.weight,f.x,f.y,f.z,f.weight,g.x,g.y,g.z,g.weight)};
function ne(e,f){this.ba=e;this.div=f;this.menu=null;this.wa=!1;this.Ud();this.Ha=this.Qa=this.ea=this.u=this.ca=this.Ja=this.v=this.ja=null;this.ye=this.ze=!1;this.aa=this.ba.aa;this.scene3D=this.aa.scene3D}ne.prototype.moveTo=function(e){this.menu.getMenu().detach().appendTo(e)};
ne.prototype.Ud=function(){var e=this,f=oe(this),g=pe(this),h=qe(this),k=re(this);se();var m=te(this),l=ue(this),q=ve(),r=we(),t={title:"Move",cmd:"move"},x={title:"Reset&nbspposition",cmd:"resetPos"},w={title:"Center",cmd:"center"},B={title:"Zoom",cmd:"zoom"},D={title:"As&nbsprotation&nbspanchor",cmd:"anchor"},E={title:"Structure&nbspname",cmd:"labelStr"},I={title:"Molecule&nbspname",cmd:"labelMol"},H={title:"Residue&nbspname",cmd:"labelRes"},K={title:"Atom&nbspname",cmd:"labelAtom"},G={title:"vdW",
cmd:"labelVdw"},L={title:"Clear",cmd:"labelClear"},P={title:"Remove",cmd:"remove"},Q=this.ba.gi,Q=Q.split("${id}")[0];this.menu=this.div.contextmenu({delegate:".hasContextMenu",autoTrigger:!1,preventContextMenuForPopup:!0,menu:[{title:"File",children:[{title:"Load",cmd:"load",children:[{title:"Load&nbspURL",cmd:"loadUrl"},{title:"Load&nbspFrom&nbsp"+Q,cmd:"loadPDB"},{title:"Load&nbspFrom&nbspLocal&nbspFile",cmd:"loadFile"},{title:"Load&nbspScript",cmd:"loadScript"},{title:"Load&nbspScript&nbspFile",
cmd:"loadScriptFile"}]},{title:"Options",cmd:"options"},{title:"Reset",cmd:"reset"}]},{title:"Model",cmd:"model",children:[{title:"Clear&nbsprotation&nbspanchor",cmd:"clearAnchor"},{title:"Manage&nbsprepresentations",cmd:"manageRep"}]},{title:"Tools",children:[{title:"Legend",cmd:"legend"},{title:"Stereoscopy",cmd:"stereo"},{title:"Anaglyph",cmd:"anaglyph"},{title:"Zoom",children:[{title:"25%",cmd:"zoom25"},{title:"50%",cmd:"zoom50"},{title:"100%",cmd:"zoom100"},{title:"200%",cmd:"zoom200"},{title:"400%",
cmd:"zoom400"}]},{title:"Spin",cmd:"spin"},{title:"Measurements",cmd:"measurements"}]},{title:"About",children:[{title:"Controls",cmd:"controls"},{title:"BiovizJS",cmd:"biovizJS"},{title:"System",cmd:"System"}]}],position:function(e){return{my:"left top",at:"left+"+e.extraData.pageX+" top+"+e.extraData.pageY,of:parent.$(document),collision:e.extraData.rj?"none":"fit"}},beforeOpen:function(f){e.ca=f.extraData.target;null!==e.ca?(f=e.ba.aa,e.Ja=e.ca.ib(),e.v=e.Ja.Fa,e.ja=e.v.uc(),e.u=f.jb(e.ja.ta())[0],
e.ea=xe(f,e.ja.ta(),e.v.type,e.v.id)[0],e.div.contextmenu("setEntry","model",{title:"Model",cmd:"model",children:[{title:"Clear&nbsprotation&nbspanchor",cmd:"clearAnchor"},{title:"----"},{title:e.ja.toString(),cmd:"structure",children:[t,x,D,{title:"----"},w,B,{title:"----"},{title:"Labels",children:[E,I,H,K,G,{title:"----"},L]},{title:"----"},P]},{title:e.v.toString(),cmd:"molecule",children:[t,x,D,{title:"----"},w,B,{title:"----"},{title:"Labels",children:[I,H,K,G,{title:"----"},L]}]},{title:e.Ja.toString(),
cmd:"residue",children:[D,{title:"----"},w,B,{title:"----"},{title:"Labels",children:[H,K,G,{title:"----"},L]}]},{title:e.ca.toString(),cmd:"atom",children:[D,{title:"----"},w,B,{title:"----"},{title:"Labels",children:[K,G,{title:"----"},L]}]},{title:"----"},{title:"Manage&nbsprepresentations",cmd:"manageRep"}]})):e.div.contextmenu("setEntry","model",{title:"Model",cmd:"model",children:[{title:"Clear&nbsprotation&nbspanchor",cmd:"clearAnchor"},{title:"Manage&nbsprepresentations",cmd:"manageRep"}]})},
select:function(t,w){t.stopPropagation();switch(w.cmd){case "loadUrl":e.wa=!0;f.dialog("open");break;case "loadPDB":e.wa=!1;f.dialog("open");break;case "loadFile":g.dialog("open");break;case "loadScript":h.dialog("open");break;case "loadScriptFile":k.dialog("open");break;case "reset":e.scene3D.reset();break;case "options":m.dialog("open");break;case "legend":ye(e.ba.Bf,"Legend");break;case "stereo":e.ze=!e.ze;e.ye=e.aa.ze(e.ze);break;case "anaglyph":e.ye=!e.ye;e.ze=e.aa.ye(e.ye);break;case "zoom25":case "zoom50":case "zoom100":case "zoom200":case "zoom400":var x=
w.cmd.split("zoom").pop()/100,B=e.aa;B.v=x;ze(B,null!=B.Ma?B.Ma:B.scene3D,!0);break;case "spin":null===e.aa.ke?e.aa.ug():e.aa.xf();break;case "measurements":ye(e.ba.Bf,"MeasureWidget");break;case "controls":l.dialog("open");break;case "biovizJS":r.dialog("open");break;case "System":q.dialog("open");break;case "move":B=w.item.context.parentElement.parentElement.dataset.command;switch(B){case "structure":e.aa.bb=e.u;e.scene3D.aa.Ma=e.u;break;case "molecule":e.aa.bb=e.ea;e.scene3D.aa.Ma=e.ea;break;default:throw Error("Parent command type "+
B+" is not handled");}break;case "resetPos":B=w.item.context.parentElement.parentElement.dataset.command;switch(B){case "structure":e.u.he();break;case "molecule":e.ea.he();break;default:throw Error("Parent command type "+B+" is not handled");}break;case "clearAnchor":e.scene3D.aa.Ma=null;break;case "anchor":B=w.item.context.parentElement.parentElement.dataset.command;switch(B){case "structure":e.scene3D.aa.Ma=e.u;break;case "molecule":e.scene3D.aa.Ma=e.ea;break;case "residue":Ae(e);e.scene3D.aa.Ma=
e.Qa;break;case "atom":Be(e);e.scene3D.aa.Ma=e.Ha;break;default:throw Error("Parent command type "+B+" is not handled");}break;case "center":B=w.item.context.parentElement.parentElement.dataset.command;switch(B){case "structure":ze(e.aa,e.u);break;case "molecule":ze(e.aa,e.ea);break;case "residue":Ae(e);ze(e.aa,e.Qa);break;case "atom":Be(e);ze(e.aa,e.Ha);break;default:throw Error("Parent command type "+B+" is not handled");}break;case "zoom":B=w.item.context.parentElement.parentElement.dataset.command;
switch(B){case "structure":Ce(e.aa.scene3D,e.u);break;case "molecule":Ce(e.aa.scene3D,e.ea);break;case "residue":Ae(e);Ce(e.aa.scene3D,e.Qa);break;case "atom":Be(e);Ce(e.aa.scene3D,e.Ha);break;default:throw Error("Parent command type "+B+" is not handled");}break;case "remove":De(e.aa,e.u);break;case "labelStr":B=w.item.context.parentElement.parentElement.parentElement.parentElement.dataset.command;Ee(e,B);var D;"structure"===B&&(D=e.ja);e.u.$b(D,M.u.Gg);break;case "labelMol":B=w.item.context.parentElement.parentElement.parentElement.parentElement.dataset.command;
Ee(e,B);"molecule"===B&&(D=e.v);e.u.$b(D,M.u.nc);break;case "labelRes":B=w.item.context.parentElement.parentElement.parentElement.parentElement.dataset.command;Ee(e,B);switch(B){case "structure":break;case "molecule":D=e.v;break;case "residue":D=e.Ja;break;default:throw Error("Parent command type "+B+" is not handled");}e.u.$b(D,M.u.fc);break;case "labelAtom":B=w.item.context.parentElement.parentElement.parentElement.parentElement.dataset.command;Ee(e,B);switch(B){case "structure":e.u.$b(void 0,M.u.nb);
break;case "molecule":e.u.$b(e.v,M.u.nb);break;case "residue":e.u.$b(e.Ja,M.u.nb);break;case "atom":e.u.$b(e.ca,M.u.nb);break;default:throw Error("Parent command type "+B+" is not handled");}break;case "labelVdw":B=w.item.context.parentElement.parentElement.parentElement.parentElement.dataset.command;Ee(e,B);switch(B){case "structure":e.u.$b(void 0,M.u.Uc);break;case "molecule":e.u.$b(e.v,M.u.Uc);break;case "residue":B=e.Ja.Aa();for(x in B)e.u.$b(B[x],M.u.Uc);break;case "atom":e.u.$b(e.ca,M.u.Uc);
break;default:throw Error("Parent command type "+B+" is not handled");}break;case "labelClear":B=w.item.context.parentElement.parentElement.parentElement.parentElement.dataset.command;Ee(e,B);break;case "manageRep":ye(e.ba.Bf,"RepresentationManager");e.ba.Bf.af.RepresentationManager.$g(e.ca);break;default:throw Error("Command "+w.cmd+" not handled by ContextMenu");}}}).contextmenu("instance")};
function Ee(e,f){switch(f){case "structure":Fe(e.u);break;case "molecule":Fe(e.u,e.ea);Fe(e.u,e.ea.sa.ga);Fe(e.u,e.ea.sa.Aa());break;case "residue":Fe(e.u,e.Ja);Fe(e.u,e.Ja.Aa());break;case "atom":Fe(e.u,e.ca);break;default:throw Error("Parent command type "+f+" is not handled");}}
function oe(e){var f,g,h;h='<div id="load-structure-dialog-form" title="Load New Structure"><p class="validateTips">All form fields are required.</p><form><fieldset>';h+='<label id ="structIDLabel" for="structID">Structure ID : </label>';h+='<input type="text" name="structID" id="structID" class="text ui-widget-content ui-corner-all">';h+="<br>";h+='<label for="isPDBX">Load PDBX : </label>';h+='<input type="checkbox" name="isPDBX" id="isPDBX" class="button ui-widget-content ui-corner-all" checked>';
h+='<input type="submit" tabindex="-1" style="position:absolute; top:-1000px">';h+="</fieldset>";h+="</form>";h+="</div>";$(h).appendTo(document.body);var k=$("#structID"),m=$("#isPDBX"),l=$([]).add(k).add(m);f=$("#load-structure-dialog-form").dialog({autoOpen:!1,height:250,width:300,modal:!0,position:{my:"center",at:"center",of:$("#content")},buttons:{"Load Structure":function(){l.removeClass("ui-state-error");if(!e.wa){var g=/^[a-z0-9]+$/i;if(4!=k.val().length||!g.test(k.val())){k.addClass("ui-state-error");
return}}e.ba.ee=m.is(":checked");biovizAPI.ed(k.val());f.dialog("close")},Cancel:function(){f.dialog("close")}},open:function(){e.wa?$("#structIDLabel").html("Structure URL : "):$("#structIDLabel").html("Structure ID : ")},close:function(){g[0].reset();l.removeClass("ui-state-error")}});g=f.find("form").on("submit",function(f){f.preventDefault();e.ed()});return $("#load-structure-dialog-form")}
function pe(e){var f,g,h;h='<div id="load-structure-file-dialog-form" title="Load New Structure"><p class="validateTips">All form fields are required.</p><form><fieldset>';h+='<label id ="structIDLabel" for="file">Structure file : </label>';h+='<input type="file" name="file" id="file">';h+="<br>";h+='<label for="isPDBX2">Load PDBX : </label>';h+='<input type="checkbox" name="isPDBX2" id="isPDBX2" class="button ui-widget-content ui-corner-all" checked>';h+='<input type="submit" tabindex="-1" style="position:absolute; top:-1000px">';
h+="</fieldset>";h+="</form>";h+="</div>";$(h).appendTo(document.body);var k=$("#isPDBX2");f=$("#load-structure-file-dialog-form").dialog({autoOpen:!1,height:250,width:300,modal:!0,position:{my:"center",at:"center",of:$("#content")},buttons:{"Load Structure":function(){var g=$("#file")[0].files,h=new FileReader;h.onload=function(){return function(g){e.ba.ee=k.is(":checked");biovizAPI.fg(g.target.result);f.dialog("close")}}(g);h.readAsText(g[0])},Cancel:function(){f.dialog("close")}},open:function(){e.wa?
$("#structIDLabel").html("Structure URL : "):$("#structIDLabel").html("Structure ID : ")},close:function(){g[0].reset()}});g=f.find("form").on("submit",function(f){f.preventDefault();e.ed()});return $("#load-structure-file-dialog-form")}
function qe(e){var f,g,h;h='<div id="load-script-dialog-form" title="Load New Script"><form><fieldset><label id ="scriptLabel" for="script">Script (string or url) : </label>';h+='<input type="text" name="script" id="script" class="text ui-widget-content ui-corner-all">';h+="<br>";h+='<input type="submit" tabindex="-1" style="position:absolute; top:-1000px">';h+="</fieldset>";h+="</form>";h+="</div>";$(h).appendTo(document.body);var k=$("#script"),m=$([]).add(k);f=$("#load-script-dialog-form").dialog({autoOpen:!1,
height:250,width:300,modal:!0,position:{my:"center",at:"center",of:$("#content")},buttons:{"Load Script":function(){function g(h){try{Ge(e.ba,h),f.dialog("close")}catch(m){k.addClass("ui-state-error"),console.warn("Didn't succeed to get script")}}m.removeClass("ui-state-error");var h=k.val();$.ajax({async:!0,crossDomain:!0,url:h,success:function(e){g(e)},error:function(){g(h)}})},Cancel:function(){f.dialog("close")}},close:function(){g[0].reset();m.removeClass("ui-state-error")}});g=f.find("form").on("submit",
function(f){f.preventDefault();e.Fb()});return $("#load-script-dialog-form")}
function re(e){var f,g,h;h='<div id="load-local-script-dialog-form" title="Load New Script"><form><fieldset><label id ="scriptLabel" for="scriptFile">Script (string or url) : </label>';h+='<input type="file" name="scriptFile" id="scriptFile">';h+="<br>";h+='<input type="submit" tabindex="-1" style="position:absolute; top:-1000px">';h+="</fieldset>";h+="</form>";h+="</div>";$(h).appendTo(document.body);f=$("#load-local-script-dialog-form").dialog({autoOpen:!1,height:250,width:300,modal:!0,position:{my:"center",
at:"center",of:$("#content")},buttons:{"Load Script":function(){var g=$("#scriptFile")[0].files,h=new FileReader;h.onload=function(){return function(g){console.log(g.target.result);Ge(e.ba,g.target.result);f.dialog("close");f.dialog("close")}}(g);h.readAsText(g[0])},Cancel:function(){f.dialog("close")}},close:function(){g[0].reset()}});g=f.find("form").on("submit",function(f){f.preventDefault();e.Fb()});return $("#load-local-script-dialog-form")}
function se(){var e;$('<div id="not-implemented-dialog-form" title="Feature not available"><p class="info">This feature will be added soon</p></div>').appendTo(document.body);e=$("#not-implemented-dialog-form").dialog({autoOpen:!1,height:250,width:300,modal:!0,position:{my:"center",at:"center",of:$("#content")},buttons:{Cancel:function(){e.dialog("close")}}});$("#not-implemented-dialog-form")}
function ue(e){function f(e,f){return function(){return e.apply(f,arguments)}}var g;g='<div id="biovizjsinfo" title="BiovizJS informations"><div id="keyboard" autofocus><div id="mouse"><label> Mouse </label>';g+='<div class="separator"></div>';g+="<table>";g+='<tr><td class="controlLine">Left-click</td><td> Rotate</td></tr>';g+='<tr><td class="controlLine">Right-click</td><td> Translate / Open context menu</td></tr>';g+='<tr><td class="controlLine">Double click</td><td> Select an object</td></tr>';
g+='<tr><td class="controlLine">Scroll Up / Down</td><td> Move object forward / backward</td></tr>';g+='<tr><td class="controlLine">Ctrl + Scroll</td><td> Control eye separation for stereoscopy and anaglyph effects</td></tr>';g+="</table>";g+="</div>";g+="<br/>";g+="<label> Keyboard shortcut </label>";g+='<div class="separator"></div>';g+="<table>";g+="<tr><td>I</td><td>Show controls</td></tr>";g+="<tr><td>R</td><td>Show representation manager</td></tr>";g+="<tr><td>L</td><td>Show color mapping legend</td></tr>";
g+="<tr><td>M</td><td>Show measuring tool</td></tr>";g+="<tr><td>C</td><td>Show clipping tool</td></tr>";g+="<tr><td>F</td><td>Enable / Disable BiovizJS full-screen</td></tr>";g+="</table>";g+="</div>";g+="</div>";g=$(g);g.appendTo(document.body);$("#keyboard").css({display:"flex","flex-direction":"column"});$(".keyboardItem").css({margin:"0"});$("#mouse").css({display:"flex","flex-direction":"column"});$(".mouseItem").css({margin:"0"});$(".separator").css({"border-style":"solid","border-width":"1px",
width:"60%"});$(".controlLine").css({overflow:"hidden","white-space":"nowrap"});var h=$("#biovizjsinfo").dialog({autoOpen:!1,modal:!0,position:{my:"center",at:"center",of:$("#content")}});g.css({"font-size":"0.8em"});g=f(function(e){73===e.which&&(window.localStorage.setItem("infoDiv",!0),$("#pInformation").hide(),h.dialog("close"))},e);document.addEventListener("keydown",f(function(e){73===e.which&&(window.localStorage.setItem("infoDiv",!0),$("#pInformation").hide(),h.dialog("open"))},e),!1);document.addEventListener("keyup",
g,!1);return h}
function ve(){var e=new ClientJS,f;f='<div id="systemInfo" title="System informations"><div id="sysInfo" autofocus><table>'+('<tr><td class="controlLine">Browser</td><td>'+e.getBrowser()+"</td></tr>");f+='<tr><td class="controlLine">Browser Version</td><td>'+e.getBrowserVersion()+"</td></tr>";f+='<tr><td class="controlLine">Operating System</td><td>'+e.getOS()+"</td></tr>";f+='<tr><td class="controlLine">OS Version</td><td>'+e.getOSVersion()+"</td></tr>";f+='<tr><td class="controlLine">CPU</td><td>'+e.getCPU()+
"</td></tr>";f+="</table>";f+="</div>";e=$(f);e.appendTo(document.body);$("#sysInfo").css({display:"flex","flex-direction":"column"});$(".controlLine").css({overflow:"hidden","white-space":"nowrap"});f=$("#systemInfo").dialog({autoOpen:!1,modal:!0,position:{my:"center",at:"center",of:$("#content")}});e.css({"font-size":"0.8em"});return f}
function we(){var e;e='<div id="biovizJSInfo" title="About Bioviz JS"><div id="bvInfo" autofocus><p>Bioviz JS, a molecular 3D viewer for browser and mobile devices</p><p>More information about BIONEXT <a id="bvLink" href="http://bionext.com">here</a>.</p>';e+="<p>&copy; 2015-"+(new Date).getFullYear()+" BIONEXT SA</p>";e+="</div>";e=$(e);e.appendTo(document.body);$("#bvInfo").css({display:"flex","flex-direction":"column"});$("#bvLink").attr("target","_blank");var f=$("#biovizJSInfo").dialog({autoOpen:!1,
modal:!0,position:{my:"center",at:"center",of:$("#content")}});e.css({"font-size":"0.8em"});return f}
function te(e){function f(){q=m.Za;r=m.mg.antialias;t=m.xe;x="#"+m.bgColor.getHexString();w=m.hf;B=q;D=t;E=w;I="";$("#quality").find('option[value="'+q+'"]').attr("selected",!0);$("#quality").selectmenu("refresh");$("#antialias").prop("checked",r);$("#textSize").slider("value",t);$("#textSizeInfo").html(t+"%");$("#mouse3D").val("");var e=[],f=l.Ie.values(),g;for(g in f){var h=f[g];e.push('<option value="'+h.index+'">'+h.id+"</option>")}$("#mouse3D").append(e.join(""));null!=l.sb&&(I=l.sb.id,E=l.sb.index,
$("#mouse3D").find('option[value="'+E+'"]').attr("selected",!0),$("#mouse3D").selectmenu("refresh"));$.farbtastic("#colorpicker").setColor(x)}function g(){He(m,B);q=B;var e=$("#antialias").prop("checked");window.localStorage.setItem("antialias",e);r=antialias;m.xe=D;window.localStorage.setItem("textRatio",m.xe);t=D;e=$.farbtastic("#colorpicker").color;$("#saveBg").prop("checked")&&window.localStorage.setItem("background",e);m.Zd(new THREE.Color(e));x=e;l.sb=l.Ie.get(E);e=I;m.hf=e;window.localStorage.setItem("3DController",
e);w=E}var h,k;k='<div id="config-dialog-form" title="BiovizJS Configuration"><label for="quality">Select a quality : </label><select name="quality" id="quality"><option value="LOW">Low</option>';k+='<option value="MEDIUM">Medium</option>';k+='<option value="HIGH">High</option>';k+="</select>";k+="<br/>";k+='<label for="antialias">Antialiasing (needs page refresh) : </label>';k+='<input type="checkbox" name="Antialiasing" id="antialias" class="button ui-widget-content ui-corner-all">';k+="<br/>";
k+='<label for="mouse3D">Select a 3D Mouse : </label>';k+='<select name="mouse3D" id="mouse3D">';k+="</select>";k+="<br/>";k+='<label for="textSize">Text Size : </label>';k+='<span id="textSizeInfo"></span>';k+='<div id="textSize"></div>';k+="<br/>";k+='<label id ="bgLabel" for="background">Background Color : </label>';k+='<label for="saveBg">Save background configuration : </label>';k+='<input type="checkbox" name="saveBg" id="saveBg" class="button ui-widget-content ui-corner-all">';k+='<div id="colorpicker"></div>';
k+="<br/>";k=$(k);k.appendTo(document.body);var m=Ie(),l=e.ba.aa.scene3D.uj,q=m.Za,r=m.mg.antialias,t=m.xe,x="#"+m.bgColor.getHexString(),w=m.hf,B=q,D=t,E=w,I="";h=$("#config-dialog-form").dialog({autoOpen:!1,height:250,width:300,modal:!0,position:{my:"center",at:"center",of:$("#content")},buttons:{Reset:function(){m.mg.antialias=!0;m.Za="MEDIUM";m.xe=20;m.bgColor=new THREE.Color(0,0,0);m.hf="";$("#saveBg").prop("checked",!0);f();g()},Apply:function(){g();h.dialog("close")},Cancel:function(){h.dialog("close")}},
open:function(){f()}});$("#quality").selectmenu({width:"200px",select:function(e,f){B=f.item.value}});$("#mouse3D").selectmenu({width:"200px",select:function(e,f){E=f.item.value;I=f.item.label}});$("#textSize").slider({slide:function(e,f){D=f.value;$("#textSizeInfo").html(D+"%")}});$("#colorpicker").farbtastic();k.find("select").css({width:"150%"});k.find("select").find(".options-small").css({"font-size":"0.8em"});k.find("label").css({display:"block"});return $("#config-dialog-form")}
function Ae(e){e.Qa=e.ba.aa.dc(e.ja.ta(),e.v.type,e.v.id,e.Ja._id,!0)[0]}function Be(e){e.Ha=e.ba.aa.xd(e.ja.ta(),e.v.type,e.v.id,e.ca.id,e.ca.td,!0)[0]}function EventTarget(e){this._listeners={};var f=this;e&&!e.addListener&&(e.addListener=function(e,h){f.addListener(e,h)},e.removeListener=function(e,h){f.removeListener(e,h)},e.gb=function(e){f.fire(e)})}EventTarget.prototype.addListener=function(e,f){void 0===this._listeners[e]&&(this._listeners[e]=[]);this._listeners[e].push(f)};
EventTarget.prototype.removeListener=function(e,f){var g=this._listeners[e];if(void 0!==g)for(var h=g.length,k=0;k<h;k++)if(g[k]===f){g.splice(k,1);break}};EventTarget.prototype.fire=function(e){"string"===typeof e&&(e={type:e});e.target||(e.target=this);if(!e.type)throw Error("Event object type must be defined");var f=this._listeners[e.type];if(void 0!==f)for(var g=f.length,h=0;h<g;h++)f[h].call(this,e)};
var Xe=function Je(){if("object"===ha(Je.u))return Je.u;Je.u=this;this.bgColor=new THREE.Color(0,0,0);var f=window.localStorage.getItem("quality"),g=window.localStorage.getItem("antialias"),h=window.localStorage.getItem("textRatio"),k=window.localStorage.getItem("background"),m=window.localStorage.getItem("3DController");this.hg=this.Dd=this.Pe=this.Oe=this.Ha=this.vc=this.Fb=this.Fd=this.gg=null;Ke(this);this.Pc={Atoms:this.Ha,"Amino Acids":this.vc,"Nucleic Acids":this.Fb,Molecules:this.Fd,"Secondary Structure":this.Dd,
Rainbow:this.Pe,Hydrophobicity:this.Oe};this.ca={Atoms:[],Residues:[],Molecules:[],SST:[]};g="string"==typeof g?JSON.parse(g):g;this.mg={antialias:null!=g?g:!0,um:"0c0c0c"};this.Za=null!=f?f:"MEDIUM";this.xe=null!=h?h:7;null!=k&&(this.bgColor=new THREE.Color(k));this.hf=m;this.vk=30;this.fps=60;this.ja=this.ea=this.wa=this.Qa=null;this.u={la:{radius:1,widthSegments:16,heightSegments:8,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI},pa:{radius:1,widthSegments:10,heightSegments:6,phiStart:0,
phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI},oa:{radius:1,widthSegments:6,heightSegments:3,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI}};this.ra={la:{radius:.3,widthSegments:12,heightSegments:8,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI},pa:{radius:.3,widthSegments:8,heightSegments:5,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI},oa:{radius:.3,widthSegments:5,heightSegments:3,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI}};
this.va={la:{radiusTop:.2,radiusBottom:.2,height:1,Id:12,heightSegments:1,openEnded:!1},pa:{radiusTop:.2,radiusBottom:.2,height:1,Id:5,heightSegments:1,openEnded:!1},oa:{radiusTop:.2,radiusBottom:.2,height:1,Id:3,heightSegments:1,openEnded:!1}};this.v={la:{radius:this.va.la.radiusTop,widthSegments:12,heightSegments:8,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI},pa:{radius:this.va.la.radiusTop,widthSegments:6,heightSegments:4,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI},
oa:{radius:this.va.la.radiusTop,widthSegments:5,heightSegments:3,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI}};this.lineWidth=1.5;this.bi=1;this.Ed=[]};function Ie(){return new Xe}Xe.prototype.subscribe=function(e){if(void 0!==e.update)this.Ed.push(e);else throw Error("Class must have a update function to subscribe to modellingProperties");};function Ye(e,f){for(var g=e.Ed.length,h=0;h<g;h++)e.Ed[h].update(f)}
Xe.prototype.setLineWidth=function(e){this.lineWidth=e;e=new Ze;e.lineWidth=!0;Ye(this,e)};Xe.prototype.Zd=function(e){this.bgColor=e;e=new Ze;e.bgColor=!0;Ye(this,e)};
function $e(e,f,g){if("A"===g)return void 0===e.ca.Atoms[f]?(g=new THREE.Color(e.Ha[f]),e.ca.Atoms[f]=g):e.ca.Atoms[f];if("M"===g)return void 0===e.ca.Molecules[f]?(g=new THREE.Color(e.Fd[f]),e.ca.Molecules[f]=g):e.ca.Molecules[f];if("R"===g)return void 0===e.ca.Residues[f]?(g=e.vc[f],void 0===g&&(g=e.Fb[f]),g=new THREE.Color(g),e.ca.Residues[f]=g):e.ca.Residues[f];if("SST"===g)return void 0===e.ca.SST[f]?(g=e.Dd[f],g=new THREE.Color(g),e.ca.SST[f]=g):e.ca.SST[f]}
function He(e,f){if("LOW"===f||"MEDIUM"===f||"HIGH"===f){e.Za=f;var g=new Ze;g.vf=!0;"HIGH"===e.Za?(e.wa=new THREE.SphereGeometry(e.u.la.radius,e.u.la.widthSegments,e.u.la.heightSegments,e.u.la.phiStart,e.u.la.phiLength,e.u.la.thetaStart,e.u.la.thetaLength),e.ea=new THREE.SphereGeometry(e.ra.la.radius,e.ra.la.widthSegments,e.ra.la.heightSegments,e.ra.la.phiStart,e.ra.la.phiLength,e.ra.la.thetaStart,e.ra.la.thetaLength),e.ja=new THREE.CylinderGeometry(e.va.la.radiusTop,e.va.la.radiusBottom,e.va.la.height,
e.va.la.Id,e.va.la.rf,e.va.la.openEnded)):"MEDIUM"===e.Za?(e.wa=new THREE.SphereGeometry(e.u.pa.radius,e.u.pa.widthSegments,e.u.pa.heightSegments,e.u.pa.phiStart,e.u.pa.phiLength,e.u.pa.thetaStart,e.u.pa.thetaLength),e.ea=new THREE.SphereGeometry(e.ra.pa.radius,e.ra.pa.widthSegments,e.ra.pa.heightSegments,e.ra.pa.phiStart,e.ra.pa.phiLength,e.ra.pa.thetaStart,e.ra.pa.thetaLength),e.ja=new THREE.CylinderGeometry(e.va.pa.radiusTop,e.va.pa.radiusBottom,e.va.pa.height,e.va.pa.Id,e.va.pa.rf,e.va.pa.openEnded)):
"LOW"===e.Za&&(e.wa=new THREE.SphereGeometry(e.u.oa.radius,e.u.oa.widthSegments,e.u.oa.heightSegments,e.u.oa.phiStart,e.u.oa.phiLength,e.u.oa.thetaStart,e.u.oa.thetaLength),e.ea=new THREE.SphereGeometry(e.ra.oa.radius,e.ra.oa.widthSegments,e.ra.oa.heightSegments,e.ra.oa.phiStart,e.ra.oa.phiLength,e.ra.oa.thetaStart,e.ra.oa.thetaLength),e.ja=new THREE.CylinderGeometry(e.va.oa.radiusTop,e.va.oa.radiusBottom,e.va.oa.height,e.va.oa.Id,e.va.oa.rf,e.va.oa.openEnded));Ye(e,g);window.localStorage.setItem("quality",
e.Za)}}
function af(e){null===e.ea&&("HIGH"===e.Za?e.ea=new THREE.SphereGeometry(e.ra.la.radius,e.ra.la.widthSegments,e.ra.la.heightSegments,e.ra.la.phiStart,e.ra.la.phiLength,e.ra.la.thetaStart,e.ra.la.thetaLength):"MEDIUM"===e.Za?e.ea=new THREE.SphereGeometry(e.ra.pa.radius,e.ra.pa.widthSegments,e.ra.pa.heightSegments,e.ra.pa.phiStart,e.ra.pa.phiLength,e.ra.pa.thetaStart,e.ra.pa.thetaLength):"LOW"===e.Za&&(e.ea=new THREE.SphereGeometry(e.ra.oa.radius,e.ra.oa.widthSegments,e.ra.oa.heightSegments,e.ra.oa.phiStart,
e.ra.oa.phiLength,e.ra.oa.thetaStart,e.ra.oa.thetaLength)));return e.ea}function bf(e,f){if(null===f||void 0===f)f=30;return cf(e,{fontsize:f,mh:{r:255,g:255,b:255,a:1},strokeStyle:!0})}
function cf(e,f){void 0===f&&(f={});var g=void 0!==f.xk?f.xk:"Arial",h=void 0!==f.fontsize?f.fontsize:20,k=void 0!==f.mh?f.mh:{r:1,g:0,b:0,a:1},m=f.maxWidth,l=f.maxHeight,q=document.createElement("canvas"),r=q.getContext("2d");r.font=h+"px "+g;var t=r.measureText(e).width,h=Math.ceil(h);null!=m&&t>m&&(h=Math.ceil(h*m/t),r.font=h+"px "+g,t=m);null!=l&&h>l&&(t*=l/h,h=l,r.font=h+"px "+g);q.width=t;q.height=h;r.fillStyle="rgba("+k.r+","+k.g+","+k.b+","+k.a+")";r.font=h+"px "+g;r.textAlign="center";r.textBaseline=
"middle";f.strokeStyle&&(r.strokeStyle="rgba(0,0,0,1.0)",r.lineWidth=2,r.strokeText(e,t/2,h/2));r.fillText(e,t/2,h/2);g=new THREE.Texture(q);g.minFilter=THREE.LinearFilter;g.needsUpdate=!0;return g}function df(e,f){return parseFloat(bb(f.symbol.charAt(0).toUpperCase()+f.symbol.slice(1).toLowerCase())[7])}
function ef(e){var f=new THREE.MeshPhongMaterial({vertexColors:THREE.VertexColors});e.$e&&(f.blendEquation=THREE.AddEquation,f.blendEquationAlpha=THREE.AddEquation,f.blendSrc=THREE.SrcAlphaFactor,f.blendDst=THREE.ZeroFactor,f.blendSrcAlpha=THREE.OneFactor,f.blendDstAlpha=THREE.ZeroFactor);return f}
function Ke(e){e.gg=JSON.parse(window.localStorage.getItem("def"))||md;e.Fd=JSON.parse(window.localStorage.getItem("moleculeColor"))||nd;e.Fb=JSON.parse(window.localStorage.getItem("nucleicAcidColor"))||od;e.vc=JSON.parse(window.localStorage.getItem("residueColor"))||pd;e.Ha=JSON.parse(window.localStorage.getItem("atomColor"))||qd;e.Oe=JSON.parse(window.localStorage.getItem("hydroColor"))||rd;e.Pe=JSON.parse(window.localStorage.getItem("rainbowColor"))||sd;e.Dd=JSON.parse(window.localStorage.getItem("sstColor"))||
Bd;e.hg=JSON.parse(window.localStorage.getItem("unsortedProperties"))||Cd;e.Pc={Atoms:e.Ha,"Amino Acids":e.vc,"Nucleic Acids":e.Fb,Molecules:e.Fd,"Secondary Structure":e.Dd,Rainbow:e.Pe,Hydrophobicity:e.Oe}}function Ze(){this.fi=this.lineWidth=this.bi=this.vf=!1;this.bh=this.bh=null;this.bgColor=!1}function ff(e,f){var g=new THREE.Matrix4,h=(new THREE.Matrix4).multiplyMatrices(f.matrixWorldInverse,e.matrixWorld);g.getInverse(h);this.value=g}
function gf(e,f){var g=new THREE.Matrix4;g.getInverse(f.projectionMatrix);this.value=g}function hf(e){this.value=e.material.opacity}
function jf(e){var f=THREE.ShaderChunk.sphereImpostor_vert,g=THREE.ShaderChunk.sphereImpostor_frag,h=THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights,THREE.UniformsLib.fog,{viewport:{type:"v4",value:new THREE.Vector4},modelViewMatrixInverse:(new THREE.Uniform(new THREE.Matrix4)).onUpdate(ff),projectionMatrixInverse:(new THREE.Uniform(new THREE.Matrix4)).onUpdate(gf),emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",
value:30},diffuse:new THREE.Uniform(new THREE.Color(16777215)),opacity:(new THREE.Uniform(1)).onUpdate(hf),fog:!0}]),f=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(h),vertexShader:f,fragmentShader:g,lights:!0,vertexColors:THREE.VertexColors,fog:!0,clipping:!0,transparent:!0});e.$e&&(f.blendEquation=THREE.AddEquation,f.blendEquationAlpha=THREE.AddEquation,f.blendSrc=THREE.SrcAlphaFactor,f.blendDst=THREE.ZeroFactor,f.blendSrcAlpha=THREE.OneFactor,f.blendDstAlpha=THREE.ZeroFactor);f.extensions.fragDepth=
!0;return f}
function kf(e){var f=THREE.ShaderChunk.cylinderImpostor_vert,g=THREE.ShaderChunk.cylinderImpostor_frag,h=THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights,THREE.UniformsLib.fog,{viewport:{type:"v4",value:new THREE.Vector4},modelViewMatrixInverse:(new THREE.Uniform(new THREE.Matrix4)).onUpdate(ff),projectionMatrixInverse:(new THREE.Uniform(new THREE.Matrix4)).onUpdate(gf),emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",
value:30},diffuse:new THREE.Uniform(new THREE.Color(16777215)),opacity:(new THREE.Uniform(1)).onUpdate(hf),fog:!0}]),f=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(h),vertexShader:f,fragmentShader:g,lights:!0,vertexColors:THREE.VertexColors,fog:!0,clipping:!0,transparent:!0});e.$e&&(f.blendEquation=THREE.AddEquation,f.blendEquationAlpha=THREE.AddEquation,f.blendSrc=THREE.SrcAlphaFactor,f.blendDst=THREE.ZeroFactor,f.blendSrcAlpha=THREE.OneFactor,f.blendDstAlpha=THREE.ZeroFactor);f.extensions.fragDepth=
!0;return f}function lf(){var e={scale:{type:"f",value:.2},color:{type:"c",value:new THREE.Color(.9,.8,.2)}};return new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(e),vertexShader:THREE.ShaderChunk.outline_vert,fragmentShader:THREE.ShaderChunk.outline_frag,depthFunc:THREE.LessDepth})}
function mf(e){this.zg=new Worker("webworker.js");this.ba=e;this.fa=new Xe;e=$("#content").width()/$("#content").height();this.camera=new THREE.PerspectiveCamera(45,e,10,1E3);this.bb=this.scene3D=new nf(this);this.Ma=null;this.domElement=this.scene3D.renderer.domElement;this.effect=null;this.Gc=this.Ze=!1;this.u=null;this.v=1;this.ke=null}function of(e){e.ba.gb({type:"requestWidgetUpdate",data:null!=e.Ma?e.Ma.ia._id:null})}z=mf.prototype;z.Xg=function(e){this.ba.Xg(e)};
z.ed=function(e,f){var g=this;if(void 0===e)throw Error("Structure's identifier to load is undefined");var h;-1!=e.indexOf("/")?h=e:(h=this.ba.gi.slice().replace("${id}",e),h=h.replace("${divided}",e.substring(1,2)));pf(this.ba,"Downloading "+e,!0);return(new Wd(h,this.ba.ee,f)).load().then(function(e){pf(g.ba);return e})["catch"](function(e){pf(g.ba,e.message);return e})};
z.fg=function(e,f){var g=this;pf(this.ba,"Parsing...",!0);return(new Wd(e,this.ba.ee,f,!0)).load().then(function(e){pf(g.ba);return e})["catch"](function(e){console.warn("Error : ",e)})};function qf(e,f,g){pf(e.ba,"Loading 3D Objects",!0);if(null!==f&&void 0!==f){var h=new M(f);null!=g&&h.ia.lc(g);f=f.v[0].ca;g=f.length;for(var k=0;k<g;k++)h.pb(f[k]);pf(e.ba);return h}return null}
function rf(e,f){pf(e.ba,"Loading 3D Representations...",!0);var g=sf(f),h=g.length,k=f.ia.Hi;return function l(e){return(new Promise(function(f){var h=g[e];setTimeout(function(){25E4>k?tf(h):h.show(N.cf);f(e+1)},40)})).then(function(e){if(e<h)return l(e)})}(0).then(function(){return new Promise(function(f){pf(e.ba);f()})})}
function uf(e){var f=1.5*e.scene3D.ub().length();0===f&&(f=1E3);e.camera.far=f;vf=f/5E3;e.camera.fov=ld(e.scene3D,e.camera);e.camera.updateProjectionMatrix();wf(e.scene3D,0,100);e=e.scene3D;e.Hb.fog.near=e.camera.far-(e.camera.far-e.camera.near)*e.fa.vk/100;e.Hb.fog.far=e.camera.far}function De(e,f){f.traverse(function(f){f===e.Ma&&(e.Ma=null);f===e.bb&&(e.bb=e.scene3D)});var g=e.scene3D.na.indexOf(f);0<=g&&e.scene3D.na.splice(g,1);f["delete"]();uf(e);of(e)}
z.translate=function(e,f,g){e=new THREE.Vector3(e,f,g);this.bb===this.scene3D?(e=(new THREE.Matrix4).setPosition(e),e=e.multiply(this.bb.matrixWorld),this.bb.matrix.copy(e)):(f=new THREE.Matrix4,f.copy(this.bb.matrixWorld),g=new THREE.Matrix4,g.getInverse(f),f=ge(g,e),e=new THREE.Matrix4,e.makeTranslation(f.x,f.y,f.z),f=new THREE.Matrix4,f.copy(this.bb.matrix),f.multiply(e),this.bb.matrix.copy(f));this.bb.updateMatrixWorld(!0)};
z.rotate=function(e,f,g){var h=null!==this.bb?this.bb:this.scene3D.scene,k=null!==this.Ma?this.Ma:h,m=new THREE.Matrix4;m.copy(h.matrixWorld);var l=new THREE.Matrix4;l.getInverse(m);var q=new THREE.Matrix4;q.copy(h.matrixWorld);m=new THREE.Matrix4;m.getInverse(q);var q=new THREE.Vector3(m.elements[0],m.elements[1],m.elements[2]),r=new THREE.Vector3(m.elements[4],m.elements[5],m.elements[6]),t=(new THREE.Vector3).crossVectors(q,r),m=new THREE.Matrix4;he(m,e,r.x,r.y,r.z);e=new THREE.Matrix4;he(e,f,
q.x,q.y,q.z);f=new THREE.Matrix4;he(f,g,t.x,t.y,t.z);g=new THREE.Matrix4;g=f.multiply(e).multiply(m);f=new THREE.Vector3;f.copy(k.ad());f=(new THREE.Matrix4).makeTranslation(f.x,f.y,f.z);l=(new THREE.Matrix4).copy(l);l.multiply(k.matrixWorld).multiply(f);k=(new THREE.Matrix4).getInverse(l);l=[l,k];k=new THREE.Matrix4;k=k.multiply(l[0]).multiply(g).multiply(l[1]);l=new THREE.Matrix4;h.matrix.copy((null!==h.matrix?h.matrix:l).multiply(k));h.updateMatrixWorld(!0)};
function ze(e,f,g){var h=Yd(f,e.scene3D,g,e.v);e.scene3D.scene.matrix.copy(h);e.scene3D.scene.matrixWorldNeedsUpdate=!0;g&&(e.scene3D.aa.Ma=f)}z.ug=function(e){null!==this.ke&&this.xf();void 0==e&&(e=.25);this.ke=new xf(this.scene3D,e);this.scene3D.Af.sc(this.ke)};z.xf=function(){this.ke&&(this.ke.stop(),this.ke=null)};z.ze=function(e){(this.Ze=e)&&this.Gc&&(this.Gc=!1);return this.Gc};z.ye=function(e){(this.Gc=e)&&this.Ze&&(this.Ze=!1);return this.Ze};
z.jb=function(e){for(var f in this.scene3D.na)if(this.scene3D.na[f].cd()===e)return[this.scene3D.na[f]]};
function xe(e,f,g,h){var k=[];if(void 0===g)for(var m in e.scene3D.na)e.scene3D.na[m].cd().toUpperCase()===f.toUpperCase()&&(k=k.concat(sf(e.scene3D.na[m])));else if(void 0===h)for(m in e.scene3D.na){if(e.scene3D.na[m].cd().toUpperCase()===f.toUpperCase()){var l=sf(e.scene3D.na[m]),q;for(q in l)g.toUpperCase()===l[q].sa.type.toUpperCase()&&k.push(l[q])}}else for(m in e.scene3D.na)if(e.scene3D.na[m].cd().toUpperCase()===f.toUpperCase())for(q in l=sf(e.scene3D.na[m]),l)if(g.toUpperCase()===l[q].sa.type.toUpperCase()&&
h.toUpperCase()===l[q].sa.id.toUpperCase())return[l[q]];return k}z.dc=function(e,f,g,h,k){e=xe(this,e,f,g)[0];if(null!==e){f=e.sa.ga;for(var m in f)if(g=f[m],g.ta()==h)return[e.dc(g,k)]}return null};z.xd=function(e,f,g,h,k,m){e=xe(this,e,f,g)[0];if(null!==e){f=e.sa.Aa();for(var l in f)if(f[l].id===h&&(null==k||f[l].td===k)&&(g=e.dc(f[l].ib(),m),null!==g&&void 0!==g))return[g.xd(f[l],m)]}return null};
function Ff(e){this.u=null;this.scene3D=e;this.u=new THREE.DirectionalLight(16777215,1);this.u.position.set(this.scene3D.camera.position.x,this.scene3D.camera.position.y,this.scene3D.camera.position.z);this.u.matrixAutoUpdate=!0;this.scene3D.Hb.add(this.u)}function Gf(e){this.fa=Ie();this.duration=e;this.Ya=0}Gf.prototype.moveTo=function(e){if(1<e||0>e||isNaN(e))return 0;this.Ya=this.duration*e};function Hf(e){new THREE.Clock;this.fa=Ie();this.Hc=[];this.pause=!1;this.scene3D=e}Hf.prototype.sc=function(e){this.Hc.push(e)};
function If(e,f,g){if(!e.pause||g){g=e.Hc.length;for(var h=0;h<g;h++){var k=e.Hc[h];k.sd(f);-1!=k.duration&&k.Ya>=k.duration&&(e.Hc.splice(h,1),g--)}}}function Jf(e,f,g,h){Gf.call(this);this.duration=g;this.scene3D=f;this.Ee=new THREE.Matrix4;this.mj=new THREE.Matrix4;this.mj.copy(this.scene3D.scene.matrix);e=Yd(e,this.scene3D,h);this.Ee.copy(e)}Jf.prototype=Object.create(Gf.prototype);Jf.prototype.constructor=Jf;
Jf.prototype.sd=function(e){this.Ya+=e;e=this.Ya/this.duration;1<e&&(e=1);var f=new THREE.Matrix4;f.lerp(this.mj,this.Ee,e);this.scene3D.scene.matrix.copy(f);this.scene3D.scene.matrixWorldNeedsUpdate=!0};function Kf(e,f,g,h){Gf.call(this);this.r=e;this.g=f;this.b=g;this.duration=h;this.zj=this.fa.bgColor.r;this.ej=this.fa.bgColor.g;this.Ui=this.fa.bgColor.b}Kf.prototype=Object.create(Gf.prototype);Kf.prototype.constructor=Kf;
Kf.prototype.sd=function(e){this.Ya+=e;e=this.Ya/this.duration;1<e?this.fa.Zd(new THREE.Color(this.r,this.g,this.b)):this.fa.Zd(new THREE.Color(this.zj+(this.r-this.zj)*e,this.ej+(this.g-this.ej)*e,this.Ui+(this.b-this.Ui)*e))};function Lf(e){Gf.call(this);this.Ya=0;this.duration=e}Lf.prototype=Object.create(Gf.prototype);Lf.prototype.constructor=Lf;Lf.prototype.sd=function(e){this.Ya+=e};
function Mf(e,f){Gf.call(this);this.duration=e;this.Ia=f;this.cg=[];this.b=this.g=this.r=null;this.Hh=!1;this.map=null}Mf.prototype=Object.create(Gf.prototype);Mf.prototype.constructor=Mf;Mf.prototype.init=function(){var e=this.Ia.da.geometry,f=e.attributes.color,e=e.attributes.color.array;if(0===f.count)this.Ia.da.material.color=this.Ia.da.material.color.clone(),this.cg.push(this.Ia.da.material.color);else for(var f=f.count,g=0;g<f;g++){var h=(new THREE.Color(e[3*g],e[3*g+1],e[3*g+2])).clone();this.cg.push(h)}};
function Nf(e,f,g,h){1<f?e.r=f/255:e.r=f;1<g?e.g=g/255:e.g=g;1<h?e.b=h/255:e.b=h;e.init()}
Mf.prototype.sd=function(e){this.Ya+=e;e=this.Ya/this.duration;1<e&&(e=1);for(var f=this.Ia.da.geometry.attributes.color,g=new Float32Array(f.array.length),h=this.cg.length,k=0;k<h;k++){var m=this.cg[k];if(1===e)if(this.Hh){var l=this.map[k];null!=l?(g[3*k]=l.r,g[3*k+1]=l.g,g[3*k+2]=l.b):(g[3*k]=m.r,g[3*k+1]=m.g,g[3*k+2]=m.b)}else g[3*k]=this.r,g[3*k+1]=this.g,g[3*k+2]=this.b;else this.Hh?(l=this.map[k],null!=l?(g[3*k]=m.r+(l.r-m.r)*e,g[3*k+1]=m.g+(l.g-m.g)*e,g[3*k+2]=m.b+(l.b-m.b)*e):(g[3*k]=m.r,
g[3*k+1]=m.g,g[3*k+2]=m.b)):(g[3*k]=m.r+(this.r-m.r)*e,g[3*k+1]=m.g+(this.g-m.g)*e,g[3*k+2]=m.b+(this.b-m.b)*e)}f.set(g);f.needsUpdate=!0};
function Of(e,f,g,h){Gf.call(this);this.duration=e;this.target=f;this.scene3D=g;this.th=new THREE.Matrix4;this.th.copy(this.target.matrix);this.Yk=new THREE.Vector3;this.nj=new THREE.Quaternion;this.oj=new THREE.Vector3;this.th.decompose(this.Yk,this.nj,this.oj);this.Ee=h;this.tk=new THREE.Vector3;this.bj=new THREE.Quaternion;this.cj=new THREE.Vector3;this.Ee.decompose(this.tk,this.bj,this.cj);e=this.target.ad();this.Qh=new THREE.Vector3(-e.x,-e.y,-e.z);this.Ph=(new THREE.Matrix4).setPosition(this.Qh);
this.og=e.clone();this.Dj=(new THREE.Matrix4).setPosition(this.og);this.ci=new THREE.Vector3;f=new THREE.Matrix4;f.multiply(this.th).multiply((new THREE.Matrix4).setPosition(e));this.ci.setFromMatrixPosition(f);f=new THREE.Vector3;g=new THREE.Matrix4;g.multiply(this.Ee).multiply((new THREE.Matrix4).setPosition(e));f.setFromMatrixPosition(g);this.Jj=new THREE.Vector3;this.Jj.subVectors(this.ci,e);this.Xi=new THREE.Vector3;this.Xi.subVectors(f,this.ci)}Of.prototype=Object.create(Gf.prototype);
Of.prototype.constructor=Of;
Of.prototype.sd=function(e){this.Ya+=e;e=this.Ya/this.duration;if(1<e||isNaN(e))this.target.matrix.copy(this.Ee);else{var f=new THREE.Quaternion;THREE.Quaternion.slerp(this.nj,this.bj,f,e);var f=(new THREE.Matrix4).makeRotationFromQuaternion(f),g=new THREE.Vector3;g.lerp(this.Xi,e);(new THREE.Matrix4).setPosition(g);var h=new THREE.Vector3;h.lerpVectors(this.oj,this.cj,e);(new THREE.Matrix4).scale(h);e=(new THREE.Matrix4).setPosition(g.add(this.og).add(this.Jj));e.multiply(f);e.multiply(this.Ph);
this.target.matrix.copy(e)}this.target.matrixWorldNeedsUpdate=!0};Lf=function(e,f,g){Gf.call(this);this.sh=null;this.opacity=e;this.Ia=g;this.Ya=0;this.duration=f;this.Ia.da.material.transparent=!0;this.sh=this.Ia.da.material.opacity};Lf.prototype=Object.create(Gf.prototype);Lf.prototype.constructor=Lf;Lf.prototype.sd=function(e){this.Ya+=e;e=this.Ya/this.duration;1<e&&(e=1);this.Ia.da.material.opacity=1===e?this.opacity:this.sh+(this.opacity-this.sh)*e};
function xf(e,f){Gf.call(this);this.duration=-1;this.speed=f;this.target=e;var g=this.target.ad();this.Qh=new THREE.Vector3(-g.x,-g.y,-g.z);this.Ph=(new THREE.Matrix4).setPosition(this.Qh);this.og=g.clone();this.Dj=(new THREE.Matrix4).setPosition(this.og)}xf.prototype=Object.create(Gf.prototype);xf.prototype.constructor=xf;
xf.prototype.sd=function(e){var f=new THREE.Matrix4;f.copy(this.target.matrixWorld);var g=new THREE.Matrix4;g.getInverse(f);var f=new THREE.Vector3(g.elements[0],g.elements[1],g.elements[2]),h=new THREE.Vector3(g.elements[4],g.elements[5],g.elements[6]),k=(new THREE.Vector3).crossVectors(f,h),g=new THREE.Matrix4;he(g,e/1E3*this.speed*2*Math.PI,h.x,h.y,h.z);e=new THREE.Matrix4;he(e,0,f.x,f.y,f.z);f=new THREE.Matrix4;he(f,0,k.x,k.y,k.z);k=new THREE.Matrix4;k=f.multiply(e).multiply(g);g=(new THREE.Matrix4).multiply(this.Dj).multiply(k).multiply(this.Ph);
this.target.matrix.copy(this.target.matrix.multiply(g))};xf.prototype.stop=function(){this.duration=0};function Pf(e,f,g,h){Gf.call(this);this.duration=g;this.scene3D=f;this.text=e;this.position=h}Pf.prototype=Object.create(Gf.prototype);Pf.prototype.constructor=Pf;Pf.prototype.sd=function(e){this.Ya+=e;this.Ya>=this.duration&&(this.scene3D.Od[this.position]=void 0,this.scene3D.Cc.remove(this.text),this.scene3D.renderer.render(this.scene3D.Cc,this.scene3D.Yd))};
function Qf(e,f){Rf.call(this,e,f);(this.fj="getGamepads"in navigator)||console.warn("Gamepad API not supported, you can't use any 3D device to control BiovizJS");var g=this;this.Ie=new Ca;this.sb=null;this.xh=this.wh=this.Dh=this.Eh=!1;window.addEventListener("gamepadconnected",function(e){Sf(g,e.sb)});window.addEventListener("gamepaddisconnected",function(e){e=e.sb;g.sb.index==e.index&&(g.sb=null);g.Ie.remove(e.index)});this.Lk="GamepadEvent"in window;var h=window.chrome,k=window.navigator.vendor,
m=-1<window.navigator.userAgent.indexOf("OPR"),l=-1<window.navigator.userAgent.indexOf("Edge");this.isChrome=null!==h&&void 0!==h&&"Google Inc."===k&&0==m&&0==l}Qf.prototype=Object.create(Rf.prototype);Qf.prototype.constructor=Qf;
Qf.prototype.update=function(){if(this.fj){if(!this.Lk||this.isChrome)for(var e=navigator.getGamepads(),f=0;f<e.length;f++){var g=e[f];g&&(this.Ie.Zc(g.index)?this.Ie.set(g.index,g):Sf(this,g))}if(null!=this.sb){(e=this.sb.buttons[0])&&e.pressed?this.wh||(this.Eh=!this.Eh,this.wh=!0):this.wh=!1;(e=this.sb.buttons[1])&&e.pressed?this.xh||(this.Dh=!this.Dh,this.xh=!0):this.xh=!1;var e=this.sb.axes[0]*Tf,f=this.sb.axes[1]*Tf,g=this.sb.axes[2]*Tf,h=this.sb.axes[3]*Uf,k=this.sb.axes[4]*Uf,m=this.sb.axes[5]*
Uf;if(0!==e||0!==f||0!==g||0!==h||0!==k||0!==m)this.Dh||this.scene3D.aa.rotate(-m,h,k),this.Eh||this.scene3D.aa.translate(e,-g,f)}}};function Sf(e,f){f.Bb=function(){return this.index+":"+this.id};e.Ie.set(f.index,f);if(null==e.sb||f.id===Ie().hf)e.sb=f}function Rf(e,f){this.scene3D=e;this.domElement=f;this.Qa=new THREE.Vector3;this.wa=new THREE.Vector3;this.ea=new THREE.Vector3;this.Ha=new THREE.Vector3;this.ja=new THREE.Vector3;this.ca=new THREE.Vector3;this.maxDistance=Infinity}
var vf=.4,Uf=.1,Tf=1.5;
function Vf(e,f){Rf.call(this,e,f);this.u={NONE:-1,ld:0,qe:1,oe:2,re:3};this.v=this.u.NONE;var g=this,h;this.Ch=!1;this.mousedown=function(e){kd(g.scene3D.aa.ba);h=e.timeStamp;Wf(!1);if(g.v===g.u.NONE)g.v=e.button;else if(g.v===g.u.ld||g.v===g.u.oe)g.v=g.u.re;g.v===g.u.ld?g.Qa=g.Ha=Xf(g,e.clientX,e.clientY):g.v===g.u.qe||g.v===g.u.re?g.wa=g.ja=Xf(g,e.clientX,e.clientY):g.ea=g.ca=Xf(g,e.clientX,e.clientY)};this.mouseup=function(e){Wf(!0);g.v=g.u.NONE;h=e.timeStamp-h;if(300>h&&5>Math.abs(g.ca.x-g.ea.x)&&
5>Math.abs(g.ca.y-g.ea.y)){var f=[],l;for(l in g.scene3D.na)f=f.concat(Yf(g.scene3D.na[l]));var q=e.offsetX/$("#content").width()*2-1,r=2*-(e.offsetY/$("#content").height())+1,f=$d(g.scene3D,f,q,r);if(2==e.button)l=g.scene3D.aa.ba,e={target:null!=f?f:null,pageX:e.pageX,pageY:e.pageY},l.contextMenu.menu.getMenu()[0].parentElement!==l.eh[0]?(e.rj=!0,f=l.aj.offset(),e.pageX+=f.left,e.pageY+=f.top):e.rj=!1,l.contextMenu.div.contextmenu("open",l.hk,e);else if(0==e.button){for(l in g.callback)if("function"===
typeof g.callback[l])g.callback[l](f);if(null!=f&&g.Ch&&(e=g.scene3D,f!=e.ve)){if(e.aa.bb!==e)throw"In order to measure, you must have the scene as camera target";l=f.ib().Fa;q=l.uc();r=xe(e.aa,q.ta(),l.type,l.id)[0];void 0!=e.ve&&(xe(e.aa,q.ta(),l.type,l.id),e.oc=e.ve.pos.clone(),e.oc.applyMatrix4(r.matrixWorld),e.oc.applyMatrix4((new THREE.Matrix4).getInverse(e.scene.matrixWorld)));e.oc?e.rd||(e.rd=f.pos.clone(),e.rd.applyMatrix4(r.matrixWorld),e.rd.applyMatrix4((new THREE.Matrix4).getInverse(e.scene.matrixWorld)),
f=new THREE.Geometry,f.vertices.push(e.oc),f.vertices.push(e.rd),f.computeLineDistances(),l=new THREE.LineDashedMaterial({color:16760576,dashSize:.7,gapSize:.3,linewidth:1.5}),f=new THREE.Line(f,l),e.scene.add(f),l=e.oc.distanceTo(e.rd).toFixed(2),l=bf(l),l=new THREE.SpriteMaterial({map:l}),l.depthTest=!1,l.depthWrite=!1,q=new THREE.Sprite(l),r=(new THREE.Vector3).addVectors(e.oc,e.rd).multiplyScalar(.5),q.position.set(r.x,r.y,r.z),q.scale.set(l.map.image.width/40,l.map.image.height/40,1),e.scene.add(q),
e.gf.push(f),e.gf.push(q),e.oc=null,e.rd=null):(e.oc=f.pos.clone(),e.oc.applyMatrix4(r.matrixWorld),e.oc.applyMatrix4((new THREE.Matrix4).getInverse(e.scene.matrixWorld)))}}}};this.vc=function(e){e.preventDefault()};this.mousemove=function(e){if(g.v===g.u.NONE){var f=[],h;for(h in g.scene3D.na)f=f.concat(Yf(g.scene3D.na[h]));h=e.offsetX/$("#content").width()*2-1;e=2*-(e.offsetY/$("#content").height())+1;f=$d(g.scene3D,f,h,e);e=null;null!=f&&(e=f.Mc());g.scene3D.aa.Xg(e)}else g.v===g.u.ld?g.Ha=Xf(g,
e.clientX,e.clientY):g.v===g.u.qe||g.v===g.u.re?g.ja=Xf(g,e.clientX,e.clientY):g.v===g.u.oe&&(g.ca=Xf(g,e.clientX,e.clientY))};this.Fb=function(e){e.preventDefault();e.stopPropagation();if(!0===e.ctrlKey){var f=g.scene3D;e=g.scene3D.Wi+.05*e.deltaY;f.Wi=e;f.camera.focus=e}else g.scene3D.aa.translate(0,0,-e.deltaY*e.deltaFactor*vf)};this.update=function(){if(g.v!==g.u.NONE)if(g.v===g.u.ld){var e=.025*(this.Ha.x-this.Qa.x),f=.025*(this.Ha.y-this.Qa.y);g.scene3D.aa.rotate(e,f,0);this.Qa=this.Ha}else g.v===
g.u.qe||g.v===g.u.re?(e=this.ja.y-this.wa.y,e=this.v===this.u.re?2*e:e*vf,g.scene3D.aa.translate(0,0,1*e),this.wa=this.ja):g.v===g.u.oe&&(e=.2*(this.ca.x-this.ea.x),f=.2*(this.ca.y-this.ea.y),g.scene3D.aa.translate(e,-f,0),this.ea=this.ca)};this.callback=[];this.hj=function(e){this.callback.push(e)};this.Aj=function(){this.callback=[]};this.$g=function(e){var f=[],h;for(h in g.scene3D.na)f=f.concat(Yf(g.scene3D.na[h]));h=e.offsetX/$("#content").width()*2-1;var q=2*-(e.offsetY/$("#content").height())+
1,f=$d(g.scene3D,f,h,q);null!==f?(f=g.scene3D.aa.jb(f.ib().Fa.uc().ta())[0],!0===e.ctrlKey&&(g.scene3D.aa.bb=f),g.scene3D.aa.Ma=f,of(g.scene3D.aa)):(g.scene3D.aa.bb=g.scene3D,g.scene3D.aa.Ma=null)};$(this.domElement).on("mousemove",this.mousemove);$(this.domElement).on("mousedown",this.mousedown);$(this.domElement).on("mouseup",this.mouseup);$(document.body).on("dragstart ondrop",function(){return!1});$(this.domElement).on("click",function(){clearTimeout(void 0)});$(this.domElement).on("dblclick",
function(e){e.preventDefault();e.stopPropagation();clearTimeout(void 0);g.$g(e);return!1});$(this.domElement).on("contextmenu",this.vc);$(this.domElement).on("mousewheel",this.Fb)}Vf.prototype=Object.create(Rf.prototype);Vf.prototype.constructor=Vf;function Xf(e,f,g){e=e.domElement.getBoundingClientRect();return{x:f-e.left,y:g-e.top}}
function Zf(e,f){Rf.call(this,e,f);this.u={NONE:-1,ld:0,qe:1,oe:2,re:3};this.v=this.u.NONE;var g=this,h=new Hammer.Manager(this.domElement),k=new Hammer.Swipe({direction:Hammer.DIRECTION_ALL}),m=new Hammer.Pan({direction:Hammer.DIRECTION_ALL,pointers:0,threshold:50}),l=new Hammer.Pinch({enable:!0,threshold:.3}),q=new Hammer.Tap({enable:!0});h.add(k);h.add(m);h.add(l);h.add(q);m.recognizeWith(k);this.Fb=function(e){if(g.v===g.u.NONE&&"mouse"!==e.pointerType)switch(e.type){case "panstart":if(.5<Math.abs(e.velocity)||
0===e.velocity)break;var f=e.center;g.ea={x:f.x,y:f.y};g.ca={x:f.x,y:f.y};g.v=1===e.pointers.length?g.u.ld:g.u.oe;break;case "pinchstart":g.wa=e.scale;g.ja=e.scale;g.v=g.u.qe;break;case "swipeup":g.scene3D.aa.ba.jd.show();break;case "swipeleft":g.scene3D.aa.ba.il.show(!0);break;case "swiperight":g.scene3D.aa.ba.ck.show();break;case "swipedown":g.scene3D.aa.ba.jd.hide(),g.scene3D.aa.ba.il.show(!1),g.scene3D.aa.ba.ck.hide()}};this.Ha=function(){g.v=g.u.NONE};this.Qa=function(e){if("mouse"!==e.pointerType)switch(e.type){case "panmove":e=
g.v===g.u.ld?{x:e.pointers[0].clientX,y:e.pointers[0].clientY}:e.center;g.ca={x:e.x,y:e.y};break;case "pinchmove":g.ja=e.scale}};this.update=function(){if(this.v!==this.u.NONE)if(this.v===this.u.ld){var e=.0125*(this.ca.x-this.ea.x),f=.0125*(this.ca.y-this.ea.y);this.scene3D.aa.rotate(e,f,0);this.ea=this.ca}else this.v===this.u.qe?(this.scene3D.aa.translate(0,0,30*(this.ja-this.wa)),this.wa=this.ja):this.v===this.u.oe&&(e=.1*(this.ca.x-this.ea.x),f=.1*(this.ca.y-this.ea.y),this.scene3D.aa.translate(e,
-f,0),this.ea=this.ca)};h.on("panstart pinchstart swipeleft swiperight swipeup swipedown press tap",this.Fb);h.on("panend pinchend",this.Ha);h.on("panmove pinchmove",this.Qa)}Zf.prototype=Object.create(Rf.prototype);Zf.prototype.constructor=Zf;function $f(e){this.xa=e;this.ma=this.xa.ma;this.Ea=this.xa.qa;this.parent=this.xa;this.fa=Ie();this.fa.subscribe(this);this.visible=!0;this.da=null;this.kc=[];this.u=null}z=$f.prototype;
z.Oa=function(){throw"This method must be defined by childrens of Representation";};z["delete"]=function(){var e=this.fa;void 0!==this.update&&e.Ed.splice(e.Ed.indexOf(this));if(null!=this.da)if(this.parent.remove(this.da),this.da.geometry.dispose(),this.da.material instanceof THREE.MultiMaterial)for(var e=this.da.material.materials,f=0;f<e.length;f++)e[f].dispose();else this.da.material.dispose()};z.Kd=function(){this.xa instanceof ag?this.color(R.nb):this.xa instanceof bg?this.color(R.fc):this.color(R.nb)};
z.yb=function(e,f){null==this.da&&this.Oa();var g=this.da.geometry.attributes.highlight;if(null!=g){var h=e?1:0,k=g.array.slice();if(null!=f){for(var m=[],l=this.da.geometry.attributes.atomIndex.array,q=0;q<f.length;q++)m.push(this.ma.indexOf(f[q]));for(var q=g.count,r=0;r<q;r++)-1!==m.indexOf(l[r])&&(k[r]=h)}else k.fill(h);g.set(k);g.needsUpdate=!0}};z.show=function(){null===this.da&&this.Oa();null!==this.da&&(this.visible=this.da.visible=!0)};
z.hide=function(){null!==this.da&&(this.visible=this.da.visible=!1)};
z.color=function(e,f){this.u=e;var g,h,k,m;if("string"===typeof e){if(void 0!=Dd[e])h=Dd[e].r,k=Dd[e].g,m=Dd[e].b;else if("#"==e.substring(0,1))g=e.replace("#",""),e=[parseInt(g.substring(0,2),16),parseInt(g.substring(2,4),16),parseInt(g.substring(4,6),16)],h=e[0],k=e[1],m=e[2];else if("rgb("==e.substring(0,4))e=e.replace("rgb(",""),e=e.replace(")",""),e=e.split(","),h=e[0],k=e[1],m=e[2];else throw Error("unrecognized color");if(void 0!=f)return g=new Mf(f,this),Nf(g,h,k,m),g;cg(this,h,k,m)}else{a:{for(g in R)if(R[g]===
e){g=!0;break a}g=!1}if(g){if(void 0!=f)return h=dg(this,e),k=g=new Mf(f,this),k.Hh=!0,k.map=h,k.init(),g;g=e;if(null!==this.da)if(h=this.da.geometry,h instanceof THREE.BufferGeometry){k=h.attributes.color.array;m=h.attributes.atomIndex.array.length;for(var l=0;l<m;l++){var q;q=g;var r=l;null==this.kc[q.id]&&(this.kc[q.id]=dg(this,q));q=this.kc[q.id][r];void 0!=q&&(k[3*l]=q.r,k[3*l+1]=q.g,k[3*l+2]=q.b)}h.attributes.color.needsUpdate=!0}else console.warn("Unknown type of geometry for coloring by atom ",
h)}else if(3===e.length){h=e[0];k=e[1];m=e[2];if(0<f)return g=new Mf(f,this),Nf(g,h,k,m),g;cg(this,h,k,m)}else if(Array.isArray(e)){if(g=e,this.xa instanceof ag||console.warn("Buffer coloring is only managed for Molecule3D"),null!==this.da)if(h=this.da.geometry,h instanceof THREE.BufferGeometry){k=h.attributes.color.array;m=h.attributes.atomIndex.array;l=m.length;if(this.xa.sa.ga.length!==g.length)for(q=0;q<l;q++){var t=m[q],t=this.ma[t],x=t.u-1,t=g[x];if(null==t)console.warn("Unknow color for residue id ",
x,". Buffer size is ",g.length);else{var x=t[0],w=t[1],t=t[2];if(1<x||1<w||1<t)x/=255,w/=255,t/=255;k[3*q]=x;k[3*q+1]=w;k[3*q+2]=t}}else{var B=r=-1;for(q=0;q<l;q++)if(t=m[q],t=this.ma[t],x=t.u-1,x!==r&&(B++,r=x),t=g[B],null==t)console.warn("Unknow color for residue id ",B,". Buffer size is ",g.length);else{x=t[0];w=t[1];t=t[2];if(1<x||1<w||1<t)x/=255,w/=255,t/=255;k[3*q]=x;k[3*q+1]=w;k[3*q+2]=t}}h.attributes.color.needsUpdate=!0}else console.warn("Unknown type of geometry for coloring by buffer ",
h)}else throw Error("unrecognized color");}};
function dg(e,f){var g=e.kc,h=f.id,k;if(f===R.ti){var m=[];e.xa instanceof ag?m=e.xa.sa.Aa():e.xa instanceof bg?m=e.xa.wb.Aa():e.xa instanceof eg&&(m=[e.xa.vm]);k=new Ca;for(var l=m.length,q=0;q<l;q++)k.set(m[q],(new THREE.Color).setHSL(q/l*.8,1,.42));if(null!==e.da){q=e.da.geometry;m=[];if(q instanceof THREE.BufferGeometry)for(l=q.attributes.atomIndex.array,q=0;q<l.length;q++){var r=k.get(e.ma[l[q]]);m.push(r)}else console.warn("Unknown type of geometry for mapping by rainbow ",q);k=m}else k=void 0}else if(f===
R.ri)if(e.xa instanceof ag?e.xa.sa.Aa():e.xa instanceof bg&&e.xa.wb.Aa(),l=e.da.geometry,k=[],q="IVLFCMAGTWSYPHEZQDBNKR".split(""),m=[45,42,38,28,25,19,18,-4,-7,-9,-8,-13,-16,-32,-35,-35,-35,-35,-35,-35,-39,-45],null!=e.da)for(l=l.attributes.atomIndex.array,r=0;r<l.length;r++){var t=null,t=e.ma[l[r]].ib();if("Peptide"==t.type||"Protein"==t.type||"Small Peptide"==t.type){var x;for(x=0;x<q.length&&q[x]!=t.ij().toUpperCase();x++);x==q.length?t=new THREE.Color(1,1,1):(t=m[x],t=0<t?new THREE.Color(1,1-
t/45,1-t/45):new THREE.Color(1-t/-45,1-t/-45,1))}else t=new THREE.Color(1,1,1);k.push(t)}else k=void 0;else if(null!==e.da){k=e.da.geometry.attributes.atomIndex.array;q=k.length;m=[];for(l=0;l<q;l++){var r=e,t=k[l],w=x=x=x=void 0,w=void 0;switch(f){case R.nc:x=r.ma[t].ib().Fa.id.toUpperCase();x=$e(r.fa,x,"M");break;case R.fc:x=r.ma[t].ib().Lc().toUpperCase();x=$e(r.fa,x,"R");break;case R.nb:w=r.ma[t];w=w.symbol.charAt(0).toUpperCase()+w.symbol.slice(1).toLowerCase();x=$e(r.fa,w,"A");break;case R.oi:w=
r.ma[t];"C"===w.symbol&&(w=w.symbol.charAt(0).toUpperCase()+w.symbol.slice(1).toLowerCase(),x=$e(r.fa,w,"A"));break;case R.pi:w=r.ma[t];"C"!==w.symbol&&(w=w.symbol.charAt(0).toUpperCase()+w.symbol.slice(1).toLowerCase(),x=$e(r.fa,w,"A"));break;case R.vi:w=r.ma[t],x=$e(r.fa,w.ib().mb.name,"SST")}m.push(x)}k=m}else k=void 0;g[h]=k;return e.kc[f.id]}
function cg(e,f,g,h){1<f&&(f=f/255);1<g&&(g=g/255);1<h&&(h=h/255);if(null!==e.da)if(e=e.da.geometry,e instanceof THREE.BufferGeometry){for(var k=e.attributes.color.array,m=k.length/3,l=0;l<m;l++)k[3*l]=f,k[3*l+1]=g,k[3*l+2]=h;e.attributes.color.needsUpdate=!0}else console.warn("Unknown type of geometry for coloring by atom ",e)}
z.qg=function(e,f){if(null!==this.da)if(void 0===f||0===f){if(this.da.material instanceof THREE.MultiMaterial)for(var g=0,h=this.da.material.materials.length;g<h;g++){var k=this.da.material.materials[g];k.transparent=1!==e;k.blending=k.transparent&&this.fa.$e?THREE.CustomBlending:THREE.NormalBlending;k.opacity=e}this.da.material.transparent=1!==e;this.da.material.blending=this.da.material.transparent&&this.fa.$e?THREE.CustomBlending:THREE.NormalBlending;this.da.material.opacity=e}else return new Lf(e,
f,this);return null};z.update=function(e){if(e.fi){e=e.bh;if(void 0!=e){if("Amino Acids"===e||"Nucleic Acids"===e)e=R.fc;this.kc[e]=null}else this.kc=[];this.color(this.u)}};
var R={nc:{name:"Molecules",id:"molecule"},fc:{name:"Residues",id:"residue"},nb:{name:"Atoms",id:"atom"},oi:{name:"Carbon atom",id:"carbon"},pi:{name:"Heteroatom",id:"heteroatom"},vi:{name:"Secondary Structure",id:"sse"},ti:{name:"Rainbow",id:"rainbow"},ri:{name:"Hydrophobicity",id:"hydrophobicity"},Gk:function(){var e=[],f;for(f in this){var g=this[f];this.hasOwnProperty(f)&&"object"===("undefined"===typeof g?"undefined":ha(g))&&e.push(g.name)}return e},oh:function(e){for(var f in this)if(this[f].id===
e)return this[f];return null},Xf:function(e){for(var f in this)if(this[f].name===e)return this[f];return null}};function fg(e,f,g){this.name=e;this.gk=f;this.Ia=g;var h=arguments.length-3;1<=h&&(this.gl=arguments[3]);2<=h&&(this.fm=arguments[4])}var N={};N.NONE=new fg("","NONE",null);N.$f=function(e){for(var f in N)if(N[f].gk===e)return N[f]};var gg=Object;
gg.uk=function(e,f){for(var g=null,h=hg(e),k=h.length,m=0;m<k;m++)g=h[m],g.kb=!1,g.alpha=THREE.GeometryUtils.Wl(g.a,g.b,g.c,g.d),g.Nc=g.alpha>f;for(var l=new Ca,h=hg(e),k=h.length,m=0;m<k;m++){for(var g=h[m],q=[],r=ig(g),t=0;4>t;t++){var x=jg(g,t);q.push(gg.Zk(g,x[3],r[t],x[0],x[1],x[2],f))}l.set(g,q)}x=[];h=hg(e);k=h.length;for(m=0;m<k;m++)if(g=h[m],g.kb=!1,g.Nc=!1,null==g.Eb||null==g.Jb||null==g.Kb||null==g.Lb){r=ig(g);q=l.get(g);for(t=0;4>t;t++)null!=r[t]||q[t]||(g.Nc=!0);g.Nc&&x.push(g)}for(;0!==
x.length;)for(m=x[x.length-1],x.splice(x.length-1),m.kb=!0,m.Nc=!0,r=ig(m),q=l.get(m),t=0;4>t;t++)null==r[t]||r[t].kb||q[t]||x.push(r[t]);h=hg(e);k=h.length;for(m=0;m<k;m++)if(g=h[m],g.kb=!1,!g.Nc)for(r=ig(g),q=l.get(g),t=0;4>t;t++)null==r[t]||r[t].Nc||(q[t]=!1);return l};
gg.ik=function(e,f,g){g=gg.uk(f,g);f=hg(f);for(var h=[],k=Array(3),m=f.length,l=0;l<m;l++){for(var q=f[l],r=ig(q),t=g.get(q),r=r.length,x=0;x<r;x++)if(t[x]){for(var w=jg(q,x),B=0;3>B;B++){var D=w[B],E=h.indexOf(D);-1===E&&(E=h.push(D)-1,ce(e,D.x,D.y,D.z));k[B]=E}q.Nc?de(e,k[2],k[1],k[0]):de(e,k[0],k[1],k[2])}q.kb=!0}return h};
gg.Zk=function(e,f,g,h,k,m,l){if(null==e)throw"!!";var q=e.Nc,r=null==g||g.Nc;return q!=r||q&&r&&(null==g||0<THREE.GeometryUtils.lj(h,k,m,kg(e,g)))&&0<THREE.GeometryUtils.lj(h,k,m,f)&&l>=THREE.GeometryUtils.Yl(h,k,m)?!0:!1};function lg(){this.wj=1.4;this.alpha=0;this.Ri=new Ca}function mg(){this.Ea=[];this.dj=[];this.Uf=0}function ng(e){return e.Ea.length-e.Uf}function og(e,f,g){THREE.Vector3.call(this);this.yh=!0;this.x=e;this.y=f;this.z=g;this.radius=this.weight=1;this.Gb=[]}
og.prototype.set=function(e,f){this.weight=e;this.radius=f};og.prototype.toString=function(){return this.x+":"+this.y+":"+this.z};og.prototype.Bb=function(){return this.x+":"+this.y+":"+this.z};function pg(e,f,g,h){for(var k=e.Gb.length,m=0;m<k;m++){var l=e.Gb[m];if(qg(l,g)&&qg(l,h)&&l!=f)return l}return null}og.prototype.remove=function(){for(var e=[],f=this.Gb.length,g=0;g<f;g++)e.push(this.Gb[g]);f=e.length;for(g=0;g<f;g++)e[g].disconnect()};
function rg(){this.Vi=this.Jc=this.vd=this.hc=this.max=this.min=null;this.jf=0;this.Ic=[];this.Wd=[];this.ab=[];this.iterator=null;this.hl=0}rg.prototype.toString=function(){return"Tesselation"};function sg(e,f){var g=Math.trunc((f.x-e.min.x)*e.hc/(e.max.x-e.min.x)),h=Math.trunc((f.y-e.min.y)*e.vd/(e.max.y-e.min.y)),k=Math.trunc((f.z-e.min.z)*e.Jc/(e.max.z-e.min.z));0>g&&(g=0);g>=e.hc&&(g=e.hc-1);0>h&&(h=0);h>=e.vd&&(h=e.vd-1);0>k&&(k=0);k>=e.Jc&&(k=e.Jc-1);return g+h*e.hc+k*e.hc*e.Jc}
function tg(e,f,g){f.Ye=!0;e.Wd.push(f);var h=f.Eb;null==h||void 0===h||h.kb||(h.kb=!0,0<ug(h,g)&&tg(e,h,g));h=f.Jb;null==h||void 0===h||h.kb||(h.kb=!0,0<ug(h,g)&&tg(e,h,g));h=f.Kb;null==h||void 0===h||h.kb||(h.kb=!0,0<ug(h,g)&&tg(e,h,g));h=f.Lb;null==h||void 0===h||h.kb||(h.kb=!0,0<ug(h,g)&&tg(e,h,g))}
function vg(e,f){f.kb=!1;var g;g=f.Eb;null!=g&&void 0!==g&&g.kb&&vg(e,g);g=f.Jb;null!=g&&void 0!==g&&g.kb&&vg(e,g);g=f.Kb;null!=g&&void 0!==g&&g.kb&&vg(e,g);g=f.Lb;null!=g&&void 0!==g&&g.kb&&vg(e,g)}function hg(e){var f=0;e.iterator=new wg(e);for(var g=[];null!=e.iterator.$a;){var h=e.iterator.next();void 0!==h&&g.push(h);f++}return g}
function wg(e){this.Qd=e;this.Ob=this.Ub=0;for(this.$a=this.Qd.Ic[this.Ub];this.Ub<this.Qd.jf&&(null==this.$a||void 0==this.$a||0==ng(this.$a));)this.Ub++,this.$a=this.Ub<this.Qd.jf?this.Qd.Ic[this.Ub]:null;if(null!=this.$a&&void 0!=this.$a)for(;this.Ob<this.$a.Ea.length&&(null==this.$a.Ea[this.Ob]||void 0==this.$a.Ea[this.Ob]);)this.Ob++}
wg.prototype.next=function(){var e=this.Qd.Ic[this.Ub].Ea[this.Ob];for(this.Ob++;this.Ob<this.$a.Ea.length&&(null==this.$a.Ea[this.Ob]||void 0===this.$a.Ea[this.Ob]);)this.Ob++;if(this.Ob>=this.$a.Ea.length){this.Ob=0;for(this.Ub++;this.Ub<this.Qd.jf;){this.$a=this.Qd.Ic[this.Ub];if(null!==this.$a&&void 0!==this.$a&&0<ng(this.$a))break;this.Ub++}this.Ub>=this.Qd.jf&&(this.$a=null)}if(null!=this.$a&&void 0!=this.$a)for(;this.Ob<this.$a.Ea.length&&null==this.$a.Ea[this.Ob];)this.Ob++;return e};
function xg(){this.kb=!1;this.Nc=null;this.alpha=-1;this.Ye=!1;this.box=this.d=this.c=this.b=this.a=this.Mh=null;this.Ub=-1;this.id=this.Lb=this.Kb=this.Jb=this.Eb=null}xg.prototype.toString=function(){return this.Mh+":"+this.id};xg.prototype.Bb=function(){return this.Mh+":"+this.id};
xg.prototype.set=function(e,f,g,h,k,m){this.Mh=e;this.a=f;this.b=g;this.c=h;this.d=k;this.Ye=!1;this.id=e.hl++;var l=new THREE.Vector3((this.a.x+this.b.x+this.c.x+this.d.x)/4,(this.a.y+this.b.y+this.c.y+this.d.y)/4,(this.a.z+this.b.z+this.c.z+this.d.z)/4),l=sg(e,l);if(void 0===e.Ic[l]||null===e.Ic[l])e.Ic[l]=new mg;e=e.Ic[l];this.box=e;e=this.box;l=0<e.Uf?e.dj[--e.Uf]:e.Ea.length;e.Ea[l]=this;this.Ub=l;f.Gb.push(this);g.Gb.push(this);h.Gb.push(this);k.Gb.push(this);null!=m?this.Eb=m:this.Eb=pg(this.a,
this,this.b,this.c);null!=this.Eb&&Qg(this.Eb,this.a,this.b,this.c,this);this.Jb=pg(this.a,this,this.c,this.d);null!=this.Jb&&Qg(this.Jb,this.a,this.c,this.d,this);this.Kb=pg(this.a,this,this.d,this.b);null!=this.Kb&&Qg(this.Kb,this.a,this.d,this.b,this);this.Lb=pg(this.b,this,this.d,this.c);null!=this.Lb&&Qg(this.Lb,this.b,this.d,this.c,this)};
function ug(e,f){var g=e.a.x-f.x,h=e.a.y-f.y,k=e.a.z-f.z,m=e.b.x-f.x,l=e.b.y-f.y,q=e.b.z-f.z,r=e.c.x-f.x,t=e.c.y-f.y,x=e.c.z-f.z,w=e.d.x-f.x,B=e.d.y-f.y,D=e.d.z-f.z;return-THREE.GeometryUtils.sign(THREE.GeometryUtils.qk(g,h,k,g*g+h*h+k*k+(f.weight-e.a.weight),m,l,q,m*m+l*l+q*q+(f.weight-e.b.weight),r,t,x,r*r+t*t+x*x+(f.weight-e.c.weight),w,B,D,w*w+B*B+D*D+(f.weight-e.d.weight)))}
function Qg(e,f,g,h,k){if(f===e.a||g===e.a||h===e.a)if(f===e.c||g===e.c||h===e.c)f===e.b||g===e.b||h===e.b?e.Eb=k:e.Jb=k;else{if(f!==e.d&&g!==e.d&&h!==e.d)throw"This tetrahedron doesn't have the right vertices";e.Kb=k}else if(f===e.b||g===e.b||h===e.b)e.Lb=k;else throw"This tetrahedron doesn't have the right vertices - ("+f+"),("+g+"),("+h+") - ("+a+"),("+b+"),("+c+"),("+d+")";}function ig(e){var f=[];f.push(e.Eb);f.push(e.Jb);f.push(e.Kb);f.push(e.Lb);return f}
function jg(e,f){if(0==f)return[e.c,e.b,e.a,e.d];if(1==f)return[e.d,e.c,e.a,e.b];if(2==f)return[e.b,e.d,e.a,e.c];if(3==f)return[e.c,e.d,e.b,e.a];throw"i :"+f+" not between 0 and 3";}function qg(e,f){return e.a.x===f.x&&e.a.y===f.y&&e.a.z===f.z||e.b.x===f.x&&e.b.y===f.y&&e.b.z===f.z||e.c.x===f.x&&e.c.y===f.y&&e.c.z===f.z||e.d.x===f.x&&e.d.y===f.y&&e.d.z===f.z}
xg.prototype.disconnect=function(){var e=this.box,f=this.Ub;e.Ea[f]=null;e.dj[e.Uf++]=f;null!=this.Eb&&Qg(this.Eb,this.a,this.b,this.c,null);null!=this.Jb&&Qg(this.Jb,this.a,this.c,this.d,null);null!=this.Kb&&Qg(this.Kb,this.a,this.d,this.b,null);null!=this.Lb&&Qg(this.Lb,this.b,this.d,this.c,null);this.a.Gb.splice(this.a.Gb.indexOf(this),1);this.b.Gb.splice(this.b.Gb.indexOf(this),1);this.c.Gb.splice(this.c.Gb.indexOf(this),1);this.d.Gb.splice(this.d.Gb.indexOf(this),1);this.Lb=this.Kb=this.Jb=this.Eb=
this.d=this.c=this.b=this.a=null};function kg(e,f){if(f.Eb==e)return f.d;if(f.Jb==e)return f.b;if(f.Kb==e)return f.c;if(f.Lb==e)return f.a;throw"getOtherVertex: Tetrahedra "+e+" and "+f+" not touching";}function Rg(e,f){$f.call(this,e);this.wireframe=f}Rg.prototype=Object.create($f.prototype);Rg.prototype.constructor=Rg;N.Cg=new fg("Alpha Shape","ASHAPE",Rg,!1);N.ji=new fg("Alpha Shape Wireframe","ASHAPEM",Rg,!0);
Rg.prototype.Oa=function(){var e=ef(this.fa),f=null;if(this.wireframe)e.wireframe=!0,e.wireframeLinewidth=2,f=Sg(this.xa,N.Cg),null===f.da&&(f.Oa(),f.hide()),f=f.da.geometry.clone();else{e.side=THREE.DoubleSide;e.shading=THREE.FlatShading;for(var f=new lg,g=this.ma,h=[],k=g.length,m=0;m<k;m++){var l=g[m];f.Ri.set(l.pos,l);var q=df(Ie(),l),r=(q+f.wj)*(q+f.wj),l=new og(l.pos.x,l.pos.y,l.pos.z);l.set(r,q);h.push(l)}l=new rg;if(4>h.length)throw"Too few points to tesselate";l.min=new THREE.Vector3(Infinity,
Infinity,Infinity);l.max=new THREE.Vector3(-Infinity,-Infinity,-Infinity);k=h.length;for(m=0;m<k;m++)q=h[m],l.min.x=Math.min(l.min.x,q.x),l.min.y=Math.min(l.min.y,q.y),l.min.z=Math.min(l.min.z,q.z),l.max.x=Math.max(l.max.x,q.x),l.max.y=Math.max(l.max.y,q.y),l.max.z=Math.max(l.max.z,q.z);var r=(l.min.x+l.max.x)/2,t=(l.min.y+l.max.y)/2,x=(l.min.z+l.max.z)/2,w=l.min.distanceTo(l.max);l.hc=8;l.vd=8;l.Jc=8;l.Vi=Math.max(l.hc,Math.max(l.vd,l.Jc));l.jf=l.hc*l.vd*l.Jc;k=new og(r-w,t-w,x-w);m=new og(r+w,t+
w,x-w);q=new og(r-w,t+w,x+w);r=new og(r+w,t-w,x+w);(new xg).set(l,k,m,q,r,null);t=h.length;for(x=0;x<t;x++){var w=l,B=h[x];w.Wd=[];var D=!1,E=w.Ic[sg(w,B)];if(void 0!==E&&null!==E){var I=void 0;for(I in E.Ea){var H=E.Ea[I];if(null!=H){var K=ug(H,B);0===K&&console.warn(">1 point on the same power sphere");if(null!==H&&void 0!==H&&0<K){H.kb=!0;tg(w,H,B);vg(w,H);D=!0;break}}}}if(!D)for(var E=!1,K=Math.trunc((B.x-w.min.x)*w.hc/(w.max.x-w.min.x)),G=Math.trunc((B.y-w.min.y)*w.vd/(w.max.y-w.min.y)),L=Math.trunc((B.z-
w.min.z)*w.Jc/(w.max.z-w.min.z)),D=1;D<w.Vi&&!E;D++)for(var P=-D;P<=D&&!E;P++)for(var Q=-D;Q<=D&&!E;Q++)for(var V=-D;V<=D&&!E;V++)if(Math.abs(V)==D||Math.abs(Q)==D||Math.abs(P)==D){var H=K+V,aa=G+Q,oa=L+P;if(!(0>H||H>=w.hc||0>aa||aa>=w.vd||0>oa||oa>=w.Jc)&&(H=w.Ic[Math.trunc(H+aa*w.hc+oa*w.hc*w.Jc)],null!=H))for(I in aa=H.Ea,aa)if(H=aa[I],null!=H&&void 0!=H&&0<ug(H,B)){H.kb=!0;tg(w,H,B);vg(w,H);E=!0;break}}w.ab=[];E=w.Wd.length;for(D=0;D<E;D++)H=w.Wd[D],null!=H.Eb&&H.Eb.Ye||(w.ab.push(H.Eb),w.ab.push(H.a),
w.ab.push(H.b),w.ab.push(H.c)),null!=H.Jb&&H.Jb.Ye||(w.ab.push(H.Jb),w.ab.push(H.a),w.ab.push(H.c),w.ab.push(H.d)),null!=H.Kb&&H.Kb.Ye||(w.ab.push(H.Kb),w.ab.push(H.a),w.ab.push(H.d),w.ab.push(H.b)),null!=H.Lb&&H.Lb.Ye||(w.ab.push(H.Lb),w.ab.push(H.b),w.ab.push(H.d),w.ab.push(H.c));for(D=0;D<E;D++)H=w.Wd[D],H.disconnect();H=0;E=w.ab.length;for(D=0;D<E;D+=4)K=w.ab[D],G=w.ab[D+1],L=w.ab[D+2],P=w.ab[D+3],Q=(new THREE.Vector3((G.x+L.x+P.x)/3,(G.y+L.y+P.y)/3,(G.z+L.z+P.z)/3)).sub(B),Q=0>THREE.Vector3.u(G,
L,P).dot(Q),V=H<w.Wd.length?w.Wd[H++]:new xg,Q?V.set(w,G,L,P,B,K):V.set(w,P,L,G,B,K)}k.remove();m.remove();q.remove();r.remove();I=new be(!0);h=gg.ik(I,l,f.alpha);k=h.length;for(l=0;l<k;l++){m=h[l];q=f.Ri.get(m);r=g.indexOf(q);if(void 0===q)throw"Couldn't get atom for position :"+m.x+", "+m.y+", "+m.z;I.Wc.push(r)}f=ee(I);f.computeVertexNormals()}e=new THREE.Mesh(f,e);e.Ia=this;this.parent.add(e);this.da=e;this.color(R.nb)};Rg.prototype.update=function(e){$f.prototype.update.call(this,e)};
function Tg(e){$f.call(this,e)}Tg.prototype=Object.create($f.prototype);Tg.prototype.constructor=Tg;N.ne=new fg("Atoms","ATOMS",Tg);
Tg.prototype.Oa=function(){for(var e=new THREE.BufferGeometry,f=[],g=[],h=[],k=this.ma.length,m=0;m<k;m++){var l=this.ma[m],q=l.pos.clone();q.qa=l;q.x-=.5;var r=l.pos.clone();r.qa=l;r.x+=.5;var t=l.pos.clone();t.qa=l;t.y-=.5;var x=l.pos.clone();x.qa=l;x.y+=.5;var w=l.pos.clone();w.qa=l;w.z-=.5;var B=l.pos.clone();B.qa=l;B.z+=.5;f.push(q.x,q.y,q.z,r.x,r.y,r.z,t.x,t.y,t.z,x.x,x.y,x.z,w.x,w.y,w.z,B.x,B.y,B.z);for(l=0;18>l;l++)g.push(1);for(l=0;6>l;l++)h.push(m)}e.addAttribute("position",THREE.Float32Attribute(f,
3));f=THREE.Float32Attribute(g,3);f.dynamic=!0;e.addAttribute("color",f);e.addAttribute("atomIndex",THREE.Float32Attribute(h,1));e.dd();h=new THREE.LineBasicMaterial({linewidth:this.fa.bi,vertexColors:THREE.VertexColors});e=new THREE.LineSegments(e,h);e.Ia=this;this.parent.add(e);this.da=e;this.Kd()};Tg.prototype.update=function(e){$f.prototype.update.call(this,e);e.bi&&(this.parent.remove(this.da),this.da=null,this.Oa())};function Ug(e){$f.call(this,e)}Ug.prototype=Object.create($f.prototype);
Ug.prototype.constructor=Ug;N.bf=new fg("Balls & sticks","BSTICKS",Ug);
Ug.prototype.Oa=function(){if(this.fa.bg){var e=Sg(this.xa,N.gc);null===e.da&&(e.Oa(),e.hide());var f=e.da.geometry.clone(),g=f.attributes.radius.array;g.fill(this.fa.ra.la.radius,0,e.pf);var h=jf(this.fa),k=kf(this.fa),k=new THREE.MultiMaterial([h,k]);k.opacity=h.opacity;f.addGroup(0,e.pf,0);f.addGroup(e.pf,g.length,1);e=new THREE.Points(f,k)}else{var f=af(this.fa),e=ef(this.fa),m=(new THREE.BufferGeometry).fromGeometry(f),l=this.ma.length,q=m.attributes.position.array.length/m.attributes.position.itemSize,
k=l*q,g=Sg(this.xa,N.gc);null===g.da&&(g.Oa(),g.hide());for(var f=new THREE.BufferGeometry,g=g.da.geometry,r=Array(3*k),t=Array(3*k),x=Array(3*k),h=Array(2*k),k=Array(k),w=0;w<l;w++){var B=this.ma[w],D=new THREE.Matrix4;D.setPosition(B.pos);B=m.clone();B.applyMatrix(D);for(var E=B.attributes.position.array,D=0;D<E.length;D++)r[w*E.length+D]=E[D];E=B.attributes.normal.array;for(D=0;D<E.length;D++)t[w*E.length+D]=E[D];E=B.attributes.color.array;for(D=0;D<E.length;D++)x[w*E.length+D]=E[D];B=B.attributes.uv.array;
for(D=0;D<B.length;D++)h[w*B.length+D]=B[D];for(D=0;D<q;D++)k[w*q+D]=w}m=new Float32Array(r);l=new Float32Array(t);x=new Float32Array(x);h=new Float32Array(h);k=new Float32Array(k);q=new Float32Array(m.length+g.attributes.position.array.length);q.set(g.attributes.position.array);q.set(m,g.attributes.position.array.length);m=new Float32Array(l.length+g.attributes.normal.array.length);m.set(g.attributes.normal.array);m.set(l,g.attributes.normal.array.length);l=new Float32Array(x.length+g.attributes.color.array.length);
l.set(g.attributes.color.array);l.set(x,g.attributes.color.array.length);x=new Float32Array(h.length+g.attributes.uv.array.length);x.set(g.attributes.uv.array);x.set(h,g.attributes.uv.array.length);h=new Float32Array(k.length+g.attributes.atomIndex.array.length);h.set(g.attributes.atomIndex.array);h.set(k,g.attributes.atomIndex.array.length);f.addAttribute("position",new THREE.BufferAttribute(q,3));f.addAttribute("normal",new THREE.BufferAttribute(m,3));E=new THREE.BufferAttribute(l,3);E.dynamic=
!0;f.addAttribute("color",E);f.addAttribute("uv",new THREE.BufferAttribute(x,2));f.addAttribute("atomIndex",new THREE.BufferAttribute(h,1));f.dd();this.fa.bg&&fe(f);e=new THREE.Mesh(f,e)}e.Ia=this;this.parent.add(e);this.da=e;this.Kd()};Ug.prototype.update=function(e){$f.prototype.update.call(this,e);e.vf&&(this.kc=[],e=Sg(this.xa,N.gc),e.parent.remove(e.da),e.da=null,e=this.da.visible,this.parent.remove(this.da),this.da=null,this.Oa(),this.da.visible=e)};function Vg(e){$f.call(this,e)}
Vg.prototype=Object.create($f.prototype);Vg.prototype.constructor=Vg;N.Df=new fg("Cartoon","CARTOON",Vg);Vg.wa=.075;Vg.ja=1.2;Vg.ea=.25;Vg.Fb=1.3;Vg.Qa=.5;Vg.ca=.175;Vg.v=.175;Vg.Ha=34;Vg.vc=12;
Vg.prototype.Oa=function(){var e=$e(this.fa,this.xa.sa.id,"M"),f=null;if(this.Ea.Bd()){var g=this.Ea;g.Pi();var h=[],f=[];h.push(f);for(var k=g.ga,g=g.Aa(),m=["N","CA","C"],l=null,q=k.length,r=0;r<q;r++){var t=k[r];if(null!==l){var x=0;isNaN(parseFloat(t.ta()))||(x+=parseFloat(t.ta()));isNaN(parseFloat(l.ta()))||(x-=parseFloat(l.ta()));isNaN(t.xb().charCodeAt(0))||(x+=t.xb().charCodeAt(0));isNaN(l.xb().charCodeAt(0))||(x-=l.xb().charCodeAt(0));1<x&&(f=[],h.push(f))}for(var w in m)if(l=t.jc(m[w]),
void 0!==l&&null!==l){var x=new Wg(l),B=g.indexOf(l);x.cc=e;x.qa=l;x.Va=B;x.kd="CA"!==l.name;switch(t.mb.name){case F.u.name:x.width=Vg.wa;x.height=Vg.ja;x.ic=Vg.ea;break;case F.v.name:case F.ea.name:x.width=Vg.Fb;x.height=Vg.Qa;x.zb=!0;x.ae=Vg.Ha;break;default:x.width=Vg.ca,x.height=Vg.v}f.push(x)}l=t}f=h}else if(this.Ea.Me()){g=this.Ea;w=[];f=[];w.push(f);k=g.ga;g=g.Aa();m=["P","O5'","O3'"];l=null;q=k.length;for(r=0;r<q;r++){t=k[r];null!==l&&1<t.ta()-l.ta()+t.xb().charCodeAt(0)-l.xb().charCodeAt(0)&&
(f=[],w.push(f));for(h in m)l=t.jc(m[h]),null!==l&&void 0!==l&&(x=new Wg(l),B=g.indexOf(l),x.cc=e,x.qa=l,x.Va=B,x.kd=!0,x.width=Vg.wa,x.height=Vg.ja,x.ic=Vg.ea,x.ae=Vg.vc,f.push(x));l=t}f=w}w=new be(!0);if(null!==f){var h=new Xg,D;for(D in f)2<f[D].length&&Yg(h,w,f[D],e);e=ee(w);D=ef(this.fa);e=new THREE.Mesh(e,D);e.qa=this.Ea;e.Ia=this;this.parent.add(e);this.da=e;this.color(R.nc)}};Vg.prototype.Kd=function(){this.color(R.nc)};
Vg.prototype.update=function(e){$f.prototype.update.call(this,e);e.$l&&(e=this.da.visible,this.kc=[],this.parent.remove(this.da),this.da=null,this.Oa(),this.da.visible=e)};function W(e){$f.call(this,e)}W.prototype=Object.create($f.prototype);W.prototype.constructor=W;N.ni=new fg("Cylinder","CYLINDER",W);W.wa=.075;W.ja=1.2;W.ea=.25;W.Fb=1.3;W.Qa=.5;W.ca=.175;W.v=.175;W.Ha=34;W.vc=12;W.u=20;W.Dd=2.5;
W.prototype.Oa=function(){var e=$e(this.fa,this.xa.sa.id,"M"),f=null,g=[],h=[],k=[],m=[],l=[],q=[],r=[],t=[];if(this.Ea.Bd()){var x=this.Ea;x.Pi();for(var w=x.ga,B=x.Aa(),D=[],E=[],I=[],H=[],K=[],G=[],L=[],P=[],Q=!1,V=!1,aa=["N","CA","C"],oa=null,Hb=w.length,Tb=0;Tb<Hb;Tb++){var ga=w[Tb];if(null!==oa){var da=0;isNaN(parseFloat(ga.ta()))||(da+=parseFloat(ga.ta()));isNaN(parseFloat(oa.ta()))||(da-=parseFloat(oa.ta()));isNaN(ga.xb().charCodeAt(0))||(da+=ga.xb().charCodeAt(0));isNaN(oa.xb().charCodeAt(0))||
(da-=oa.xb().charCodeAt(0));1<da&&(Q?(I.push(H),Q=!1):V&&(D.push(E),V=!1))}for(var wa in aa){var Ib=ga.jc(aa[wa]);if(void 0!==Ib&&null!==Ib){var Z=new Wg(Ib),n=B.indexOf(Ib);Z.cc=e;Z.qa=Ib;Z.Va=n;Z.kd="CA"!==Ib.name;switch(ga.mb.name){case F.u.name:Q||(V&&(K.push(D.length),G.push(I.length),D.push(E),V=!1),H=[],Q=!0);H.push(Ib);break;case F.v.name:case F.ea.name:Z.width=W.Fb;Z.height=W.Qa;Z.zb=!0;Z.ae=W.Ha;Q?(P.push(I.length),L.push(D.length),I.push(H),Q=!1,E=[],V=!0):V||(E=[],V=!0);E.push(Z);break;
default:Z.width=W.ca,Z.height=W.v,Q?(P.push(I.length),L.push(D.length),I.push(H),Q=!1,E=[],V=!0):V||(E=[],V=!0),E.push(Z)}}}oa=ga}Q?I.push(H):V&&D.push(E);f=[D,I,K,G,L,P];g=f[0];h=f[1];k=f[2];m=f[3];l=f[4];q=f[5]}else this.Ea.Me()&&console.warn("Cylinder representation not available for nucleic molecules");var y=new be(!0);if(null!==g){var Jb=new Xg,ea;for(ea in h){var Ab=null,wc=null;if(2<h[ea].length){var cb,ta=y,Bb=h[ea],hd=e;console.assert(2<Bb.length,"Helix number must be > 2");for(var Ub,db=
Bb,pb=0,eb=0,qb=0,ra=0,fb=0,Pa=0,rb=0,Cb=0,Qa=0,qa=db.length,O=null,S=0;S<qa;S++)O=db[S],pb+=O.pos.x,eb+=O.pos.y,qb+=O.pos.z,ra+=O.pos.x*O.pos.x,fb+=O.pos.y*O.pos.y,Pa+=O.pos.z*O.pos.z,rb+=O.pos.x*O.pos.y,Cb+=O.pos.y*O.pos.z,Qa+=O.pos.z*O.pos.x;for(var sb=qa*ra-pb*pb,Ka=(qa*rb-pb*eb)/sb,Vb=(-pb*rb+ra*eb)/sb,Lc=qa*fb-eb*eb,jc=(qa*Cb-eb*qb)/Lc,Wb=(-eb*Cb+fb*qb)/Lc,Mc=qa*Pa-qb*qb,kc=(qa*Qa-qb*pb)/Mc,Db=(-qb*Qa+Pa*pb)/Mc,lc=1-Ka*jc*kc,La=(jc*kc*Vb+kc*Wb+Db)/lc,Xa=(Vb+Ka*kc*Wb+Ka*Db)/lc,gb=(jc*Vb+Wb+Ka*
jc*Db)/lc,fa=void 0,pa=void 0,la=void 0,Da=0,Eb=0,tb=Number.POSITIVE_INFINITY,ub=0;180>=ub;ub+=10)for(var Ma=Math.PI*ub/180,Fb=0;360>Fb;Fb+=10){for(var sa=Math.PI*Fb/180,fa=Math.cos(sa)*Math.sin(Ma),pa=Math.sin(sa)*Math.sin(Ma),la=Math.cos(Ma),Ra=0,S=0;S<qa;S++)var O=db[S],ma=(fa*(O.pos.x-La)+pa*(O.pos.y-Xa)+la*(O.pos.z-gb))/(fa*fa+pa*pa+la*la),Ya=fa*ma+La,ua=pa*ma+Xa,hb=la*ma+gb,Ra=Ra+((O.pos.x-Ya)*(O.pos.x-Ya)+(O.pos.y-ua)*(O.pos.y-ua)+(O.pos.z-hb)*(O.pos.z-hb));Ra<tb&&(tb=Ra,Da=Ma,Eb=sa)}for(var xc=
Da,yc=Eb,Xb=-10;10>=Xb;Xb++)for(var Ma=xc+Math.PI*Xb/180,xa=-10;10>=xa;xa++){sa=yc+Math.PI*xa/180;fa=Math.cos(sa)*Math.sin(Ma);pa=Math.sin(sa)*Math.sin(Ma);la=Math.cos(Ma);for(S=Ra=0;S<qa;S++)O=db[S],ma=(fa*(O.pos.x-La)+pa*(O.pos.y-Xa)+la*(O.pos.z-gb))/(fa*fa+pa*pa+la*la),Ya=fa*ma+La,ua=pa*ma+Xa,hb=la*ma+gb,Ra+=(O.pos.x-Ya)*(O.pos.x-Ya)+(O.pos.y-ua)*(O.pos.y-ua)+(O.pos.z-hb)*(O.pos.z-hb);Ra<tb&&(tb=Ra,Da=Ma,Eb=sa)}for(var fa=Math.cos(Eb)*Math.sin(Da),pa=Math.sin(Eb)*Math.sin(Da),la=Math.cos(Da),na=
[],ya=[],Nc=!1;!Nc;){for(S=0;S<db.length;S++)O=db[S],ma=(fa*(O.pos.x-La)+pa*(O.pos.y-Xa)+la*(O.pos.z-gb))/(fa*fa+pa*pa+la*la),ya[S]=ma,Ya=fa*ma+La,ua=pa*ma+Xa,hb=la*ma+gb,na[S]=new THREE.Vector3(Ya,ua,hb);ya[0]>ya[ya.length-1]?(fa=-fa,pa=-pa,la=-la):Nc=!0}for(S=0;S<db.length;S++)for(var Ea=S+1;Ea<db.length;Ea++)ya[S]>ya[Ea]&&(Ma=ya[S],ya[S]=ya[Ea],ya[Ea]=Ma,sa=na[S],na[S]=na[Ea],na[Ea]=sa);Ub=[na,fa,pa,la];var Kb=Ub[0],Oc=Ub[1],Pc=Ub[2],Yb=Ub[3],Sa=Kb[0],Na=Kb[Kb.length-1],mc=Na.clone().sub(Sa).normalize(),
zc=le(mc.clone()),nc=mc.clone().cross(zc).normalize(),ib=ta.pc.length/3,Lb=NaN,Za=0,Mb=Sa.clone();Mb.qa=Bb[0];var oc=this.ma.indexOf(Bb[0]);Mb.Va=oc;ce(ta,Mb.x,Mb.y,Mb.z,hd);ta.Wc.push(Mb.Va);var ib=ta.pc.length/3,Gb=ib-1;Zg(this,ta,zc,nc,Sa,Bb[0],hd);for(var Za=ib,ib=ta.pc.length/3,va=0;va<W.u;va++){var Ta=(va+1)%W.u;de(ta,Gb,Za+va,Za+Ta)}for(var A=1;A<Bb.length;A++){var vb=Bb[A],Na=Kb[A];Zg(this,ta,zc,nc,Na,vb,hd);Lb=Za;Za=ib;ib=ta.pc.length/3;for(va=0;va<W.u;va++)Ta=(va+1)%W.u,de(ta,Lb+va,Za+va,
Za+Ta),de(ta,Lb+va,Za+Ta,Lb+Ta)}var ja=Na.clone();ja.qa=Bb[Bb.length-1];oc=this.ma.indexOf(Bb[Bb.length-1]);ja.Va=oc;ce(ta,ja.x,ja.y,ja.z,hd);ta.Wc.push(ja.Va);ib=ta.pc.length/3;for(va=0;va<W.u;va++)Ta=(va+1)%W.u,de(ta,ib-1,Za+Ta,Za+va);Sa.add((new THREE.Vector3(Oc,Pc,Yb)).multiplyScalar(.3));Na.add((new THREE.Vector3(-Oc,-Pc,-Yb)).multiplyScalar(.3));cb=[Sa,Na];Ab=cb[0];wc=cb[1]}r.push(Ab);t.push(wc)}for(ea=0;ea<k.length;ea++){var Zb=k[ea],J=m[ea];if(null!=r[J]){var za=g[Zb],Aa=h[J],Ua=Aa[0],U=new Wg(Ua),
jb=this.ma.indexOf(Ua);U.cc=e;U.qa=Ua;U.Va=jb;U.width=W.ca;U.height=W.v;U.pos=r[J];za.push(U.clone());za.push(U.clone());za.push(U.clone())}}for(ea=0;ea<l.length;ea++)J=q[ea],Zb=l[ea],null!=r[J]&&(za=g[Zb],Aa=h[J],Ua=Aa[Aa.length-1],U=new Wg(Ua),jb=this.ma.indexOf(Ua),U.cc=e,U.qa=Ua,U.Va=jb,U.width=W.ca,U.height=W.v,U.pos=t[J],za.splice(0,0,U.clone()),za.splice(0,0,U.clone()),za.splice(0,0,U.clone()));for(ea in g)2<g[ea].length&&Yg(Jb,y,g[ea],e);var $b=ee(y),id=ef(this.fa);id.vertexColors=THREE.FaceColors;
var ac=new THREE.Mesh($b,id);ac.qa=this.Ea;ac.Ia=this;this.parent.add(ac);this.da=ac;this.color(R.nc)}};function Zg(e,f,g,h,k,m,l){for(var q=0;q<W.u;q++){var r=q*Math.PI*2/W.u,t=W.Dd*Math.sin(r),r=W.Dd*Math.cos(r),t=g.clone().multiplyScalar(t).add(h.clone().multiplyScalar(r)),t=k.clone().add(t);t.qa=m;t.Va=e.ma.indexOf(m);ce(f,t.x,t.y,t.z,l);f.Wc.push(t.Va)}}W.prototype.Kd=function(){this.color(R.nc)};W.prototype.update=function(e){$f.prototype.update.call(this,e)};
function $g(e){$f.call(this,e);this.Qb=this.xa.qa.Qb()}$g.prototype=Object.create($f.prototype);$g.prototype.constructor=$g;N.LINES=new fg("Lines","LINES",$g);
$g.prototype.Oa=function(){for(var e=new THREE.BufferGeometry,f=[],g=[],h=[],k=this.ma.length,m=0;m<k;m++){var l=this.ma[m],q=this.Qb.findNode(l);if(q){var r=q.bd();if(r)for(var t=r.length,x=0;x<t;x++){var w=Gd(r[x],q).nd;if(this.ma.includes(w)){var B=l.pos,w=w.pos,w=new THREE.Vector3((B.x+w.x)/2,(B.y+w.y)/2,(B.z+w.z)/2);f.push(B.x);f.push(B.y);f.push(B.z);f.push(w.x);f.push(w.y);f.push(w.z);for(B=0;6>B;B++)g.push(1);h.push(m);h.push(m)}}}}e.addAttribute("position",THREE.Float32Attribute(f,3));f=
THREE.Float32Attribute(g,3);f.dynamic=!0;e.addAttribute("color",f);e.addAttribute("atomIndex",THREE.Float32Attribute(h,1));e.dd();h=new THREE.LineBasicMaterial({linewidth:this.fa.lineWidth,vertexColors:THREE.VertexColors});e=new THREE.LineSegments(e,h);e.Ia=this;this.da=e;this.parent.add(e);this.Kd()};$g.prototype.update=function(e){$f.prototype.update.call(this,e);e.lineWidth&&(this.parent.remove(this.da),this.da=null,this.Oa())};
var ah=[[],[0,8,3],[0,1,9],[1,8,3,9,8,1],[1,2,10],[0,8,3,1,2,10],[9,2,10,0,2,9],[2,8,3,2,10,8,10,9,8],[3,11,2],[0,11,2,8,11,0],[1,9,0,2,3,11],[1,11,2,1,9,11,9,8,11],[3,10,1,11,10,3],[0,10,1,0,8,10,8,11,10],[3,9,0,3,11,9,11,10,9],[9,8,10,10,8,11],[4,7,8],[4,3,0,7,3,4],[0,1,9,8,4,7],[4,1,9,4,7,1,7,3,1],[1,2,10,8,4,7],[3,4,7,3,0,4,1,2,10],[9,2,10,9,0,2,8,4,7],[2,10,9,2,9,7,2,7,3,7,9,4],[8,4,7,3,11,2],[11,4,7,11,2,4,2,0,4],[9,0,1,8,4,7,2,3,11],[4,7,11,9,4,11,9,11,2,9,2,1],[3,10,1,3,11,10,7,8,4],[1,11,
10,1,4,11,1,0,4,7,11,4],[4,7,8,9,0,11,9,11,10,11,0,3],[4,7,11,4,11,9,9,11,10],[9,5,4],[9,5,4,0,8,3],[0,5,4,1,5,0],[8,5,4,8,3,5,3,1,5],[1,2,10,9,5,4],[3,0,8,1,2,10,4,9,5],[5,2,10,5,4,2,4,0,2],[2,10,5,3,2,5,3,5,4,3,4,8],[9,5,4,2,3,11],[0,11,2,0,8,11,4,9,5],[0,5,4,0,1,5,2,3,11],[2,1,5,2,5,8,2,8,11,4,8,5],[10,3,11,10,1,3,9,5,4],[4,9,5,0,8,1,8,10,1,8,11,10],[5,4,0,5,0,11,5,11,10,11,0,3],[5,4,8,5,8,10,10,8,11],[9,7,8,5,7,9],[9,3,0,9,5,3,5,7,3],[0,7,8,0,1,7,1,5,7],[1,5,3,3,5,7],[9,7,8,9,5,7,10,1,2],[10,
1,2,9,5,0,5,3,0,5,7,3],[8,0,2,8,2,5,8,5,7,10,5,2],[2,10,5,2,5,3,3,5,7],[7,9,5,7,8,9,3,11,2],[9,5,7,9,7,2,9,2,0,2,7,11],[2,3,11,0,1,8,1,7,8,1,5,7],[11,2,1,11,1,7,7,1,5],[9,5,8,8,5,7,10,1,3,10,3,11],[5,7,0,5,0,9,7,11,0,1,0,10,11,10,0],[11,10,0,11,0,3,10,5,0,8,0,7,5,7,0],[11,10,5,7,11,5],[10,6,5],[0,8,3,5,10,6],[9,0,1,5,10,6],[1,8,3,1,9,8,5,10,6],[1,6,5,2,6,1],[1,6,5,1,2,6,3,0,8],[9,6,5,9,0,6,0,2,6],[5,9,8,5,8,2,5,2,6,3,2,8],[2,3,11,10,6,5],[11,0,8,11,2,0,10,6,5],[0,1,9,2,3,11,5,10,6],[5,10,6,1,9,2,
9,11,2,9,8,11],[6,3,11,6,5,3,5,1,3],[0,8,11,0,11,5,0,5,1,5,11,6],[3,11,6,0,3,6,0,6,5,0,5,9],[6,5,9,6,9,11,11,9,8],[5,10,6,4,7,8],[4,3,0,4,7,3,6,5,10],[1,9,0,5,10,6,8,4,7],[10,6,5,1,9,7,1,7,3,7,9,4],[6,1,2,6,5,1,4,7,8],[1,2,5,5,2,6,3,0,4,3,4,7],[8,4,7,9,0,5,0,6,5,0,2,6],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9],[3,11,2,7,8,4,10,6,5],[5,10,6,4,7,2,4,2,0,2,7,11],[0,1,9,4,7,8,2,3,11,5,10,6],[9,2,1,9,11,2,9,4,11,7,11,4,5,10,6],[8,4,7,3,11,5,3,5,1,5,11,6],[5,1,11,5,11,6,1,0,11,7,11,4,0,4,11],[0,5,9,0,6,5,0,3,6,11,
6,3,8,4,7],[6,5,9,6,9,11,4,7,9,7,11,9],[10,4,9,6,4,10],[4,10,6,4,9,10,0,8,3],[10,0,1,10,6,0,6,4,0],[8,3,1,8,1,6,8,6,4,6,1,10],[1,4,9,1,2,4,2,6,4],[3,0,8,1,2,9,2,4,9,2,6,4],[0,2,4,4,2,6],[8,3,2,8,2,4,4,2,6],[10,4,9,10,6,4,11,2,3],[0,8,2,2,8,11,4,9,10,4,10,6],[3,11,2,0,1,6,0,6,4,6,1,10],[6,4,1,6,1,10,4,8,1,2,1,11,8,11,1],[9,6,4,9,3,6,9,1,3,11,6,3],[8,11,1,8,1,0,11,6,1,9,1,4,6,4,1],[3,11,6,3,6,0,0,6,4],[6,4,8,11,6,8],[7,10,6,7,8,10,8,9,10],[0,7,3,0,10,7,0,9,10,6,7,10],[10,6,7,1,10,7,1,7,8,1,8,0],[10,
6,7,10,7,1,1,7,3],[1,2,6,1,6,8,1,8,9,8,6,7],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9],[7,8,0,7,0,6,6,0,2],[7,3,2,6,7,2],[2,3,11,10,6,8,10,8,9,8,6,7],[2,0,7,2,7,11,0,9,7,6,7,10,9,10,7],[1,8,0,1,7,8,1,10,7,6,7,10,2,3,11],[11,2,1,11,1,7,10,6,1,6,7,1],[8,9,6,8,6,7,9,1,6,11,6,3,1,3,6],[0,9,1,11,6,7],[7,8,0,7,0,6,3,11,0,11,6,0],[7,11,6],[7,6,11],[3,0,8,11,7,6],[0,1,9,11,7,6],[8,1,9,8,3,1,11,7,6],[10,1,2,6,11,7],[1,2,10,3,0,8,6,11,7],[2,9,0,2,10,9,6,11,7],[6,11,7,2,10,3,10,8,3,10,9,8],[7,2,3,6,2,7],[7,0,8,7,6,0,6,
2,0],[2,7,6,2,3,7,0,1,9],[1,6,2,1,8,6,1,9,8,8,7,6],[10,7,6,10,1,7,1,3,7],[10,7,6,1,7,10,1,8,7,1,0,8],[0,3,7,0,7,10,0,10,9,6,10,7],[7,6,10,7,10,8,8,10,9],[6,8,4,11,8,6],[3,6,11,3,0,6,0,4,6],[8,6,11,8,4,6,9,0,1],[9,4,6,9,6,3,9,3,1,11,3,6],[6,8,4,6,11,8,2,10,1],[1,2,10,3,0,11,0,6,11,0,4,6],[4,11,8,4,6,11,0,2,9,2,10,9],[10,9,3,10,3,2,9,4,3,11,3,6,4,6,3],[8,2,3,8,4,2,4,6,2],[0,4,2,4,6,2],[1,9,0,2,3,4,2,4,6,4,3,8],[1,9,4,1,4,2,2,4,6],[8,1,3,8,6,1,8,4,6,6,10,1],[10,1,0,10,0,6,6,0,4],[4,6,3,4,3,8,6,10,3,
0,3,9,10,9,3],[10,9,4,6,10,4],[4,9,5,7,6,11],[0,8,3,4,9,5,11,7,6],[5,0,1,5,4,0,7,6,11],[11,7,6,8,3,4,3,5,4,3,1,5],[9,5,4,10,1,2,7,6,11],[6,11,7,1,2,10,0,8,3,4,9,5],[7,6,11,5,4,10,4,2,10,4,0,2],[3,4,8,3,5,4,3,2,5,10,5,2,11,7,6],[7,2,3,7,6,2,5,4,9],[9,5,4,0,8,6,0,6,2,6,8,7],[3,6,2,3,7,6,1,5,0,5,4,0],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8],[9,5,4,10,1,6,1,7,6,1,3,7],[1,6,10,1,7,6,1,0,7,8,7,0,9,5,4],[4,0,10,4,10,5,0,3,10,6,10,7,3,7,10],[7,6,10,7,10,8,5,4,10,4,8,10],[6,9,5,6,11,9,11,8,9],[3,6,11,0,6,3,0,5,6,0,
9,5],[0,11,8,0,5,11,0,1,5,5,6,11],[6,11,3,6,3,5,5,3,1],[1,2,10,9,5,11,9,11,8,11,5,6],[0,11,3,0,6,11,0,9,6,5,6,9,1,2,10],[11,8,5,11,5,6,8,0,5,10,5,2,0,2,5],[6,11,3,6,3,5,2,10,3,10,5,3],[5,8,9,5,2,8,5,6,2,3,8,2],[9,5,6,9,6,0,0,6,2],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8],[1,5,6,2,1,6],[1,3,6,1,6,10,3,8,6,5,6,9,8,9,6],[10,1,0,10,0,6,9,5,0,5,6,0],[0,3,8,5,6,10],[10,5,6],[11,5,10,7,5,11],[11,5,10,11,7,5,8,3,0],[5,11,7,5,10,11,1,9,0],[10,7,5,10,11,7,9,8,1,8,3,1],[11,1,2,11,7,1,7,5,1],[0,8,3,1,2,7,1,7,5,7,2,11],
[9,7,5,9,2,7,9,0,2,2,11,7],[7,5,2,7,2,11,5,9,2,3,2,8,9,8,2],[2,5,10,2,3,5,3,7,5],[8,2,0,8,5,2,8,7,5,10,2,5],[9,0,1,5,10,3,5,3,7,3,10,2],[9,8,2,9,2,1,8,7,2,10,2,5,7,5,2],[1,3,5,3,7,5],[0,8,7,0,7,1,1,7,5],[9,0,3,9,3,5,5,3,7],[9,8,7,5,9,7],[5,8,4,5,10,8,10,11,8],[5,0,4,5,11,0,5,10,11,11,3,0],[0,1,9,8,4,10,8,10,11,10,4,5],[10,11,4,10,4,5,11,3,4,9,4,1,3,1,4],[2,5,1,2,8,5,2,11,8,4,5,8],[0,4,11,0,11,3,4,5,11,2,11,1,5,1,11],[0,2,5,0,5,9,2,11,5,4,5,8,11,8,5],[9,4,5,2,11,3],[2,5,10,3,5,2,3,4,5,3,8,4],[5,10,
2,5,2,4,4,2,0],[3,10,2,3,5,10,3,8,5,4,5,8,0,1,9],[5,10,2,5,2,4,1,9,2,9,4,2],[8,4,5,8,5,3,3,5,1],[0,4,5,1,0,5],[8,4,5,8,5,3,9,0,5,0,3,5],[9,4,5],[4,11,7,4,9,11,9,10,11],[0,8,3,4,9,7,9,11,7,9,10,11],[1,10,11,1,11,4,1,4,0,7,4,11],[3,1,4,3,4,8,1,10,4,7,4,11,10,11,4],[4,11,7,9,11,4,9,2,11,9,1,2],[9,7,4,9,11,7,9,1,11,2,11,1,0,8,3],[11,7,4,11,4,2,2,4,0],[11,7,4,11,4,2,8,3,4,3,2,4],[2,9,10,2,7,9,2,3,7,7,4,9],[9,10,7,9,7,4,10,2,7,8,7,0,2,0,7],[3,7,10,3,10,2,7,4,10,1,10,0,4,0,10],[1,10,2,8,7,4],[4,9,1,4,1,
7,7,1,3],[4,9,1,4,1,7,0,8,1,8,7,1],[4,0,3,7,4,3],[4,8,7],[9,10,8,10,11,8],[3,0,9,3,9,11,11,9,10],[0,1,10,0,10,8,8,10,11],[3,1,10,11,3,10],[1,2,11,1,11,9,9,11,8],[3,0,9,3,9,11,1,2,9,2,11,9],[0,2,11,8,0,11],[3,2,11],[2,3,8,2,8,10,10,8,9],[9,10,2,0,9,2],[2,3,8,2,8,10,0,1,8,1,10,8],[1,10,2],[1,3,8,9,1,8],[0,9,1],[0,3,8],[]];function Xg(){this.xg=24;this.di=2;this.Vl=3;this.tl=!1;this.Tj=3;this.Lh=20;this.Fd=new THREE.Color(16777215)}
function Wg(e){e instanceof Wa?this.pos=e.pos.clone():this.pos=e;this.cc=null;this.qa=e;this.height=this.width=1;this.ic=0;this.zb=this.sf=!1;this.kd=!0;this.ae=0;this.cb=this.wd=this.ya=null;this.Ae=0}Wg.prototype.clone=function(){var e=new Wg;e.pos=this.pos.clone();e.cc=this.cc;e.qa=this.qa;e.Va=this.Va;e.width=this.width;e.height=this.height;e.ic=this.ic;e.sf=this.sf;e.zb=this.zb;e.kd=this.kd;e.ae=this.ae;e.ya=this.ya;e.wd=this.wd;e.cb=this.cb;e.Ae=this.Ae;return e};
function Yg(e,f,g,h){if(!(2>g.length)){e.Fd=h;bh(e,g);ch(g);dh(e,g);eh(g);fh(e,g);g=gh(e,g);g.forEach(function(e){var f=e.cb.clone().cross(e.ya).normalize();e.wd=f});h=0;for(var k=g.length-1;0<=k;k--){var m=g[k];m.zb?(1<k&&(h+=m.pos.distanceTo(g[k-1].pos)),m.Ae=h):h=0}hh(e,f,g)}}
function bh(e,f){for(var g=f.length,h=0;h<e.Vl;h++){var k=[];if(e.tl)for(var m=0;m<g;m++)f[m].kd&&(k[m]=f[m-1].pos.clone().add(f[m+1].pos.clone()).multiplyScalar(.5));else for(f[1].kd&&(k[1]=f[0].pos.clone().add(f[1].pos.clone()).multiplyScalar(.5)),f[g-1].kd&&(k[g-1]=f[g-2].pos.add(f[g-1].pos.clone()).multiplyScalar(.5)),m=2;m<g-2;m++)f[m].kd&&(k[m]=(new THREE.Vector3).qb(f[m-2].pos.clone(),-.25).qb(f[m-1].pos.clone(),.5).qb(f[m].pos.clone(),.5).qb(f[m+1].pos.clone(),.5).qb(f[m+2].pos.clone(),-.25));
for(m=1;m<g-1;m++){var l=k[m];void 0!==l&&null!==l&&(f[m].pos=l.clone())}}for(var q=0,h=0;h<g;h++)k=f[h].ae,k>q&&(q=k);for(h=0;h<q;h++){k=[];for(m=1;m<g-1;m++)f[m].ae>h&&(k[m]=f[m].pos.clone().add(f[m-1].pos.clone().add(f[m+1].pos.clone()).multiplyScalar(.5)).multiplyScalar(.5));for(m=1;m<g-1;m++)l=k[m],null!==l&&void 0!==l&&(f[m].pos=l.clone())}}
function fh(e,f){for(var g=f.length,h=0;h<e.Tj;h++)for(var k=[],m=1;m<g-1;m++)k[m]=f[m-1].cb.clone().add(f[m+1].cb.clone()).qb(f[m].cb.clone(),2).normalize(),me(k[m],f[m-1].ya.clone(),f[m+1].ya.clone(),.5).normalize()}
function gh(e,f){var g=f.length;if(1<e.di){var h=[],k=0;h[k++]=f[0];for(var m=0;m<g-3;m++)for(var l=0;l<e.di;l++){var q=h,r=k++,t=f[m+1],x=f[m+2],w=f[m+3],B=l/e.di,w=THREE.Vector3.ca(f[m].pos.clone(),t.pos.clone(),x.pos.clone(),w.pos.clone(),B),w=new Wg(w);w.qa=.5>B?t.qa:x.qa;w.Va=.5>B?t.Va:x.Va;t.zb==x.zb?(w.width=THREE.Math.wc(t.width,x.width,B),w.height=THREE.Math.wc(t.height,x.height,B),w.ic=THREE.Math.wc(t.ic,x.ic,B),w.cc=THREE.Color.wc(t.cc,x.cc,B),w.zb=t.zb):(w.width=t.zb?x.width:t.width,w.height=
t.zb?x.height:t.height,w.ic=t.zb?x.ic:t.ic,w.cc=t.zb?x.cc:t.cc,w.zb=!1);w.sf=t.sf;w.wd=THREE.Vector3.wc(t.wd,x.wd,B).normalize();w.cb=THREE.Vector3.wc(t.cb,x.cb,B).normalize();null!==t.ya&&null!==x.ya&&null!==w.cb&&void 0!==t.ya&&void 0!==x.ya&&void 0!==w.cb?w.ya=me(w.cb.clone(),t.ya,x.ya,B):w.ya=THREE.Vector3.wc(t.ya,x.ya,B).normalize();q[r]=w}h[k++]=f[g-1];return h}return f}
function ch(e){e[0].cb=e[1].pos.clone().sub(e[0].pos).normalize();for(var f=e.length,g=1;g<f-1;g++)e[g].cb=e[g+1].pos.clone().sub(e[g-1].pos).normalize();e[f-1].cb=e[f-1].pos.clone().sub(e[f-2].pos).normalize()}
function dh(e,f){for(var g=f.length,h=0;h<g;h++){var k=f[h];if(k.width!==k.height){for(var m=new THREE.Vector3,l=0,q=new THREE.Vector3,r=0,t=0,x=h-1;0<=x;x--){var t=t+f[x].pos.distanceTo(f[x+1].pos),w=(e.Lh-t)/t*t;if(0>=w)break;m=m.qb(f[x].pos,w);l+=w}t=0;for(x=h+1;x<g;x++){t+=f[x].pos.distanceTo(f[x-1].pos);w=(e.Lh-t)/t*t;if(0>=w)break;q=q.qb(f[x].pos,w);r+=w}q=q.multiplyScalar(1/r);m=m.multiplyScalar(1/l);0===l&&(q=m);0===r&&(m=q);k.ya=k.pos.clone().sub(q).add(k.pos.clone().sub(m)).multiplyScalar(1/
e.Lh);l=k.ya.clone().cross(k.cb.clone());if(.1>Math.sqrt(l.x*l.x+l.y*l.y+l.z*l.z))k.ya=null;else if(k.ya=k.cb.clone().cross(k.ya.clone()).cross(k.cb.clone()).normalize(),0===k.ic)for(l=h-1;0<=l;l--)if(r=f[l].ya,m=k.ya,null!==r&&void 0!==r){0>m.x*r.x+m.y*r.y+m.z*r.z&&(f[h].ya=m.multiplyScalar(-1));break}}}}
function eh(e){for(var f=[],g=e.length,h=0;h<g;h++){var k=e[h];if(null===k.ya||void 0===k.ya){for(var m=h;0<=m&&(null===e[m].ya||void 0===e[m].ya);)m--;for(var l=h;l<g&&(null===e[l].ya||void 0===e[l].ya);)l++;l===g&&(l=-1);if(0>m&&0>l)f[h]=le(k.cb);else if(0<=m&&0<=l){var q=(h-m)/(l-m),k=k.cb.clone();f[h]=me(k,e[m].ya,e[l].ya,q)}else f[h]=0<=m?e[m].ya.clone():e[l].ya.clone()}}g=f.length;for(h=0;h<g;h++)m=f[h],null!==m&&void 0!==m&&(l=m.clone(),l.qa=m.qa,l.Va=m.Va,e[h].ya=l)}
function hh(e,f,g){var h=ih(g[0],e.xg,!0),k=!1;jh(e,f,h,!1);for(var m=g.length,l=1;l<m;l++){var q=g[l],r=ih(q,e.xg,!0),t=q.zb&&q.Ae<2*q.width;if(t&&!k)k=ih(q,e.xg,!1),q=ih(q,e.xg,!0),kh(e,f,h,k),kh(e,f,k,q);else{for(var k=r.length,x=0;x<k;x++).01>=r[x].clone().sub(h[x].clone()).dot(q.cb.clone())&&(r[x]=h[x].clone(),r[x].normal=h[x].normal,r[x].qa=h[x].qa,r[x].Va=h[x].Va);kh(e,f,h,r)}h=r;k=t}jh(e,f,h,!0)}
function lh(e,f,g){for(var h=g.length,k=f.pc.length/3,m=0;m<h;m++){var l=g[m];ce(f,l.x,l.y,l.z,e.Fd);f.Wc.push(l.Va)}return k}function kh(e,f,g,h){if(g.length!==h.length)throw"meshFill impossible, a.length !== b.length";g=g.length;e=lh(e,f,h);for(h=0;h<g;h++){var k=(h+1)%g,m=e-g+h,l=e-g+k,k=e+k;de(f,m,e+h,k);de(f,m,k,l)}}function jh(e,f,g,h){var k=g.length;e=lh(e,f,g);for(g=0;g<k-1;g++){var m=e+g,l=e+g+1,q=e+k-g-1;h?de(f,m,q,l):de(f,m,l,q)}}
function ih(e,f,g){for(var h=[],k=0;k<f;k++){var m=2*(k+.5)*Math.PI/f,l;if(e.sf){l=f/4;var q=l+2,r=3*f/4,t=r+2,x=.1*e.width;k==l||k==l+1||k==t||k==t+1?(l=k==l||k==l+1?x:-x,m=e.height-2*e.width):k==q||k==q+1||k==r||k==r+1?(l=k==q||k==q+1?x:-x,m=2*e.width-e.height):k<l||k>t?(l=Math.sin(2*m)*e.width,m=e.height-e.width+Math.cos(2*m)*e.width):(l=Math.sin(Math.PI+2*m)*e.width,m=e.width-e.height+Math.cos(Math.PI+2*m)*e.width)}else l=Math.sin(m)*e.width,m=Math.cos(m)*e.height,e.zb?(q=e.width,e.zb&&e.Ae<2*
e.width&&g&&(q=e.Ae),l=q*(0<=l?1:-1),m=e.height*(0<=m?1:-1)):l+=e.ic*Math.cos(Math.PI*m/e.height);q=null;e.pos instanceof Wa?q=e.pos.pos.clone().qb(e.ya,l).qb(e.wd,m):q=e.pos.clone().qb(e.ya,l).qb(e.wd,m);q.qa=e.qa;q.Va=e.Va;h.push(q)}for(k=0;k<f;k++)g=(k+f-1)%f,m=(k+1)%f,l=new THREE.Vector3,l=h[m].clone().sub(h[g].clone()),h[k].normal=l.cross(e.cb).normalize();return h}function mh(e,f){$f.call(this,e);this.hi=null==f?!0:f}mh.prototype=Object.create($f.prototype);mh.prototype.constructor=mh;
N.cf=new fg("Spheres","SPHERES",mh);N.ki=new fg("Balls","BALLS",mh,!1);
mh.prototype.Oa=function(){var e=this.ma.length,f=null,g=this.fa.bg;if(g)f=e;else{var h;this.hi?(h=this.fa,null===h.wa&&("HIGH"===h.Za?h.wa=new THREE.SphereGeometry(h.u.la.radius,h.u.la.widthSegments,h.u.la.heightSegments,h.u.la.phiStart,h.u.la.phiLength,h.u.la.thetaStart,h.u.la.thetaLength):"MEDIUM"===h.Za?h.wa=new THREE.SphereGeometry(h.u.pa.radius,h.u.pa.widthSegments,h.u.pa.heightSegments,h.u.pa.phiStart,h.u.pa.phiLength,h.u.pa.thetaStart,h.u.pa.thetaLength):"LOW"===h.Za&&(h.wa=new THREE.SphereGeometry(h.u.oa.radius,
h.u.oa.widthSegments,h.u.oa.heightSegments,h.u.oa.phiStart,h.u.oa.phiLength,h.u.oa.thetaStart,h.u.oa.thetaLength))),h=h.wa):h=af(this.fa);var k=(new THREE.BufferGeometry).fromGeometry(h),m=k.attributes.position.array.length/k.attributes.position.itemSize,f=e*m}h=new THREE.BufferGeometry;var l=new Float32Array(3*f),q=new Float32Array(3*f),r=new Float32Array(f);if(g)var t=new Float32Array(f);else var x=new Float32Array(3*f),w=new Float32Array(2*f);for(f=0;f<e;f++){var B=this.ma[f],D=df(0,B);if(g)l[3*
f]=B.pos.x,l[3*f+1]=B.pos.y,l[3*f+2]=B.pos.z,t[f]=this.hi?D:this.fa.ra.la.radius,r[f]=f;else{var E=new THREE.Matrix4;E.setPosition(B.pos);this.hi&&(B=new THREE.Matrix4,B.makeScale(D,D,D),E.multiply(B));var I=k.clone();I.applyMatrix(E);for(var E=I.attributes.position.array,D=I.attributes.normal.array,B=I.attributes.color.array,I=I.attributes.uv.array,H=E.length/3,K=0;K<H;K++){for(var G=0;3>G;G++)l[f*E.length+3*K+G]=E[3*K+G],x[f*D.length+3*K+G]=D[3*K+G],q[f*B.length+3*K+G]=B[3*K+G];for(G=0;2>G;G++)w[f*
I.length+2*K+G]=I[2*K+G];r[f*m+K]=f}}}h.addAttribute("position",new THREE.BufferAttribute(l,3));B=new THREE.BufferAttribute(q,3);B.dynamic=!0;h.addAttribute("color",B);h.addAttribute("atomIndex",new THREE.BufferAttribute(r,1));g?h.addAttribute("radius",new THREE.BufferAttribute(t,1)):h.addAttribute("normal",new THREE.BufferAttribute(x,3));h.dd();g&&fe(h);e=null;e=g?jf(this.fa):ef(this.fa);t=null;t=g?new THREE.Points(h,e):new THREE.Mesh(h,e);t.Ia=this;this.parent.add(t);this.da=t;this.Kd()};
mh.prototype.update=function(e){$f.prototype.update.call(this,e);e.vf&&(this.kc=[],this.parent.remove(this.da),e=this.da.visible,this.da=null,this.Oa(),this.da.visible=e)};function nh(e){$f.call(this,e)}nh.prototype=Object.create($f.prototype);nh.prototype.constructor=nh;N.gc=new fg("Sticks","STICKS",nh);
nh.prototype.Oa=function(){if(this.fa.bg){var e=null;this.xa instanceof ag?e=this.xa.sa.Ib.Qb():this.xa instanceof bg?e=this.xa.wb.Fa.Ib.Qb():console.warn("Sticks representation unavailable for this data type");for(var f=new THREE.BufferGeometry,g=[],h=[],k=[],m=[],l=this.ma.length,q=0;q<l;q++){var r=this.ma[q],t=e.findNode(r);"HOH"!==this.ma[q].Lc()&&(g.push(r.pos.x),g.push(r.pos.y),g.push(r.pos.z),h.push(this.fa.va.la.radiusBottom),k.push(0),k.push(0),k.push(0),m.push(q))}this.pf=m.length;for(q=
0;q<l;q++){var r=this.ma[q],t=e.findNode(r),x=t.bd();if(x)for(var w=x.length,B=0;B<w;B++){var D=Gd(x[B],t).nd;if(this.ma.includes(D)){var E=r.pos,D=D.pos,D=(new THREE.Vector3).subVectors(D,E);D.divideScalar(2);g.push(E.x);g.push(E.y);g.push(E.z);k.push(D.x);k.push(D.y);k.push(D.z);h.push(this.fa.va.la.radiusTop);m.push(q)}}}f.addAttribute("position",THREE.Float32Attribute(g,3));e=new Float32Array(3*h.length);e=THREE.Float32Attribute(e,3);e.dynamic=!0;f.addAttribute("color",e);f.addAttribute("radius",
THREE.Float32Attribute(h,1));f.addAttribute("dir",THREE.Float32Attribute(k,3));f.addAttribute("atomIndex",THREE.Float32Attribute(m,1));f.dd();fe(f);h=jf(this.fa);k=kf(this.fa);k=new THREE.MultiMaterial([h,k]);k.opacity=h.opacity;f.addGroup(0,this.pf,0);f.addGroup(this.pf,m.length,1);f=new THREE.Points(f,k)}else{f=null;this.xa instanceof ag?f=this.xa.sa.Ib.Qb():this.xa instanceof bg?f=this.xa.wb.Fa.Ib.Qb():console.warn("Sticks representation unavailable for this data type");m=this.fa;null===m.ja&&
("HIGH"===m.Za?m.ja=new THREE.CylinderGeometry(m.va.la.radiusTop,m.va.la.radiusBottom,m.va.la.height,m.va.la.Id,m.va.la.rf,m.va.la.openEnded):"MEDIUM"===m.Za?m.ja=new THREE.CylinderGeometry(m.va.pa.radiusTop,m.va.pa.radiusBottom,m.va.pa.height,m.va.pa.Id,m.va.pa.rf,m.va.pa.openEnded):"LOW"===m.Za&&(m.ja=new THREE.CylinderGeometry(m.va.oa.radiusTop,m.va.oa.radiusBottom,m.va.oa.height,m.va.oa.Id,m.va.oa.rf,m.va.oa.openEnded)));m=m.ja;m=(new THREE.BufferGeometry).fromGeometry(m);h=this.fa;null===h.Qa&&
("HIGH"===h.Za?h.Qa=new THREE.SphereGeometry(h.v.la.radius,h.v.la.widthSegments,h.v.la.heightSegments,h.v.la.phiStart,h.v.la.phiLength,h.v.la.thetaStart,h.v.la.thetaLength):"MEDIUM"===h.Za?h.Qa=new THREE.SphereGeometry(h.v.pa.radius,h.v.pa.widthSegments,h.v.pa.heightSegments,h.v.pa.phiStart,h.v.pa.phiLength,h.v.pa.thetaStart,h.v.pa.thetaLength):"LOW"===h.Za&&(h.Qa=new THREE.SphereGeometry(h.v.oa.radius,h.v.oa.widthSegments,h.v.oa.heightSegments,h.v.oa.phiStart,h.v.oa.phiLength,h.v.oa.thetaStart,h.v.oa.thetaLength)));
h=h.Qa;k=(new THREE.BufferGeometry).fromGeometry(h);e=k.attributes.position.array.length/k.attributes.position.itemSize;g=m.attributes.position.array.length/m.attributes.position.itemSize;h=new THREE.BufferGeometry;l=[];q=[];r=[];t=[];x=[];w=new THREE.Matrix4;w.makeRotationX(.5*Math.PI);B=this.ma.length;for(E=0;E<B;E++){var D=this.ma[E],I=f.findNode(D);if("HOH"!==this.ma[E].Lc()){var H=new THREE.Matrix4;H.setPosition(D.pos);var K=k.clone();K.applyMatrix(H);for(var G=K.attributes.position.array,L=
0;L<G.length;L++)l.push(G[L]);G=K.attributes.normal.array;for(L=0;L<G.length;L++)q.push(G[L]);G=K.attributes.color.array;for(L=0;L<G.length;L++)r.push(G[L]);G=K.attributes.uv.array;for(L=0;L<G.length;L++)t.push(G[L]);for(L=0;L<e;L++)x.push(E)}if(K=I.bd())for(var H=K.length,P=0;P<H;P++)if(L=Gd(K[P],I).nd,this.ma.includes(L)){var G=D.pos,Q=L.pos,L=G.clone(),V=new THREE.Vector3((G.x+Q.x)/2,(G.y+Q.y)/2,(G.z+Q.z)/2),Q=L.distanceTo(V),aa=V.clone().add(L).divideScalar(2),G=new THREE.Matrix4;G.lookAt(L,V,
new THREE.Vector3(0,1,0));G.multiply(w);G.setPosition(aa);L=new THREE.Matrix4;L.makeScale(1,Q,1);G.multiply(L);Q=m.clone();Q.applyMatrix(G);G=Q.attributes.position.array;for(L=0;L<G.length;L++)l.push(G[L]);G=Q.attributes.normal.array;for(L=0;L<G.length;L++)q.push(G[L]);G=Q.attributes.color.array;for(L=0;L<G.length;L++)r.push(G[L]);G=Q.attributes.uv.array;for(L=0;L<G.length;L++)t.push(G[L]);for(L=0;L<g;L++)x.push(E)}}h.addAttribute("position",THREE.Float32Attribute(l,3));h.addAttribute("normal",THREE.Float32Attribute(q,
3));G=THREE.Float32Attribute(r,3);G.dynamic=!0;h.addAttribute("color",G);h.addAttribute("uv",THREE.Float32Attribute(t,2));h.addAttribute("atomIndex",THREE.Float32Attribute(x,1));h.dd();f=ef(this.fa);f=new THREE.Mesh(h,f)}f.Ia=this;this.parent.add(f);this.da=f;this.Kd()};nh.prototype.update=function(e){$f.prototype.update.call(this,e);if(e=e.vf)e=void 0===this.xa.ge.yd(N.bf);e&&(e=this.da.visible,this.kc=[],this.parent.remove(this.da),this.da=null,this.Oa(),this.da.visible=e)};
var ph=function oh(f,g,h){$f.call(this,f);this.Qj=h;this.wireframe=g;this.Ug=h?oh.u:oh.v;this.startTime=null};ph.v=0;ph.u=1.4;ph.prototype=Object.create($f.prototype);ph.prototype.constructor=ph;N.ii=new fg("Accessible Surface Wireframe","ASM",ph,!0,!0);N.Bg=new fg("Accessible Surface","AS",ph,!1,!0);N.si=new fg("Molecular Surface Wireframe","MSM",ph,!0,!1);N.Eg=new fg("Molecular Surface","MS",ph,!1,!1);
ph.prototype.Oa=function(){var e,f;if("Solvent"!==this.Ea.type){if(this.wireframe){var g=ef(this.fa);g.wireframe=!0;var h=this.Qj?Sg(this.xa,N.Bg):Sg(this.xa,N.Eg);null===h.da&&(h.Oa(),h.hide());h=h.da.geometry.clone()}else{var g=ef(this.fa),k;h=this.fa;k="LOW"===h.Za?.5:"MEDIUM"===h.Za?1:"HIGH"===h.Za?1.5:void 0;var m=this.Ea.Aa(),h=this.tc(m),l=h[0],h=h[1],q=6*Math.ceil(k)+1;l.x-=q;h.x+=q;l.y-=q;h.y+=q;l.z-=q;h.z+=q;for(var r=Math.trunc((h.x-l.x)*k),t=Math.trunc((h.y-l.y)*k),x=Math.trunc((h.z-l.z)*
k),h=Array(r),q=0;q<r;q++)for(var w=0;w<t;w++)for(var B=0;B<x;B++)void 0===h[q]&&(h[q]=Array(t)),void 0===h[q][w]&&(h[q][w]=Array(x)),h[q][w][B]=new THREE.Vector3(q/k+l.x,w/k+l.y,B/k+l.z),h[q][w][B].Ab=[],h[q][w][B].state=0;r=m.length;q=null;for(t=0;t<r;t++)for(var x=m[t],D=df(0,x),E=Math.trunc((D+this.Ug)*k)+1,I=Math.trunc((x.pos.x-l.x)*k),H=Math.trunc((x.pos.y-l.y)*k),K=Math.trunc((x.pos.z-l.z)*k),G=I-E;G<=I+E;G++)for(f=H-E;f<=H+E;f++)for(e=K-E;e<=K+E;e++)q=G/k+l.x,w=f/k+l.y,B=e/k+l.z,x.Wa().distanceTo(new THREE.Vector3(q,
w,B))<D+this.Ug&&(q=h[G][f][e],q.Ab.push(x),q.qa=x,q.Va=t,q.state=1);k=new be(!0);m=h.length;for(l=1;l<m;l++)for(q=h[l].length,w=1;w<q;w++)for(B=h[l][w].length,r=1;r<B;r++){E=0;1===h[l-1][w][r].state&&(E|=128);1===h[l][w][r].state&&(E|=64);1===h[l][w-1][r].state&&(E|=32);1===h[l-1][w-1][r].state&&(E|=16);1===h[l-1][w][r-1].state&&(E|=8);1===h[l][w][r-1].state&&(E|=4);1===h[l][w-1][r-1].state&&(E|=2);1===h[l-1][w-1][r-1].state&&(E|=1);t=k;D=h[l-1][w-1][r-1];I=h[l][w-1][r-1];H=h[l][w][r-1];K=h[l-1][w][r-
1];G=h[l-1][w-1][r];f=h[l][w-1][r];e=h[l][w][r];for(var L=h[l-1][w][r],x=[D,I,H,K,G,f,e,L,D,I,H,K],D=[I,H,K,D,f,e,L,G,G,f,e,L],H=ah[E],K=H.length,E=[],I=0;I<K;I++){G=H[I];f=x[G];e=D[G];G=void 0;for(L=0;8>L;L++)if(G=new THREE.Vector3((f.x+e.x)/2,(f.y+e.y)/2,(f.z+e.z)/2),G.Ab=[],0<f.Ab.length)qh(this,G,f.Ab)?(Array.prototype.push.apply(G.Ab,f.Ab),f=G):qh(this,G,e.Ab)||(e=G);else if(0<e.Ab.length)qh(this,G,e.Ab)?(Array.prototype.push.apply(G.Ab,e.Ab),e=G):qh(this,G,f.Ab)||(f=G);else break;Array.prototype.push.apply(G.Ab,
f.Ab);Array.prototype.push.apply(G.Ab,e.Ab);e=f=G;for(var L=G.Ab,P=Infinity,Q=null,V=L.length,aa=0;aa<V;aa++){var oa=L[aa],Hb=e.distanceTo(oa.Wa());Hb<P&&(P=Hb,Q=oa)}f.qa=Q;G.Va=this.ma.indexOf(G.qa);e=t;L=G.x;P=G.y;Q=G.z;f=!1;V=-1;aa=L+":"+P+":"+Q;e.Qg.has(aa)?V=e.Qg.get(aa):(V=e.pc.length/3,ce(e,L,P,Q,void 0,void 0),e.Qg.set(aa,V),f=!0);e=V;f&&t.Wc.push(G.Va);E.push(e)}I=0;for(x=E.length/3;I<x;I++)de(t,E[3*I],E[3*I+2],E[3*I+1])}h=ee(k)}g=new THREE.Mesh(h,g);g.qa=this.Ea;g.Ia=this;this.parent.add(g);
this.da=g;this.color(R.nb)}};ph.prototype.tc=function(e){for(var f=new THREE.Vector3(Infinity,Infinity,Infinity),g=new THREE.Vector3(-Infinity,-Infinity,-Infinity),h=e.length,k=0;k<h;k++){var m=e[k].pos;f.x=Math.min(f.x,m.x);f.y=Math.min(f.y,m.y);f.z=Math.min(f.z,m.z);g.x=Math.max(g.x,m.x);g.y=Math.max(g.y,m.y);g.z=Math.max(g.z,m.z)}return[f,g]};function qh(e,f,g){for(var h=g.length,k=!1,m=0;m<h;m++){var l=g[m];if(l.Wa().distanceTo(f)<parseFloat(bb(l.symbol)[7])+e.Ug){k=!0;break}}return k}
ph.prototype.update=function(e){$f.prototype.update.call(this,e);e.vf&&(e=this.da.visible,this.kc=[],this.parent.remove(this.da),this.da=null,this.Oa(),this.da.visible=e)};function rh(){THREE.Object3D.call(this);this.matrixAutoUpdate=!1;this.matrixWorldNeedsUpdate=!0;this.xa=this;this.ge=new Ja;this.labels=new THREE.Object3D;this.add(this.labels)}rh.prototype=Object.create(THREE.Object3D.prototype);rh.prototype.constructor=rh;function sh(){this.map=[]}sh.prototype.get=function(e){return this.map[e.constructor]};
sh.prototype.add=function(e,f){this.map[e]=f};var th=new sh;z=rh.prototype;z["delete"]=function(){for(var e=this.ge.keys(),f=0,g=e.length;f<g;f++)e[f]["delete"]()};z.show=function(e){if(void 0!==e){if(e=Sg(this,e),null!=e)return e.show(),e}else this.visible=!0};z.hide=function(e){void 0!==e?(e=Sg(this,e),null!=e&&e.hide()):this.visible=!1};z.yb=function(e,f,g){if(void 0!==f)f=Sg(this,f),null!=f&&f.yb(e,g);else{f=this.Wb();for(var h=0;h<f.length;h++)f[h].yb(e,g)}};
function Sg(e,f){if(null!==f){var g=e.ge.yd(f);void 0===g&&-1!==th.get(e).indexOf(f)&&(void 0!==f&&null!==f?(g=new f.Ia(e,f.gl,f.fm),g.hd=f.name):g=void 0,void 0!==g&&(g.uf=void 0),e.ge.set(g,f));return g}}z.eg=function(e){var f=this.ge.yd(e);return void 0===f||-1===th.get(this).indexOf(e)?!1:f.visible};z.Wb=function(){var e=[],f=this.ge.keys(),g;for(g in f){var h=f[g];h.visible&&e.push(h)}return e};
function Yf(e){var f=[],g=null,h=e.children.length;if(0!==h)for(var k=0;k<h;k++)g=e.children[k],!(g instanceof THREE.Mesh||g instanceof THREE.Line||g instanceof THREE.Points)||void 0===g.qa&&0===g.material.vertexColors?g instanceof rh&&(f=f.concat(Yf(g))):f.push(g);return f}function eg(e,f){rh.call(this);this.fa=Ie();this.Xd=f;this.lg=e;this.lg.add(this);this.ma=[f];this.qa=this.Xd;this.updateMatrixWorld()}eg.prototype=Object.create(rh.prototype);eg.prototype.constructor=eg;th.add(eg,[N.cf,N.ne]);
z=eg.prototype;z["delete"]=function(){rh.prototype["delete"].call(this);this.parent.remove(this)};z.jb=function(){return this.lg.jb()};z.pb=function(){return this.lg.pb()};z.dc=function(){return this.lg};z.ad=function(){return this.Xd.Wa()};z.ub=function(){return this.Xd.tc()};function ag(e,f){rh.call(this);this.yf=e;this.yf.add(this);this.sa=f;this.fa=Ie();this.Jd=new Ca;this.ma=this.sa.Aa();this.qa=this.sa;this.updateMatrixWorld()}ag.prototype=Object.create(rh.prototype);
ag.prototype.constructor=ag;th.add(ag,[N.cf,N.bf,N.LINES,N.gc,N.ne,N.Df,N.ni,N.Eg,N.si,N.Bg,N.ii,N.Cg,N.ji]);z=ag.prototype;z["delete"]=function(){rh.prototype["delete"].call(this);for(var e=this.Jd.values(),f=0,g=e.length;f<g;f++)e[f]["delete"]();this.parent.remove(this)};z.jb=function(){return this.yf};z.clear=function(e){e=Sg(this,e);null!==e&&void 0!==e&&e.clear()};
function uh(e){if(null!==e.sa.type)switch(e.sa.type){case "Protein":case "Peptide":return N.Df;case "Small Peptide":return N.bf;case "RNA":case "DNA":return N.Df;case "Ligand":return N.gc;case "Ion":return N.ne;case "Solvent":return N.NONE}console.warn("Error, cannot draw : ",e.sa.type);return null}function tf(e){e=Sg(e,uh(e));null!==e&&void 0!==e&&e.show()}
z.dc=function(e,f){"string"===typeof e&&(e=e.includes(":")?this.sa.ib(e.split(":")[1]):this.sa.ib(e));if(e.Fa!==this.sa)throw e.toString()+" don't belongs to "+this.sa.toString();var g=this.Jd.get(e);null==g&&f&&(g=new bg(this,e),this.Jd.set(e,g));return g};z.reset=function(){for(var e=this.Wb(),f=0;f<e.length;f++){var g=e[f];g.Kd();g.yb(!1);g.hide();if(g=e[f].da)g.material.opacity=1,g.material.transparent=!1}tf(this);e=this.Jd.values();g=e.length;for(f=0;f<g;f++)this.remove(e[f]);this.Jd.clear()};
z.he=function(){this.matrix.identity();this.matrixWorldNeedsUpdate=!0};z.ad=function(){return Hd(this.sa.tc())};z.ub=function(){return this.sa.tc()};z.Bb=function(){return this.sa.Bb()};function bg(e,f){rh.call(this);this.fa=Ie();this.wb=f;this.Gh=e;this.Of=new Ca;this.Gh.add(this);this.ma=this.wb.Aa();this.qa=this.wb;this.updateMatrixWorld()}bg.prototype=Object.create(rh.prototype);bg.prototype.constructor=bg;th.add(bg,[N.cf,N.bf,N.LINES,N.gc,N.ne]);z=bg.prototype;
z["delete"]=function(){rh.prototype["delete"].call(this);for(var e=this.Of.values(),f=0,g=e.length;f<g;f++)e[f]["delete"]();this.parent.remove(this)};z.jb=function(){return this.Gh.yf};z.pb=function(){return this.Gh};z.xd=function(e,f){"string"===typeof e&&(e=e.includes(":")?this.wb.gj(e.split(":")[1]):this.wb.gj(e));if(e.Ja!==this.wb)throw e.toString()+" don't belongs to "+this.wb.toString();var g=this.Of.get(e);null==g&&f&&(g=new eg(this,e),this.Of.set(e,g));return g};z.ad=function(){return Hd(this.wb.tc())};
z.ub=function(){return this.wb.tc()};
function nf(e){THREE.Group.call(this);this.Hb=new THREE.Scene;this.scene=this;this.scene.qa=this;this.Hb.add(this);this.eb=e.ba.canvas;this.na=[];this.light=this.camera=this.renderer=null;this.fa=Ie();this.animations=new Hf(this);this.Af=new Hf(this);this.Mb=new ScriptEngine(this);this.aa=e;this.Cc=this.Yd=null;this.Od=[];this.rd=this.oc=this.ve=null;this.gf=[];if(this.aa.ba.Fj){this.fb={enabled:!0};this.Sf=1;e=THREE.ShaderLib.depthRGBA;var f=THREE.UniformsUtils.clone(e.uniforms);new THREE.ShaderMaterial({fragmentShader:e.fragmentShader,
vertexShader:e.vertexShader,uniforms:f,blending:THREE.NoBlending})}this.Kh=new THREE.Plane(new THREE.Vector3(0,0,-1),0);this.kh=new THREE.Plane(new THREE.Vector3(0,0,1),0);this.init();jd.Cb.Uj()&&jd.Cb.Vj({element:$(this.renderer.domElement.parent).get(0),ba:this.aa.ba});e=this.eb.width();f=this.eb.height();this.Pf=new THREE.EffectComposer(this.renderer);var g=new THREE.RenderPass(this.Hb,this.camera);new THREE.SMAAPass(e,f);var h=new THREE.ShaderPass(THREE.CopyShader);h.renderToScreen=!0;this.Pf.addPass(g);
this.Pf.addPass(h);this.Nh=new THREE.ParallaxBarrierEffect(this.renderer);this.Nh.setSize(e,f);this.Gc=new THREE.AnaglyphEffect(this.renderer);this.Gc.setSize(e,f);jd.Vc.bind(this.Nh,this.eb);jd.Vc.bind(this.Gc,this.eb);jd.Vc.bind(this.Pf,this.eb);this.hm=new Xd(this.renderer,this.eb);this.Wi=this.camera.focus;this.pl=lf();this.uj=new Qf(this,this.renderer.domElement);this.fe=new Vf(this,this.renderer.domElement);this.nl=new Zf(this,this.renderer.domElement);this.zf=!1;this.xj=null;var k=this,m=new THREE.Clock;
requestAnimationFrame(function q(){requestAnimationFrame(q);var e=m.getDelta();k.Mb.Oc?0!==k.Af.Hc.length&&If(k.Af,1E3*e):k.Mb.update(1E3*e);k.fe.update();k.uj.update();k.nl.update();vh(k,k.Hb);wh(k)});this.fa.subscribe(this)}nf.prototype=Object.create(THREE.Group.prototype);nf.prototype.constructor=nf;var xh=Object;xh.location=[];xh.location.ea="CENTER";xh.location.ja="TOP";xh.location.u="BOTTOM";xh.location.LEFT="LEFT";xh.location.RIGHT="RIGHT";xh.location.wa="TOP_LEFT";xh.location.v="BOTTOM_LEFT";
xh.location.ca="BOTTOM_RIGHT";xh.location.Ha="TOP_RIGHT";z=nf.prototype;z.ei=function(){jd.Cb.toggle(this.aa.ba,$(this.renderer.domElement.parent).get(0))};function yh(e){return new Promise(function(f){e.zf=!0;e.xj=f})}function wf(e,f,g){var h=1.5*e.ub().length();null!=f&&(e.Kh.constant=-(e.camera.near-e.camera.position.z+f/100*(h-e.camera.near)));null!=g&&(e.kh.constant=e.camera.near-e.camera.position.z+g/100*(h-e.camera.near))}
function zh(e,f){for(var g=e.na.length,h=f.cd(),k=0,m=0;m<g;m++)e.na[m].cd().substring(0,4)===h&&k++;0<k&&f.ia.lc(h+"_"+k);e.add(f);e.na.push(f)}
function wh(e){e.renderer.clear();e.aa.Ze?e.Nh.render(e.Hb,e.camera):e.aa.Gc?e.Gc.render(e.Hb,e.camera):(e.fa.$e?e.hm.render(e.Hb,e.camera):e.renderer.render(e.Hb,e.camera),e.Hb.overrideMaterial=e.pl,e.renderer.render(e.Hb,e.camera),e.Hb.overrideMaterial=null);null!=e.Cc&&(e.renderer.clearDepth(),e.renderer.render(e.Cc,e.Yd));e.zf&&(e.zf=!1,e.renderer.domElement.zm(function(f){e.xj(f)},"image/png"))}
function vh(e,f){var g=new THREE.Vector4(0,0,e.renderer.domElement.offsetWidth,e.renderer.domElement.offsetHeight);f.traverse(function(e){if(e.material){var f=e.material.uniforms,m=e.material.materials;if(f||m)for(f&&(m=[e.material]),e=0;e<m.length;e++)f=m[e].uniforms,f.viewport&&(f.viewport.value=g)}})}
z.init=function(){this.camera=this.aa.camera;this.camera.position.set(0,0,30);this.light=new Ff(this);this.scene.matrixAutoUpdate=!1;var e=new THREE.AmbientLight(6710886);this.Hb.add(e);this.Hb.fog=new THREE.Fog(this.fa.bgColor,0,0);this.renderer=new THREE.WebGLRenderer({antialias:this.fa.mg.antialias});this.renderer.autoClear=!1;this.renderer.setSize(this.eb.width(),this.eb.height());this.renderer.setPixelRatio(window.devicePixelRatio);this.renderer.setClearColor(this.fa.bgColor,1);this.renderer.domElement.className+=
" hasContextMenu";this.eb.prepend(this.renderer.domElement);this.renderer.getContext();this.renderer.clippingPlanes=[this.Kh,this.kh];jd.Vc.bind(this.renderer,this.eb,this.camera,this);var f=this.renderer.getContext(),e=this.fa,g=f.getSupportedExtensions(),h=f.getExtension("EXT_frag_depth"),k=f.getExtension("WEBGL_depth_texture"),f=f.getParameter(f.ALIASED_POINT_SIZE_RANGE);console.info("Available WEBGL extensions : ",g);console.info("WebGL Point Size Range : "+f[0]+"-"+f[1]);h&&1024<=f[1]?(e.bg=
!0,console.info("BiovizJS is using advanced impostor representation for Spheres, Sticks and Balls & Sticks")):console.info("BiovizJS is using standard representation for Spheres, Sticks and Balls & Sticks");k&&(e.$e=!1);this.aa.ba.Fj&&(this.fb.scene=new THREE.Scene,this.fb.camera=new THREE.OrthographicCamera(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,-1E4,1E4),this.fb.camera.position.z=1,e={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter},this.fb.Fl=
new THREE.WebGLRenderTarget(window.innerWidth*this.Sf,window.innerHeight*this.Sf,e),this.fb.El=new THREE.WebGLRenderTarget(window.innerWidth,window.innerHeight,e),e=THREE.SSAOShader,this.fb.ssao_uniforms=THREE.UniformsUtils.clone(e.uniforms),this.fb.ssao_uniforms.tDiffuse.value=this.fb.El,this.fb.ssao_uniforms.tDepth.value=this.fb.Fl,this.fb.ssao_uniforms.size.value.set(window.innerWidth*this.Sf,window.innerHeight*this.Sf),this.fb.ssao_uniforms.cameraNear.value=this.camera.near,this.fb.ssao_uniforms.cameraFar.value=
this.camera.far,this.fb.ssao_uniforms.onlyAO.value=!1,this.fb.ml=new THREE.ShaderMaterial({uniforms:this.fb.ssao_uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.fb.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(window.innerWidth,window.innerHeight),this.fb.ml),this.fb.quad.position.z=-500,this.fb.scene.add(this.fb.quad),new SSAOConfig(this.renderer,this.fb))};z.clear=function(){for(var e=0;e<this.na.length;e++)this.scene.remove(this.na);this.na=[]};
z.Zd=function(e,f){null==f&&(f=.1);var g=new Kf(e.r,e.g,e.b,f);this.animations.sc(g)};function Ce(e,f,g,h){void 0===f&&(f=e.na[0]);void 0===g&&(g=1E3);void 0===h&&(h=!0);g=new Jf(f,e,g,h);e.Af.sc(g);h&&(e.aa.Ma=f)}function Ah(e,f,g,h){void 0===f&&(f=e.na[0]);void 0===h&&(h=1E3);f=new Of(h,f,e,g);e.animations.sc(f)}z.toString=function(){return"scene"};z.update=function(e){e.bgColor&&(this.renderer.setClearColor(this.fa.bgColor,1),this.Hb.fog.color=this.fa.bgColor)};
z.pg=function(e,f,g,h,k){function m(e){return"#"===e.charAt(0)?e.substring(1,7):"x"===e.charAt(1)?e.substring(2,8):e}var l=this.eb.height(),q=this.eb.width();null==f&&(f=xh.location.Ha);null!=g?"string"===typeof g&&g.endsWith("%")&&(g=l*g.substr(0,g.length-1)/100):g=l*this.fa.xe/100;null==h&&(h="#00ff00");null==k&&(k=2E3);if(null===this.Cc){this.Yd=new THREE.OrthographicCamera(-q/2,q/2,l/2,-l/2,1,10);this.Yd.position.z=10;this.Cc=new THREE.Scene;jd.Vc.bind(this.renderer,this.eb,this.Yd,this);var r=
new THREE.RenderPass(this.Cc,this.Yd);this.Pf.addPass(r,1)}""===e?void 0!==this.Od[f]&&(this.Cc.remove(this.Od[f]),this.Od[f]=void 0,this.renderer.render(this.Cc,this.Yd)):void 0!==e&&(e=cf(e,{fontsize:g,mh:{r:parseInt(m(h).substring(0,2),16),g:parseInt(m(h).substring(2,4),16),b:parseInt(m(h).substring(4,6),16),a:1},maxWidth:q,maxHeight:l}),h=new THREE.SpriteMaterial({map:e}),e=h.map.image.width,g=h.map.image.height,h=new THREE.Sprite(h),h.scale.set(e,g,1),void 0!==this.Od[f]&&this.Cc.remove(this.Od[f]),
this.Od[f]=h,Bh(this),this.Cc.add(h),void 0!==k&&(f=new Pf(h,this,k,f),this.Mb.Oc?this.Af.sc(f):this.animations.sc(f)))};
function Bh(e){var f=e.eb.width()/2,g=e.eb.height()/2,h;for(h in xh.location){var k=xh.location[h],m=e.Od[k];if(void 0!==m){var l=m.material.map.image.width/2,q=m.material.map.image.height/2;switch(k){case xh.location.ea:m.position.set(0,0,1);break;case xh.location.ja:m.position.set(0,g-q,1);break;case xh.location.u:m.position.set(0,-g+q,1);break;case xh.location.LEFT:m.position.set(-f+l,0,1);break;case xh.location.RIGHT:m.position.set(f-l,0,1);break;case xh.location.wa:m.position.set(-f+l,g-q,1);
break;case xh.location.v:m.position.set(-f+l,-g+q,1);break;case xh.location.ca:m.position.set(f-l,-g+q,1);break;default:m.position.set(f-l,g-q,1)}}}}z.ng=function(){for(var e=0;e<this.na.length;e++)this.na[e].ng()};z.Qe=function(){for(var e=0;e<this.na.length;e++)this.na[e].Qe();this.aa.ba.gb({type:"requestWidgetUpdate"})};z.Oh=function(){this.scene.matrix.identity();for(var e=0;e<this.na.length;e++)this.na[e].he();this.scene.updateMatrixWorld(!0);ze(this.aa,this.aa.bb,!0)};
z.reset=function(){this.scene.matrix.identity();for(var e=0;e<this.na.length;e++)this.na[e].reset();this.scene.updateMatrixWorld(!0);ze(this.aa,this.aa.bb,!0);this.aa.ba.gb({type:"requestWidgetUpdate"})};z.Wa=function(){return new THREE.Vector3};z.ad=function(){return Hd(this.ub())};z.ub=function(){for(var e=null,f=this.na.length,g=0;g<f;g++){var h=this.na[g],k=h.ub().clone();k.applyMatrix4(h.matrix);e=null===e?k:e.merge(k)}f=new THREE.Vector3;return null!==e?e:new kb(f,f)};
z.tg=function(e){this.fe.Ch=!0;void 0!=e?this.ve=e:this.ve=null};z.wg=function(){this.ve=null;this.fe.Ch=!1};z.ah=function(){for(var e=this.gf.length,f=0;f<e;f++)this.scene.remove(this.gf[f]);this.gf.splice()};function M(e){rh.call(this);this.fl=!0;this.ia=e;this.qa=this.ia.Yf();this.fa=Ie();this.za=new Ja;this.updateMatrixWorld();this.Rc=new Ca}M.prototype=Object.create(rh.prototype);z=M.prototype;z.constructor=M;z.jb=function(){return this};
z["delete"]=function(){rh.prototype["delete"].call(this);for(var e=this.za.values(),f=0,g=e.length;f<g;f++)e[f]["delete"]();this.parent.remove(this)};z.show=function(e){for(var f=0;f<this.za.keys().length;f++)this.za.get(this.za.keys()[f]).show(e)};z.hide=function(e){for(var f=0;f<this.za.keys().length;f++)this.za.get(this.za.keys()[f]).hide(e)};z.eg=function(e){for(var f=!0,g=this.za.keys(),h=0;h<g.length&&(f=this.za.get(g[h]).eg(e),f);h++);return f};
z.Wb=function(){for(var e=[],f=this.za.values(),g=0,h=f.length;g<h;g++)for(var k=f[g].ge.keys(),m=0;m<k.length;m++){var l=k[m];l.visible&&e.push(l)}return e};z.ad=function(){return Hd(this.ub())};z.ub=function(){var e=null,f;for(f in this.za.keys()){var g=this.za.get(this.za.keys()[f]),h=g.ub().clone();h.applyMatrix4(g.matrix);e=null===e?h:e.merge(h)}return e};z.toString=function(){return this.ia.Gi};z.Bb=function(){return this.toString()};z.cd=function(){return this.ia._id};
function Ch(e,f){for(var g=e.za.keys(),h=0;h<g.length;h++){var k=g[h];if(k.toString()===f)return e.za.get(k)}}function sf(e){for(var f=[],g=e.za.keys(),h=0;h<g.length;h++)f.push(e.za.get(g[h]));return f}z.pb=function(e){var f=this.za.get(e);void 0===f&&(f=new ag(this,e),this.za.set(e,f));return f};z.reset=function(){Fe(this);this.he();this.Qe();this.ng()};
z.ng=function(){for(var e=sf(this),f=0;f<e.length;f++){e[f].yb(!1);for(var g=e[f].Jd.values();f<g.length;f++){g[0].yb(!1);for(var h=g[0].Of.values();f<h.length;f++)h[0].yb(!1)}}};z.he=function(){this.matrix.identity();this.matrixWorldNeedsUpdate=!0;for(var e=sf(this),f=0;f<e.length;f++)e[f].he()};z.Qe=function(){Fe(this);var e=sf(this);this.show();for(var f=0;f<e.length;f++)e[f].reset()};
z.$b=function(e,f,g){var h,k;if(e instanceof dd||void 0==e)switch(f){case void 0:case M.u.Gg:Dh(this,this.ia,this.ia.toString(),this.ia.Wa(),this,g);break;case M.u.nc:e=this.za.keys();for(var m in e)k=this.za.get(e[m]),Dh(this,k.sa,k.sa.toString(),k.sa.Wa(),k,g);break;case M.u.fc:e=this.za.keys();for(m in e){k=this.za.get(e[m]);f=k.sa.ga;for(var l=0;l<f.length;l++)h=f[l],Dh(this,h,h.toString(),h.nh(),k,g)}break;case M.u.nb:case M.u.Uc:for(m in e=this.za.keys(),e)for(k=this.za.get(e[m]),h=k.sa.Aa(),
l=0;l<h.length;l++){var q=h[l];f===M.u.nb?Dh(this,q,q.toString(),q.Wa(),k,g):Dh(this,q,bb(q.symbol)[7],q.Wa(),k,g)}}else if(e instanceof Nb)switch(f){case M.u.nb:case M.u.Uc:h=e.Aa();k=this.pb(e);for(m=0;m<h.length;m++)q=h[m],f===M.u.nb?Dh(this,q,q.toString(),q.Wa(),k,g):Dh(this,q,bb(q.symbol)[7],q.Wa(),k,g);break;case M.u.fc:f=e.ga;k=this.pb(e);for(m=0;m<f.length;m++)h=f[m],Dh(this,h,h.toString(),h.nh(),k,g);break;case M.u.nc:case void 0:k=this.pb(e),Dh(this,e,e.toString(),e.Wa(),k,g)}else if(e instanceof
Gc)switch(f){case void 0:case M.u.fc:k=this.pb(e.Fa);Dh(this,e,e.toString(),e.nh(),k,g);break;case M.u.nb:case M.u.Uc:for(m3D=this.pb(e.Fa),h=e.Aa(),m=0;m<h.length;m++)q=h[m],f===M.u.nb?Dh(this,q,q.toString(),q.Wa(),k,g):Dh(this,q,bb(q.symbol)[7],q.Wa(),k,g)}else if(e instanceof Wa)switch(f){case void 0:case M.u.nb:case M.u.Uc:k=this.pb(e.Ja.Fa),f===M.u.nb||void 0===f?Dh(this,e,e.toString(),e.Wa(),k,g):Dh(this,e,bb(e.symbol)[7],e.Wa(),k,g)}};
function Dh(e,f,g,h,k,m){void 0==e.Rc.get(f)&&(g=bf(g,m),h=ae(g,h),k.labels.add(h),e.Rc.set(f,h))}function Fe(e,f){var g,h;if(void 0===f){var k=e.Rc.keys();for(h=0;h<k.length;h++)g=e.Rc.get(k[h]),g.parent.remove(g);e.Rc.clear()}else if(Array.isArray(f))for(h=0;h<f.length;h++)g=e.Rc.get(f[h]),null!=g&&(e.Rc.remove(f[h]),g.parent.remove(g));else g=e.Rc.remove(f),null!=g&&g.parent.remove(g)}M.u={Gg:"structure",nc:"molecule",fc:"residue",nb:"atom",Uc:"vdw"};function Eh(){}Eh.prototype.hb=function(){};
function Fh(e,f,g){var h=[],k,m=N.ne;switch(f.type){case Gh:e=sf(f.jb(e)[0]);for(var l in e)if(f=e[l],k=f.Wb(),void 0===g)0===k.length&&(k=Sg(f,m)),h=h.concat(k);else for(var q in k)k[q].hd===g.name&&h.push(k[q]);break;case Hh:e=f.zd(e);for(l in e)if(f=e[l],k=f.Wb(),void 0===g)0===k.length&&(k=Sg(f,m)),h=h.concat(k);else for(q in k)k[q].hd===g.name&&h.push(k[q]);break;case Ih:f=f.pb(e)[0];k=f.Wb();if(void 0===g)0===k.length&&(k=Sg(f,m)),h=h.concat(k);else for(q in k)k[q].hd===g.name&&h.push(k[q]);
break;case Jh:l=f.dc(e)[0];if(null!==l&&void 0!==l)if(k=l.Wb(),void 0===g)0===k.length&&(k=Sg(l,m)),h=h.concat(k);else for(q in k)k[q].hd===g.name&&h.push(k[q]);break;case Kh:if(l=f.xd(e)[0],null!==l&&void 0!==l&&(k=l.Wb()),void 0===g)0===k.length&&(k=Sg(l,m)),h=h.concat(k);else for(q in k)k[q].hd===g.name&&h.push(k[q])}return h}function Lh(){this.Qi=this.Wg=this.vb=this.fd=this.ac=this.yc=this.type=null;this.Bj="\x00"}Lh.prototype=Object.create(Eh.prototype);Lh.prototype.constructor=Lh;
var Gh="STRUCTURE",Hh="MOL_TYPE",Ih="MOLECULE",Jh="RESIDUE",Kh="ATOM";z=Lh.prototype;z.hb=function(){};z.zd=function(e){switch(this.type){case "SCENE":return e;case Gh:return e.jb(this.ac);case Hh:return xe(e,this.ac,this.yc);case Ih:return xe(e,this.ac,this.yc,this.fd);case Jh:return e.dc(this.ac,this.yc,this.fd,this.vb,this.Bj,!0);case Kh:return e.xd(this.ac,this.yc,this.fd,this.Wg,this.Qi,!0);default:return null}};z.jb=function(e){return e.jb(this.ac)};
z.pb=function(e){return xe(e,this.ac,this.yc,this.fd)};z.dc=function(e){return e.dc(this.ac,this.yc,this.fd,this.vb,this.Bj,!0)};z.xd=function(e){return e.xd(this.ac,this.yc,this.fd,this.Wg,this.Qi,!0)};function Mh(e){this.v=Nh;this.aa=e;this.u=[];new EventTarget(Mh.prototype)}var ScriptEngine=function Oh(f){this.scene3D=f;this.u=this.scene3D.animations;this.Oc=!0;this.u.pause=this.Oc;this.v=this.ja=this.ca=this.currentTime=this.ea=null;new EventTarget(Oh.prototype)};z=ScriptEngine.prototype;
z.update=function(e){if(!this.Oc){this.currentTime+=e;if(0<this.ea)this.ea-=e;else for(var f=0;this.v.length;f++){var g=this.v.remove();if(!1===g)break;else void 0!==g&&void 0!==g.hb||console.warn("WARNING : the command didn't return a class with execute function");if(g instanceof Ph){this.ea=g.duration;break}else try{g.hb(this.scene3D.aa)}catch(h){console.warn("Error on parsing script : "+h+"\nOn stack : "+(h.stack?h.stack:"Unknown")+"\nComing from command "+g.constructor.name);break}}0!==this.u.Hc.length&&
If(this.u,e);this.currentTime>this.ca&&this.gb("endScript");this.gb({type:"timeChanged",data:{currentTime:this.currentTime,progress:this.currentTime/this.ca}})}};
function Qh(e,f){Rh(e);var g=e.u;g.Hc.splice(0,g.Hc.length);e.currentTime=f.value*e.ca;for(var h=0,g=[],k=0;e.v.length;k++){var m=e.v.remove();if(!1===m)break;else void 0!==m&&void 0!==m.hb||console.warn("The command didn't return a class with execute function");if(m instanceof Ph){for(var m=m.duration,l=g.length,k=0;k<l;k++)try{g[k].hb(e.scene3D.aa)}catch(q){console.warn("Error on parsing script : "+q+"\nOn stack : "+(q.stack?q.stack:"Unknown")+"\nComing from command "+g[k].constructor.name);break}g.splice(0,
g.length);if(h+m>e.currentTime){h=e.currentTime-h;If(e.u,h,!0);e.ea=m-h;break}else If(e.u,m,!0),h+=m}else g.push(m)}l=g.length;if(0<l){for(k=0;k<l;k++)try{g[k].hb(e.scene3D.aa)}catch(q){console.warn("Error on parsing script : "+q+"\nOn stack : "+(q.stack?q.stack:"Unknown")+"\nComing from command "+g[k].constructor.name);break}e.gb("endScript")}}z.sc=function(e){this.u.sc(e)};z.play=function(){this.Oc=!1;this.u.pause=this.Oc;Qh(this,{type:"update",value:this.currentTime/this.ca})};
z.stop=function(){this.Oc=!0;this.u.pause=this.Oc;Rh(this);var e=this.u;e.Hc.splice(0,e.Hc.length);this.scene3D.reset();this.gb({type:"timeChanged",data:{currentTime:this.currentTime,progress:this.currentTime/this.ca}})};z.pause=function(){this.Oc=!0;this.u.pause=this.Oc};function Rh(e){e.currentTime=0;e.ea=0;e.v=e.ja.slice(0);e.v.add=e.v.push;e.v.remove=e.v.shift}function Sh(e,f,g){this.Fi=e;this.rc=f;this.Di=g?g.get("full"):!1;this.Ci=g?g.get("duration"):0}Sh.prototype=Object.create(Eh.prototype);
Sh.prototype.constructor=Sh;
Sh.prototype.hb=function(e){var f;var g=this.Fi.pb(e)[0],h=this.rc.pb(e)[0],k=new Sd;k.align(g.sa,h.sa);k=k.ca;if(null!==k){var m=Th(this,e).matrixWorld;f=(new THREE.Matrix4).getInverse(m);var l=g.matrixWorld,q=h.matrixWorld,m=(new THREE.Matrix4).extractRotation(m),r=(new THREE.Matrix4).extractRotation(q),t=this.Di?(new THREE.Matrix4).extractRotation((new THREE.Matrix4).getInverse(g.matrix)):new THREE.Matrix4,g=g.sa.Wa().clone().applyMatrix4(l),q=h.sa.Wa().clone().applyMatrix4(q),h=new THREE.Vector3;
h.setFromMatrixPosition((new THREE.Matrix4).multiply(f).multiply((new THREE.Matrix4).setPosition(g)));g=(new THREE.Vector3).subVectors(q,g);f=(new THREE.Matrix4).multiply((new THREE.Matrix4).setPosition(ge(f,g))).multiply((new THREE.Matrix4).setPosition(h)).multiply((new THREE.Matrix4).getInverse(m)).multiply(r).multiply(k).multiply(t).multiply((new THREE.Matrix4).setPosition(h.clone().negate()))}else f=null;k=Th(this,e);0<=this.Ci?(f=k.matrix.clone().multiply(f),Ah(e.scene3D,k,f,this.Ci)):(k.matrix.multiply(f),
k.matrixWorldNeedsUpdate=!0)};function Th(e,f){var g=e.Fi.pb(f)[0];return e.Di?g.jb():g}function Uh(e,f,g,h){this.alpha=f;this.target=e;this.zc=h;this.duration=g?g.get("duration"):void 0}Uh.prototype=Object.create(Eh.prototype);Uh.prototype.constructor=Uh;Uh.prototype.hb=function(e){for(var f=Fh(e,this.target,this.zc),g=0;g<f.length;g++){var h=f[g].qg(this.alpha,this.duration);null!=h&&e.scene3D.animations.sc(h)}};function Vh(e,f,g){this.target=e;this.zoom=g;this.duration=f?f.get("duration"):0}
Vh.prototype=Object.create(Eh.prototype);Vh.prototype.constructor=Vh;Vh.prototype.hb=function(e){var f=this.target.jb(e)[0];if(void 0!==f)if(0>=this.duration)ze(e,f,this.zoom);else{e=e.scene3D;var g=this.duration,h=this.zoom;void 0===f&&(f=e.na[0]);void 0===g&&(g=1E3);void 0===h&&(h=!0);f=new Jf(f,e,g,h);e.animations.sc(f)}};function Wh(e,f,g,h){this.target=e;this.duration=h?h.get("duration"):void 0}Wh.prototype=Object.create(Eh.prototype);Wh.prototype.constructor=Wh;Wh.prototype.hb=function(){console.log("Clip Command not supported yet")};
function Xh(e,f,g,h){this.target=e;this.color=f;this.zc=g;this.duration=h?h.get("duration"):void 0}Xh.prototype=Object.create(Eh.prototype);Xh.prototype.constructor=Xh;Xh.prototype.hb=function(e){var f=Fh(e,this.target,this.zc),g,h=this.color;void 0!=R.oh(this.color)&&(h=R.oh(this.color));for(var k=0;k<f.length;k++)g=f[k].color(h,this.duration),null!=g&&e.scene3D.animations.sc(g)};
function Yh(e,f){this.name="display";this.text=e;this.position=null==f?void 0:f.get("location");this.size=null==f?void 0:f.get("size");this.color=null==f?void 0:f.get("color");this.duration=null==f?void 0:f.get("duration")}Yh.prototype=Object.create(Eh.prototype);Yh.prototype.constructor=Yh;Yh.prototype.hb=function(e){e.scene3D.pg(this.text,this.position,this.size,this.color,this.duration)};function Zh(e,f,g){this.target=e;this.zc=f;this.enable=g}Zh.prototype=Object.create(Eh.prototype);
Zh.prototype.constructor=Zh;Zh.prototype.hb=function(e){var f=this.target.zd(e);switch(this.target.type){case Gh:f=sf(f);for(e=0;e<f.length;e++)f[e].yb(this.enable,this.zc);break;case Hh:case Ih:for(e=0;e<f.length;e++)f[e].yb(this.enable,this.zc);break;case Jh:e=f[0];e.yb(this.enable,this.zc);f=e.pb();f.yb(this.enable,this.zc,e.wb.Aa());break;case Kh:var g=f[0];g.yb(this.enable,this.zc);e=g.dc();e.yb(this.enable,this.zc,[g.Xd]);f=g.pb();f.yb(this.enable,this.zc,[g.Xd])}};
function $h(e,f){this.name="load";this.qh=e;this.Nf=f}$h.prototype=Object.create(Eh.prototype);$h.prototype.constructor=$h;$h.prototype.hb=function(){biovizAPI.ed(this.qh,this.Nf)};function ai(e,f,g){this.target=e;this.matrix=f;this.duration=g?g.get("duration"):0}ai.prototype=Object.create(Eh.prototype);ai.prototype.constructor=ai;
ai.prototype.hb=function(e){var f;if("SCENE"==this.target.type)f=e.scene3D;else if(this.target.type==Gh)f=this.target.jb(e)[0];else if(this.target.type==Ih)f=this.target.zd(e)[0];else throw"MoveCommand only applies to Scene, Structure and Molecule targets";var g=new THREE.Matrix4;g.set(this.matrix[0],this.matrix[4],this.matrix[8],this.matrix[12],this.matrix[1],this.matrix[5],this.matrix[9],this.matrix[13],this.matrix[2],this.matrix[6],this.matrix[10],this.matrix[14],this.matrix[3],this.matrix[7],
this.matrix[11],this.matrix[15]);void 0!==f&&Ah(e.scene3D,f,g,this.duration)};function bi(e){this.qh=e}bi.prototype=Object.create(Eh.prototype);bi.prototype.constructor=bi;bi.prototype.hb=function(e){var f=e.jb(this.qh);void 0!==f&&void 0!==f[0].remove&&De(e,f[0])};function ci(e,f,g){this.target=e;this.Ia=f;this.enable=g}ci.prototype=Object.create(Eh.prototype);ci.prototype.constructor=ci;
ci.prototype.hb=function(e){e=this.target.zd(e);for(var f in e){var g;e[f].fl?g=sf(e[f]):g=[e[f]];for(var h in g)this.enable?g[h].show(this.Ia):g[h].hide(this.Ia)}};function di(){}di.prototype=Object.create(Eh.prototype);di.prototype.constructor=di;di.prototype.hb=function(e){e.scene3D.reset()};function ei(e,f,g){this.lm=e;this.value=f;this.duration=null==g?void 0:g.get("duration")}ei.prototype=Object.create(Eh.prototype);ei.prototype.constructor=ei;
ei.prototype.hb=function(e){switch(this.lm){case "background":var f=new THREE.Color(this.value),g=this.duration;g&&0<g?e.scene3D.Zd(f,g):e.fa.Zd(f);break;case "quality":He(e.Zb,this.value)}};function fi(e,f){this.target=e;this.show=f}fi.prototype=Object.create(Eh.prototype);fi.prototype.constructor=fi;fi.prototype.hb=function(e){var f="SCENE"==this.target.type?e.scene3D.na:this.target.zd(e);for(e=0;e<f.length;e++)this.show?f[e].show():f[e].hide()};function Ph(e){this.duration=e}Ph.prototype=Object.create(Eh.prototype);
Ph.prototype.constructor=Ph;Ph.prototype.hb=function(){};
var Nh=function(){function e(f,g,h,k){this.message=f;this.location=k;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}(function(e,g){function h(){this.constructor=e}h.prototype=g.prototype;e.prototype=new h})(e,Error);return{SyntaxError:e,parse:function(f){function g(e){var g=yf[e],h,k;if(g)return g;for(h=e-1;!yf[h];)h--;g=yf[h];for(g={line:g.line,rb:g.rb,ec:g.ec};h<e;)k=f.charAt(h),"\n"===k?(g.ec||g.line++,g.rb=1,g.ec=!1):"\r"===k||"\u2028"===k||
"\u2029"===k?(g.line++,g.rb=1,g.ec=!0):(g.rb++,g.ec=!1),h++;return yf[e]=g}function h(e,f){var h=g(e),k=g(f);return{start:{offset:e,line:h.line,rb:h.rb},end:{offset:f,line:k.line,rb:k.rb}}}function k(e){p<$a||(p>$a&&($a=p,yg=[]),yg.push(e))}function m(){var e,f,g,h;e=p;f=[];for(g=l();g!==n;)f.push(g),g=l();if(f!==n){g=[];for(f=wa();f!==n;)g.push(f),f=wa();if(g!==n){f=[];for(h=l();h!==n;)f.push(h),h=l();if(f!==n){e=g;g=[];for(var k in e)g.push(e[k]);e=g}else p=e,e=n}else p=e,e=n}else p=e,e=n;if(e===
n)for(e=[],f=l();f!==n;)e.push(f),f=l();return e}function l(){var e;32===f.charCodeAt(p)?(e=ea,p++):(e=n,0===C&&k(Ab));e===n&&(9===f.charCodeAt(p)?(e=wc,p++):(e=n,0===C&&k(cb)));return e}function q(){var e;Ka.test(f.charAt(p))?(e=f.charAt(p),p++):(e=n,0===C&&k(Vb));return e}function r(){var e;Lc.test(f.charAt(p))?(e=f.charAt(p),p++):(e=n,0===C&&k(jc));return e}function t(){var e,g,h;e=p;Wb.test(f.charAt(p))?(g=f.charAt(p),p++):(g=n,0===C&&k(Mc));g!==n?(h=E(),h!==n?e=g=[g,h]:(p=e,e=n)):(p=e,e=n);return e}
function x(){var e;32===f.charCodeAt(p)?(e=ea,p++):(e=n,0===C&&k(Ab));e===n&&(33===f.charCodeAt(p)?(e=kc,p++):(e=n,0===C&&k(Db)),e===n&&(35===f.charCodeAt(p)?(e=ra,p++):(e=n,0===C&&k(fb)),e===n&&(36===f.charCodeAt(p)?(e=lc,p++):(e=n,0===C&&k(La)),e===n&&(37===f.charCodeAt(p)?(e=Xa,p++):(e=n,0===C&&k(gb)),e===n&&(38===f.charCodeAt(p)?(e=fa,p++):(e=n,0===C&&k(pa)),e===n&&(40===f.charCodeAt(p)?(e=la,p++):(e=n,0===C&&k(Da)),e===n&&(41===f.charCodeAt(p)?(e=Eb,p++):(e=n,0===C&&k(tb)),e===n&&(42===f.charCodeAt(p)?
(e=ub,p++):(e=n,0===C&&k(Ma)),e===n&&(43===f.charCodeAt(p)?(e=Fb,p++):(e=n,0===C&&k(sa)),e===n&&(44===f.charCodeAt(p)?(e=Ra,p++):(e=n,0===C&&k(ma)),e===n&&(45===f.charCodeAt(p)?(e=Ya,p++):(e=n,0===C&&k(ua)),e===n&&(46===f.charCodeAt(p)?(e=hb,p++):(e=n,0===C&&k(xc)),e===n&&(47===f.charCodeAt(p)?(e=yc,p++):(e=n,0===C&&k(Xb)),e===n&&(Ka.test(f.charAt(p))?(e=f.charAt(p),p++):(e=n,0===C&&k(Vb)),e===n&&(58===f.charCodeAt(p)?(e=xa,p++):(e=n,0===C&&k(na)),e===n&&(59===f.charCodeAt(p)?(e=eb,p++):(e=n,0===
C&&k(qb)),e===n&&(60===f.charCodeAt(p)?(e=ya,p++):(e=n,0===C&&k(Nc)),e===n&&(61===f.charCodeAt(p)?(e=Ea,p++):(e=n,0===C&&k(Kb)),e===n&&(62===f.charCodeAt(p)?(e=Oc,p++):(e=n,0===C&&k(Pc)),e===n&&(63===f.charCodeAt(p)?(e=Yb,p++):(e=n,0===C&&k(Sa)),e===n&&(64===f.charCodeAt(p)?(e=Na,p++):(e=n,0===C&&k(mc)),e===n&&(zc.test(f.charAt(p))?(e=f.charAt(p),p++):(e=n,0===C&&k(nc)),e===n&&(91===f.charCodeAt(p)?(e=ib,p++):(e=n,0===C&&k(Lb)),e===n&&(92===f.charCodeAt(p)?(e=Za,p++):(e=n,0===C&&k(Mb)),e===n&&(93===
f.charCodeAt(p)?(e=oc,p++):(e=n,0===C&&k(Gb)),e===n&&(94===f.charCodeAt(p)?(e=va,p++):(e=n,0===C&&k(Ta)),e===n&&(95===f.charCodeAt(p)?(e=A,p++):(e=n,0===C&&k(vb)),e===n&&(96===f.charCodeAt(p)?(e=ja,p++):(e=n,0===C&&k(Zb)),e===n&&(J.test(f.charAt(p))?(e=f.charAt(p),p++):(e=n,0===C&&k(za)),e===n&&(123===f.charCodeAt(p)?(e=Aa,p++):(e=n,0===C&&k(Ua)),e===n&&(47===f.charCodeAt(p)?(e=yc,p++):(e=n,0===C&&k(Xb)),e===n&&(125===f.charCodeAt(p)?(e=U,p++):(e=n,0===C&&k(jb)),e===n&&(126===f.charCodeAt(p)?(e=$b,
p++):(e=n,0===C&&k(id)))))))))))))))))))))))))))))))))));return e}function w(){var e;44===f.charCodeAt(p)?(e=Ra,p++):(e=n,0===C&&k(ma));return e}function B(){var e,f,g,h,k;e=p;f=[];for(g=l();g!==n;)f.push(g),g=l();if(f!==n)if(g=w(),g!==n){h=[];for(k=l();k!==n;)h.push(k),k=l();h!==n?e=f=[f,g,h]:(p=e,e=n)}else p=e,e=n;else p=e,e=n;return e}function D(){var e,f;e=[];f=q();if(f!==n)for(;f!==n;)e.push(f),f=q();else e=n;e!==n&&(e=parseInt(e.join(""),10));return e}function E(){var e,g,h;e=p;43===f.charCodeAt(p)?
(g=Fb,p++):(g=n,0===C&&k(sa));g===n&&(45===f.charCodeAt(p)?(g=Ya,p++):(g=n,0===C&&k(ua)));g===n&&(g=null);g!==n?(h=D(),h!==n?e=g=parseInt(g+h,10):(p=e,e=n)):(p=e,e=n);return e}function I(){var e,g,h,l,m,r,w;e=p;g=E();g!==n?(h=t(),h!==n?e=g=parseFloat(g+h.join("")):(p=e,e=n)):(p=e,e=n);if(e===n)if(e=p,43===f.charCodeAt(p)?(g=Fb,p++):(g=n,0===C&&k(sa)),g===n&&(45===f.charCodeAt(p)?(g=Ya,p++):(g=n,0===C&&k(ua))),g===n&&(g=null),g!==n){l=h=p;m=[];for(r=q();r!==n;)m.push(r),r=q();m!==n?(46===f.charCodeAt(p)?
(r=hb,p++):(r=n,0===C&&k(xc)),r!==n?(w=D(),w!==n?l=m=[m,r,w]:(p=l,l=n)):(p=l,l=n)):(p=l,l=n);if(l===n){l=p;m=[];r=q();if(r!==n)for(;r!==n;)m.push(r),r=q();else m=n;m!==n?(46===f.charCodeAt(p)?(r=hb,p++):(r=n,0===C&&k(xc)),r!==n?l=m=[m,r]:(p=l,l=n)):(p=l,l=n)}h=l!==n?f.substring(h,p):l;h!==n?(l=t(),l===n&&(l=null),l!==n?e=g=parseFloat((g?g:"")+(h?h:"")+(l?l.join(""):"")):(p=e,e=n)):(p=e,e=n)}else p=e,e=n;return e}function H(){var e;e=I();e===n&&(e=E());return e}function K(){var e,g,h,m,q,r,t,w,x,y,
A,Aa,D,Ua,E,U,G,I,jb;e=p;91===f.charCodeAt(p)?(g=ib,p++):(g=n,0===C&&k(Lb));if(g!==n){h=[];for(g=l();g!==n;)h.push(g),g=l();if(h!==n)if(g=H(),g!==n)if(h=B(),h!==n)if(h=H(),h!==n)if(m=B(),m!==n)if(m=H(),m!==n)if(q=B(),q!==n)if(q=H(),q!==n)if(r=B(),r!==n)if(r=H(),r!==n)if(t=B(),t!==n)if(t=H(),t!==n)if(w=B(),w!==n)if(w=H(),w!==n)if(x=B(),x!==n)if(x=H(),x!==n)if(y=B(),y!==n)if(y=H(),y!==n)if(A=B(),A!==n)if(A=H(),A!==n)if(Aa=B(),Aa!==n)if(Aa=H(),Aa!==n)if(D=B(),D!==n)if(D=H(),D!==n)if(Ua=B(),Ua!==n)if(Ua=
H(),Ua!==n)if(E=B(),E!==n)if(E=H(),E!==n)if(U=B(),U!==n)if(U=H(),U!==n)if(G=B(),G!==n)if(G=H(),G!==n){I=[];for(jb=l();jb!==n;)I.push(jb),jb=l();I!==n?(93===f.charCodeAt(p)?(jb=oc,p++):(jb=n,0===C&&k(Gb)),jb!==n?e=g=[g,h,m,q,r,t,w,x,y,A,Aa,D,Ua,E,U,G]:(p=e,e=n)):(p=e,e=n)}else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,
e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n}else p=e,e=n;return e}function G(){var e,g;e=[];gi.test(f.charAt(p))?(g=f.charAt(p),p++):(g=n,0===C&&k(hi));if(g!==n)for(;g!==n;)e.push(g),gi.test(f.charAt(p))?(g=f.charAt(p),p++):(g=n,0===C&&k(hi));else e=n;e!==n&&(e=e.join(""));return e}function L(){var e,g,h,l;e=p;39===f.charCodeAt(p)?(g=Pa,p++):(g=n,0===C&&k(rb));
if(g!==n){h=[];f.substr(p,2)===Cb?(l=Cb,p+=2):(l=n,0===C&&k(Qa));l===n&&(34===f.charCodeAt(p)?(l=qa,p++):(l=n,0===C&&k(O)),l===n&&(l=x()));for(;l!==n;)h.push(l),f.substr(p,2)===Cb?(l=Cb,p+=2):(l=n,0===C&&k(Qa)),l===n&&(34===f.charCodeAt(p)?(l=qa,p++):(l=n,0===C&&k(O)),l===n&&(l=x()));h!==n?(39===f.charCodeAt(p)?(l=Pa,p++):(l=n,0===C&&k(rb)),l!==n?e=g=[g,h,l]:(p=e,e=n)):(p=e,e=n)}else p=e,e=n;if(e===n)if(e=p,34===f.charCodeAt(p)?(g=qa,p++):(g=n,0===C&&k(O)),g!==n){h=[];f.substr(p,2)===S?(l=S,p+=2):
(l=n,0===C&&k(sb));l===n&&(39===f.charCodeAt(p)?(l=Pa,p++):(l=n,0===C&&k(rb)),l===n&&(l=x()));for(;l!==n;)h.push(l),f.substr(p,2)===S?(l=S,p+=2):(l=n,0===C&&k(sb)),l===n&&(39===f.charCodeAt(p)?(l=Pa,p++):(l=n,0===C&&k(rb)),l===n&&(l=x()));h!==n?(34===f.charCodeAt(p)?(l=qa,p++):(l=n,0===C&&k(O)),l!==n?e=g=[g,h,l]:(p=e,e=n)):(p=e,e=n)}else p=e,e=n;return e}function P(){var e,g,h,m,q,t;g=p;var w,x,y;e=p;35===f.charCodeAt(p)?(h=ra,p++):(h=n,0===C&&k(fb));h===n&&(f.substr(p,2)===ii?(h=ii,p+=2):(h=n,0===
C&&k(Qj)));h!==n?(m=r(),m!==n?(q=r(),q!==n?(t=r(),t!==n?(w=r(),w!==n?(x=r(),x!==n?(y=r(),y!==n?e=h=[h,m,q,t,w,x,y]:(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n);h=e;e=g=h!==n?f.substring(g,p):h;if(e===n)if(e=p,f.substr(p,4)===ji?(g=ji,p+=4):(g=n,0===C&&k(Rj)),g!==n){h=[];for(g=l();g!==n;)h.push(g),g=l();if(h!==n)if(g=H(),g!==n)if(h=B(),h!==n)if(h=H(),h!==n)if(m=B(),m!==n)if(m=H(),m!==n){q=[];for(t=l();t!==n;)q.push(t),t=l();q!==n?(41===f.charCodeAt(p)?(t=Eb,p++):(t=n,
0===C&&k(tb)),t!==n?e=g="#"+("0"+g.toString(16)).slice(-2)+("0"+h.toString(16)).slice(-2)+("0"+m.toString(16)).slice(-2):(p=e,e=n)):(p=e,e=n)}else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n}else p=e,e=n;return e}function Q(){var e;e=P();e===n&&(e=G());return e}function V(){var e,g;e=p;var h,l,m,q;g=p;84===f.charCodeAt(p)?(h=ac,p++):(h=n,0===C&&k(Ob));h===n&&(116===f.charCodeAt(p)?(h=qc,p++):(h=n,0===C&&k(Ba)));h!==n?(82===f.charCodeAt(p)?(l=td,p++):(l=n,0===C&&k(zg)),
l===n&&(114===f.charCodeAt(p)?(l=ud,p++):(l=n,0===C&&k(Pb))),l!==n?(85===f.charCodeAt(p)?(m=Sj,p++):(m=n,0===C&&k(Tj)),m===n&&(117===f.charCodeAt(p)?(m=Uj,p++):(m=n,0===C&&k(Vj))),m!==n?(69===f.charCodeAt(p)?(q=Bc,p++):(q=n,0===C&&k(Sc)),q===n&&(101===f.charCodeAt(p)?(q=rc,p++):(q=n,0===C&&k(sc))),q!==n?g=h=[h,l,m,q]:(p=g,g=n)):(p=g,g=n)):(p=g,g=n)):(p=g,g=n);g===n&&(g=p,79===f.charCodeAt(p)?(h=Le,p++):(h=n,0===C&&k(Me)),h===n&&(111===f.charCodeAt(p)?(h=Ne,p++):(h=n,0===C&&k(Oe))),h!==n?(78===f.charCodeAt(p)?
(l=Cc,p++):(l=n,0===C&&k(Qb)),l===n&&(110===f.charCodeAt(p)?(l=Dc,p++):(l=n,0===C&&k(Rb))),l!==n?g=h=[h,l]:(p=g,g=n)):(p=g,g=n));if(g===n){var r;g=p;70===f.charCodeAt(p)?(h=Ag,p++):(h=n,0===C&&k(Bg));h===n&&(102===f.charCodeAt(p)?(h=Cg,p++):(h=n,0===C&&k(Dg)));h!==n?(65===f.charCodeAt(p)?(l=Pe,p++):(l=n,0===C&&k(Qe)),l===n&&(97===f.charCodeAt(p)?(l=Re,p++):(l=n,0===C&&k(Se))),l!==n?(76===f.charCodeAt(p)?(m=Te,p++):(m=n,0===C&&k(Ue)),m===n&&(108===f.charCodeAt(p)?(m=Ve,p++):(m=n,0===C&&k(We))),m!==
n?(83===f.charCodeAt(p)?(q=Eg,p++):(q=n,0===C&&k(Fg)),q===n&&(115===f.charCodeAt(p)?(q=Gg,p++):(q=n,0===C&&k(Hg))),q!==n?(69===f.charCodeAt(p)?(r=Bc,p++):(r=n,0===C&&k(Sc)),r===n&&(101===f.charCodeAt(p)?(r=rc,p++):(r=n,0===C&&k(sc))),r!==n?g=h=[h,l,m,q,r]:(p=g,g=n)):(p=g,g=n)):(p=g,g=n)):(p=g,g=n)):(p=g,g=n);g===n&&(g=p,79===f.charCodeAt(p)?(h=Le,p++):(h=n,0===C&&k(Me)),h===n&&(111===f.charCodeAt(p)?(h=Ne,p++):(h=n,0===C&&k(Oe))),h!==n?(70===f.charCodeAt(p)?(l=Ag,p++):(l=n,0===C&&k(Bg)),l===n&&(102===
f.charCodeAt(p)?(l=Cg,p++):(l=n,0===C&&k(Dg))),l!==n?(70===f.charCodeAt(p)?(m=Ag,p++):(m=n,0===C&&k(Bg)),m===n&&(102===f.charCodeAt(p)?(m=Cg,p++):(m=n,0===C&&k(Dg))),m!==n?g=h=[h,l,m]:(p=g,g=n)):(p=g,g=n)):(p=g,g=n))}e=g!==n?f.substring(e,p):g;e!==n&&(e="true"===e.toLowerCase()||"on"===e.toLowerCase());return e}function aa(){var e;e=P();if(e===n){var g,h;e=p;g=H();g!==n?(37===f.charCodeAt(p)?(h=Xa,p++):(h=n,0===C&&k(gb)),h!==n?e=g=[g,h]:(p=e,e=n)):(p=e,e=n);e!==n&&(e=e.join(""));e===n&&(e=H(),e===
n&&(e=da(),e===n&&(e=K(),e===n&&(e=L(),e===n&&(e=V(),e===n&&(e=G()))))))}return e}function oa(){var e,g,h,m;e=p;40===f.charCodeAt(p)?(g=la,p++):(g=n,0===C&&k(Da));if(g!==n){var q,r;g=p;h=G();if(h!==n){m=[];for(q=l();q!==n;)m.push(q),q=l();if(m!==n)if(61===f.charCodeAt(p)?(q=Ea,p++):(q=n,0===C&&k(Kb)),q!==n){q=[];for(m=l();m!==n;)q.push(m),m=l();if(q!==n)if(m=aa(),m!==n){q=[];for(r=l();r!==n;)q.push(r),r=l();q!==n?g=h=[h,m]:(p=g,g=n)}else p=g,g=n;else p=g,g=n}else p=g,g=n;else p=g,g=n}else p=g,g=n;
h=g;if(h!==n){g=[];for(m=Hb();m!==n;)g.push(m),m=Hb();if(g!==n)if(41===f.charCodeAt(p)?(m=Eb,p++):(m=n,0===C&&k(tb)),m!==n){e=new Map;e.set(h[0],h[1]);for(var t in g)h=g[t],e.set(h[0],h[1])}else p=e,e=n;else p=e,e=n}else p=e,e=n}else p=e,e=n;return e}function Hb(){var e,g,h,m,q;e=p;g=[];for(h=l();h!==n;)g.push(h),h=l();if(g!==n)if(h=w(),h!==n){h=[];for(g=l();g!==n;)h.push(g),g=l();if(h!==n)if(g=G(),g!==n){h=[];for(m=l();m!==n;)h.push(m),m=l();if(h!==n)if(61===f.charCodeAt(p)?(m=Ea,p++):(m=n,0===C&&
k(Kb)),m!==n){m=[];for(h=l();h!==n;)m.push(h),h=l();if(m!==n)if(h=aa(),h!==n){m=[];for(q=l();q!==n;)m.push(q),q=l();m!==n?e=g=[g,h]:(p=e,e=n)}else p=e,e=n;else p=e,e=n}else p=e,e=n;else p=e,e=n}else p=e,e=n;else p=e,e=n}else p=e,e=n;else p=e,e=n;return e}function Tb(){var e,g,h,l,m,q,r,t;e=p;80===f.charCodeAt(p)?(g=Ig,p++):(g=n,0===C&&k(Jg));g===n&&(112===f.charCodeAt(p)?(g=Kg,p++):(g=n,0===C&&k(Lg)));g!==n?(69===f.charCodeAt(p)?(h=Bc,p++):(h=n,0===C&&k(Sc)),h===n&&(101===f.charCodeAt(p)?(h=rc,p++):
(h=n,0===C&&k(sc))),h!==n?(80===f.charCodeAt(p)?(l=Ig,p++):(l=n,0===C&&k(Jg)),l===n&&(112===f.charCodeAt(p)?(l=Kg,p++):(l=n,0===C&&k(Lg))),l!==n?(84===f.charCodeAt(p)?(m=ac,p++):(m=n,0===C&&k(Ob)),m===n&&(116===f.charCodeAt(p)?(m=qc,p++):(m=n,0===C&&k(Ba))),m!==n?(73===f.charCodeAt(p)?(q=zf,p++):(q=n,0===C&&k(Af)),q===n&&(105===f.charCodeAt(p)?(q=Bf,p++):(q=n,0===C&&k(Cf))),q!==n?(68===f.charCodeAt(p)?(r=Mg,p++):(r=n,0===C&&k(Ng)),r===n&&(100===f.charCodeAt(p)?(r=Og,p++):(r=n,0===C&&k(Pg))),r!==n?
(69===f.charCodeAt(p)?(t=Bc,p++):(t=n,0===C&&k(Sc)),t===n&&(101===f.charCodeAt(p)?(t=rc,p++):(t=n,0===C&&k(sc))),t!==n?e=g=[g,h,l,m,q,r,t]:(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n);return e}function ga(){var e,g,h,m,q,r,t,w;e=p;80===f.charCodeAt(p)?(g=Ig,p++):(g=n,0===C&&k(Jg));g===n&&(112===f.charCodeAt(p)?(g=Kg,p++):(g=n,0===C&&k(Lg)));g!==n?(82===f.charCodeAt(p)?(h=td,p++):(h=n,0===C&&k(zg)),h===n&&(114===f.charCodeAt(p)?(h=ud,p++):(h=n,0===C&&k(Pb))),h!==n?(79===
f.charCodeAt(p)?(m=Le,p++):(m=n,0===C&&k(Me)),m===n&&(111===f.charCodeAt(p)?(m=Ne,p++):(m=n,0===C&&k(Oe))),m!==n?(84===f.charCodeAt(p)?(q=ac,p++):(q=n,0===C&&k(Ob)),q===n&&(116===f.charCodeAt(p)?(q=qc,p++):(q=n,0===C&&k(Ba))),q!==n?(69===f.charCodeAt(p)?(r=Bc,p++):(r=n,0===C&&k(Sc)),r===n&&(101===f.charCodeAt(p)?(r=rc,p++):(r=n,0===C&&k(sc))),r!==n?(73===f.charCodeAt(p)?(t=zf,p++):(t=n,0===C&&k(Af)),t===n&&(105===f.charCodeAt(p)?(t=Bf,p++):(t=n,0===C&&k(Cf))),t!==n?(78===f.charCodeAt(p)?(w=Cc,p++):
(w=n,0===C&&k(Qb)),w===n&&(110===f.charCodeAt(p)?(w=Dc,p++):(w=n,0===C&&k(Rb))),w!==n?e=g=[g,h,m,q,r,t,w]:(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n);e===n&&(e=Tb(),e===n&&(e=p,83===f.charCodeAt(p)?(g=Eg,p++):(g=n,0===C&&k(Fg)),g===n&&(115===f.charCodeAt(p)?(g=Gg,p++):(g=n,0===C&&k(Hg))),g!==n?(77===f.charCodeAt(p)?(h=Wj,p++):(h=n,0===C&&k(Xj)),h===n&&(109===f.charCodeAt(p)?(h=Yj,p++):(h=n,0===C&&k(Zj))),h!==n?(65===f.charCodeAt(p)?(m=Pe,p++):(m=n,0===C&&k(Qe)),m===
n&&(97===f.charCodeAt(p)?(m=Re,p++):(m=n,0===C&&k(Se))),m!==n?(76===f.charCodeAt(p)?(q=Te,p++):(q=n,0===C&&k(Ue)),q===n&&(108===f.charCodeAt(p)?(q=Ve,p++):(q=n,0===C&&k(We))),q!==n?(76===f.charCodeAt(p)?(r=Te,p++):(r=n,0===C&&k(Ue)),r===n&&(108===f.charCodeAt(p)?(r=Ve,p++):(r=n,0===C&&k(We))),r!==n?(t=l(),t!==n?(w=Tb(),w!==n?e=g=[g,h,m,q,r,t,w]:(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n),e===n&&(e=p,82===f.charCodeAt(p)?(g=td,p++):(g=n,0===C&&k(zg)),g===n&&(114===f.charCodeAt(p)?
(g=ud,p++):(g=n,0===C&&k(Pb))),g!==n?(78===f.charCodeAt(p)?(h=Cc,p++):(h=n,0===C&&k(Qb)),h===n&&(110===f.charCodeAt(p)?(h=Dc,p++):(h=n,0===C&&k(Rb))),h!==n?(65===f.charCodeAt(p)?(m=Pe,p++):(m=n,0===C&&k(Qe)),m===n&&(97===f.charCodeAt(p)?(m=Re,p++):(m=n,0===C&&k(Se))),m!==n?e=g=[g,h,m]:(p=e,e=n)):(p=e,e=n)):(p=e,e=n),e===n&&(e=p,68===f.charCodeAt(p)?(g=Mg,p++):(g=n,0===C&&k(Ng)),g===n&&(100===f.charCodeAt(p)?(g=Og,p++):(g=n,0===C&&k(Pg))),g!==n?(78===f.charCodeAt(p)?(h=Cc,p++):(h=n,0===C&&k(Qb)),h===
n&&(110===f.charCodeAt(p)?(h=Dc,p++):(h=n,0===C&&k(Rb))),h!==n?(65===f.charCodeAt(p)?(m=Pe,p++):(m=n,0===C&&k(Qe)),m===n&&(97===f.charCodeAt(p)?(m=Re,p++):(m=n,0===C&&k(Se))),m!==n?e=g=[g,h,m]:(p=e,e=n)):(p=e,e=n)):(p=e,e=n),e===n&&(e=p,76===f.charCodeAt(p)?(g=Te,p++):(g=n,0===C&&k(Ue)),g===n&&(108===f.charCodeAt(p)?(g=Ve,p++):(g=n,0===C&&k(We))),g!==n?(73===f.charCodeAt(p)?(h=zf,p++):(h=n,0===C&&k(Af)),h===n&&(105===f.charCodeAt(p)?(h=Bf,p++):(h=n,0===C&&k(Cf))),h!==n?(71===f.charCodeAt(p)?(m=ak,
p++):(m=n,0===C&&k(bk)),m===n&&(103===f.charCodeAt(p)?(m=ck,p++):(m=n,0===C&&k(dk))),m!==n?(65===f.charCodeAt(p)?(q=Pe,p++):(q=n,0===C&&k(Qe)),q===n&&(97===f.charCodeAt(p)?(q=Re,p++):(q=n,0===C&&k(Se))),q!==n?(78===f.charCodeAt(p)?(r=Cc,p++):(r=n,0===C&&k(Qb)),r===n&&(110===f.charCodeAt(p)?(r=Dc,p++):(r=n,0===C&&k(Rb))),r!==n?(68===f.charCodeAt(p)?(t=Mg,p++):(t=n,0===C&&k(Ng)),t===n&&(100===f.charCodeAt(p)?(t=Og,p++):(t=n,0===C&&k(Pg))),t!==n?e=g=[g,h,m,q,r,t]:(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=
e,e=n)):(p=e,e=n)):(p=e,e=n),e===n&&(e=p,73===f.charCodeAt(p)?(g=zf,p++):(g=n,0===C&&k(Af)),g===n&&(105===f.charCodeAt(p)?(g=Bf,p++):(g=n,0===C&&k(Cf))),g!==n?(79===f.charCodeAt(p)?(h=Le,p++):(h=n,0===C&&k(Me)),h===n&&(111===f.charCodeAt(p)?(h=Ne,p++):(h=n,0===C&&k(Oe))),h!==n?(78===f.charCodeAt(p)?(m=Cc,p++):(m=n,0===C&&k(Qb)),m===n&&(110===f.charCodeAt(p)?(m=Dc,p++):(m=n,0===C&&k(Rb))),m!==n?e=g=[g,h,m]:(p=e,e=n)):(p=e,e=n)):(p=e,e=n),e===n&&(e=p,83===f.charCodeAt(p)?(g=Eg,p++):(g=n,0===C&&k(Fg)),
g===n&&(115===f.charCodeAt(p)?(g=Gg,p++):(g=n,0===C&&k(Hg))),g!==n?(79===f.charCodeAt(p)?(h=Le,p++):(h=n,0===C&&k(Me)),h===n&&(111===f.charCodeAt(p)?(h=Ne,p++):(h=n,0===C&&k(Oe))),h!==n?(76===f.charCodeAt(p)?(m=Te,p++):(m=n,0===C&&k(Ue)),m===n&&(108===f.charCodeAt(p)?(m=Ve,p++):(m=n,0===C&&k(We))),m!==n?(86===f.charCodeAt(p)?(q=ek,p++):(q=n,0===C&&k(fk)),q===n&&(118===f.charCodeAt(p)?(q=gk,p++):(q=n,0===C&&k(hk))),q!==n?(69===f.charCodeAt(p)?(r=Bc,p++):(r=n,0===C&&k(Sc)),r===n&&(101===f.charCodeAt(p)?
(r=rc,p++):(r=n,0===C&&k(sc))),r!==n?(78===f.charCodeAt(p)?(t=Cc,p++):(t=n,0===C&&k(Qb)),t===n&&(110===f.charCodeAt(p)?(t=Dc,p++):(t=n,0===C&&k(Rb))),t!==n?(84===f.charCodeAt(p)?(w=ac,p++):(w=n,0===C&&k(Ob)),w===n&&(116===f.charCodeAt(p)?(w=qc,p++):(w=n,0===C&&k(Ba))),w!==n?e=g=[g,h,m,q,r,t,w]:(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n))))))));e!==n&&(e=e.join(""));return e}function da(){var e;f.substr(p,5)===ki?(e=ki,p+=5):(e=n,0===C&&k(ik));e!==n&&(e=new Lh,e.type=
"SCENE");if(e===n){var g,h;e=p;f.substr(p,9)===li?(g=li,p+=9):(g=n,0===C&&k(jk));if(g!==n){h=[];for(g=l();g!==n;)h.push(g),g=l();h!==n?(g=G(),g!==n?(e=new Lh,e.type=Gh,e.ac=g.toUpperCase()):(p=e,e=n)):(p=e,e=n)}else p=e,e=n;if(e===n){e=p;f.substr(p,7)===mi?(g=mi,p+=7):(g=n,0===C&&k(kk));if(g!==n){h=[];for(g=l();g!==n;)h.push(g),g=l();h!==n?(g=G(),g!==n?(58===f.charCodeAt(p)?(h=xa,p++):(h=n,0===C&&k(na)),h!==n?(h=ga(),h!==n?(e=new Lh,e.type=Hh,e.yc=h.toUpperCase(),e.ac=g.toUpperCase()):(p=e,e=n)):
(p=e,e=n)):(p=e,e=n)):(p=e,e=n)}else p=e,e=n;if(e===n){var m;e=p;f.substr(p,8)===ni?(g=ni,p+=8):(g=n,0===C&&k(lk));if(g!==n){h=[];for(g=l();g!==n;)h.push(g),g=l();h!==n?(g=G(),g!==n?(58===f.charCodeAt(p)?(h=xa,p++):(h=n,0===C&&k(na)),h!==n?(h=ga(),h!==n?(58===f.charCodeAt(p)?(m=xa,p++):(m=n,0===C&&k(na)),m!==n?(m=G(),m!==n?(e=new Lh,e.type=Ih,e.ac=g.toUpperCase(),e.yc=h.toUpperCase(),e.fd=m):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)}else p=e,e=n;if(e===n){var q,r,t,w;e=p;f.substr(p,
7)===oi?(g=oi,p+=7):(g=n,0===C&&k(mk));if(g!==n){h=[];for(g=l();g!==n;)h.push(g),g=l();h!==n?(g=G(),g!==n?(58===f.charCodeAt(p)?(h=xa,p++):(h=n,0===C&&k(na)),h!==n?(h=ga(),h!==n?(58===f.charCodeAt(p)?(m=xa,p++):(m=n,0===C&&k(na)),m!==n?(m=G(),m!==n?(58===f.charCodeAt(p)?(q=xa,p++):(q=n,0===C&&k(na)),q!==n?(q=r=p,t=G(),t!==n?(58===f.charCodeAt(p)?(w=xa,p++):(w=n,0===C&&k(na)),w!==n?q=t=[t,w]:(p=q,q=n)):(p=q,q=n),q===n&&(q=null),r=q!==n?f.substring(r,p):q,r!==n?(q=p,t=E(),q=t!==n?f.substring(q,p):t,
q!==n?(e=new Lh,e.type=Jh,e.ac=g.toUpperCase(),e.yc=h.toUpperCase(),e.fd=m,e.vb=parseInt(q)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)}else p=e,e=n;if(e===n)if(e=p,f.substr(p,4)===pi?(g=pi,p+=4):(g=n,0===C&&k(nk)),g!==n){h=[];for(g=l();g!==n;)h.push(g),g=l();h!==n?(g=G(),g!==n?(58===f.charCodeAt(p)?(h=xa,p++):(h=n,0===C&&k(na)),h!==n?(h=ga(),h!==n?(58===f.charCodeAt(p)?(m=xa,p++):(m=n,0===C&&k(na)),m!==n?(m=G(),m!==n?(58===f.charCodeAt(p)?(q=
xa,p++):(q=n,0===C&&k(na)),q!==n?(q=r=p,t=G(),t!==n?(58===f.charCodeAt(p)?(w=xa,p++):(w=n,0===C&&k(na)),w!==n?q=t=[t,w]:(p=q,q=n)):(p=q,q=n),q===n&&(q=null),r=q!==n?f.substring(r,p):q,r!==n?(q=p,t=E(),q=t!==n?f.substring(q,p):t,q!==n?(e=new Lh,e.type=Kh,e.ac=g.toUpperCase(),e.yc=h.toUpperCase(),e.fd=m,e.Wg=parseInt(q)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)}else p=e,e=n}}}}return e}function wa(){var e,g,h,m,q;e=p;g=[];for(h=l();h!==n;)g.push(h),
h=l();if(g!==n){var r,t,w,x,y,A;r=p;f.substr(p,4)===qi?(t=qi,p+=4):(t=n,0===C&&k(ok));if(t!==n){w=[];for(x=l();x!==n;)w.push(x),x=l();if(w!==n)if(x=G(),x!==n){y=[];for(A=l();A!==n;)y.push(A),A=l();if(y!==n){var Aa,B,Ua,E;Aa=p;f.substr(p,2)===ri?(B=ri,p+=2):(B=n,0===C&&k(pk));if(B!==n){Ua=[];for(E=l();E!==n;)Ua.push(E),E=l();Ua!==n?(E=G(),E!==n?Aa=B=E:(p=Aa,Aa=n)):(p=Aa,Aa=n)}else p=Aa,Aa=n;A=Aa;A===n&&(A=null);A!==n?r=t=new $h(x.toUpperCase(),A):(p=r,r=n)}else p=r,r=n}else p=r,r=n;else p=r,r=n}else p=
r,r=n;h=r;if(h===n){var U,H,jb,$b,id,J,ac;U=p;f.substr(p,7)===si?(H=si,p+=7):(H=n,0===C&&k(qk));if(H!==n){jb=[];for($b=l();$b!==n;)jb.push($b),$b=l();if(jb!==n)if($b=oa(),$b===n&&($b=null),$b!==n){id=[];for(J=l();J!==n;)id.push(J),J=l();if(id!==n)if(J=p,ac=L(),J=ac!==n?f.substring(J,p):ac,J!==n){var O=J,O=O.substring(0).substring(O.length-1,1);U=H=new Yh(O,$b)}else p=U,U=n;else p=U,U=n}else p=U,U=n;else p=U,U=n}else p=U,U=n;h=U;if(h===n){var Ob,S,Z,qc;Ob=p;f.substr(p,6)===ti?(S=ti,p+=6):(S=n,0===
C&&k(rk));if(S!==n){Z=[];for(qc=l();qc!==n;)Z.push(qc),qc=l();Z!==n?(qc=G(),qc!==n?Ob=S=new bi(qc.toUpperCase()):(p=Ob,Ob=n)):(p=Ob,Ob=n)}else p=Ob,Ob=n;h=Ob;if(h===n){var Ba,aa,td,fa,la,ea,pa,ga;Ba=p;f.substr(p,3)===ui?(aa=ui,p+=3):(aa=n,0===C&&k(sk));if(aa!==n){td=[];for(fa=l();fa!==n;)td.push(fa),fa=l();if(td!==n)if(fa=G(),fa!==n){la=[];for(ea=l();ea!==n;)la.push(ea),ea=l();if(la!==n)if(ea=oa(),ea===n&&(ea=null),ea!==n){pa=[];for(ga=l();ga!==n;)pa.push(ga),ga=l();if(pa!==n)if(ga=P(),ga===n&&(ga=
G()),ga!==n){var na=fa,va=ea,qa=ga;"background"===na?aa=new ei(na,qa,va):"quality"===na?(qa=qa.toUpperCase(),aa=new ei(na,qa,va)):aa=new ei(na,qa);Ba=aa}else p=Ba,Ba=n;else p=Ba,Ba=n}else p=Ba,Ba=n;else p=Ba,Ba=n}else p=Ba,Ba=n;else p=Ba,Ba=n}else p=Ba,Ba=n;h=Ba;if(h===n){var ja,ma,xa,sa;ja=p;f.substr(p,4)===vi?(ma=vi,p+=4):(ma=n,0===C&&k(tk));ma===n&&(f.substr(p,4)===wi?(ma=wi,p+=4):(ma=n,0===C&&k(uk)));if(ma!==n){xa=[];for(sa=l();sa!==n;)xa.push(sa),sa=l();xa!==n?(sa=da(),sa!==n?ja=ma=new fi(sa,
"show"===ma):(p=ja,ja=n)):(p=ja,ja=n)}else p=ja,ja=n;h=ja;if(h===n){var lb,Ma,Ra,wa,Ya,ya,Za,za;lb=p;f.substr(p,4)===xi?(Ma=xi,p+=4):(Ma=n,0===C&&k(vk));if(Ma!==n){Ra=[];for(wa=l();wa!==n;)Ra.push(wa),wa=l();if(Ra!==n)if(wa=da(),wa!==n){Ya=[];for(ya=l();ya!==n;)Ya.push(ya),ya=l();if(Ya!==n)if(ya=G(),ya!==n){Za=[];for(za=l();za!==n;)Za.push(za),za=l();Za!==n?(za=V(),za!==n?lb=Ma=new ci(wa,N.$f(ya.toUpperCase()),za):(p=lb,lb=n)):(p=lb,lb=n)}else p=lb,lb=n;else p=lb,lb=n}else p=lb,lb=n;else p=lb,lb=
n}else p=lb,lb=n;h=lb;if(h===n){var Ga,Xa,gb,ua,hb,Ea,ib,Pb,bc,ra,Qa,La,cb,Pa;Ga=p;f.substr(p,5)===yi?(Xa=yi,p+=5):(Xa=n,0===C&&k(wk));if(Xa!==n){gb=[];for(ua=l();ua!==n;)gb.push(ua),ua=l();if(gb!==n)if(ua=oa(),ua===n&&(ua=null),ua!==n){hb=[];for(Ea=l();Ea!==n;)hb.push(Ea),Ea=l();if(hb!==n)if(Ea=da(),Ea!==n){ib=[];for(Pb=l();Pb!==n;)ib.push(Pb),Pb=l();if(ib!==n){bc=Pb=p;ra=G();if(ra!==n){Qa=p;C++;La=p;cb=[];for(Pa=l();Pa!==n;)cb.push(Pa),Pa=l();cb!==n?(Pa=Q(),Pa!==n?La=cb=[cb,Pa]:(p=La,La=n)):(p=
La,La=n);C--;La!==n?(p=Qa,Qa=void 0):Qa=n;Qa!==n?bc=ra=[ra,Qa]:(p=bc,bc=n)}else p=bc,bc=n;bc===n&&(bc=null);Pb=bc!==n?f.substring(Pb,p):bc;if(Pb!==n){bc=[];for(ra=l();ra!==n;)bc.push(ra),ra=l();bc!==n?(ra=Q(),ra!==n?Ga=Xa=new Xh(Ea,ra,N.$f((Pb?Pb.toUpperCase():"").toUpperCase()),ua):(p=Ga,Ga=n)):(p=Ga,Ga=n)}else p=Ga,Ga=n}else p=Ga,Ga=n}else p=Ga,Ga=n;else p=Ga,Ga=n}else p=Ga,Ga=n;else p=Ga,Ga=n}else p=Ga,Ga=n;h=Ga;if(h===n){var mb,rb,Cb,Da,Eb,Ta,Hb,Ka;mb=p;f.substr(p,4)===zi?(rb=zi,p+=4):(rb=n,0===
C&&k(xk));if(rb!==n){Cb=[];for(Da=l();Da!==n;)Cb.push(Da),Da=l();if(Cb!==n)if(Da=oa(),Da===n&&(Da=null),Da!==n){Eb=[];for(Ta=l();Ta!==n;)Eb.push(Ta),Ta=l();if(Eb!==n)if(Ta=da(),Ta!==n){Hb=[];for(Ka=l();Ka!==n;)Hb.push(Ka),Ka=l();if(Hb!==n){Ka=K();if(Ka===n){var tb;f.substr(p,6)===Ai?(tb=Ai,p+=6):(tb=n,0===C&&k(yk));tb!==n&&(tb=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);Ka=tb}Ka!==n?mb=rb=new ai(Ta,Ka,Da):(p=mb,mb=n)}else p=mb,mb=n}else p=mb,mb=n;else p=mb,mb=n}else p=mb,mb=n;else p=mb,mb=n}else p=mb,mb=n;
h=mb;if(h===n){var nb,Fb,Kb,Na,Mb,$a,Tb,fb;nb=p;f.substr(p,5)===Bi?(Fb=Bi,p+=5):(Fb=n,0===C&&k(zk));if(Fb!==n){Kb=[];for(Na=l();Na!==n;)Kb.push(Na),Na=l();if(Kb!==n)if(Na=oa(),Na===n&&(Na=null),Na!==n){Mb=[];for($a=l();$a!==n;)Mb.push($a),$a=l();if(Mb!==n)if($a=da(),$a!==n){Tb=[];for(fb=l();fb!==n;)Tb.push(fb),fb=l();Tb!==n?(fb=da(),fb!==n?nb=Fb=new Sh($a,fb,Na):(p=nb,nb=n)):(p=nb,nb=n)}else p=nb,nb=n;else p=nb,nb=n}else p=nb,nb=n;else p=nb,nb=n}else p=nb,nb=n;h=nb;if(h===n){var Sa,Lb,Zb,sb;Sa=p;
f.substr(p,4)===Ci?(Lb=Ci,p+=4):(Lb=n,0===C&&k(Ak));if(Lb!==n){Zb=[];for(sb=l();sb!==n;)Zb.push(sb),sb=l();Zb!==n?(sb=D(),sb!==n?Sa=Lb=new Ph(sb):(p=Sa,Sa=n)):(p=Sa,Sa=n)}else p=Sa,Sa=n;h=Sa;if(h===n){var cc,Vb,jc,Xc,kc,ub;cc=p;f.substr(p,4)===Di?(Vb=Di,p+=4):(Vb=n,0===C&&k(Bk));if(Vb!==n){jc=[];for(Xc=l();Xc!==n;)jc.push(Xc),Xc=l();if(jc!==n)if(Xc=oa(),Xc===n&&(Xc=null),Xc!==n){kc=[];for(ub=l();ub!==n;)kc.push(ub),ub=l();kc!==n?(ub=da(),ub!==n?cc=Vb=new Vh(ub,Xc,!0):(p=cc,cc=n)):(p=cc,cc=n)}else p=
cc,cc=n;else p=cc,cc=n}else p=cc,cc=n;h=cc;if(h===n){var ob,Xb,oc,vb,ud,Tc,dc,Ec,Jb,Ab,Wb,Db;ob=p;f.substr(p,9)===Ei?(Xb=Ei,p+=9):(Xb=n,0===C&&k(Ck));if(Xb!==n){oc=[];for(vb=l();vb!==n;)oc.push(vb),vb=l();if(oc!==n)if(vb=da(),vb!==n){ud=[];for(Tc=l();Tc!==n;)ud.push(Tc),Tc=l();if(ud!==n){dc=Tc=p;Ec=G();if(Ec!==n){Jb=p;C++;Ab=p;Wb=[];for(Db=l();Db!==n;)Wb.push(Db),Db=l();Wb!==n?(Db=V(),Db!==n?Ab=Wb=[Wb,Db]:(p=Ab,Ab=n)):(p=Ab,Ab=n);C--;Ab!==n?(p=Jb,Jb=void 0):Jb=n;Jb!==n?dc=Ec=[Ec,Jb]:(p=dc,dc=n)}else p=
dc,dc=n;dc===n&&(dc=null);Tc=dc!==n?f.substring(Tc,p):dc;if(Tc!==n){dc=[];for(Ec=l();Ec!==n;)dc.push(Ec),Ec=l();dc!==n?(Ec=V(),Ec!==n?ob=Xb=new Zh(vb,N.$f((Tc?Tc.toUpperCase():"").toUpperCase()),Ec):(p=ob,ob=n)):(p=ob,ob=n)}else p=ob,ob=n}else p=ob,ob=n}else p=ob,ob=n;else p=ob,ob=n}else p=ob,ob=n;h=ob;if(h===n){var Ha,lc,xc,Yc,zc,Gb,Cc,Qb,Dc,Rb;Ha=p;f.substr(p,4)===Fi?(lc=Fi,p+=4):(lc=n,0===C&&k(Dk));if(lc!==n){xc=[];for(Yc=l();Yc!==n;)xc.push(Yc),Yc=l();if(xc!==n)if(Yc=oa(),Yc===n&&(Yc=null),Yc!==
n){zc=[];for(Gb=l();Gb!==n;)zc.push(Gb),Gb=l();if(zc!==n)if(Gb=da(),Gb!==n){Cc=[];for(Qb=l();Qb!==n;)Cc.push(Qb),Qb=l();if(Cc!==n)if(Qb=I(),Qb!==n){Dc=[];for(Rb=l();Rb!==n;)Dc.push(Rb),Rb=l();Dc!==n?(Rb=I(),Rb!==n?Ha=lc=new Wh(Gb,0,0,Yc):(p=Ha,Ha=n)):(p=Ha,Ha=n)}else p=Ha,Ha=n;else p=Ha,Ha=n}else p=Ha,Ha=n;else p=Ha,Ha=n}else p=Ha,Ha=n;else p=Ha,Ha=n}else p=Ha,Ha=n;h=Ha;if(h===n&&(h=Ib(),h===n)){var ec,wc,Lc,Zc,Mc,vd;ec=p;f.substr(p,6)===Gi?(wc=Gi,p+=6):(wc=n,0===C&&k(Ek));if(wc!==n){Lc=[];for(Zc=
l();Zc!==n;)Lc.push(Zc),Zc=l();if(Lc!==n)if(Zc=oa(),Zc===n&&(Zc=null),Zc!==n){Mc=[];for(vd=l();vd!==n;)Mc.push(vd),vd=l();Mc!==n?(vd=da(),vd!==n?ec=wc=new Vh(vd,Zc,!1):(p=ec,ec=n)):(p=ec,ec=n)}else p=ec,ec=n;else p=ec,ec=n}else p=ec,ec=n;h=ec;if(h===n){var Ia,yc,Nc,$c,Oc,wd,Pc,Uc,fc,Fc,Yb,xd,mc,yd;Ia=p;f.substr(p,7)===Hi?(yc=Hi,p+=7):(yc=n,0===C&&k(Fk));if(yc!==n){Nc=[];for($c=l();$c!==n;)Nc.push($c),$c=l();if(Nc!==n)if($c=oa(),$c===n&&($c=null),$c!==n){Oc=[];for(wd=l();wd!==n;)Oc.push(wd),wd=l();
if(Oc!==n)if(wd=da(),wd!==n){Pc=[];for(Uc=l();Uc!==n;)Pc.push(Uc),Uc=l();if(Pc!==n){fc=Uc=p;Fc=G();if(Fc!==n){Yb=p;C++;xd=p;mc=[];for(yd=l();yd!==n;)mc.push(yd),yd=l();mc!==n?(yd=I(),yd!==n?xd=mc=[mc,yd]:(p=xd,xd=n)):(p=xd,xd=n);C--;xd!==n?(p=Yb,Yb=void 0):Yb=n;Yb!==n?fc=Fc=[Fc,Yb]:(p=fc,fc=n)}else p=fc,fc=n;fc===n&&(fc=null);Uc=fc!==n?f.substring(Uc,p):fc;if(Uc!==n){fc=[];for(Fc=l();Fc!==n;)fc.push(Fc),Fc=l();fc!==n?(Fc=I(),Fc!==n?Ia=yc=new Uh(wd,Fc,$c,N.$f((Uc?Uc.toUpperCase():"").toUpperCase())):
(p=Ia,Ia=n)):(p=Ia,Ia=n)}else p=Ia,Ia=n}else p=Ia,Ia=n}else p=Ia,Ia=n;else p=Ia,Ia=n}else p=Ia,Ia=n;else p=Ia,Ia=n}else p=Ia,Ia=n;h=Ia;if(h===n){var nc;f.substr(p,5)===Ii?(nc=Ii,p+=5):(nc=n,0===C&&k(Gk));nc!==n&&(nc=new di);h=nc;if(h===n&&(h=Ib(),h===n)){var ad,Bc,Sc,zd;ad=p;f.substr(p,6)===Ji?(Bc=Ji,p+=6):(Bc=n,0===C&&k(Hk));if(Bc!==n){Sc=[];for(zd=l();zd!==n;)Sc.push(zd),zd=l();Sc!==n?(zd=da(),zd!==n?ad=Bc=zd:(p=ad,ad=n)):(p=ad,ad=n)}else p=ad,ad=n;h=ad}}}}}}}}}}}}}}}}if(h!==n){m=[];for(q=l();q!==
n;)m.push(q),q=l();if(m!==n){var Ad,rc,sc;Ad=p;59===f.charCodeAt(p)?(rc=eb,p++):(rc=n,0===C&&k(qb));if(rc!==n){var bd;10===f.charCodeAt(p)?(bd=ta,p++):(bd=n,0===C&&k(Bb));bd===n&&(13===f.charCodeAt(p)?(bd=hd,p++):(bd=n,0===C&&k(Ub)),bd===n&&(f.substr(p,2)===db?(bd=db,p+=2):(bd=n,0===C&&k(pb))));sc=bd;sc===n&&(sc=null);sc!==n?Ad=rc=[rc,sc]:(p=Ad,Ad=n)}else p=Ad,Ad=n;q=Ad;q!==n?e=g=h:(p=e,e=n)}else p=e,e=n}else p=e,e=n}else p=e,e=n;return e}function Ib(){var e,g,h;e=p;f.substr(p,6)===Df?(g=Df,p+=6):
(g=n,0===C&&k(Ki));if(g!==n){g=[];for(h=l();h!==n;)g.push(h),h=l();g!==n?e=null:(p=e,e=n)}else p=e,e=n;return e}function Ib(){var e;f.substr(p,6)===Df?(e=Df,p+=6):(e=n,0===C&&k(Ki));e!==n&&(e=!1);return e}var Z=1<arguments.length?arguments[1]:{},n={},y={start:m},Jb=m,ea=" ",Ab={type:"literal",value:" ",description:'" "'},wc="\t",cb={type:"literal",value:"\t",description:'"\\t"'},ta="\n",Bb={type:"literal",value:"\n",description:'"\\n"'},hd="\r",Ub={type:"literal",value:"\r",description:'"\\r"'},db=
"\r\n",pb={type:"literal",value:"\r\n",description:'"\\r\\n"'},eb=";",qb={type:"literal",value:";",description:'";"'},ra="#",fb={type:"literal",value:"#",description:'"#"'},Pa="'",rb={type:"literal",value:"'",description:'"\'"'},Cb="\\'",Qa={type:"literal",value:"\\'",description:'"\\\\\'"'},qa='"',O={type:"literal",value:'"',description:'"\\""'},S='\\"',sb={type:"literal",value:'\\"',description:'"\\\\\\""'},Ka=/^[0-9]/,Vb={type:"class",value:"[0-9]",description:"[0-9]"},Lc=/^[0-9, A-F, a-f]/,jc=
{type:"class",value:"[0-9, A-F, a-f]",description:"[0-9, A-F, a-f]"},Wb=/^["e" \/ "E"]/,Mc={type:"class",value:'["e" / "E"]',description:'["e" / "E"]'},kc="!",Db={type:"literal",value:"!",description:'"!"'},lc="$",La={type:"literal",value:"$",description:'"$"'},Xa="%",gb={type:"literal",value:"%",description:'"%"'},fa="&",pa={type:"literal",value:"&",description:'"&"'},la="(",Da={type:"literal",value:"(",description:'"("'},Eb=")",tb={type:"literal",value:")",description:'")"'},ub="*",Ma={type:"literal",
value:"*",description:'"*"'},Fb="+",sa={type:"literal",value:"+",description:'"+"'},Ra=",",ma={type:"literal",value:",",description:'","'},Ya="-",ua={type:"literal",value:"-",description:'"-"'},hb=".",xc={type:"literal",value:".",description:'"."'},yc="/",Xb={type:"literal",value:"/",description:'"/"'},xa=":",na={type:"literal",value:":",description:'":"'},ya="<",Nc={type:"literal",value:"<",description:'"<"'},Ea="=",Kb={type:"literal",value:"=",description:'"="'},Oc=">",Pc={type:"literal",value:">",
description:'">"'},Yb="?",Sa={type:"literal",value:"?",description:'"?"'},Na="@",mc={type:"literal",value:"@",description:'"@"'},zc=/^[A-Z]/,nc={type:"class",value:"[A-Z]",description:"[A-Z]"},ib="[",Lb={type:"literal",value:"[",description:'"["'},Za="\\",Mb={type:"literal",value:"\\",description:'"\\\\"'},oc="]",Gb={type:"literal",value:"]",description:'"]"'},va="^",Ta={type:"literal",value:"^",description:'"^"'},A="_",vb={type:"literal",value:"_",description:'"_"'},ja="`",Zb={type:"literal",value:"`",
description:'"`"'},J=/^[a-z]/,za={type:"class",value:"[a-z]",description:"[a-z]"},Aa="{",Ua={type:"literal",value:"{",description:'"{"'},U="}",jb={type:"literal",value:"}",description:'"}"'},$b="~",id={type:"literal",value:"~",description:'"~"'},ac="T",Ob={type:"literal",value:"T",description:'"T"'},qc="t",Ba={type:"literal",value:"t",description:'"t"'},td="R",zg={type:"literal",value:"R",description:'"R"'},ud="r",Pb={type:"literal",value:"r",description:'"r"'},Sj="U",Tj={type:"literal",value:"U",
description:'"U"'},Uj="u",Vj={type:"literal",value:"u",description:'"u"'},Bc="E",Sc={type:"literal",value:"E",description:'"E"'},rc="e",sc={type:"literal",value:"e",description:'"e"'},Le="O",Me={type:"literal",value:"O",description:'"O"'},Ne="o",Oe={type:"literal",value:"o",description:'"o"'},Cc="N",Qb={type:"literal",value:"N",description:'"N"'},Dc="n",Rb={type:"literal",value:"n",description:'"n"'},Ag="F",Bg={type:"literal",value:"F",description:'"F"'},Cg="f",Dg={type:"literal",value:"f",description:'"f"'},
Pe="A",Qe={type:"literal",value:"A",description:'"A"'},Re="a",Se={type:"literal",value:"a",description:'"a"'},Te="L",Ue={type:"literal",value:"L",description:'"L"'},Ve="l",We={type:"literal",value:"l",description:'"l"'},Eg="S",Fg={type:"literal",value:"S",description:'"S"'},Gg="s",Hg={type:"literal",value:"s",description:'"s"'},ji="rgb(",Rj={type:"literal",value:"rgb(",description:'"rgb("'},Ai="origin",yk={type:"literal",value:"origin",description:'"origin"'},gi=/^[0-9a-zA-Z_]/,hi={type:"class",value:"[0-9a-zA-Z_]",
description:"[0-9a-zA-Z_]"},ri="as",pk={type:"literal",value:"as",description:'"as"'},ii="0x",Qj={type:"literal",value:"0x",description:'"0x"'},Ig="P",Jg={type:"literal",value:"P",description:'"P"'},Kg="p",Lg={type:"literal",value:"p",description:'"p"'},zf="I",Af={type:"literal",value:"I",description:'"I"'},Bf="i",Cf={type:"literal",value:"i",description:'"i"'},Mg="D",Ng={type:"literal",value:"D",description:'"D"'},Og="d",Pg={type:"literal",value:"d",description:'"d"'},Wj="M",Xj={type:"literal",value:"M",
description:'"M"'},Yj="m",Zj={type:"literal",value:"m",description:'"m"'},ak="G",bk={type:"literal",value:"G",description:'"G"'},ck="g",dk={type:"literal",value:"g",description:'"g"'},ek="V",fk={type:"literal",value:"V",description:'"V"'},gk="v",hk={type:"literal",value:"v",description:'"v"'},ki="scene",ik={type:"literal",value:"scene",description:'"scene"'},li="structure",jk={type:"literal",value:"structure",description:'"structure"'},mi="moltype",kk={type:"literal",value:"moltype",description:'"moltype"'},
ni="molecule",lk={type:"literal",value:"molecule",description:'"molecule"'},oi="residue",mk={type:"literal",value:"residue",description:'"residue"'},pi="atom",nk={type:"literal",value:"atom",description:'"atom"'},si="display",qk={type:"literal",value:"display",description:'"display"'},qi="load",ok={type:"literal",value:"load",description:'"load"'},ti="remove",rk={type:"literal",value:"remove",description:'"remove"'},ui="set",sk={type:"literal",value:"set",description:'"set"'},Gi="center",Ek={type:"literal",
value:"center",description:'"center"'},vi="show",tk={type:"literal",value:"show",description:'"show"'},wi="hide",uk={type:"literal",value:"hide",description:'"hide"'},xi="repr",vk={type:"literal",value:"repr",description:'"repr"'},yi="color",wk={type:"literal",value:"color",description:'"color"'},zi="move",xk={type:"literal",value:"move",description:'"move"'},Bi="align",zk={type:"literal",value:"align",description:'"align"'},Di="zoom",Bk={type:"literal",value:"zoom",description:'"zoom"'},Ei="highlight",
Ck={type:"literal",value:"highlight",description:'"highlight"'},Fi="clip",Dk={type:"literal",value:"clip",description:'"clip"'},Df="finish",Ki={type:"literal",value:"finish",description:'"finish"'},Ci="wait",Ak={type:"literal",value:"wait",description:'"wait"'},Hi="opacity",Fk={type:"literal",value:"opacity",description:'"opacity"'},Ii="reset",Gk={type:"literal",value:"reset",description:'"reset"'},Ji="target",Hk={type:"literal",value:"target",description:'"target"'},p=0,yf=[{line:1,rb:1,ec:!1}],
$a=0,yg=[],C=0,Ef;if("startRule"in Z){if(!(Z.wf in y))throw Error("Can't start parsing from rule \""+Z.wf+'".');Jb=y[Z.wf]}Ef=Jb();if(Ef!==n&&p===f.length)return Ef;Ef!==n&&p<f.length&&k({type:"end",description:"end of input"});throw function(f,g,h,k){function m(e){var f=1;for(e.sort(function(e,f){return e.description<f.description?-1:e.description>f.description?1:0});f<e.length;)e[f-1]===e[f]?e.splice(f,1):f++}function l(e,f){function g(e){function f(e){return e.charCodeAt(0).toString(16).toUpperCase()}
return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+f(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+f(e)}).replace(/[\u0100-\u0FFF]/g,function(e){return"\\u0"+f(e)}).replace(/[\u1000-\uFFFF]/g,function(e){return"\\u"+f(e)})}var h=Array(e.length),k;for(k=0;k<e.length;k++)h[k]=e[k].description;h=1<e.length?h.slice(0,-1).join(", ")+
" or "+h[e.length-1]:h[0];k=f?'"'+g(f)+'"':"end of input";return"Expected "+h+" but "+k+" found."}null!==g&&m(g);return new e(null!==f?f:l(g,h),0,0,k)}(null,yg,$a<f.length?f.charAt($a):null,$a<f.length?h($a,$a+1):h($a,$a));}}}();THREE.ShaderChunk.cylinderImpostor_frag="// Inherits from Phong Shading in ThreeJS, allows compatibility with chunks\n#define PHONG\n\n#include <common>\n#include <fog_pars_fragment>\n#include <color_pars_fragment>\n#include <lights_pars>\n#include <bsdfs>\n#include <lights_phong_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\n// Normalize diagonal matrix (1)\nconst mat4 D = mat4(\n    vec4(1.0, 0.0, 0.0, 0.0),\n    vec4(0.0, 1.0, 0.0, 0.0),\n    vec4(0.0, 0.0, 0.0, 0.0),\n    vec4(0.0, 0.0, 0.0, -1.0)\n);\n\n// Create transpose method (not built-in OpenGL ES Shading Language)\nhighp mat4 transpose(in highp mat4 inMatrix) {\n    highp vec4 i0 = inMatrix[0];\n    highp vec4 i1 = inMatrix[1];\n    highp vec4 i2 = inMatrix[2];\n    highp vec4 i3 = inMatrix[3];\n\n    highp mat4 outMatrix = mat4(\n        vec4(i0.x, i1.x, i2.x, i3.x),\n        vec4(i0.y, i1.y, i2.y, i3.y),\n        vec4(i0.z, i1.z, i2.z, i3.z),\n        vec4(i0.w, i1.w, i2.w, i3.w)\n    );\n\n    return outMatrix;\n}\n\nvarying mat4 MTInverse;\nvarying mat4 VPInverse;\nvarying vec4 centernormclip;\n\n// Near, far, width and height\nvarying float n, f, w, h;\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\nuniform mat4 projectionMatrix;\nuniform mat4 projectionMatrixInverse;\n\nvarying vec3 vViewDirection;\nvarying float vLength;\n\nvoid main() {\n    gl_FragColor = vec4(1.0);\n    float c = (f - n) / (2.0 * n * f) * 2.0 / (gl_DepthRange.diff);\n    vec4 c3 = MTInverse[3] * c;\n\n    // Computing xprime (6)\n    vec4 xp = vec4(\n        (gl_FragCoord.x * 2.0 / w - 1.0),\n        (gl_FragCoord.y * 2.0 / h - 1.0),\n        -1.0,\n        1.0\n    );\n    xp = projectionMatrixInverse * xp;\n    xp.z = -1.0;\n    xp.w = (f + n) / (2.0 * f * n) - (n - f) /\n        (2.0 * f * n) * (gl_DepthRange.near + gl_DepthRange.far) / -gl_DepthRange.diff;\n    vec4 xpPrime = MTInverse * xp;\n\n    // Checking quadratic equation discriminant (7)\n    float c3TDc3 = dot(c3, D * c3);\n    float xpPrimeTDc3 = dot(xpPrime, D * c3);\n    float xpPrimeTDxpPrime = dot(xpPrime, D * xpPrime);\n    float A = c3TDc3, B = 2.0 * xpPrimeTDc3, C = xpPrimeTDxpPrime;\n    float discriminant = B * B - 4.0 * A * C;\n\n    gl_FragColor = vec4(1.0);\n    if (discriminant < 0.0) {\n        discard;\n    } else {\n        // Resolving solutions\n        float x1 = (-B - sqrt(discriminant)) / (2.0 * A);\n        float x2 = (-B + sqrt(discriminant)) / (2.0 * A);\n        float z = 1.0 - max(x1, x2);\n        gl_FragDepthEXT = z;\n\n        // Getting current pixel clip coordinate\n        vec4 vClipPos = vec4(\n            (gl_FragCoord.x * 2.0 - 1.0),\n            (gl_FragCoord.y * 2.0 - 1.0),\n            z * 2.0 - 1.0,\n            1.0\n        );\n\n        // Getting current pixel in NDC\n        vec3 fc = vec3(gl_FragCoord.xy, z);\n        fc.xy /= vec2(w, h);\n        fc *= 2.0;\n        fc -= 1.0;\n        // Getting current pixel in view coordinates\n        vec4 p = projectionMatrixInverse * vec4(fc, 1.0);\n        p /= p.w;\n\n        vec3 cylBase = p.xyz + vViewPosition.xyz;\n\n        float a = dot(cylBase,vViewDirection);\n        if (a < 0.0 || a > vLength + 0.000001) {\n        \tdiscard;\n        }\n\n        // Computing current pixel position in eye space\n        vec4 vViewPos = projectionMatrixInverse * vClipPos;\n        vViewPos = vViewPos / vViewPos.w;\n        vViewPos.z = - vViewPos.z;\n\n        // Performing clipping\n        #if NUM_CLIPPING_PLANES > 0\n        for ( int i = 0; i < NUM_CLIPPING_PLANES; ++ i ) {\n            vec4 plane = clippingPlanes[ i ];\n            if ( dot(vViewPos.xyz, plane.xyz ) > plane.w ) {\n                discard;\n            }\n        }\n        #endif\n\n        // Position in eye coordinates (8)\n        vec4 pe = vec4(\n            (gl_FragCoord.x * 2.0 / w - 1.0),\n            (gl_FragCoord.y * 2.0 / h - 1.0),\n            -1.0,\n            1.0\n        );\n        pe = projectionMatrixInverse * pe;\n        pe.z = -1.0;\n        pe.w = (f + n)/(2.0 * f * n) -\n            (n - f)/(2.0 * f * n) * (gl_DepthRange.near + gl_DepthRange.far) / gl_DepthRange.diff +\n            z * ((n - f) / (n * f) / gl_DepthRange.diff);\n        vec4 np = MTInverse * pe;\n        // Because the cylinder's axis is Z, we ignore z value of the vertex\n        np.z = 0.0;\n        vec4 ne = transpose(MTInverse) * np;\n\n        // Declaring normal to get compatibility with threejs Phong chunks\n        vec3 normal = normalize(ne.xyz);\n\n        // Starting to compute phong lighting\n        vec4 diffuseColor = vec4(diffuse, opacity);\n        ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n        vec3 totalEmissiveLight = emissive;\n        #include <color_fragment>\n        // Declaring specularStength to get compatibility with threejs chunks\n        float specularStrength = 1.0;\n        #include <lights_phong_fragment>\n        #include <lights_template>\n        vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse +\n                                reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;\n\n        gl_FragColor = vec4(outgoingLight, opacity);\n\n        #include <fog_fragment>\n    }\n}\n";
THREE.ShaderChunk.cylinderImpostor_vert="// Inherits from Phong Shading in ThreeJS, allows compatibility with chunks\n#define PHONG\n\n// Normalize diagonal matrix (1)\nconst mat4 D = mat4(\n    vec4(1.0, 0.0, 0.0, 0.0),\n    vec4(0.0, 1.0, 0.0, 0.0),\n    vec4(0.0, 0.0, 0.0, 0.0),\n    vec4(0.0, 0.0, 0.0, -1.0)\n);\n\nconst mat4 t1 = mat4(\n    vec4(1.0, 0.0, 0.0, 0.0),\n    vec4(0.0, 1.0, 0.0, 0.0),\n    vec4(0.0, 0.0, 0.0, 0.0),\n    vec4(0.0, 0.0, 1.0, 1.0)\n);\n\nconst mat4 t2 = mat4(\n    vec4(1.0, 0.0, 0.0, 0.0),\n    vec4(0.0, 1.0, 0.0, 0.0),\n    vec4(0.0, 0.0, 0.0, 0.0),\n    vec4(0.0, 0.0, -1.0, 1.0)\n);\n\n// Create transpose method (not built-in OpenGL ES Shading Language)\nhighp mat4 transpose(in highp mat4 inMatrix) {\n    highp vec4 i0 = inMatrix[0];\n    highp vec4 i1 = inMatrix[1];\n    highp vec4 i2 = inMatrix[2];\n    highp vec4 i3 = inMatrix[3];\n\n    highp mat4 outMatrix = mat4(\n        vec4(i0.x, i1.x, i2.x, i3.x),\n        vec4(i0.y, i1.y, i2.y, i3.y),\n        vec4(i0.z, i1.z, i2.z, i3.z),\n        vec4(i0.w, i1.w, i2.w, i3.w)\n    );\n\n    return outMatrix;\n}\n\n#include <common>\n#include <color_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nattribute float radius;\nattribute vec3 dir;\n\nuniform vec4 viewport;\nuniform mat4 modelViewMatrixInverse;\n\nvarying mat4 MTInverse;\nvarying mat4 VPInverse;\nvarying vec4 centernormclip;\n\n// Near, far, width and height\nvarying float n, f, w, h;\n\n// Compatibility with threejs chunks\nvarying vec3 vViewPosition;\nvarying vec3 vViewDirection;\nvarying float vLength;\n\nvec4 ComputeBoundsFromPMT(mat4 PMT) {\n    // Getting coefficients\n    vec4 r1 = PMT[0];\n    vec4 r2 = PMT[1];\n    vec4 r4 = PMT[3];\n\n    // Intermediate computations\n    float r4TDr4 = dot(r4, D * r4);\n    float r1TDr4 = dot(r1, D * r4);\n    float r1TDr1 = dot(r1, D * r1);\n    float r2TDr4 = dot(r2, D * r4);\n    float r2TDr2 = dot(r2, D * r2);\n\n    // Computing bounding box by resolving second degree equations (5)\n    vec2 yBounds;\n    vec2 xBounds;\n    float A, B, C;\n    A = r4TDr4; B = -2.0 * r1TDr4; C = r1TDr1;\n    xBounds[0] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );\n    xBounds[1] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );\n    A = r4TDr4; B = - 2.0 * r2TDr4; C = r2TDr2;\n    yBounds[0] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );\n    yBounds[1] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );\n\n    return vec4(xBounds, yBounds);\n}\n\nvoid main() {\n    // Chunck to color vertex with vertex color attribute\n    #include <color_vertex>\n\n    // Chunck to compute position in world space\n    #include <begin_vertex>\n    #include <project_vertex>\n    #include <logdepthbuf_vertex>\n    #include <clipping_planes_vertex>\n\n    vViewPosition = - mvPosition.xyz;\n\n    float zScale = length(dir);\n    vec3 normDir = normalize(dir);\n\n    // Computing T matrix with u,v,w and c as quadratic surface parameters (2)\n    // Note : ceil radius because low radius value seems to provoke precision errors\n    mat4 Tscalet = mat4(\n        vec4(ceil(radius), 0.0, 0.0,     0.0),\n        vec4(0.0, ceil(radius), 0.0,     0.0),\n        vec4(0.0, 0.0, zScale,   0.0),\n        vec4(0.0, 0.0, 0.0, 1.0)\n    );\n\n    // Finding up vector to compute rotation matrix from dir attribute\n    vec3 up;\n    bool yMain = abs(normDir[1]) > 0.9;\n    if (yMain) {\n    \tup = vec3( 1, 0, 0 );\n    } else {\n    \tup = vec3( 0, 1, 0 );\n    }\n    vec3 xAxis = normalize(cross(up, normDir.xyz));\n    vec3 yAxis = normalize(cross(normDir.xyz, xAxis));\n\n    mat4 Trott = mat4(\n        vec4(xAxis.xyz,     0.0),\n        vec4(yAxis.xyz,     0.0),\n        vec4(normDir.xyz,   0.0),\n        vec4(0.0, 0.0, 0.0, 1.0)\n    );\n\n    mat4 Ttranst = mat4(\n        vec4(1.0, 0.0, 0.0, 0.0),\n        vec4(0.0, 1.0, 0.0, 0.0),\n        vec4(0.0, 0.0, 1.0, 0.0),\n        vec4(position.x,    position.y,    position.z,    1.0)\n    );\n\n    mat4 Tt = Ttranst * Trott * Tscalet;\n\n    vViewDirection = vec3(modelViewMatrix * (Trott * (vec4(0.0, 0.0, 1.0, 0.0))));\n    vLength = zScale;\n\n    // Computing PMTt Matrix\n    mat4 PMTt = transpose(projectionMatrix * modelViewMatrix * Tt * t1);\n\n    vec4 firstBounds = ComputeBoundsFromPMT(PMTt);\n\n    // Computing PMTt Matrix\n    PMTt = transpose(projectionMatrix * modelViewMatrix * Tt * t2);\n\n    vec4 secBounds = ComputeBoundsFromPMT(PMTt);\n\n    vec2 vertBorders;\n    vec2 horizBorders;\n    horizBorders[0] = min(firstBounds[0], min(firstBounds[1], min(secBounds[0], secBounds[1])));\n  \thorizBorders[1] = max(firstBounds[0], max(firstBounds[1], max(secBounds[0], secBounds[1])));\n\n  \tvertBorders[1] = max(firstBounds[2], max(firstBounds[3], max(secBounds[2], secBounds[3])));\n    vertBorders[0] = min(firstBounds[2], min(firstBounds[3], min(secBounds[2], secBounds[3])));\n\n    // Getting bounding box size in window space\n    float bx = abs( horizBorders[ 0 ] - horizBorders[ 1 ] ) * 0.5 * viewport.z;\n    float by = abs( vertBorders[ 0 ] - vertBorders[ 1 ] ) * 0.5 * viewport.w;\n\n    // Getting bounding box center in clip space\n    float cx = 0.5 * (horizBorders.x + horizBorders.y);\n    float cy = 0.5 * (vertBorders.x + vertBorders.y);\n\n    // Setting point size\n    gl_PointSize = ceil(max(bx, by));\n\n    // Reposition vertex to fit with bounding box\n    //gl_Position.xy = vec2(cx, cy) * gl_Position.w;\n\n    // Prepare varyings for fragment shader\n    mat4 TscaleInv = mat4(\n        vec4(1.0 / radius,        0.0,           0.0,           0.0),\n        vec4(0.0,           1.0 / radius,        0.0,           0.0),\n        vec4(0.0,           0.0,           1.0 / zScale,        0.0),\n        vec4(0.0,           0.0,           0.0,           1.0)\n    );\n\n    mat4 TrotInv = transpose(Trott);\n\n    mat4 TtransInv = mat4(\n        vec4(1.0, 0.0, 0.0, 0.0),\n        vec4(0.0, 1.0, 0.0, 0.0),\n        vec4(0.0, 0.0, 1.0, 0.0),\n        vec4(-position, 1.0)\n    );\n\n    mat4 TInverse = TscaleInv * TrotInv * TtransInv;\n\n    MTInverse = TInverse * modelViewMatrixInverse;\n\n    // Getting near and far\n    n = projectionMatrix[3][2] / (projectionMatrix[2][2] - 1.0);\n    f = ((projectionMatrix[2][2] - 1.0) * n) / (projectionMatrix[2][2] + 1.0);\n\n    // Getting width and height of the viewport for fragment\n    w = viewport.z;\n    h = viewport.w;\n}\n";
THREE.ShaderChunk.outline_frag="uniform vec3 color;\n\nvarying float doHighlight;\nvarying float outputRadius;\n\nvoid main() {\n    if (doHighlight > 0.99) {\n        gl_FragColor = vec4( color, 1.0 );\n        /*gl_FragColor = vec4(vec3(outputRadius), 1.0 );*/\n    } else {\n        discard;\n    }\n}\n";THREE.ShaderChunk.outline_vert="uniform float scale;\n\nattribute float highlight;\nattribute float radius;\n\nvarying float doHighlight;\nvarying float outputRadius;\n\nvoid main() {\n    outputRadius = radius;\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n    vec4 pNormal = projectionMatrix * vec4( normalMatrix * normal, 0.0 );\n    vec2 xyNormal = pNormal.xy * scale;\n    doHighlight = highlight;\n    gl_Position = projectionMatrix * mvPosition + vec4( xyNormal, 0.15 , 0.0 );\n}\n";
THREE.ShaderChunk.sphereImpostor_frag="// Inherits from Phong Shading in ThreeJS, allows compatibility with chunks\n#define PHONG\n\n#include <common>\n#include <fog_pars_fragment>\n#include <color_pars_fragment>\n#include <lights_pars>\n#include <bsdfs>\n#include <lights_phong_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\n// Normalize diagonal matrix (1)\nconst mat4 D = mat4(\n    vec4(1.0, 0.0, 0.0, 0.0),\n    vec4(0.0, 1.0, 0.0, 0.0),\n    vec4(0.0, 0.0, 1.0, 0.0),\n    vec4(0.0, 0.0, 0.0, -1.0)\n);\n\n// Create transpose method (not built-in OpenGL ES Shading Language)\nhighp mat4 transpose(in highp mat4 inMatrix) {\n    highp vec4 i0 = inMatrix[0];\n    highp vec4 i1 = inMatrix[1];\n    highp vec4 i2 = inMatrix[2];\n    highp vec4 i3 = inMatrix[3];\n\n    highp mat4 outMatrix = mat4(\n        vec4(i0.x, i1.x, i2.x, i3.x),\n        vec4(i0.y, i1.y, i2.y, i3.y),\n        vec4(i0.z, i1.z, i2.z, i3.z),\n        vec4(i0.w, i1.w, i2.w, i3.w)\n    );\n\n    return outMatrix;\n}\n\nvarying mat4 MTInverse;\nvarying mat4 VPInverse;\nvarying vec4 centernormclip;\n\n// Near, far, width and height\nvarying float n, f, w, h;\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\nuniform mat4 projectionMatrix;\nuniform mat4 projectionMatrixInverse;\n\nvoid main() {\n    float c = (f - n) / (2.0 * n * f) * 2.0 / (gl_DepthRange.diff);\n    vec4 c3 = MTInverse[3] * c;\n\n    // Computing xprime (6)\n    vec4 xp = vec4(\n        (gl_FragCoord.x * 2.0 / w - 1.0),\n        (gl_FragCoord.y * 2.0 / h - 1.0),\n        -1.0,\n        1.0\n    );\n    xp = projectionMatrixInverse * xp;\n    xp.z = -1.0;\n    xp.w = (f + n) / (2.0 * f * n) - (n - f) /\n        (2.0 * f * n) * (gl_DepthRange.near + gl_DepthRange.far) / -gl_DepthRange.diff;\n    vec4 xpPrime = MTInverse * xp;\n\n    // Checking quadratic equation discriminant (7)\n    float c3TDc3 = dot(c3, D * c3);\n    float xpPrimeTDc3 = dot(xpPrime, D * c3);\n    float xpPrimeTDxpPrime = dot(xpPrime, D * xpPrime);\n    float A = c3TDc3, B = 2.0 * xpPrimeTDc3, C = xpPrimeTDxpPrime;\n    float discriminant = B * B - 4.0 * A * C;\n\n    gl_FragColor = vec4(1.0);\n    if (discriminant < 0.0) {\n        /*gl_FragColor = vec4(1.0, 0.5, 0.5, 1.0);*/\n        discard;\n    } else {\n        // Resolving solutions\n        float x1 = (-B - sqrt(discriminant)) / (2.0 * A);\n        float x2 = (-B + sqrt(discriminant)) / (2.0 * A);\n        float z = 1.0 - max(x1, x2);\n        gl_FragDepthEXT = z;\n\n        // Getting current pixel clip coordinate\n        vec4 vClipPos = vec4(\n            (gl_FragCoord.x * 2.0 - 1.0),\n            (gl_FragCoord.y * 2.0 - 1.0),\n            z * 2.0 - 1.0,\n            1.0\n        );\n\n        // Computing current pixel position in eye space\n        vec4 vViewPos = projectionMatrixInverse * vClipPos;\n        vViewPos = vViewPos / vViewPos.w;\n        vViewPos.z = - vViewPos.z;\n\n        // Performing clipping\n        #if NUM_CLIPPING_PLANES > 0\n        for ( int i = 0; i < NUM_CLIPPING_PLANES; ++ i ) {\n            vec4 plane = clippingPlanes[ i ];\n            if ( dot(vViewPos.xyz, plane.xyz ) > plane.w ) {\n                discard;\n            }\n        }\n        #endif\n\n        // Position in eye coordinates (8)\n        vec4 pe = vec4(\n            (gl_FragCoord.x * 2.0 / w - 1.0),\n            (gl_FragCoord.y * 2.0 / h - 1.0),\n            -1.0,\n            1.0\n        );\n        pe = projectionMatrixInverse * pe;\n        pe.z = -1.0;\n        pe.w = (f + n)/(2.0 * f * n) -\n            (n - f)/(2.0 * f * n) * (gl_DepthRange.near + gl_DepthRange.far) / gl_DepthRange.diff +\n            z * ((n - f) / (n * f) / gl_DepthRange.diff);\n        vec4 np = MTInverse * pe;\n        vec4 ne = transpose(MTInverse) * np;\n\n        // Declaring normal to get compatibility with threejs Phong chunks\n        vec3 normal = normalize(ne.xyz);\n\n        // Starting to compute phong lighting\n        vec4 diffuseColor = vec4(diffuse, opacity);\n        ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n        vec3 totalEmissiveLight = emissive;\n        #include <color_fragment>\n        // Declaring specularStength to get compatibility with threejs chunks\n        float specularStrength = 1.0;\n        #include <lights_phong_fragment>\n        #include <lights_template>\n        vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse +\n                                reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;\n\n        gl_FragColor = vec4(outgoingLight, opacity);\n\n        #include <fog_fragment>\n    }\n}\n";
THREE.ShaderChunk.sphereImpostor_vert="// Inherits from Phong Shading in ThreeJS, allows compatibility with chunks\n#define PHONG\n\n// Normalize diagonal matrix (1)\nconst mat4 D = mat4(\n    vec4(1.0, 0.0, 0.0, 0.0),\n    vec4(0.0, 1.0, 0.0, 0.0),\n    vec4(0.0, 0.0, 1.0, 0.0),\n    vec4(0.0, 0.0, 0.0, -1.0)\n);\n\n// Create transpose method (not built-in OpenGL ES Shading Language)\nhighp mat4 transpose(in highp mat4 inMatrix) {\n    highp vec4 i0 = inMatrix[0];\n    highp vec4 i1 = inMatrix[1];\n    highp vec4 i2 = inMatrix[2];\n    highp vec4 i3 = inMatrix[3];\n\n    highp mat4 outMatrix = mat4(\n        vec4(i0.x, i1.x, i2.x, i3.x),\n        vec4(i0.y, i1.y, i2.y, i3.y),\n        vec4(i0.z, i1.z, i2.z, i3.z),\n        vec4(i0.w, i1.w, i2.w, i3.w)\n    );\n\n    return outMatrix;\n}\n\n#include <common>\n#include <color_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nattribute float radius;\n\nuniform vec4 viewport;\nuniform mat4 modelViewMatrixInverse;\n\nvarying mat4 MTInverse;\nvarying mat4 VPInverse;\nvarying vec4 centernormclip;\n\n// Near, far, width and height\nvarying float n, f, w, h;\n\n// Compatibility with threejs chunks\nvarying vec3 vViewPosition;\n\nvoid main() {\n    // Chunck to color vertex with vertex color attribute\n    #include <color_vertex>\n\n    // Chunck to compute position in world space\n    #include <begin_vertex>\n    #include <project_vertex>\n    #include <logdepthbuf_vertex>\n    #include <clipping_planes_vertex>\n\n    vViewPosition = - mvPosition.xyz;\n\n    // Computing T matrix with u,v,w and c as quadratic surface parameters (2)\n    mat4 T = mat4(\n        // Three following vectors represents u, v, w axis of the quadric\n        vec4(radius,        0.0,           0.0,           0.0),\n        vec4(0.0,           radius,        0.0,           0.0),\n        vec4(0.0,           0.0,           radius,        0.0),\n        // Represents c, center of the quadric\n        vec4(position.x,    position.y,    position.z,    1.0)\n    );\n\n    // Computing PMTt Matrix\n    mat4 PMTt = transpose(projectionMatrix * modelViewMatrix * T);\n\n    // Getting coefficients\n    vec4 r1 = PMTt[0];\n    vec4 r2 = PMTt[1];\n    vec4 r4 = PMTt[3];\n\n    // Intermediate computations\n    float r4TDr4 = dot(r4, D * r4);\n    float r1TDr4 = dot(r1, D * r4);\n    float r1TDr1 = dot(r1, D * r1);\n    float r2TDr4 = dot(r2, D * r4);\n    float r2TDr2 = dot(r2, D * r2);\n\n    // Computing bounding box by resolving second degree equations (5)\n    vec2 vertBorders;\n    vec2 horizBorders;\n    float A, B, C;\n    A = r4TDr4; B = -2.0 * r1TDr4; C = r1TDr1;\n    horizBorders[0] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );\n    horizBorders[1] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );\n    A = r4TDr4; B = - 2.0 * r2TDr4; C = r2TDr2;\n    vertBorders[0] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );\n    vertBorders[1] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );\n\n    // Getting bounding box size in window space\n    float bx = abs( horizBorders[ 0 ] - horizBorders[ 1 ] ) * viewport.z;\n    float by = abs( vertBorders[ 0 ] - vertBorders[ 1 ] ) * viewport.w;\n\n    // Getting bounding box center in clip space\n    float cx = 0.5 * (horizBorders.x + horizBorders.y);\n    float cy = 0.5 * (vertBorders.x + vertBorders.y);\n\n    // Setting point size\n    gl_PointSize = max(bx, by) * 0.5;\n\n    // Reposition vertex to fit with bounding box\n    gl_Position.xy = vec2(cx, cy) * gl_Position.w;\n\n    // Prepare varyings for fragment shader\n    mat4 TInverse = mat4(\n        1.0,          0.0,          0.0,         0.0,\n        0.0,          1.0,          0.0,         0.0,\n        0.0,          0.0,          1.0,         0.0,\n        -position.x,  -position.y,  -position.z, radius\n    );\n    MTInverse = TInverse * modelViewMatrixInverse;\n\n    // Getting near and far\n    n = projectionMatrix[3][2] / (projectionMatrix[2][2] - 1.0);\n    f = ((projectionMatrix[2][2] - 1.0) * n) / (projectionMatrix[2][2] + 1.0);\n\n    // Getting width and height of the viewport for fragment\n    w = viewport.z;\n    h = viewport.w;\n}\n";
THREE.ShaderChunk.transparencyQuad_frag="#include <packing>\n\nvarying vec2 vUv;\n\nuniform sampler2D tOpaque;\nuniform sampler2D tTransparent;\nuniform sampler2D tOpaqueDepth;\nuniform sampler2D tTransparentDepth;\nuniform float cameraNear;\nuniform float cameraFar;\n\nfloat readDepth (sampler2D depthSampler, vec2 coord) {\n  float cameraFarPlusNear = cameraFar + cameraNear;\n  float cameraFarMinusNear = cameraFar - cameraNear;\n  float cameraCoef = 2.0 * cameraNear;\n  return cameraCoef / (cameraFarPlusNear - texture2D(depthSampler, coord).x * cameraFarMinusNear);\n}\n\nvoid main()\n{\n    vec4 opaque = texture2D( tOpaque, vUv );\n    vec4 transparent = texture2D( tTransparent, vUv );\n\n    float opaqueDepth = readDepth( tOpaqueDepth, vUv );\n    float transparentDepth = readDepth( tTransparentDepth, vUv );\n\n    if (opaqueDepth < transparentDepth) {\n        gl_FragColor = opaque;\n    } else {\n        gl_FragColor = transparent + opaque * (1.0 - transparent.a);\n    }\n}\n";
THREE.ShaderChunk.transparencyQuad_vert="varying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n";function Li(e){this.parent=e;this.content=null}Li.prototype.show=function(){Mi(this.parent);this.content.show();var e=[];e.visible=!0;this.update(e)};Li.prototype.hide=function(){this.content.hide();var e=[];e.visible=!1;this.update(e);this.parent.ba.aa.scene3D.fe.Aj()};
Li.prototype.toggle=function(){this.content.is(":visible")?this.hide():this.show()};function Ni(e,f,g){$(g?'<option selected value="'+f+'">'+f+"</option>":'<option value="'+f+'">'+f+"</option>").appendTo(e)}function Oi(e,f){var g;return g=""+('<input type="checkbox" id="widget'+e+'" title="'+f+'">')+('<label class="hasMenu mapSelection" for="widget'+e+'" title="'+f+'">')+"</label>"}Li.prototype.update=function(){};
function Pi(e){Li.call(this,e);this.ba=this.parent.ba;this.time=0;Qi(this);Ri(this)}Pi.prototype=Object.create(Li.prototype);Pi.prototype.constructor=Pi;
function Qi(e){e.content=$('<div id="clippingWidget"></div>');var f;f='<div><span id="clippingTitle" class="mapSelection"> Clipping tool </span><button id="closeClippingButton" class="mapSelection">Close</button></div>';e.content.appendTo(e.parent.me);f=$(f);f.appendTo(e.content);$('<div id="nearFarSliderTitle">Near / Far</div><div id="slider-range2" style="width:90%;"></div>').appendTo(e.content);e.bk=$("#slider-range2").css({margin:"0 auto"});e.bk.slider({orientation:"horizontal",xm:!0,step:.1,
values:[0,100],slide:function(f,h){wf(e.ba.aa.scene3D,h.values[0],h.values[1])}});$("#clippingTitle").css({color:"white"});$("#nearFarSliderTitle").css({color:"white"});$("#closeClippingButton").button({text:!1,label:"Quit",icons:{primary:"ui-icon-close"}}).click(function(){e.hide()});$("#closeClippingButton").css({width:"15px",position:"absolute",right:"0px","margin-right":"10px"})}
function Ri(e){document.addEventListener("keypress",function(e,g){return function(){return e.apply(g,arguments)}}(function(e){99===e.which&&this.toggle()},e),!1)}function Si(e){Li.call(this,e);Ti(this);Ui(this)}Si.prototype=Object.create(Li.prototype);Si.prototype.constructor=Si;
function Vi(e,f){$("#mapping").empty();void 0===f&&(f="Atoms");$("selectMap").text()!==f&&$("#selectMap").text(f);if("Atoms"===f||"Amino Acids"===f)Wi(e,f,4);else if("Nucleic Acids"===f)Wi(e,f,5);else if("Secondary Structure"===f)Wi(e,f,2);else if("Molecules"===f)Wi(e,f,4);else if("Rainbow"===f){$('<span class="gradientLabelLeft">First</span><span class="gradientLabelRight">Last</span></br><canvas id="gradient"></canvas><br/>').appendTo("#mapping");$("#gradient").css({width:"90%",height:"20px",border:"1px solid #555"});
for(var g=document.getElementById("gradient"),h=g.getContext("2d"),k=g.width,g=g.height,m=null,l=0;l<k;l++)for(var q=0;q<g;q++)m="hsl("+l+", 100%, 50%)",h.fillStyle=m,h.fillRect(l,q,1,1)}else"Hydrophobicity"===f?($('<span class="gradientLabelLeft">Hydrophilic</span><span class="gradientLabelRight">Hydrophobic</span></br><canvas id="gradient"></canvas><br/>').appendTo("#mapping"),$("#gradient").css({width:"90%",height:"20px",border:"1px solid #555"}),g=document.getElementById("gradient"),h=g.getContext("2d"),
k=g.width,g=g.height,m=h.createLinearGradient(0,0,k,0),m.addColorStop(0,e.Zb.Pc.Hydrophobicity.Hydrophobic),m.addColorStop(.5,"rgb(255,255,255)"),m.addColorStop(1,e.Zb.Pc.Hydrophobicity.Hydrophilic),h.fillStyle=m,h.fillRect(0,0,k,g)):console.warn("Unknown legend mapping name : ",f)}
function Wi(e,f,g){var h=$('<table style="display: inline-block;">'),k,m=e.Zb.Pc[f],l=0,q;for(q in m){0===l%g&&(k=$("<tr></tr>"),k.appendTo(h));var r=$("<td></td>");r.appendTo(k);var t=$('<div class="legend-mapping"></div>');t.appendTo(r);$('<input type="text" value="'+q+'" readonly/>').appendTo(t);r='<div class="color-box" style="background-color:'+m[q]+';" data-mapping="'+f+'" data-mappingName="'+q+'" data-color="'+m[q]+'"></div>';r=$(r);r.click(function(){e.yg.map=$(this).attr("data-mapping");
e.yg.name=$(this).attr("data-mappingName");$.farbtastic($("#mcp")).setColor($(this).attr("data-color"));$.farbtastic($("#mcp")).Ii=$(this);$("#mapColPick").show()});$(r).appendTo(t);l++}h.appendTo("#mapping")}
function Ti(e){e.content=$('<div id="legend"></div>');var f;f='<button id="previousMapping" class="mapSelection">Previous</button><span id="selectMap" class="mapSelection"></span><button id="nextMapping" class="mapSelection">Next</button>';e.content.appendTo(e.parent.me);$('<button id="closeLegend" class="mapSelection">Close</button>').appendTo(e.content);$('<div id="mappingSelection" style="text-align: center;"></div><div id="mapping" style="text-align: center;"></div>').appendTo(e.content);$("#mappingSelection").css({color:"white",
display:"inline-flex","justify-content":"center",width:"100%"});$(f).appendTo($("#mappingSelection"));$("#selectMap").css({width:"63%"});e.toggle();e.Xj=$("#previousMapping");e.Wj=$("#nextMapping");e.Zb=Ie();$('<div id="mapColPick"><div id="mcp"></div><button id="mapClPicker" class="mapSelection">Close</button></div>').appendTo(e.content);$("#mcp").farbtastic().click(function(){$("#mcp").farbtastic().on("mousemove",function(){var f=$.farbtastic($("#mcp")),g=f.color,m=e.Zb,l=e.yg.map,q=e.yg.name;if(void 0!==
m.Pc[l]&&void 0!==m.Pc[l][q]){m.Pc[l][q]=g;var r=l;"Amino Acids"===r||"Nucleic Acids"===r?r="Residues":"Secondary Structure"===r&&(r="SST");void 0!=m.ca[r]&&void 0!=m.ca[r][q]&&(m.ca[r][q]=m.ca[r][q].set(g),q=new Ze,q.fi=!0,q.bh=l,Ye(m,q))}f.Ii.css("background-color",g);f.Ii.attr("data-color",g)});$("#mcp").farbtastic().on("mouseup",function(){$("#mcp").farbtastic().off("mousemove");$("#mcp").farbtastic().off("mouseup")})});$("#mapColPick").toggle();$("#mapColPick").hide();$("#mapClPicker").button({text:!1,
label:"Quit",icons:{primary:"ui-icon-check"}}).click(function(){$("#mapColPick").hide()});$("#mapColPick").css({"float":"right"});$("#previousMapping").css({width:"7%",right:"5px"});$("#nextMapping").css({width:"7%",left:"5px"});$("#closeLegend").button({text:!1,label:"Quit",icons:{primary:"ui-icon-close"}}).click(function(){e.hide()});$("#closeLegend").css({width:"15px",position:"absolute",right:"0px","margin-right":"10px"});e.Xj.button({text:!1,label:"Previous",icons:{primary:"ui-icon-triangle-1-w"}}).click(function(){void 0!=
this&&this.blur();var f=$("#selectMap").text(),g=null,m;for(m in e.Zb.Pc){if(null!=g&&m===f)break;g=m}$("#selectMap").text(g);Vi(e,g);$("#mapColPick").hide()});e.Wj.button({text:!1,label:"Previous",icons:{primary:"ui-icon-triangle-1-e"}}).click(function(){void 0!=this&&this.blur();var f=!1,g=$("#selectMap").text(),m=null,l;for(l in e.Zb.Pc){if(f){m=l;break}l===g&&(f=!0)}if(null===m){for(var q in e.Zb.Pc)break;m=q}$("#selectMap").text(m);Vi(e,m);$("#mapColPick").hide()});f=$(Oi("SaveButton","Save")).button({text:!1,
label:"Save",icons:{primary:"ui-icon-arrowstop-1-s"}}).click(function(){var f=e.Zb;window.localStorage.setItem("def",JSON.stringify(f.gg));window.localStorage.setItem("moleculeColor",JSON.stringify(f.Fd));window.localStorage.setItem("nucleicAcidColor",JSON.stringify(f.Fb));window.localStorage.setItem("residueColor",JSON.stringify(f.vc));window.localStorage.setItem("atomColor",JSON.stringify(f.Ha));window.localStorage.setItem("hydroColor",JSON.stringify(f.Oe));window.localStorage.setItem("rainbowColor",
JSON.stringify(f.Pe));window.localStorage.setItem("sstColor",JSON.stringify(f.Dd));window.localStorage.setItem("unsortedProperties",JSON.stringify(f.hg));this.blur()}).css({width:"10%"});var g=$(Oi("ResetButton","Reset")).button({text:!1,label:"Reset",icons:{primary:" ui-icon-arrowrefresh-1-e"}}).click(function(){var f=e.Zb;f.ca={Atoms:[],Residues:[],Molecules:[],SST:[]};window.localStorage.setItem("def",JSON.stringify(md));window.localStorage.setItem("moleculeColor",JSON.stringify(nd));window.localStorage.setItem("nucleicAcidColor",
JSON.stringify(od));window.localStorage.setItem("residueColor",JSON.stringify(pd));window.localStorage.setItem("atomColor",JSON.stringify(qd));window.localStorage.setItem("hydroColor",JSON.stringify(rd));window.localStorage.setItem("rainbowColor",JSON.stringify(sd));window.localStorage.setItem("sstColor",JSON.stringify(Bd));window.localStorage.setItem("unsortedProperties",JSON.stringify(Cd));Ke(f);var g=new Ze;g.fi=!0;Ye(f,g);$("#mapColPick").hide();Vi(e);this.blur()}).css({width:"10%"});f.focus(function(){});
g.focus(function(){});f.appendTo("#legend");g.appendTo("#legend")}function Ui(e){document.addEventListener("keypress",function(e,g){return function(){return e.apply(g,arguments)}}(function(e){108===e.which&&this.toggle()},e),!1);Vi(e);e.yg={map:null,name:null,value:null}}function Xi(e){Li.call(this,e);this.am="Star selection";this.rl="Pair selection";this.Zg=" Click to select an atom ";Yi(this);Zi(this)}Xi.prototype=Object.create(Li.prototype);z=Xi.prototype;z.constructor=Xi;z.tg=function(e){this.parent.ba.aa.scene3D.tg(e)};
z.wg=function(){this.parent.ba.aa.scene3D.wg()};z.ah=function(){this.parent.ba.aa.scene3D.ah()};
function Yi(e){e.content=$('<div id="measureWidget"></div>');var f;f='<div><span id="measureTitle" class="mapSelection"> Measuring tool </span><button id="closeMeasurementButton" class="mapSelection">Close</button></div>';e.content.appendTo(e.parent.me);f=$(f);f.appendTo(e.content);f='<button id="clearMeasureButton"> Clear </button><div id="MeasurementTypeSelection"><input type="radio" id="starSelection" name="radioSelectionMeasure" checked="checked">'+('<label for="starSelection" title="starSelection">'+
e.am+"</label>");f=f+'<input type="radio" id="pairSelection" name="radioSelectionMeasure">'+('<label for="pairSelection" title="pairSelection">'+e.rl+"</label>");f+="</div>";var g=$("<div></div>").css({display:"flex","justify-content":"center"});$(f).appendTo(g);g.appendTo(e.content);$("#clearMeasureButton").button({text:!1,label:"Clear",icons:{primary:" ui-icon-arrowrefresh-1-e"}}).css({height:"20px","font-size":"0.7em"}).click(function(){e.ah()});e.ai=$('<div id="starMeasureWidget"><button id="objectMeasurementSelection">'+
e.Zg+"</button></div>");e.ig=$('<div id="pairMeasureWidget"></div>');e.ai.appendTo(e.content);e.ig.appendTo(e.content);e.ig.hide();$("#MeasurementTypeSelection").change(function(){var f=$("input[type='radio'][name='radioSelectionMeasure']:checked").attr("id");"starSelection"===f?(f=[],f.visible=!0,e.update(f.visible),e.wg(),e.ai.show(),e.ig.hide()):"pairSelection"===f&&(e.ai.hide(),e.ig.show(),e.tg())});$("#objectMeasurementSelection").button().css({width:"70%",height:"20px","font-size":"0.7em"}).click(function(){var f=
[];f.visible=!0;e.update(f.visible)});$("#MeasurementTypeSelection").buttonset().css({"font-size":"0.7em","margin-right":"0px",height:"100%",border:"0px"});$("#measureTitle").css({color:"white"});$("#closeMeasurementButton").button({text:!1,label:"Quit",icons:{primary:"ui-icon-close"}}).click(function(){e.hide()});$("#closeMeasurementButton").css({width:"15px",position:"absolute",right:"0px","margin-right":"10px"})}
function Zi(e){document.addEventListener("keypress",function(e,g){return function(){return e.apply(g,arguments)}}(function(e){109===e.which&&this.toggle()},e),!1)}z.hide=function(){Li.prototype.hide.call(this);this.wg()};z.update=function(e){var f=this;e.visible?($("#objectMeasurementSelection").text(this.Zg),f.parent.ba.aa.scene3D.fe.hj(function(e){null!=e&&(f.tg(e),$("#objectMeasurementSelection").text(e.Mc()));f.parent.ba.aa.scene3D.fe.Aj()})):!1===e.visible&&$("#objectMeasurementSelection").text(this.Zg)};
function $i(e){Li.call(this,e);this.lb=this.$d=this.Bc=null;this.Ih=Ie();this.Hj=" (visible)";this.Mi="All representations";this.ol="Click to select an object";aj(this);bj(this);var f=this;this.parent.ba.addListener("requestWidgetUpdate",function(){var e=cj(f),h=dj(),k=$("#objectSelection").html();f.lb=biovizAPI.Kc(k,h)[0];ej(f,h,e);fj(f)})}$i.prototype=Object.create(Li.prototype);$i.prototype.constructor=$i;
function dj(){var e=$("input[type='radio'][name='radioSelectionLevel']:checked").attr("id"),e=e.replace("radioSelection","");return parseInt(e)}function gj(e){0<e&&5>e&&(e="#radioSelection"+e,$(e)[0].checked=!0,$(e).button("refresh"))}$i.prototype.$g=function(e){e instanceof Wa&&($("#objectSelection").text(e.Mc()),gj(2),this.lb=void 0,hj(this))};
function hj(e){$("#reprcolorpicker").hide();var f=e.lb,g=dj(),h=$("#objectSelection").html(),k=biovizAPI.Kc(h,g)[0];if(null!=f)if(f==k)4>g&&g++;else{for(var m=!1,l=g;f.parent!=k.parent&&0<g;)if(g--,f=f.parent,k=k.parent,null==f||null==f.parent){m=!0;break}m&&(g=l)}gj(g);k=biovizAPI.Kc(h,g)[0];e.lb=k;ij(e);ej(e,g)}
function ej(e,f,g){var h;1===f||2===f?h="molecule":3===f?h="residue":4===f&&(h="atom");if(void 0!=e.lb){var k=$("#objectSelection").html();e.lb=biovizAPI.Kc(k,f)[0];f=[];h=h.toLowerCase();h="structure"===h||"molecule"===h?th.map[ag]:"residue"===h?th.map[bg]:"atom"===h?th.map[eg]:void 0;for(k=0;k<h.length;k++)f.push(h[k].name);e.Bc.html("<option selected>"+e.Mi+"</option>");for(var m in f)biovizAPI.tf([e.lb],f[m])?(k=f[m]+e.Hj,g===f[m]?Ni(e.Bc,k,!0):Ni(e.Bc,k,!1)):g===f[m]?Ni(e.Bc,f[m],!0):Ni(e.Bc,
f[m],!1)}}function cj(e){return null!=e.Bc.val()&&e.Bc.val()!==e.Mi?e.Bc.val().replace(e.Hj,""):null}
function fj(e){var f=dj(),g=$("#objectSelection").html(),f=biovizAPI.Kc(g,f)[0];e=cj(e);null==f||null==e?$("#showhideRep").button({icons:{primary:" ui-icon-plus"},label:"Hide the representation"}):biovizAPI.tf([f],e)?$("#showhideRep").button({icons:{primary:" ui-icon-minus"},label:"Hide the representation"}):$("#showhideRep").button({icons:{primary:" ui-icon-plus"},label:"Show the representation"})}
function ij(e){var f=dj();1===f?$.farbtastic($("#colPicker")).setColor("#D3D3D3"):2===f?$.farbtastic($("#colPicker")).setColor("#"+$e(e.Ih,e.lb.sa.id,"M").getHexString()):3===f?$.farbtastic($("#colPicker")).setColor("#"+$e(e.Ih,e.lb.wb.Lc(),"R").getHexString()):4===f&&(f=e.lb.Xd,f=f.symbol.charAt(0).toUpperCase()+f.symbol.slice(1).toLowerCase(),$.farbtastic($("#colPicker")).setColor("#"+$e(e.Ih,f,"A").getHexString()))}
function aj(e){e.content=$('<div id="reprManagement"></div>');var f;f='<span id="managementTitle" class="mapSelection">Representation management</span><button id="closeManagementButton" class="mapSelection">Close</button>';var g;g=$("<div></div>");e.content.appendTo(e.parent.me);f=$(f);f.appendTo(g);f=$("<div></div>");var h='<button id="objectSelection"> '+e.ol+" </button> ",k;k='<div id="selectionLevel"><input type="radio" id="radioSelection1" name="radioSelectionLevel"><label for="radioSelection1" title="Structure">S</label><input type="radio" id="radioSelection2" name="radioSelectionLevel" checked="checked"><label for="radioSelection2" title="Molecule">M</label>';
k+='<input type="radio" id="radioSelection3" name="radioSelectionLevel">';k+='<label for="radioSelection3" title="Residue">R</label>';k+='<input type="radio" id="radioSelection4" name="radioSelectionLevel">';k+='<label for="radioSelection4" title="Atom">A</label>';k+="</div>";var m=$('<div id="selection"></div>');$(h).appendTo($(m));$(k).appendTo($(m));$(m).appendTo(f);h=$('<div id="selectDiv"></div>');$('<button id="showhideRep" class="mapSelection">Close</button>').appendTo(h);e.Bc=$('<select name="repType" id="repType" onfocus="this.selectedIndex = -1;"><option selected disabled>Representation</option></select>');
e.$d=$('<select name="col" id="col" onfocus="this.selectedIndex = 0;"><option selected disabled value="Coloration">Coloration</option></select>');e.Bc.appendTo(h);e.$d.appendTo(h);h.appendTo(f);f.appendTo(g);g.appendTo(e.content);$('<div id="reprcolorpicker"><div id="colPicker"></div><button id="reprClosePicker" class="mapSelection">Close</button></div>').appendTo(e.content);$("#colPicker").farbtastic().mousemove(function(){biovizAPI.mf($.farbtastic($("#colPicker")).color,[l.lb],cj(l))});$("#reprcolorpicker").toggle();
$("#reprcolorpicker").hide();$("#reprClosePicker").button({text:!1,label:"Quit",icons:{primary:"ui-icon-check"}}).click(function(){$("#reprcolorpicker").hide()});$("#reprcolorpicker").css({"align-self":"flex-end","float":"right"});$("#showhideRep").button({text:!1,label:"Show the representation",icons:{primary:"ui-icon-plus"}});$("#showhideRep").css({width:"5%",top:"3px"});e.toggle();var l=e;$("#managementTitle").css({color:"white"});$("#closeManagementButton").button({text:!1,label:"Quit",icons:{primary:"ui-icon-close"}}).click(function(){l.hide()});
$("#closeManagementButton").css({width:"15px",position:"absolute",right:"0px","margin-right":"10px"});$("#objectSelection").button().css({width:"63%",height:"20px"});$("#selectionLevel").buttonset().css({"margin-right":"0px",height:"100%",border:"0px"});$("#selection").css({"font-size":"0.7em",display:"flex","align-items":"stretch",width:"100%","margin-bottom":"2px"});$("#selectDiv").css({height:"20px",display:"flex","align-items":"stretch",width:"100%"});$("#repType").css({width:"60%"});e.Bc.change(function(){var e=
cj(l);null===e||biovizAPI.tf([l.lb],e)||biovizAPI.sg([l.lb],e);fj(l);var f=dj();ej(l,f,e);$('#col option[value="Coloration"]').prop("selected",!0);biovizAPI.gb({type:"requestWidgetUpdate"})});e.$d.change(function(){"Uniform color"===l.$d.val()?(void 0!=l.lb&&biovizAPI.mf($.farbtastic($("#colPicker")).color,[l.lb],cj(l)),$("#reprcolorpicker").show()):($("#reprcolorpicker").hide(),biovizAPI.mf(l.$d.val(),[l.lb],cj(l)))});$("#selectionLevel").change(function(){$("#reprcolorpicker").hide();var e=cj(l),
f=dj(),g=$("#objectSelection").html();l.lb=biovizAPI.Kc(g,f)[0];ij(l);ej(l,f,e);null!=l.lb&&fj(l);$('#col option[value="Coloration"]').prop("selected",!0)});$("#showhideRep").click(function(){var e=cj(l);if(null!=e){biovizAPI.tf([l.lb],e)?biovizAPI.kj([l.lb],e):biovizAPI.sg([l.lb],e);fj(l);var f=dj();ej(l,f,e);biovizAPI.gb({type:"requestWidgetUpdate"})}});g=R.Gk();for(var q in g)Ni(e.$d,g[q],!1);Ni(e.$d,"Uniform color",!1)}
function bj(e){document.addEventListener("keypress",function(e,g){return function(){return e.apply(g,arguments)}}(function(e){114===e.which&&this.toggle()},e),!1)}$i.prototype.update=function(e){if(e.visible){var f=this;f.parent.ba.aa.scene3D.fe.hj(function(e){null!=e&&($("#objectSelection").text(e.Mc()),hj(f),$('#col option[value="Coloration"]').prop("selected",!0))})}};
function jj(e){this.ba=e;this.div=this.ba.canvas;this.time=0;this.u=this.Ef=this.md=null;new EventTarget(jj.prototype);this._listeners=[];this.Ud()}
jj.prototype.Ud=function(){var e=this,f;f='<div id="scriptPlayerDiv"><table style="width:100%"><tr><td><button id="play">Play</button></td>';f+='<td><button id="stop">Stop</button></td>';f+='<td id="progressbar" style="width:90%"></td>';f+="</tr>";f+="</table>";f+="</div>";$(f).css({position:"relative",top:"-50px",width:"95%","margin-left":"auto","margin-right":"auto"}).appendTo(this.div);this.gd=$("#scriptPlayerDiv");this.md=$("#progressbar");this.Ef=$("#play");this.u=$("#stop");setTimeout(function(){e.gd.fadeTo(1E3,
0)},1E3);this.gd.on("mouseenter",function(){e.gd.stop().fadeTo(500,1)});this.gd.on("mouseleave",function(){e.gd.stop().fadeTo(500,0)});this.md.progressbar({value:!1});this.md.bind("click",function(f){f=(f.clientX-f.currentTarget.offsetLeft-f.currentTarget.offsetParent.offsetParent.offsetLeft)/f.currentTarget.clientWidth;e.md.progressbar("option","value",100*f);e.gb({type:"update",value:f})});this.md.bind("mousemove",function(f){1===f.buttons&&(f=(f.clientX-f.currentTarget.offsetLeft-f.currentTarget.offsetParent.offsetParent.offsetLeft)/
f.currentTarget.clientWidth,e.md.progressbar("option","value",100*f),e.gb({type:"update",value:f}))});this.Ef.button({text:!1,label:"play",icons:{primary:"ui-icon-play"}}).click(function(){var f;"play"===$(this).text()?(f={label:"pause",icons:{primary:"ui-icon-pause"}},e.gb("play")):(f={label:"play",icons:{primary:"ui-icon-play"}},e.gb("pause"));$(this).button("option",f)});this.u.button({text:!1,icons:{primary:"ui-icon-stop"}}).click(function(){e.Ef.button("option",{label:"play",icons:{primary:"ui-icon-play"}});
e.gb("stop")});this.md.find(".ui-progressbar-value")};jj.prototype.toggle=function(){this.gd.toggle()};jj.prototype.show=function(){this.gd.stop().fadeTo(0,1)};jj.prototype.hide=function(){this.gd.stop().fadeTo(0,0)};
function kj(e){this.ba=e;this.canvas=this.ba.canvas;this.af=[];this.me=$('<div id="widgets"></div>').css({position:"absolute",top:"10px",right:"0px","margin-left":"5px","margin-right":"5px","text-align":"center","flex-direction":"column","align-items":"stretch",opacity:"0.9",width:"300px"});this.me.appendTo(this.canvas);for(var f in lj)this.af[f]=new lj[f](this);Mi(this)}kj.prototype.update=function(e){for(var f in lj)this.af[f].update(e)};function Mi(e){for(var f in lj)e.af[f].hide()}
function ye(e,f){void 0!=e.af[f]&&e.af[f].show(!0)}kj.prototype.show=function(){this.me.show()};kj.prototype.hide=function(){this.me.hide()};var lj={pm:Si,sm:$i,mm:Pi,qm:Xi};function mj(){this.canvas=null;this.gi="//pdb.bionext.com/pdbx/${id}";this.load=this.ee=!0;this.Fj=!1;new EventTarget(mj.prototype);this.Sh=this.aa=null;this.canvas=$('<div id="content"></div>').css({tabindex:"0","z-index":"0",width:"100%",height:"100%",overflow:"hidden"})}
mj.prototype.Zh=function(e,f){"urlTemplate"===e?this.gi=f:"loadPDBX"===e?this.ee=f:console.warn("Can't change unexisting option : "+e)};
function pf(e,f,g){e=e.Vf();var h=$("#loadBar"),k=$("#loadLabel"),m;void 0==f?h.remove():(g?m='<img src="img/loader.gif" id="imgLoader" alt="loader">':(h.remove(),h=$("#loadBar"),setTimeout(function(){$("#loadBar").remove()},6E3)),0==h.length&&(g=$(m).css({display:"inline-block"}),k=$('<div id="loadLabel"> </div>').css({display:"inline-block",color:"white","font-size":"100%"}),h=$('<div id="loadBar" class="noselect"> </div>').css({position:"absolute",top:"2%",right:"0px"}),k.appendTo(h),g.appendTo(h),
h.appendTo(e)),k.text(f))}mj.prototype.Xg=function(e){this.gb({type:"atomMouseOver",data:e})};function Ge(e,f){var g=e.Sh;g.u=g.v.parse(f).slice(0);g.u[0]instanceof di||g.u.splice(0,0,new di);g.u.add=g.u.push;g.u.remove=g.u.shift;g.gb({type:"commandParsed",data:g.u})}mj.prototype.Vf=function(){return this.canvas};function kd(e){e.contextMenu.div.contextmenu("close")}
mj.prototype.Ud=function(){if(!THREE.Detector.webgl)return THREE.Detector.addGetWebGLMessage({parent:this.canvas[0]}),!1;this.aa=new mf(this);this.Sh=new Mh(this.aa);this.contextMenu=new ne(this,$(document.body));this.hk=$(".hasContextMenu:first");this.eh=this.contextMenu.div;this.aj=this.Tf=null;this.Mb=this.aa.scene3D.Mb;this.Bf=new kj(this);$('<div id="bionextlogo" class="noselect"><img src="img/logo.png" alt="Bionext Logo" width="100%" /></div>').css({position:"absolute",top:"10px",width:"30%",
"margin-left":"10px","margin-right":"auto"}).appendTo(this.canvas);setTimeout(function(){$("#bionextlogo").fadeTo(2E3,.6)},4E3);nj(this);return!0};
function nj(e){e.jd=new jj(e);e.Mb.addListener("timeChanged",function(f){e.jd.md.progressbar("option","value",100*f.data.progress)});e.Mb.addListener("endScript",function(){e.jd.Ef.button("option",{label:"play",icons:{primary:"ui-icon-play"}})});e.jd.addListener("play",function(){e.Mb.play()});e.jd.addListener("pause",function(){e.Mb.pause()});e.jd.addListener("stop",function(){e.Mb.stop()});e.jd.addListener("update",function(f){Qh(e.Mb,f)});e.Sh.addListener("commandParsed",function(f){var g=e.Mb;
f=f.data;g.ca=0;g.ja=f.slice(0);Rh(g);f=g.ja.length;for(var h=0;h<f;h++){var k=g.ja[h];k instanceof Ph&&(g.ca+=k.duration)}})}function Wf(e){e?$("#scriptPlayerDiv").css({top:"-50px"}):$("#scriptPlayerDiv").css({top:"50px"})}
var oj=N.gc.name,pj=N.Df.name,qj={NONE:N.NONE.name,SPHERES:N.cf.name,BALLS:N.ki.name,LINES:N.LINES.name,BALL_AND_STICKS:N.bf.name,STICKS:oj,ATOMS:N.ne.name,MOLECULAR_SURFACE_WIREFRAME:N.si.name,MOLECULAR_SURFACE:N.Eg.name,ACCESSIBLE_SURFACE_WIREFRAME:N.ii.name,ACCESSIBLE_SURFACE:N.Bg.name,CARTOON:pj,CYLINDER:N.ni.name,ALPHA_SHAPE:N.Cg.name,ALPHA_SHAPE_WIREFRAME:N.ji.name},rj={Structure:M.u.Gg,Molecule:M.u.nc,Residue:M.u.fc,Atom:M.u.nb,Vdw:M.u.Uc},sj=R.nb.name,tj={Molecule:R.nc.name,Residue:R.fc.name,
Atom:sj,CarbonAtom:R.oi.name,HeteroAtom:R.pi.name,SST:R.vi.name,Rainbow:R.ti.name,Hydrophobicity:R.ri.name},uj={PROTEIN:"Protein",PEPTIDE:"Peptide",SMALL_PEPTIDE:"Small Peptide",RNA:"RNA",DNA:"DNA",LIGAND:"Ligand",ION:"Ion",SOLVENT:"Solvent",UNKNOWN:"Unknown"};function X(){}z=X.prototype;z.jk=function(){this.u=new mj};z.Xk=function(){this.v=this.u.Ud();this.aa=this.u.aa};z.$k=function(){return this.v};z.Jl=function(e){this.u.contextMenu.moveTo(e);this.u.Tf=e;this.u.aj=e.find("#biovizFrame")};
z.Vf=function(){return this.u.Vf()};z.Pj=function(e){this.ca=e};z.gb=function(e){this.u.gb(e)};z.Yc=function(e){a:{for(var f=this.aa.scene3D,g=0;g<f.na.length;g++)if(f.na[g].cd().toUpperCase()===e.toUpperCase()){e=f.na[g];break a}e=void 0}return e};z.df=function(e,f){var g=this.Yc(e);if(void 0!==g)if(f.includes("Proteinic"))for(var h=["Protein","Peptide","Small Peptide"],k=0,m=h.length;k<m;k++){var l=Ch(g,f.replace("Proteinic",h[k]));if(null!=l)return l}else return Ch(g,f)};
z.ef=function(e,f,g){e=this.df(e,f);if(void 0!==e)return e.dc(g,!0)};z.Ei=function(e,f,g,h){e=this.ef(e,f,g);if(void 0!==e)return e.xd(h,!0)};z.Xc=function(e){var f,g;for(g in N){var h=N[g];if(h.name===e){f=h;break}}if(!f)throw"Can't find RepresentationType corresponding to representationTypeID : "+e;return f};z.xi=function(e){if(1<e.length)throw Error("Selection must contain a single object");e=e[0];if(e instanceof ag)return e;throw Error("Selection must contain a only a molecule");};
z.yi=function(e){if(1<e.length)throw Error("Selection must contain a single object");e=e[0];if(e instanceof rh)return e;throw Error("Selection must contain a only a molecule");};z.Ig=function(e,f){var g=this,h=qf(this.aa,e);pf(g.u,"Creating scene");zh(this.aa.scene3D,h);this.aa.scene3D.aa.Ma=h;return new Promise(function(e){uf(g.aa);ze(g.aa,h,!0);pf(g.u);g.ca?rf(g.aa,h).then(function(){ze(g.aa,h,!0);g.u.gb({type:"structureReady",data:f});e()}):(g.u.gb({type:"structureReady",data:f}),e())})};
z.dc=function(e,f,g){return this.ef(e,f,g)};z.xl=function(e){e=e[0];for(var f=e.Jd.values(),g=0,h=f.length;g<h;g++)e.remove(f[g]);e.Jd.clear()};z.Ek=function(e){if(e instanceof M)return uj.u;if(e instanceof ag)return e.sa.type;if(e instanceof bg)return e.wb.Fa.type;if(e instanceof eg)return e.Xd.ib().Fa.type};
z.Kc=function(e,f){var g=null,h=e.split(":"),k,m,l;5<h.length&&(l=h[5]+":"+h[6],null==f&&(f=4));3<h.length&&(isNaN(h[3])?(m=h[3]+":"+h[4],null==f&&(f=3)):(m=h[3],null!=h[4]?(l=h[4],null==f&&(f=4)):null==f&&(f=3)));1<h.length&&(k=h[1]+":"+h[2],null==f&&(f=2));h=h[0];null==f&&(f=1);switch(f){case 1:g=this.Yc(h);break;case 2:g=this.df(h,k);break;case 3:g=this.ef(h,k,m);break;case 4:g=this.Ei(h,k,m,l)}return null!=g?[g]:[]};z.Mj=function(e,f){this.xi(e).sa.Oj(f)};z.Qe=function(){this.aa.scene3D.Qe()};
z.zl=function(){this.aa.scene3D.ng()};z.Oh=function(){this.aa.scene3D.Oh()};z.Bl=function(){this.aa.scene3D.reset()};z.yb=function(e,f,g,h,k){var m=this.yi(e);null!=g?(g=this.Xc(g),g=[Sg(m,g)]):g=m.Wb();e=null;if(null!=h){e=[];for(var m=m.sa,l=m.ga,q=null,q=null,r=h[0]-1;r<h[1];r++)if(k?(q=Ld(m.sk,r),q=l[q]):(q=r,q=m.ib(q)),null!=q)for(var q=q.Aa(),t=0;t<=q.length;t++)e.push(q[t])}for(t=0;t<g.length;t++)g[t].yb(f,e)};z.rk=function(e){Ge(this.u,e)};z.bm=function(){this.u.Mb.play()};z.cm=function(){this.u.Mb.stop()};
z.sl=function(){this.u.Mb.pause()};z.Tk=function(){this.u.jd.gd.css("visibility","hidden")};z.Vk=function(){this.u.Bf.hide()};z.addListener=function(e,f){this.u.addListener(e,f)};z.pj=function(){return this.u.pj()};z.Zh=function(e,f){this.u.Zh(e,f)};z.tf=function(e,f){if(1===e.length&&e[0]instanceof rh)var g=e[0],h=this.Xc(f);else throw Error("Selection must contain a single object");return g.eg(h)};
z.Zj=function(e,f,g){null==g&&(g=0);if(1===e.length)0<g?Ce(this.aa.scene3D,e[0],g,f):ze(this.aa,e[0],f);else throw Error("Selection must contain a single object");};z.Sj=function(e){if(1===e.length)this.aa.scene3D.aa.Ma=e[0];else throw Error("Selection must contain a single object");};
z.Mk=function(e){var f;if(1!==e.length)throw Error("Selection must contain a single object");if(e[0]instanceof ag){f=e[0].sa;e=e[0].jb();f=f.ga;for(var g=0;g<f.length;g++)if(void 0==e.Rc.get(f[g]))return!1;return!0}return e[0]instanceof bg?(f=e[0].wb,e=e[0].pb().jb(),void 0!=e.Rc.get(f)):!1};z.Nk=function(){return 0!==this.aa.scene3D.na.length};z.ag=function(){for(var e=[],f=this.aa,g=f.scene3D.na.length,h=0;h<g;h++){var k=f.scene3D.na[h];k instanceof M&&e.push(k.cd())}return e};
z.Fk=function(e){var f=[];e=this.Yc(e).za.keys();for(var g=0,h=e.length;g<h;g++){var k=e[g];f.push(k.type+":"+k.id)}return f};z.Ng=function(e){var f=[];e=this.Yc(e).za.keys();for(var g=0,h=e.length;g<h;g++)f.push(e[g]);return f};z.Hk=function(e){var f=[];e=this.Yc(e).za.keys();for(var g=0,h=e.length;g<h;g++){var k=e[g];"Protein"!==k.type&&"Peptide"!==k.type&&"Small Peptide"!==k.type||f.push(k.type+":"+k.id)}return f};
z.Ik=function(e,f){for(var g=this.df(e,f).sa.ga,h=[],k=0;k<g.length;k++)h.push(g[k].toString());return h};z.ed=function(e,f){var g=this;return this.aa.ed(e,f).then(function(e){return new Promise(function(k,m){e instanceof Error?m(e):g.Ig(e,f).then(function(e){k(e)})})})};z.fg=function(e,f){var g=this;return this.aa.fg(e,f).then(function(e){return new Promise(function(k,m){e instanceof Error?m(e):g.Ig(e,f).then(function(e){k(e)})})})};
z.$i=function(e){var f=this.Yc(e);if(null==f)throw Error("Structure with id: "+e+" not found");De(this.aa,f)};z.lk=function(){for(var e=this.ag(),f=0,g=e.length;f<g;f++)this.$i(e[f])};z.pg=function(e,f,g,h,k){this.aa.scene3D.pg(e,f,g,h,k)};z.sg=function(e,f){for(var g=this.Xc(f),h=0,k=e.length;h<k;h++)e[h].show(g)};z.kj=function(e,f){for(var g=this.Xc(f),h=0,k=e.length;h<k;h++)e[h].hide(g)};
z.show=function(e,f){for(var g=[],h=0,k=e.length;h<k;h++){var m=e[h];m.visible=!0;f&&m.traverseAncestors(function(e){(e instanceof M||e instanceof ag||e instanceof bg)&&g.push(e)})}0!=g.length&&this.show(g)};z.hide=function(e,f){for(var g=[],h=0,k=e.length;h<k;h++){var m=e[h];m.visible=!1;f&&m.traverse(function(e){(e instanceof ag||e instanceof bg||e instanceof eg)&&g.push(e)})}0!=g.length&&this.hide(g)};
z.cl=function(e){if(1===e.length)return e[0].visible;throw Error("Selection must contain a single object");};z.$b=function(e,f){var g,h;if(1!==e.length)throw Error("Selection must contain a single object");if(e[0]instanceof ag)g=e[0].sa,h=e[0].jb();else if(e[0]instanceof bg)g=e[0].wb,h=e[0].pb().jb();else throw Error("Selection item is not a Molecule or a Residue");h.$b(g,f)};
z.Sk=function(e){var f;if(1!==e.length)throw Error("Selection must contain a single object");if(e[0]instanceof ag)f=e[0].sa.ga,e=e[0].jb();else if(e[0]instanceof bg)f=e[0].wb,e=e[0].pb().jb();else throw Error("Selection item is not a Molecule or a Residue");Fe(e,f)};z.mf=function(e,f,g){f[0]instanceof M&&(f=sf(f[0]));var h=R.Xf(e);null==h&&(h=e);e=0;for(var k=f.length;e<k;e++)if(null!=f[e])for(var m=f[e].Wb(),l=0,q=m.length;l<q;l++){var r=m[l].hd;null!=g&&r!==g||m[l].color(h)}};
z.qg=function(e,f,g){if(1!==f.length)throw Error("Selection must contain a single object");f[0]instanceof M&&(f=sf(f[0]));for(var h=0,k=f.length;h<k;h++)if(null!=f[h])for(var m=f[h].Wb(),l=0,q=m.length;l<q;l++){var r=m[l].hd;null!=g&&r!==g||m[l].qg(e)}};z.$j=function(e,f){if(1!=e.length||!(e[0]instanceof ag))throw Error("Selection must contain a single object");var g=e[0];g.sa.Ll(f);var h=this.Xc(pj);Sg(g,h).update({$l:!0})};
z.Yj=function(e){var f=this.aa;e=this.Yc(e);f.u=new THREE.Matrix4;f.u.copy(e.matrix);var g;g="["+f.u.elements[0];for(var h=f.u.elements.length,k=1;k<h;k++)g+=","+f.u.elements[k];console.log(e+" : "+(g+"]"))};z.Hl=function(e){var f=this.aa;e=new THREE.Color(e);f.fa.Zd(e)};z.ug=function(e){this.aa.ug(e)};z.xf=function(){this.aa.xf()};z.ei=function(){this.aa.scene3D.ei()};
z.zf=function(){var e=yh(this.aa.scene3D),f=window.open("","","height="+window.innerHeight+",width="+window.innerWidth);e.then(function(e){e=(window.URL||window.webkitURL).createObjectURL(e);f.location=e})};window.BiovizAPI=X.prototype.constructor;X.prototype.RepresentationTypeID=qj;X.prototype.LabelTypeID=rj;X.prototype.ColorMappingID=tj;X.prototype.ObjectTypeID=uj;z=X.prototype;
z.ll=function(e,f,g,h){var k=this,m=new vj(e);new vj(f);for(var l=new wj(g,0,this.aa.scene3D),q=m.ka.keys().length,r=[],t=0;t<q;t++){var x=gd(m.ka)[t],x=this.aa.ed(x);r.push(x);x.then(function(m){m=qf(k.aa,m,g);l.Vg(m);m=new xj(l,h,g);for(var q=k.Zf(g,e),r=0,t=q.length;r<t;r++)tf(q[r]);r=R.Xf(sj);q=k.Zf(g,f);1===q.length&&q[0].show(N.gc).color(r);ze(k.aa,m,!0);k.aa.scene3D.aa.Ma=m;uf(k.aa)})["catch"](function(e){console.warn("Error on loadStructure : ",e)})}return Promise.all(r).then(function(){return"Query loaded"})};
z.nk=function(){this.se()["delete"]();uf(this.aa)};
z.jl=function(e,f,g,h,k){var m=this,l=new vj(e),q=this.se();if(null==yj(q,f)){var r=new zj(f,q),q=new THREE.Vector3(h[4],h[5],h[6]);h=new THREE.Quaternion(h[1],h[2],h[3],h[0]);h=(new THREE.Matrix4).compose(q,h,new THREE.Vector3(1,1,1));r.applyMatrix(h);r.updateMatrixWorld(!0);h=l.ka.keys().length;for(var q=[],t=0;t<h;t++){var x=gd(l.ka)[t],x=this.aa.ed(x);q.push(x);x.then(function(h){var q=qf(m.aa,h,f);r.Vg(q);null!=g&&new xj(r,g,f);for(var q=0,t=gd(l.ka),x=t.length,I=0;I<x;I++)if(t[I].toUpperCase()===
h.Og.toUpperCase()){q=h.Og;break}if(null!=k)for(h=0,t=k.length;h<t;h++)x=k[h],I=new Aj(r.tb,r,x.qTips),r.Qc[x.type]=I,r.add(I);h=m.Zf(f,e);t=0;for(x=h.length;t<x;t++)tf(h[t]);h=R.Xf(sj);q=l.ka.get(q).ka.keys();t=0;for(x=q.length;t<x;t++)I=m.Kc(f+":Ligand:"+q[t],2),m.sg(I,oj),m.mf(h,I,oj);uf(m.aa)})["catch"](function(e){console.warn("Error on loadStructure : ",e)})}return Promise.all(q).then(function(){return"Hit loaded"})}};z.mk=function(e){e=this.pd(e);null!=e&&(e["delete"](),uf(this.aa))};
z.Zf=function(e,f){for(var g=new Set,h=new vj(f),k=gd(h.ka),m=k.length,l=0;l<m;l++)for(var q=h.ka.get(k[l]),r=q.ka.keys(),t=r.length,x=0;x<t;x++)for(var w=r[x],B=q.ka.get(w),D=B.length,E=0;E<D;E++){var I=B[E],H;a:{switch(I.type){case Bj:H=["Protein","Small Peptide","Peptide","DNA","RNA"];break a;case Cj:H=["Solvent"];break a;case Dj:H=["Ligand"];break a}H=void 0}for(var K=null,G=0,L=H.length;G<L;G++)K=H[G],K=I.type==Dj?this.ef(e,K+":"+w,I.Vh+":"+I.Uh):this.df(e,K+":"+w),null!=K&&g.add(K)}return Array.from(g)};
z.dl=function(e,f){var g=this.te(e),h=this.Xc(f);return g.eg(h)};z.Ul=function(e,f){var g=this.te(e),h=this.Xc(f);g.show(h)};z.Uk=function(e,f){var g=this.te(e),h=this.Xc(f);g.hide(h)};z.Ql=function(e){e=yj(this.se(),e);null!=e&&e.show()};z.Rk=function(e){e=yj(this.se(),e);null!=e&&e.hide()};z.Rl=function(e){e=sf(e[0]);for(var f in e){var g=e[f];g.visible="Ligand"!==g.qa.type?!1:!0}};
z.Sl=function(e){if(1!==e.length)throw Error("Selection must contain a single Structure3D");e[0].visible=!0;e=sf(e[0]);for(var f in e)e[f].visible=!0};z.dk=function(e,f,g,h){e=sf(this.Yc(e));for(var k in e){var m=e[k],l=m.qa.type;if("Protein"===l||"Peptide"===l||"Small Peptide"===l){var m=m.Wb(),q;for(q in m)m[q].color([f,g,h])}}};z.fk=function(e,f,g){var h=this.te(f);f=R.Xf(e);null==f&&(f=e);e=h.Wb();for(var k in e)h=e[k].hd,null!=g&&h!==g||e[k].color(f)};
z.ek=function(e,f,g,h,k){h=this.te(h).Wb();for(var m in h){var l=h[m].hd;null!=k&&l!==k||h[m].color([e,f,g])}};z.Nl=function(e,f){var g=this.pd(e).Qc[f];g&&g.show()};z.Ok=function(e,f){var g=this.pd(e).Qc[f];g&&g.hide()};z.Pl=function(e,f){var g=this.pd(e).Qc[f];g&&(g.De.visible=!1,g.Ue.visible=!0)};z.Qk=function(e,f){var g=this.pd(e).Qc[f];g&&(g.Ue.visible=!1)};z.Ol=function(e,f){var g=this.pd(e).Qc[f];g&&(g.Ue.visible=!1,g.De.visible=!0)};
z.Pk=function(e,f){var g=this.pd(e).Qc[f];g&&(g.De.visible=!1)};z.te=function(e){var f=this.aa.scene3D,g;for(g in f.na){var h=f.na[g];if(h instanceof xj&&h.name===e)return f.na[g]}return null};z.se=function(){return this.aa.scene3D.tb};z.pd=function(e){return yj(this.se(),e)};function Ej(e){this.ia=e;this.ka=new Ca}Ej.prototype.Bb=function(){return structure+"@"+chain};function Fj(e,f,g){this.type=e;this.Vh=f;this.Uh=g}
Fj.prototype.toString=function(){var e="";switch(this.type){case Bj:e+="T";break;case Cj:e+="S";break;case Dj:e+="L"}null!=this.Vh&&null!=this.Uh&&(e+="."+this.Vh+"."+this.Uh);return e};var Bj="TARGET",Cj="SOLVENT",Dj="LIGAND";function Gj(e){switch(e){case "Protein":case "Small Peptide":case "Peptide":case "DNA":case "RNA":return Bj;case "Solvent":return Cj;case "Ligand":return Dj;default:return null}}
function Hj(e){switch(e.toUpperCase()){case "T":case "TAR":case "TARGET":return Bj;case "L":case "LIG":case "LIGAND":return Dj;case "S":case "SOL":case "SOLVENT":return Cj;default:return Bj}}
function vj(e){this.ka=new Ca;if(null!=e){e=e.split("+");for(var f=0;f<e.length;f++){var g=e[f].split("/"),h=g[0].toUpperCase(),k=new Ej(h);this.ka.set(h,k);for(var h=g.slice(1),m=0;m<h.length;m++){var g=h[m].split(":"),l=g[0].toUpperCase();k.ka.set(l,[]);for(var g=g[1].split(","),q=0;q<g.length;q++){var r="",t=null,x=null,w=g[q].split("."),r=w[0].toUpperCase();3===w.length&&(t=w[1].toUpperCase(),x=parseFloat(w[2]));r=new Fj(Hj(r),t,x);k.ka.get(l).push(r)}}}}}
vj.prototype.toString=function(){for(var e="",f=gd(this.ka),g=0,h=f.length;g<h;g++){0<g&&(e+="+");for(var k=f[g],e=e+(k+"/"),k=this.ka.get(k),m=k.ka.keys(),l=0,q=m.length;l<q;l++){0<l&&(e+="/");for(var r=m[l],t=k.ka.get(r),e=e+(r+":"),r=0,x=t.length;r<x;r++)e+=t[r].toString()}}return e};function Ij(e){$f.call(this,e);this.tb=e.tb;this.gm=e.ph}Ij.prototype=Object.create($f.prototype);Ij.prototype.constructor=Ij;N.li=new fg("BVS Matching","BVSMatching",Ij);
Ij.prototype.Oa=function(){var e=new THREE.CylinderGeometry(.1,.1,1),f=(new THREE.BufferGeometry).fromGeometry(e),g=this.ma.length/2,h=f.attributes.position.array.length/f.attributes.position.itemSize,k=g*h,e=new THREE.BufferGeometry,m=new Float32Array(3*k),l=new Float32Array(3*k),q=new Float32Array(3*k),r=new Float32Array(2*k),k=new Float32Array(k),t=new THREE.Matrix4;t.makeRotationX(.5*Math.PI);for(var x=0;x<g;x++){var w=this.ma[2*x+1],B=this.xa.Ej[x],D=this.ma[2*x].pos.clone(),E=w.pos.clone(),
w=(new THREE.Matrix4).getInverse(this.gm.matrix);D.applyMatrix4(w);var I=(new THREE.Vector3).addVectors(D,E).multiplyScalar(.5),w=(new THREE.Vector3).subVectors(D,E),H=new THREE.Vector3(1,w.length(),1),K=new THREE.Matrix4;K.lookAt(E,D,new THREE.Vector3(0,1,0));K.multiply(t);K.setPosition(I);K.scale(H);I=f.clone();I.applyMatrix(K);D=I.attributes.position.array;E=I.attributes.normal.array;K=I.attributes.color.array;I=I.attributes.uv.array;B=Ij.ql(w.length(),B);w=D.length/3;for(H=0;H<w;H++){for(var G=
0;3>G;G++)m[x*D.length+3*H+G]=D[3*H+G],l[x*E.length+3*H+G]=E[3*H+G],q[x*K.length+3*H+G]=B[G];for(G=0;2>G;G++)r[x*I.length+2*H+G]=I[2*H+G];k[x*h+H]=x}}e.addAttribute("position",new THREE.BufferAttribute(m,3));e.addAttribute("normal",new THREE.BufferAttribute(l,3));K=new THREE.BufferAttribute(q,3);K.dynamic=!0;e.addAttribute("color",K);e.addAttribute("uv",new THREE.BufferAttribute(r,2));e.addAttribute("atomIndex",new THREE.BufferAttribute(k,1));e.dd();f=ef(this.fa);e=new THREE.Mesh(e,f);e.Ia=this;this.parent.add(e);
this.da=e};Ij.prototype.update=function(){};Ij.hg=[new THREE.Color(.7,.7,.7),new THREE.Color(0,1,0)];Ij.Pe=[new THREE.Color(1,0,0),new THREE.Color(.9,.5,.1)];Ij.gg=[.5,1];Ij.Oe=[.25,.75];Ij.ql=function(e,f){var g=null,g=5<e||.5>f||.7>f&&4<e?Ij.Ed(Ij.Pe,Ij.Oe,f):Ij.Ed(Ij.hg,Ij.gg,f);return g.toArray()};
Ij.Ed=function(e,f,g){var h=f[0],k=f[1];f=null;if(g>=h&&g<=k){var m=e.length-1;f=(k-h)/m;k=Math.ceil((g-h)/(k-h)*m)-1;m=h+k*f;g=(g-m)/(h+(k+1)*f-m);h=e[k].clone();e=e[k+1].clone();h.lerp(e,g);f=h}else f=g<h?e[0]:e[e.length-1];return f};function Jj(e){$g.call(this,e);this.ce=e.ce;e=this.ma.length;for(var f=[],g=[],h=0;h<e;h++){var k=this.ma[h].ib();if(!(0<=f.indexOf(k))){var m=k.Aa(),g=g.concat(m);f.push(k)}}this.ma=g}Jj.prototype=Object.create($g.prototype);Jj.prototype.constructor=Jj;
N.Lj=new fg("BVS Residues","BVSResidues",Jj);function Kj(e){$f.call(this,e);this.ce=e.ce}Kj.prototype=Object.create($f.prototype);Kj.prototype.constructor=Kj;N.mi=new fg("BVS Surface","BVSSurface",Kj);
Kj.prototype.Oa=function(){for(var e=new be(!0),f=[],g=this.ce.we.values(),h=g.length,k=0;k<h;k++)f.push(g[k]);for(g=0;g<f.length;g++)h=f[g].nd,ce(e,h.pos.x,h.pos.y,h.pos.z,new THREE.Color("#AAAA00")),e.Wc.push(this.xa.ma.indexOf(h));for(g=0;g<f.length;g++)if(h=f[g],k=h.bd())for(var m=0;m<k.length;m++)for(var l=Gd(k[m],h),q=l.bd(),r=0;r<q.length;r++){var t=Gd(q[r],l);t!==h&&t.jj(h)&&de(e,h._id,l._id,t._id)}e=ee(e);f=ef(this.fa);f.shading=THREE.FlatShading;f.vertexColors=THREE.FaceColors;f.side=THREE.DoubleSide;
e=new THREE.Mesh(e,f);e.qa=this.Ea;e.Ia=this;this.parent.add(e);this.da=e};Kj.prototype.update=function(){};function Lj(e){$g.call(this,e);this.Qb=e.ce}Lj.prototype=Object.create($g.prototype);Lj.prototype.constructor=Lj;N.Kj=new fg("BVS Mesh","BVSMesh",Lj);Lj.prototype.Oa=function(){$g.prototype.Oa.call(this);this.color(R.oh("residue"))};function zj(e,f){rh.call(this);this.Zb=Ie();this._id=e;this.mc=[];this.Ld=null;var g=this.tb=f;g.Ad.push(this);g.add(this);this.Qc={}}zj.prototype=Object.create(rh.prototype);
z=zj.prototype;z.constructor=zj;
z["delete"]=function(){rh.prototype["delete"].call(this);var e=this;this.traverse(function(f){f===e.tb.scene3D.aa.Ma&&(e.tb.scene3D.aa.Ma=null);f===e.tb.scene3D.aa.bb&&(e.tb.scene3D.aa.bb=e.tb.scene3D)});for(var f=this.tb.parent.na,g=0,h=this.mc.length;g<h;g++)f.splice(f.indexOf(this.mc[g]),1),this.mc[g]["delete"]();for(var k in this.Qc)this.remove(this.Qc[k]),this.Qc[k]["delete"]();null!=this.Ld&&(f.splice(f.indexOf(this.Ld),1),this.Ld["delete"]());this.tb.Ad.splice(this.tb.Ad.indexOf(this),1);this.parent.remove(this)};
z.Vg=function(e){this.mc.push(e);this.tb.scene3D.na.push(e);this.add(e);var f=this;e.ub=function(){var e=null,h;for(h in this.za.keys()){var k=this.za.get(this.za.keys()[h]),m=k.ub().clone();m.applyMatrix4(k.matrix);e=null===e?m:e.merge(m)}e.applyMatrix4(f.matrix);return e};e.updateMatrixWorld(!0)};z.Ki=function(e){this.Ld=e;this.tb.scene3D.na.push(e);this.add(e)};z.show=function(){this.visible=!0};z.hide=function(){this.visible=!1};
function Aj(e,f,g){rh.call(this);this.tb=e;this.ph=f;this.kg=g;this.Zb=Ie();this.Ue=new THREE.Object3D;this.add(this.Ue);this.Ue.visible=!1;this.De=new THREE.Object3D;this.add(this.De);this.De.visible=!1;this.ma=Array(2*this.kg.length);this.Ej=Array(this.kg.length);e=this.tb.mc[0].ia.Yf().Aa();f=this.ph.mc[0].ia.Yf().Aa();g=0;for(var h=this.kg.length;g<h;g++){var k=this.kg[g],m=Mj(e,k.queryAtom),l=Mj(f,k.targetAtom),k=parseFloat(k.value);this.ma[2*g]=m;this.ma[2*g+1]=l;this.Ej[g]=k;var m=m.pos.clone(),
l=l.pos.clone(),q=(new THREE.Matrix4).getInverse(this.ph.matrix);m.applyMatrix4(q);q=(new THREE.Vector3).addVectors(m,l).multiplyScalar(.5);m=(new THREE.Vector3).subVectors(m,l).length();this.Ue.add(Nj(k.toFixed(2),q));this.De.add(Nj(m.toFixed(2),q))}e=Sg(this,N.li);null!==e&&void 0!==e&&e.show();this.visible=!1}Aj.prototype=Object.create(rh.prototype);Aj.prototype.constructor=Aj;th.add(Aj,[N.li]);Aj.prototype["delete"]=function(){rh.prototype["delete"].call(this)};
Aj.prototype.show=function(){this.visible=!0};Aj.prototype.hide=function(){this.visible=!1};function Mj(e,f){for(var g=null,h=0,k=e.length;h<k;h++){var m=e[h];m.name+"."+m.id===f.split(".",2).join(".")&&(g=m)}return g}function Nj(e,f){var g=bf(e,15);return ae(g,f)}function wj(e,f,g){rh.call(this);this.Zb=Ie();this._id=e;this.mc=[];this.Ld=null;this.Ad=[];this.scene3D=g;this.scene3D.tb=this;this.scene3D.add(this)}wj.prototype=Object.create(rh.prototype);wj.prototype.constructor=wj;
wj.prototype["delete"]=function(){rh.prototype["delete"].call(this);var e=this;this.traverse(function(f){f===e.scene3D.aa.Ma&&(console.log("hasAnchor"),e.scene3D.aa.Ma=null);f===e.scene3D.aa.bb&&(console.log("hasTarget"),e.scene3D.aa.bb=e.scene3D)});for(var f=this.parent.na,g=0,h=this.mc.length;g<h;g++)f.splice(f.indexOf(this.mc[g]),1),this.mc[g]["delete"]();this.Ld["delete"]();f.splice(f.indexOf(this.Ld),1);g=0;for(h=this.Ad.length;g<h;g++)this.Ad[0]["delete"]();this.Ad=null;this.scene3D.tb=null;
this.parent.remove(this)};wj.prototype.Vg=function(e){this.mc.push(e);this.scene3D.na.push(e);e.scene3D=this.scene3D;this.add(e);var f=this;e.ub=function(){var e=null,h;for(h in this.za.keys()){var k=this.za.get(this.za.keys()[h]),m=k.ub().clone();m.applyMatrix4(k.matrix);e=null===e?m:e.merge(m)}e.applyMatrix4(f.matrix);return e}};wj.prototype.Ki=function(e){this.Ld=e;this.scene3D.na.push(e);this.add(e)};
function yj(e,f){for(var g=0,h=e.Ad.length;g<h;g++){var k=e.Ad[g];if(k._id===f)return k}return null}
function xj(e,f,g){rh.call(this);this.Zb=Ie();this.Cj=e;this.Cj.Ki(this);this.name=g;this.yf=this.Cj.mc[0];this.qa=this.yf.ia.Yf();e=new yb;g=this.qa.Aa();for(var h=f.isolated,k=0;k<h.length;k++){for(var m=h[k].value,l=null,q=0;q<g.length&&(null==x||null==w);q++){var r=g[q],t=r.name+"."+r.id;t===m.split(".",2).join(".")&&(l=r)}null==e.findNode(l)&&e.Mf(l)}f=f.edges;for(k=0;k<f.length;k++){for(var h=f[k].v1,m=f[k].v2,x=null,w=null,q=0;q<g.length&&(null==x||null==w);q++)r=g[q],t=r.name+"."+r.id,t===
h.split(".",2).join(".")&&(x=r),t===m.split(".",2).join(".")&&(w=r);q=e.findNode(x);null==q&&(q=e.Mf(x));x=e.findNode(w);null==x&&(x=e.Mf(w));w=!1;if(r=e.od.get(q))for(t=0,h=r.length;t<h;t++)if(Gd(r[t],q)===x){w=!0;break}w||e.Rg(q,x)}this.ce=e;this.ma=this.ce.values();this.updateMatrixWorld(!0);Sg(this,N.mi).show()}xj.prototype=Object.create(rh.prototype);xj.prototype.constructor=xj;th.add(xj,[N.mi,N.Kj,N.Lj,N.ki]);z=xj.prototype;z["delete"]=function(){rh.prototype["delete"].call(this)};z.cd=function(){return this.name};
z.reset=function(){};z.he=function(){};z.ad=function(){return Hd(this.ub())};z.ub=function(){for(var e=new THREE.Vector3(Infinity,Infinity,Infinity),f=new THREE.Vector3(-Infinity,-Infinity,-Infinity),g=0,h=this.ma.length;g<h;g++){var k=this.ma[g].pos;e.x=Math.min(e.x,k.x);e.y=Math.min(e.y,k.y);e.z=Math.min(e.z,k.z);f.x=Math.max(f.x,k.x);f.y=Math.max(f.y,k.y);f.z=Math.max(f.z,k.z)}e=new kb(e,f);e.applyMatrix4(this.parent.matrix);return e};z=X.prototype;
z.pk=function(e,f,g){var h=new Ca,k=this.Kc(e)[0],m=[];e=0;for(var l=f.length;e<l;e++)m.push(this.Kc(f[e])[0]);var q=[],r=new THREE.Vector3(Infinity,Infinity,Infinity),t=new THREE.Vector3(-Infinity,-Infinity,-Infinity);e=0;for(l=m.length;e<l;e++)if(f=m[e],f!==k){var x=f.ma;f=0;for(var w=x.length;f<w;f++){var B=x[f];r.min(B.pos);t.max(B.pos);q.push(new gc(B))}}m=new Sb(r,t);m.add(q);m.optimize();k=k.ma;e=0;for(l=k.length;e<l;e++)for(B=k[e],q=B.radius(),r=m.lh(B.pos,2*g),f=0,t=r.length;f<t;f++){var x=
r[f].getPoint(),D=x.ib(),E=D.Fa,w=E.uc().toString()+":"+E.toString();E.sj()&&(w+=":"+D.qc+":"+D._id);D=x.distanceTo(B);E=x.radius();D/(q+E)<=g&&(D=h.get(w),null==D&&(D=[],h.set(w,D)),D.push([B,x]))}return h};z.Ak=function(e){var f=new vj,g=e.split(":"),h=g[0],k=g[1];e=g[2];var m=null,l=null;3<g.length&&(m=g[3],l=g[4]);g=new Ej(h);g.ka.set(e,[]);f.ka.set(h,g);h=new Fj(Gj(k),m,l);g.ka.get(e).push(h);return f.toString()};
z.zk=function(){for(var e=[],f=this.ag(),g=f.length,h=0;h<g;h++)for(var k=f[h],m=this.Ng(k),l=0,q=m.length;l<q;l++){var r=m[l];r.tj()&&e.push(k+":"+r.toString())}return e};z.yk=function(){for(var e=[],f=this.ag(),g=f.length,h=0;h<g;h++)for(var k=f[h],m=this.Ng(k),l=0,q=m.length;l<q;l++){var r=m[l];if(r.tj())e.push(k+":"+r.toString());else if(r.sj())for(var t=r.ga,x=0,w=t.length;x<w;x++)e.push(k+":"+r.toString()+":"+t[x].toString())}return e};
z.Jk=function(e,f){for(var g=[],h=0,k=e.length;h<k;h++){var m=e[h][f].ib(),m=m.Fa.uc().toString()+":"+m.Fa.toString()+":"+m.toString();0>g.indexOf(m)&&g.push(m)}return g};z.Dk=function(e){return e.ia.blob};
(function(e){e.widget("bionext.bvsjobswidget",{options:{ba:null},Jh:[],dg:null,jg:null,_create:function(){this.element.addClass("bionext.bvsjobswidget");this.ba=this.options.ba;if(null==this.ba)throw new Exception("You must set bioviz option when using this widget");this.Ud()},_destroy:function(){this.element.removeClass("bionext.bvsjobswidget")},Ud:function(){var f=this,g;g='<label for="target">Select a target : </label><select name="target" id="target"><option disabled>No target available</option></select><br><label for="dist">Interaction distance : </label>';
g+='<input type="text" id="dist" readonly>';g+='<div id="distSlider"></div>';g+="<br>";g+='<button id="detect">Detect</button>';g+="<br>";g+='<label for="detected">Detected Ligand : </label>';g+='<select name="detected" id="detected"><option disabled>No compound available</option></select>';g+='<input type="checkbox" id ="focus">autoFocus</input>';g+="<br>";g+='<input id="title" placeholder="Title">';g+='<select name="db" id="db"><option>crystal</option><option>small-mq</option></select>';g+="<br>";
g+='<input id="compoundStr" placeholder="Compound selection">';g+='<input id="siteStr" placeholder="Site selection">';g+='<button id="submit">Submit</button>';g=e('<div id="bvsjobswidget" class="ui-widget-header ui-corner-all">'+g+"</div>");this.element.empty();g.appendTo(this.element);e("#target").selectmenu().addClass("disabled");e("#detected").selectmenu().addClass("disabled");e("#db").selectmenu();e("#distSlider").slider({value:20,min:1,max:80,step:1,slide:function(f,g){e("#dist").val(g.value/
10+"A")}}).each(function(){for(var f=e(this).data()["ui-slider"].options,g=f.max-f.min,m=0;m<=g;m++)if(0===(m+f.min)%20){var l=e("<label>"+(m+f.min)/10+"</label>").css("left",m/g*100+"%");e("#distSlider").append(l)}});e("#dist").val(e("#distSlider").slider("value")/10+"A");e("#detect").button().attr("disabled",!0);e("#submit").button().attr("disabled",!0);e("#target").css("color","black").css("font-weight","normal");e("#detected").css("color","black").css("font-weight","normal");e("#db").css("color",
"black").css("font-weight","normal");e("#title").css("color","black").css("font-weight","normal");e("#compoundStr").css("color","black").css("font-weight","normal");e("#siteStr").css("color","black").css("font-weight","normal");e("#dist").css("color","black").css("font-weight","normal");e("#distSlider label").css("position","absolute").css("width","20px").css("margin-top","10px").css("margin-left","-10px").css("text-align","center");e("#detect").click(function(){e("#detected").empty();f.dg=f.ba.ba("detectLigands",
e("#target").val(),f.Jh,e("#distSlider").slider("value")/10);var g=f.dg.keys();if(0<g.length){for(var k=0,m=g.length;k<m;k++)e("#detected").append(e("<option></option>").attr("value",g[k]).text(g[k]));e("#detected").selectmenu().removeClass("disabled");e("#submit").button().removeAttr("disabled")}else e("#detected").append(e("<option disabled></option>").attr("value","No compound available").text("No compound available")),e("#detected").selectmenu().addClass("disabled");e("#detected").selectmenu("refresh",
!0);f.Oi();e("#focus").is(":checked")&&setTimeout(function(){var g=f.ba.ba("getObjects3DFromSelection",e("#detected").val());f.ba.ba("centerOnSelection",g,!1);f.ba.ba("anchorOnSelection",g)},200)});e("#target").on("selectmenuselect",function(){var g=f.ba.ba("getObjects3DFromSelection",e("#target").val(),1);f.ba.ba("centerOnSelection",g)});e("#detected").on("selectmenuchange",function(){null!=f.dg&&(f.Oi(),e("#focus").is(":checked")&&setTimeout(function(){var g=f.ba.ba("getObjects3DFromSelection",
e("#detected").val());f.ba.ba("centerOnSelection",g,!1);f.ba.ba("anchorOnSelection",g)},200))});e("#focus").change(function(){if(!e("#submit").button().attr("disabled"))if(e(this).is(":checked"))g=f.ba.ba("getObjects3DFromSelection",e("#detected").val()),f.ba.ba("centerOnSelection",g,!1);else{var g=f.ba.ba("getObjects3DFromSelection",e("#target").val(),1);f.ba.ba("centerOnSelection",g)}});e("#submit").click(function(){f.Gl()});this.ba.ba("addListener","requestWidgetUpdate",function(){f.km()})},km:function(){var f=
e("#target").val();e("#target").empty();this.Jh=[];if(this.ba.ba("hasObject3D")){e("#target").selectmenu().removeClass("disabled");e("#detect").button().removeAttr("disabled");for(var g=this.ba.ba("getAvailableTargets"),h=0,k=g.length;h<k;h++){var m=g[h];e("#target").append(e("<option></option>").attr("value",m).text(m))}this.Jh=this.ba.ba("getAvailableCompounds")}else e("#target").append(e("<option disabled></option>").attr("value","No target available").text("No target available")),e("#target").selectmenu().addClass("disabled"),
e("#detect").button().attr("disabled",!0);e("#target").selectmenu("refresh",!0);g=e("#selectBox option");0>e.map(g,function(e){return e.value===f}).indexOf(!0)&&this.im()},im:function(){e("#detected").empty();e("#detected").append(e("<option></option>").attr("value","No compound available").text("No compound available"));e("#detected").selectmenu("refresh",!0);e("#submit").button().attr("disabled",!0);e("#compoundStr").val("");e("#siteStr").val("")},Oi:function(){this.jm();this.Dl();this.jg=e("#detected").val();
for(var f=this.dg.get(e("#detected").val()),g=this.ba.ba("getSelectionFromInteraction",f,0),f=this.ba.ba("getSelectionFromInteraction",f,1),h=0,k=g.length;h<k;h++){var m=this.ba.ba("getObjects3DFromSelection",g[h]);this.ba.ba("showRepresentation",m,e.u.Fg.gc);this.ba.ba("colorBy",[255,0,0],m,e.u.Fg.gc);this.ba.ba("showLabel",m,e.u.Nj.fc)}h=0;for(k=f.length;h<k;h++)m=this.ba.ba("getObjects3DFromSelection",f[h]),this.ba.ba("showRepresentation",m,e.u.Fg.gc),this.ba.ba("colorBy",[0,255,0],m,e.u.Fg.gc),
this.ba.ba("showLabel",m,e.u.Nj.fc)},Dl:function(){var f=this.ba.ba("getObjects3DFromSelection",e("#target").val());this.ba.ba("removeResidues3D",f);this.ba.ba("hideLabel",f);null!=this.jg&&(f=this.ba.ba("getObjects3DFromSelection",this.jg,2),0===f.length?this.jg=null:(this.ba.ba("removeResidues3D",f),this.ba.ba("hideLabel",f)))},jm:function(){var f=this.ba.ba("getBVSSelectionFromBiovizSelection",e("#target").val()),g=this.ba.ba("getBVSSelectionFromBiovizSelection",e("#detected").val());e("#compoundStr").val(g);
e("#siteStr").val(f)},Gl:function(){var f={title:e("#title").val(),Qf:e("#db").val(),wm:e("#compoundStr").val(),ym:e("#siteStr").val()},g=this.ba.ba("getObjects3DFromSelection",e("#target").val(),1),g=this.ba.ba("getFileFromStructureSelection",g[0]);console.log(g);console.log(JSON.stringify(f))}})})(jQuery);X.prototype.createBioviz=X.prototype.jk;X.prototype.initBioviz=X.prototype.Xk;X.prototype.isAvailable=X.prototype.$k;X.prototype.setExternalContextMenuDiv=X.prototype.Jl;
X.prototype.getCanvas=X.prototype.Vf;X.prototype._setDefaultRepresentations=X.prototype.Pj;X.prototype._notify=X.prototype.gb;X.prototype._getStructure=X.prototype.Yc;X.prototype._getMolecule=X.prototype.df;X.prototype._getResidue=X.prototype.ef;X.prototype._getAtom=X.prototype.Ei;X.prototype._getRepresentationType=X.prototype.Xc;X.prototype._checkSingleMolecule3DFromSelection=X.prototype.xi;X.prototype._checkSingleObject3DFromSelection=X.prototype.yi;X.prototype._afterLoaded=X.prototype.Ig;
X.prototype.getResidue3D=X.prototype.dc;X.prototype.removeResidues3D=X.prototype.xl;X.prototype.getMoleculeType=X.prototype.Ek;X.prototype.getObjects3DFromSelection=X.prototype.Kc;X.prototype.linkWithExternalSequence=X.prototype.Mj;X.prototype.resetRepresentations=X.prototype.Qe;X.prototype.resetHighlights=X.prototype.zl;X.prototype.resetPositions=X.prototype.Oh;X.prototype.resetScene=X.prototype.Bl;X.prototype.highlight=X.prototype.yb;X.prototype.executeScript=X.prototype.rk;
X.prototype.startScript=X.prototype.bm;X.prototype.stopScript=X.prototype.cm;X.prototype.pauseScript=X.prototype.sl;X.prototype.hideScriptPlayer=X.prototype.Tk;X.prototype.hideWidgetManager=X.prototype.Vk;X.prototype.addListener=X.prototype.addListener;X.prototype.isDebug=X.prototype.pj;X.prototype.setOption=X.prototype.Zh;X.prototype.isRepresentationActive=X.prototype.tf;X.prototype.centerOnSelection=X.prototype.Zj;X.prototype.anchorOnSelection=X.prototype.Sj;X.prototype.hasLabels=X.prototype.Mk;
X.prototype.hasObject3D=X.prototype.Nk;X.prototype.getStructuresByPDBID=X.prototype.ag;X.prototype.getMoleculesFromStructure=X.prototype.Fk;X.prototype._getMoleculesFromStructure=X.prototype.Ng;X.prototype.getProteinicMoleculesFromStructure=X.prototype.Hk;X.prototype.getResiduesFromMolecule=X.prototype.Ik;X.prototype.loadStructure=X.prototype.ed;X.prototype.loadLocalStructure=X.prototype.fg;X.prototype.deleteStructure=X.prototype.$i;X.prototype.deleteAllStructures=X.prototype.lk;X.prototype.say=X.prototype.pg;
X.prototype.showRepresentation=X.prototype.sg;X.prototype.hideRepresentation=X.prototype.kj;X.prototype.show=X.prototype.show;X.prototype.hide=X.prototype.hide;X.prototype.isShowed=X.prototype.cl;X.prototype.showLabel=X.prototype.$b;X.prototype.hideLabel=X.prototype.Sk;X.prototype.colorBy=X.prototype.mf;X.prototype.setAlpha=X.prototype.qg;X.prototype.changeSSE=X.prototype.$j;X.prototype.capturePosition=X.prototype.Yj;X.prototype.setBackground=X.prototype.Hl;X.prototype.startSpin=X.prototype.ug;
X.prototype.stopSpin=X.prototype.xf;X.prototype.toggleFullscreen=X.prototype.ei;X.prototype.takeScreenshot=X.prototype.zf;X.prototype.loadBvsQuery=X.prototype.ll;X.prototype.deleteBvsQuery=X.prototype.nk;X.prototype.loadBvsHit=X.prototype.jl;X.prototype.deleteBvsHit=X.prototype.mk;X.prototype.getObjects3DFromBVSSelection=X.prototype.Zf;X.prototype.isSiteRepresentationActive=X.prototype.dl;X.prototype.showSiteRepresentation=X.prototype.Ul;X.prototype.hideSiteRepresentation=X.prototype.Uk;
X.prototype.showHit=X.prototype.Ql;X.prototype.hideHit=X.prototype.Rk;X.prototype.showLigandOnly=X.prototype.Rl;X.prototype.showMolecules=X.prototype.Sl;X.prototype.colorMolecules=X.prototype.dk;X.prototype.colorSiteBy=X.prototype.fk;X.prototype.colorSite=X.prototype.ek;X.prototype.showBvsHitMatching=X.prototype.Nl;X.prototype.hideBvsHitMatching=X.prototype.Ok;X.prototype.showBvsHitMatchingLabels=X.prototype.Pl;X.prototype.hideBvsHitMatchingLabels=X.prototype.Qk;
X.prototype.showBvsHitMatchingDistanceLabels=X.prototype.Ol;X.prototype.hideBvsHitMatchingDistanceLabels=X.prototype.Pk;X.prototype._getSite=X.prototype.te;X.prototype._getQuery=X.prototype.se;X.prototype._getHit=X.prototype.pd;X.prototype.detectLigands=X.prototype.pk;X.prototype.getBVSSelectionFromBiovizSelection=X.prototype.Ak;X.prototype.getAvailableTargets=X.prototype.zk;X.prototype.getAvailableCompounds=X.prototype.yk;X.prototype.getSelectionFromInteraction=X.prototype.Jk;
X.prototype.getFileFromStructureSelection=X.prototype.Dk;
}(biovizNamespace));