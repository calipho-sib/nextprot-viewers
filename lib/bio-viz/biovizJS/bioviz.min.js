var biovizNamespace = {};
(function(ns) {
var z,ba=[];function ha(e){return function(){return ba[e].apply(this,arguments)}}var ia="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ca=function la(){if(this.constructor===la)throw Error("Can't instanciate abstract class BiovizMap");};z=Ca.prototype;z.set=function(){throw Error("Trying to call an abstract method");};
z.get=function(){throw Error("Trying to call an abstract method");};z.remove=function(){throw Error("Trying to call an abstract method");};z.bd=function(){throw Error("Trying to call an abstract method");};z.keys=function(){throw Error("Trying to call an abstract method");};z.values=function(){throw Error("Trying to call an abstract method");};z.clear=function(){throw Error("Trying to call an abstract method");};z.Jd=ha(2);function Fa(){Ca.call(this);this.la=new Map;this.vd=new Map}Fa.prototype=Object.create(Ca.prototype);
z=Fa.prototype;z.constructor=Fa;z.set=function(e,f){var g=Ja(e);this.la.set(g,f);this.vd.set(g,e)};z.get=function(e){e=Ja(e);return this.bd(e)?this.la.get(e):null};z.remove=function(e){e=Ja(e);if(this.bd(e)){var f=this.la.get(e);this.la["delete"](e);this.vd["delete"](e);return f}return null};z.bd=function(e){e=Ja(e);return this.la.has(e)};
z.keys=function(){var e=[],f=!0,g=!1,h=void 0;try{for(var k=this.la.keys()[Symbol.iterator](),m;!(f=(m=k.next()).done);f=!0)e.push(m.value)}catch(l){g=!0,h=l}finally{try{!f&&k["return"]&&k["return"]()}finally{if(g)throw h;}}return e};z.values=function(){var e=[],f=!0,g=!1,h=void 0;try{for(var k=this.la.values()[Symbol.iterator](),m;!(f=(m=k.next()).done);f=!0)e.push(m.value)}catch(l){g=!0,h=l}finally{try{!f&&k["return"]&&k["return"]()}finally{if(g)throw h;}}return e};
z.clear=function(){this.la.clear();this.vd.clear()};z.Jd=ha(1);function Ja(e){if(e instanceof Array){e=[];for(var f=e.length,g=0;g<f;g++)e.push(e[g].Fb());return e.join("")}return e instanceof Object?e.Fb():e}function Ka(){Ca.call(this);this.la=[]}function Pa(e,f){this.key=e;this.value=f}Ka.prototype=Object.create(Ca.prototype);z=Ka.prototype;z.constructor=Ka;
z.set=function(e,f){if(void 0===e)throw"ERROR: key cannot be undefined";var g;a:if(void 0!==e.zf)g=this.la[e.zf];else{for(g in this.la)if(this.la[g].key===e){g=this.la[g];break a}g=void 0}void 0===g?"object"===("undefined"===typeof e?"undefined":ia(e))&&(e.zf=this.la.push(new Pa(e,f))-1):g.value=f};z.get=function(e){if(void 0!==e.zf)return this.la[e.zf].value;for(var f in this.la)if(this.la[f].key===e)return this.la[f].value};z.keys=function(){var e=[],f;for(f in this.la)e.push(this.la[f].key);return e};
z.bd=function(e){return-1!==this.keys().indexOf(e)};z.values=function(){var e=[],f;for(f in this.la)e.push(this.la[f].value);return e};z.remove=function(e){var f=-1,g;for(g in this.la)if(this.la[g].key===e){f=g;break}return 0<=f?this.la.splice(f,1)[0].value:null};z.clear=function(){this.la=[]};z.Jd=ha(0);

function Va(e){e.la=new Map(JSON.parse(e.la));e.vd=new Map(JSON.parse(e.vd))}function $a(){this.pos=new THREE.Vector3;this.ca=this.Oa=this.ec=this.u=this.v=this.vc=this.ea=this.symbol=this.ya=this.ka=this.zd=this.name=this.id=this.type=null}z=$a.prototype;z.ta=function(){return this.id};z.Aa=function(){return this.Oa};function ab(e,f){e.u!==f&&(e.u=f,null!==e.Oa&&e.Oa.qc(f))}z.Ya=function(){return this.pos};
z.zc=function(){if(null===this.ca){var e=parseFloat(jb(this.symbol)[7]),f=new THREE.Vector3(-e,-e,-e),e=new THREE.Vector3(e,e,e);this.ca=new ob(f,e)}return this.ca};z.radius=function(){return parseFloat(jb(this.symbol)[7])};z.Bb=function(){return this.ec};function wb(e,f){if(e.ec!==f&&(e.ec=f,null!=e.Oa)){var g=e.Oa,h=e.ec;if(g.ec!=h){g.ec=h;for(var k=g.u.length,m=0;m<k;m++)wb(g.u[m],h)}}}z.xb=function(){return this.vc};z.af=function(e){this.vc!=e&&(this.vc=e,null!==this.Oa&&this.Oa.af(e))};
z.dg=function(){return this.v};z.me=function(e){this.v!==e&&(this.v=e,null!==this.Oa&&this.Oa.me(e))};z.toString=function(){return this.symbol+":"+this.id};z.$b=function(){return this.Oa.$b()+":"+this.toString()};z.Fb=function(){return this.symbol+":"+this.id+":"+this.v};z.distanceTo=function(e){return e instanceof $a?this.pos.distanceTo(e.pos):this.pos.distanceTo(e)};z.distanceToSquared=function(e){return e instanceof $a?this.pos.distanceToSquared(e.pos):this.pos.distanceToSquared(e)};
z.sub=function(e){return e instanceof $a?new THREE.Vector3(this.pos.x-e.pos.x,this.pos.y-e.pos.y,this.pos.z-e.pos.z):new THREE.Vector3(this.pos.x-e.x,this.pos.y-e.y,this.pos.z-e.z)};z.add=function(e){return e instanceof $a?new THREE.Vector3(this.pos.x+e.pos.x,this.pos.y+e.pos.y,this.pos.z+e.pos.z):new THREE.Vector3(this.pos.x+e.x,this.pos.y+e.y,this.pos.z+e.z)};z.clone=function(){return new THREE.Vector3(this.pos.x,this.pos.y,this.pos.z)};
function xb(){this.ka=null;this.u=new yb;this.ca=[];this.ya=this.v=this.ea=null}z=xb.prototype;z.Bc=function(){return this.ka};z.bf=function(e){this.ka=e;e=this.ca.length;for(var f=0;f<e;f++)f.bf(this.ka)};z.add=function(e){if(e instanceof $a)return e=this.u.Sf(e),Mb(this),e;e instanceof Rb?((null!==e.Kb&&e.Kb!==this||e.Kb===this)&&console.warn("ERROR: ",e,"already belongs to",e.Kb),null===e.Kb&&(this.ca.push(e),e.bf(this.ka),e.Kb=this,Mb(this))):console.warn("ERROR : a is not an atom or a molecule")};
z.remove=function(e){e instanceof $a?(e=this.u.findNode(atom),-1<e&&(delete this.u[e],Mb(this))):e instanceof Rb&&(null===molecule&&console.warn("molecule null in function remove in model"),molecule.Kb===this&&(this.ca.splice(this.ca.Ua(molecule),1),molecule.bf(null),molecule.Kb=null,Mb(this)))};z.Ea=function(){return this.u.values()};
z.Vb=function(){if(!this.ya){this.u.gk();this.v=this.zc();for(var e=new Tb(this.v.Ue(),this.v.Qe(),32),f=this.Ea(),g=0,h=f.length;g<h;g++)e.add(new gc(f[g]));e.optimize();h=f.length;for(g=0;g<h;g++)for(var k=f[g],m=k.symbol,m=m.charAt(0).toUpperCase()+m.slice(1).toLowerCase(),l=parseFloat(jb(m)[6]),q=e.$f(k.pos,5),r=q.length,t=0;t<r;t++){var w=q[t].getPoint();if(w!==k){var m=w.symbol,m=m.charAt(0).toUpperCase()+m.slice(1).toLowerCase(),x=parseFloat(jb(m)[6]),m=l+x-.4,x=l+x+.4,B=k.distanceTo(w);B>=
m&&B<=x&&(m=k,x=this.u.findNode(m),B=this.u.findNode(w),void 0!==x&&void 0!==B||console.warn("Couldn't find atoms ",m," and/or ",w," in model ",this),x.pj(B)||this.u.$g(x,B).setAttribute("BondType","SIMPLE"))}}this.ya=!0}return this.u};function Mb(e){e.ea=null;e.v=null;e.ya=!1}z.Ya=function(){if(null===this.ea){this.ea=new THREE.Vector3;for(var e=this.Ea(),f=0,g=0,h=0,k=e.length,m=0;m<k;m++)var l=e[m].pos,f=f+parseInt(l.x),g=g+parseInt(l.y),h=h+parseInt(l.z);this.ea.set(f/k,g/k,h/k)}return this.ea};
z.zc=function(){if(null===this.v){for(var e=new THREE.Vector3(Infinity,Infinity,Infinity),f=new THREE.Vector3(-Infinity,-Infinity,-Infinity),g=this.Ea(),h=0,k=g.length;h<k;h++){var m=g[h].pos;e.x=Math.min(e.x,m.x);e.y=Math.min(e.y,m.y);e.z=Math.min(e.z,m.z);f.x=Math.max(f.x,m.x);f.y=Math.max(f.y,m.y);f.z=Math.max(f.z,m.z)}this.v=new ob(e,f)}return this.v};function Rb(e){this.id=e;this.Kb=this.ea=this.type=null;this.ga=[];this.v=this.ca=this.u=null;this.Qf=!1}z=Rb.prototype;z.ta=function(){return this.id};
z.Vb=function(){return this.Kb.Vb()};z.qc=function(e){if(this.id!==e){this.id=e;for(var f=0;f<this.ga.length;f++)this.ga[f].me(e)}};z.Bc=function(){return this.ea};z.bf=function(e){this.ea=e};z.add=function(e){null==e&&console.warn("residue is null in Molecule");null!==e.xa&&e.xa!==this&&console.warn(e," already belongs to ",e.xa);null===e.xa&&(this.ga.push(e),hc(e,this),ic(this))};
z.remove=function(e){null===e&&console.warn("residue is null in Molecule");e.xa===this&&(this.ga.remove(e),hc(e,null),ic(this))};z.Aa=function(e){for(var f=0;f<this.ga.length;f++){var g=this.ga[f];if(g.ta()==e)return g}return null};z.Ea=function(){for(var e=[],f=this.ga.length,g=0;g<f;g++)e=e.concat(this.ga[g].Ea());return e};z.size=function(){return this.ga.length};z.isEmpty=function(){return 0===this.size};function ic(e){e.u=null;e.ca=null;null!==e.Kb&&Mb(e.Kb)}
z.Ya=function(){if(null===this.u){this.u=new THREE.Vector3;for(var e=this.Ea(),f=e.length,g=0;g<f;g++){var h=e[g].pos;this.u.x+=h.x;this.u.y+=h.y;this.u.z+=h.z}this.u.x/=f;this.u.y/=f;this.u.z/=f}return this.u};
z.zc=function(){if(null===this.ca){for(var e=new THREE.Vector3(Infinity,Infinity,Infinity),f=new THREE.Vector3(-Infinity,-Infinity,-Infinity),g=this.Ea(),h=g.length,k=0;k<h;k++){var m=g[k].pos;e.x=Math.min(e.x,m.x);e.y=Math.min(e.y,m.y);e.z=Math.min(e.z,m.z);f.x=Math.max(f.x,m.x);f.y=Math.max(f.y,m.y);f.z=Math.max(f.z,m.z)}this.ca=new ob(e,f)}return this.ca};z.toString=function(){return this.type+":"+this.id};z.Fb=function(){return this.toString()};z.$b=function(){return this.ea.$b()+":"+this.toString()};
z.Vi=function(){if(null!==this.type&&"Protein"===this.type&&!this.Qf){if(null===this.v){var e=this.ga,f=e.length;this.v=new yb;for(var g=1;g<f;g++){var h=e[g-1],k=e[g],m=this.v.findNode(k);null==m&&(m=this.v.ah(k.toString(),k));var l=k.nc("CA"),q=k.nc("N"),r=k.nc("H");if(h.ta()+h.Bb().charCodeAt(0)===k.ta()+k.Bb().charCodeAt(0)-1&&"PRO"!==h.ca){r=h.nc("C");h=h.nc("O");if(null==r||null==h)continue;r=r.sub(h);r=r.normalize();h=q.add(r);r=new $a;r.name="H";r.symbol="H";r.pos.x=h.x;r.pos.y=h.y;r.pos.z=
h.z}if(null!=r)for(h=0;h<f;h++)if(h!=g&&h!=g-1){var t=e[h],k=this.v.findNode(t);null==k&&(k=this.v.ah(t.toString(),t));var w=t.nc("CA"),x=t.nc("C"),B=t.nc("O");if(null!=w&&null!=x&&null!=B&&!(9<w.distanceTo(l))){var w=r.distanceTo(B),t=r.distanceTo(x),B=q.distanceTo(B),C=q.distanceTo(x),x=-9.9;.5>w||.5>t||.5>B||.5>C||(x=27.888/B,x+=27.888/t,x-=27.888/w,x-=27.888/C,-9.9>x&&(x=-9.9));if(-.5>x){var w=m.Ik(k),G;null!=w?G=w.getAttribute("eH"):G=0;x<G&&(this.v.$g(m,k,!0).setAttribute("eH",x),null!=w&&this.v.Gl(w))}}}}}e=
this.ga.length;for(f=0;f<e;f++)this.ga[f].nb=null;f=1;for(l=4;f+l<e;f++)if(jc(this,this.ga[f-1],this.ga[f-1+l])&&jc(this,this.ga[f],this.ga[f+l]))for(g=f;g<f+l;g++)this.ga[g].nb=H.u;for(f=1;f+1<e;f++)for(g=f+3;g+1<e;g++)if(m=this.ga[f],l=this.ga[g],null===m.nb&&null===l.nb)if(jc(this,this.ga[f-1],l)&&jc(this,l,this.ga[f+1])||jc(this,this.ga[g-1],m)&&jc(this,m,this.ga[g+1]))m.nb=H.v,l.nb=H.v;else if(jc(this,m,l)&&jc(this,l,m)||jc(this,this.ga[f-1],this.ga[g+1])&&jc(this,this.ga[g-1],this.ga[f+1]))m.nb=
H.ea,l.nb=H.ea;f=1;for(l=3;f+l<e;f++)if(jc(this,this.ga[f-1],this.ga[f-1+l])&&jc(this,this.ga[f],this.ga[f+l])){m=!0;for(g=f;g<f+l;g++)if(null!=this.ga[g]){m=!1;break}for(g=f;g<f+l;g++)this.ga[g].nb=m?H.u:H.ka}f=1;for(l=5;f+l<e;f++)if(jc(this,this.ga[f-1],this.ga[f-1+l])&&jc(this,this.ga[f],this.ga[f+l])){m=!0;for(g=f;g<f+l;g++)if(null!=this.ga[g]){m=!1;break}for(g=f;g<f+l;g++)this.ga[g].nb=m?H.u:H.ka}for(l=3;5>=l;l++)for(f=0;f+l<e;f++)if(jc(this,this.ga[f],this.ga[f+l]))for(g=f+1;g<f+l;g++)m=this.ga[g].nb,
null==m&&(this.ga[g].nb=H.ka);for(f=0;f<e;f++)m=this.ga[f].nb,null==m&&(this.ga[f].nb=H.ca);this.Qf=!0}};z.Sl=function(e){if(e.length!=this.ga.length)for(var f=0,g=this.ga.length;f<g;f++){var h=qc[e[this.ga[f]._id-1]];this.ga[f].nb=null!=h?h:H.ca}else for(f=0,g=this.ga.length;f<g;f++)h=qc[e[f]],this.ga[f].nb=null!=h?h:H.ca;this.Qf=!0};function jc(e,f,g){f=e.v.findNode(f);return null==f?!1:f.Qk(e.v.findNode(g))}
z.ee=function(e){void 0===e&&(e=!0);for(var f="",g=this.ga,h=0,k="\x00",m=this.Od()?"X":this.We()?"N":"-",l=g.length,q=0;q<l;q++){var r=g[q];if(e&&0!=q)for(h=r.ta()-h+r.Bb().charCodeAt(0)-k.charCodeAt(0);1<h--;)f+=m;f+=r.oj();h=r.ta();k=r.Bb()}return f};z.We=function(){return"DNA"==this.type||"RNA"==this.type};z.Od=function(){return"Protein"==this.type||"Peptide"==this.type||"Small Peptide"==this.type};z.zj=function(){return this.We()||this.Od()};z.yj=function(){return"Ligand"===this.type};
z.Uj=function(e){var f=new uc,g=[];g.push(new vc(this.toString(),this.ee(!1)));g.push(new vc("ExternalSequence",e));f=f.align(g);e=f.ee("ExternalSequence");f=f.ee(this.toString());console.log(e,f);this.zk=f;console.log(f.ka())};
function Ac(e){for(var f=[],g=0,h=e.ga,k=0,m=0;m<h.length;m++){var l=h[m];if(null===l.type)k++;else{var q=f[l.type];void 0===q&&(q=0,f[l.type]=q,g++);f[l.type]++}}if(0!==g){var g=Infinity,r;for(q in f)h=f[q],0!==h&&h<g?(g=h,r=q):h===g&&q<r&&(r=q);g>=k&&("Protein"==r?(f=e.size(),e.type=20>f?"Small Peptide":60>f?"Peptide":"Protein"):e.type=r)}else e.type="Unknown"}
function Gc(){this._id=this.ea=this.vc=this.xa=this.nb=this.type=this.ca=null;this.ec="\x00";this.u=[];this.ya=new Fa;this.Ma=this.ka=this.v=null}function Hc(e,f){e.ea=f.Xb;e._id=f.zb;e.ec=f.ac}z=Gc.prototype;z.Vb=function(){return this.xa.Vb()};function hc(e,f){e.xa=f;null!==f&&void 0!==f&&e.me(f.ta())}z.ta=function(){return this._id};z.qc=function(e){if(this._id!=e){this._id=e;for(var f=0;f<this.u.length;f++)ab(this.u[f],e)}};z.Bb=function(){return this.ec};z.xb=function(){return this.vc};
z.af=function(e){if(this.vc!=e){this.vc=e;for(var f=this.u.length,g=0;g<f;g++)g.af(e)}};z.dg=function(){return this.ea};z.me=function(e){if(this.ea!=e){this.ea=e;null!==this.xa&&this.xa.qc(e);for(var f=this.u.length,g=0;g<f;g++)g.me(e)}};
z.add=function(e){null===e&&console.warn("atom = null in Residue");null!==e.Aa()&&e.Aa()!==this&&console.warn(e," already belongs to ",e.Aa());if(null===e.Aa()){this.u.push(e);var f=new Ic(e.name,e.zd);this.ya.bd(f)||this.ya.set(f,e);e.Oa=this;null!==this&&(ab(e,e.Oa.ta()),wb(e,e.Oa.Bb()),e.af(e.Oa.xb()),e.me(e.Oa.dg()))}};z.remove=function(e){null===e&&console.warn("atom = null in Residue");e.Aa()===this&&(this.u.remove(e),e=new this.tb(e.name,e.zd),this.ya.remove(e))};z.Ea=function(){return this.u};
z.mj=function(e){for(var f=0;f<this.u.length;f++){var g=this.u[f];if(g.ta()==e)return g}return null};z.nc=function(e){var f=void 0;void 0===f&&(f="\x00");e=this.ya.get((new Ic(e,f)).toString());if(null!==e)return e};z.Ya=function(){if(null==this.v){this.v=new THREE.Vector3;for(var e=this.u.length,f=0;f<e;f++){var g=this.u[f].pos;this.v.x+=g.x;this.v.y+=g.y;this.v.z+=g.z}this.v.x/=e;this.v.y/=e;this.v.z/=e}return this.v};
z.th=function(){if(null==this.ka)for(var e=this.u.length,f=0;f<e;f++){var g=this.u[f];if("CA"===g.name){this.ka=g.pos.clone();break}}if(null==this.ka){for(var h=this.Ya(),k=this.u[0],m=h.distanceTo(k.pos),e=this.u.length,f=0;f<e;f++){var g=this.u[f],l=h.distanceTo(g.pos);l<m&&(k=g,m=l)}this.ka=k.clone()}return this.ka};
z.zc=function(){if(null===this.Ma){for(var e=new THREE.Vector3(Infinity,Infinity,Infinity),f=new THREE.Vector3(-Infinity,-Infinity,-Infinity),g=this.u.length,h=0;h<g;h++){var k=this.u[h];e.x=Math.min(e.x,k.pos.x);e.y=Math.min(e.y,k.pos.y);e.z=Math.min(e.z,k.pos.z);f.x=Math.max(f.x,k.pos.x);f.y=Math.max(f.y,k.pos.y);f.z=Math.max(f.z,k.pos.z)}this.Ma=new ob(e,f)}return this.Ma};z.We=function(){return"DNA"==this.type||"RNA"==this.type};
z.Od=function(){return"Protein"==this.type||"Peptide"==this.type||"Small Peptide"==this.type};
z.oj=function(){switch(null!==this.ca?this.ca:this.vc){case "GLY":return"G";case "ALA":return"A";case "VAL":return"V";case "LEU":return"L";case "ILE":return"I";case "PRO":return"P";case "PHE":return"F";case "MET":return"M";case "TRP":return"W";case "SER":return"S";case "THR":return"T";case "ASN":return"N";case "GLN":return"Q";case "ASP":return"D";case "GLU":return"E";case "CYS":return"C";case "TYR":return"Y";case "HIS":return"H";case "LYS":return"K";case "ARG":return"R";case "ASX":return"B";case "GLX":return"Z";
case "A":case "DA":case "+A":return"A";case "C":case "DC":case "+C":return"C";case "G":case "DG":case "+G":return"G";case "T":case "DT":case "+T":return"T";case "U":case "DU":case "+U":return"U";case "I":case "DI":case "+I":return"I"}return null!=this.xa.type&&"Protein"===this.xa.type?"X":null==this.xa.type||"RNA"!==this.xa.type&&"DNA"!==this.xa.type?"?":"N"};z.toString=function(){return this.vc+":"+this._id};z.Fb=function(){return this.vc+":"+this._id+":"+this.ea};
z.$b=function(){return this.xa.$b()+":"+this.toString()};function Ic(e,f){this.name=e;this.zd=f}Ic.prototype.toString=function(){return this.name+":"+this.zd};Ic.prototype.Fb=function(){return this.name+":"+this.zd};
function Jc(e,f){null===e.ca&&console.warn("Error : stdResName must be set before guessing residue type");if(-1!==Pc.indexOf(e.ca))e.type="DNA";else if(-1!==Tc.indexOf(e.ca))e.type="RNA";else if(-1!==Uc.indexOf(e.ca))e.type="Protein";else if(-1!==bd.indexOf(e.xb()))e.type="Solvent";else if(-1!==cd.indexOf(e.xb()))e.type=null;else{var g=f.get(e.ta());null!=g&&g.name.endsWith(" ION")&&(e.type="Ion");e.type="Ligand"}}
var Uc="GLY ALA VAL LEU ILE PRO PHE MET TRP SER THR ASN GLN ASP GLU CYS TYR HIS LYS ARG".split(" "),Tc=["A","C","G","U","I"],Pc="DA DC DG DT DI DU +A +C +G +T +I +U T".split(" "),cd="UNK ASX GLX N DN UNL UNX".split(" "),bd=["HOH","DOD","GOL","EDO"];
function dd(e,f,g){null===e&&console.warn("chainId null in Residue.Id");this.Xb=e;this.zb=f;this.ac=g;this.toString=function(){return"\x00"!==this.ac.charCodeAt(0)?this.Xb+":"+this.zb+":"+this.ac:this.Xb+":"+this.zb};this.Fb=function(){return"\x00"!==this.ac.charCodeAt(0)?this.Xb+":"+this.zb+":"+this.ac:this.Xb+":"+this.zb}}function H(e,f){this.name=e;this.code=f}H.ca=new H("Coil"," ");H.ka=new H("Turn","T");H.u=new H("Helix","H");H.v=new H("Strand","x");H.ea=new H("Strand","X");
var qc={G:H.u,H:H.u,I:H.u,B:H.v,E:H.v,T:H.ka,S:H.ca,C:H.ca,X:H.ca};H.prototype.toString=function(){return name};function ed(){this.ml=!0;this._id=this.Xg=null;this.Oi=NaN;this.Mi=null;this.ca=[];this.Gi=[];this.xd=new Fa;this.ud=new Fa;this.wc=new Fa;this.Ci=[];this.v=[];this.ea=new Fa;this.u=null}z=ed.prototype;
z.Ya=function(){if(null===this.u){this.u=new THREE.Vector3;for(var e=this.v[0].ca,f=0;f<e.length;f++){var g=e[f].Ya();this.u.x+=g.x;this.u.y+=g.y;this.u.z+=g.z}this.u.x/=e.length;this.u.y/=e.length;this.u.z/=e.length}return this.u};z.Vb=function(){return this.v[0].Vb()};z.ta=function(){return this._id};z.qc=function(e){null==this._id&&(this.Xg=e);this._id=e};z.Ul=function(e){this.Oi=e};z.ci=function(){};z.setDate=function(){};z.ei=function(e){this.Mi=e};z.Rl=function(){};
z.Pi=function(e,f){null==(null==e?this.ca:this.ca[e])&&(this.ca[e]=f)};z.Pl=function(e){this.Gi=e};z.add=function(e){null===e&&console.warn("Error on adding model to structure : model = NULL");null!=e.Bc()&&e.Bc()!=this&&console.warn(e," already belongs to ",e.Bc());null==e.Bc()&&(this.v.push(e),e.bf(this))};z.remove=function(e){null===e&&console.warn("Error on removing structure");e.Bc()==this&&(this.v.remove(e),e.bf(null))};z.fg=function(){return this.v[0]};z.toString=function(){return this._id};
z.Fb=function(){return this.toString()};z.$b=function(){return this.toString()};
z.qk=function(e){this.xd.__proto__=Fa.prototype;Va(this.xd);this.wc.__proto__=Fa.prototype;Va(this.wc);this.ud.__proto__=Fa.prototype;Va(this.ud);for(var f=e.length,g=0;g<f;g++){var h=new xb;this.add(h);for(var k=e[g],m=k.length,l=0;l<m;l++){var q=new $a;q.type=k[l][0];q.id=k[l][1];q.name=k[l][2];q.zd=k[l][3];q.af(k[l][4]);q.me(k[l][5]);ab(q,k[l][6]);wb(q,k[l][7]);q.pos.x=k[l][8];q.pos.y=k[l][9];q.pos.z=k[l][10];q.ka=k[l][11];q.ya=k[l][12];q.symbol=k[l][13];q.ea=k[l][14];h.add(q)}}fd(this)};
function fd(e){var f=e.xd,g=e.ud,h=e.wc,k=e.v,m=!1,l,q=k.length,r=new Fa;for(l=0;l<q;l++){for(var t=k[l],w=[],x=t.Ea(),B=x.length,C=0;C<B;C++){var G=x[C],I=void 0,D=new dd(G.dg(),G.u,G.Bb()),I=r.get(D);if(null==I){I=new Gc;Hc(I,D);I.af(G.xb());var J=f.get(D);I.ca=J?J.Eg:I.xb();Jc(I,g);J=h.get(D);null!=J?(m||(m=!0),I.nb=J):I.nb=H.ca;w.push([I,D]);r.set(D,I)}I.add(G)}G=void 0;for(I=0;I<w.length;I++){x=w[I][0];B=w[I][1];I=x;for(C=[];void 0!==I&&null!==I&&-1===C.indexOf(B)&&!I.Od()&&!I.We();)if(C.push(B),
G=e.ea.get(B),null!=G){for(var G=G.Ua.Xb===B.Xb&&G.Ua.zb===B.zb&&G.Ua.ac===B.ac?G.hc:G.Ua,F,I=0;I<w.length;I++)D=w[I],G.Xb===D.Xb&&G.zb===D.zb&&G.ac===D.ac&&(F=I);I=w[F][0]}void 0!==I&&I.type!==x.type&&(x.type=I.type)}x=new Map;for(I=0;I<w.length;I++)B=w[I][0],C=B.dg(),G=B.type+" "+C,D=x.get(G),void 0===D&&(D=new Rb(C),t.add(D),x.set(G,D)),D.add(B),D.Qf=m;t=function(e,f){return e.Ug<f.Ug?-1:e.Ug>f.Ug?1:e._id<f._id?-1:e._id>f._id?1:e.ec<f.ec?-1:e.ec>f.ec?1:0};w=!0;I=!1;B=void 0;try{for(var K=x.values()[Symbol.iterator](),
N;!(w=(N=K.next()).done);w=!0){var O=N.value;O.ga.sort(t);Ac(O)}}catch(U){I=!0,B=U}finally{try{!w&&K["return"]&&K["return"]()}finally{if(I)throw B;}}}};

function id(e,f){return ba[e]=f}Ca.prototype.Jd=id(2,function(){throw Error("Trying to call an abstract method");});Fa.prototype.Jd=id(1,function(e){var f=!0,g=!1,h=void 0;try{for(var k=this.la.keys()[Symbol.iterator](),m;!(f=(m=k.next()).done);f=!0){var l=m.value;if(this.la.get(l)===e)return l}}catch(q){g=!0,h=q}finally{try{!f&&k["return"]&&k["return"]()}finally{if(g)throw h;}}});Ka.prototype.Jd=id(0,function(e){for(var f in this.la)if(this.la[f].value===e)return this.la[f].key});
function jd(e){var f=[],g=!0,h=!1,k=void 0;try{for(var m=e.vd.keys()[Symbol.iterator](),l;!(g=(l=m.next()).done);g=!0)f.push(l.value)}catch(q){h=!0,k=q}finally{try{!g&&m["return"]&&m["return"]()}finally{if(h)throw k;}}return f}var ia="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kd=kd||{};kd.Gb=kd.Gb||{};
kd.Gb.$j=function(){return this.Of||this.Nf};kd.Gb.Xj=function(){if(this.Of)return document.webkitIsFullScreen;if(this.Nf)return document.mozFullScreen;console.assert(!1)};kd.Gb.request=function(e){e=e||document.body;this.Of?e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):this.Nf?e.mozRequestFullScreen():console.assert(!1)};kd.Gb.cancel=function(){this.Of?document.webkitCancelFullScreen():this.Nf?document.mozCancelFullScreen():console.assert(!1)};
kd.Gb.Of="webkitCancelFullScreen"in document?!0:!1;kd.Gb.Nf="mozCancelFullScreen"in document?!0:!1;kd.Gb.toggle=function(e,f){kd.Gb.Xj()?(ld(e),null!=e.Zf?e.contextMenu.moveTo(e.Zf):e.contextMenu.moveTo(e.lh),kd.Gb.cancel()):(ld(e),null!=e.Zf&&e.contextMenu.moveTo(e.lh),kd.Gb.request(f))};
kd.Gb.ak=function(e){e=e||{};var f=e.charCode||102,g=void 0!==e.dblclick?e.dblclick:!1,h=e.element,k=e.ba;document.addEventListener("keypress",function(e,f){return function(){return e.apply(f,arguments)}}(function(e){e.which===f&&kd.Gb.toggle(k,h)},this),!1);g&&document.addEventListener("dblclick",toggle,!1)};kd=kd||{};
kd.Yc=function(e,f,g,h){function k(){var k=null,r=null;null==f?(k=window.v,r=window.u):(k=f.width(),r=f.height());if(m!==k||l!==r)m=k,l=r,e.setSize(m,l),null!=g&&(g instanceof THREE.PerspectiveCamera?(g.aspect=m/l,g.fov=md(h,g),g.updateProjectionMatrix()):g instanceof THREE.OrthographicCamera?(g.left=-m/2,g.right=m/2,g.top=l/2,g.bottom=-l/2,g.updateProjectionMatrix()):console.warn("Unknown camera type"))}var m,l;window.addEventListener("resize",k,!1);return{stop:function(){window.removeEventListener("resize",
k)}}};kd.Yc.bind=function(e,f,g,h){return kd.Yc(e,f,g,h)};kd=kd||{};
kd.ym=function(){var e=document.createElement("div");e.style.cssText="width:80px;opacity:0.9;cursor:pointer";var f=document.createElement("div");f.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#200;";e.appendChild(f);var g=document.createElement("div");g.style.cssText="color:#f00;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px";g.innerHTML="WebGLRenderer";f.appendChild(g);for(var h=[],g=0;9>g;g++)h[g]=document.createElement("div"),h[g].style.cssText=
"color:#f00;background-color:#311;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",f.appendChild(h[g]),h[g].innerHTML="-";var k=Date.now();return{domElement:e,update:function(e){console.assert(e instanceof THREE.WebGLRenderer);if(!(Date.now()-k<1E3/30)){k=Date.now();var f=0;h[f++].textContent="== Memory =====";h[f++].textContent="Programs: "+e.info.memory.programs;h[f++].textContent="Geometries: "+e.info.memory.geometries;h[f++].textContent="Textures: "+e.info.memory.textures;
h[f++].textContent="== Render =====";h[f++].textContent="Calls: "+e.info.render.calls;h[f++].textContent="Vertices: "+e.info.render.vertices;h[f++].textContent="Faces: "+e.info.render.faces;h[f++].textContent="Points: "+e.info.render.points}}}};
var nd={atom:"#F5A99580",residue:"#CCFF00",molecule:"#FF66CC"},od={A:"#2424DC",B:"#AABDC0",C:"#00C500",D:"#5A00C1",E:"#96640A",F:"#F5A995",G:"#2EF7F0",H:"#C1C1BC",I:"#E8A432",J:"#0AFA0A",K:"#49C8C8",L:"#C8C80A",M:"#64C864",N:"#CB70BB",O:"#960096",P:"#531966",Q:"#173232",R:"#AA4664",S:"#7B7B7B",T:"#189A8F",U:"#F57B15",V:"#EA22EA",W:"#82B4BE",X:"#828282",Y:"#505050",Z:"#323232",0:"#7B7B7B",1:"#189A8F",2:"#F57B15",3:"#EA22EA",4:"#82B4BE",5:"#828282",6:"#505050",7:"#323232",8:"#A050FA",9:"#1EEA20"},pd=
{A:"#FF3232",T:"#0A32FF",C:"#FFFF32",G:"#0AFF0A",U:"#FF32FF",DA:"#FF3232",DT:"#0A32FF",DC:"#FFFF32",DG:"#0AFF0A",DU:"#FF32FF"},qd={SER:"#DAD0CC",LEU:"#008CB1",GLY:"#D6E9E5",ALA:"#69A0AC",LYS:"#DD524A",VAL:"#799CB4",THR:"#D0C2B0",ASP:"#82C56B",GLU:"#4EC4A4",PRO:"#315E87",ASN:"#E5E3DA",ARG:"#A73638",PHE:"#315E87",ILE:"#61818A",GLN:"#CFD0CD",TYR:"#72896E",CYS:"#72896E",HIS:"#6C6C67",MET:"#C8DBE8",TRP:"#356B84"},rd={H:"#FFFFFF",He:"#FADEC5",Li:"#7F3C3D",Be:"#000000",B:"#229262",C:"#AFAFAF",N:"#385E96",
O:"#B83839",F:"#FB9B27",Ne:"#000000",Na:"#38608E",Mg:"#72896E",Al:"#82C56B",Si:"#000000",P:"#FB9B27",S:"#F7B848",Cl:"#28FE28",Ar:"#000000",K:"#FADEC5",Ca:"#6C6C67",Sc:"#6C6C67",Ti:"#72896E",V:"#000000",Cr:"#6C6C67",Mn:"#6C6C67",Fe:"#FB9B27",Co:"#AAB844",Ni:"#6B5248",Cu:"#6B5248",Zn:"#6B5248"},Ad={Hydrophobic:"#FF0000",Hydrophilic:"#0000FF"},Bd={"First residue":"#00FF00","Last residue":"#0000FF"},Cd={Coil:"#B4B4B4",Turn:"#FFB419",Helix:"#FF1919",Strand:"#1919FF"},Dd={AA_AROMATIC:"#CDCD4B",AA_CHARGED_NEG:"#FF1919",
AA_CHARGED_PLUS:"#1919FF",AA_CYSTEINE:"#FF7D0F",AA_GLYCINE:"#9696FF",AA_HYDROPHOB:"#AFAFAF",AA_POLAR_NEG:"#9B3737",AA_POLAR_PLUS:"#37379B",AA_PROLINE:"#FF9B9B",AccessibleSurface:"#C8641E",ALL_ATOMS:"#000000",ALL_RESIDUES:"#000000",ALL_SSE:"#000000",AlphaShapeSurface:"#C8641E",Antiparallel_Strand:"#1919FF",APOLAIRE:"#CFD0CD",ATOM_CARBON_CHAIN:"#AFAFAF",ATOM_CARBON_CYCLE:"#AFAF4B",ATOM_CHARGED_NEG:"#1919FF",ATOM_CHARGED_PLUS:"#1919FF",ATOM_POLAR_NEG:"#9B1919",ATOM_POLAR_PLUS:"#19199B",ATOM_S:"#FFFFFF",
AXIS:"#FFFFFF",BACKBONE:"#A0B4FA",Background:"#000000",BOND:"#1EEA2066",CHARGE_NEG:"#0000FF99",CHARGE_NEUTRAL:"#FFFFFF99",CHARGE_POS:"#FF000099",Coil:"#B4B4B4",CORE:"#FF6464",C_TERM:"#A73638",DELTA_NEG:"#0000B499",DELTA_POS:"#B4000099",FIX:"#315E87",FLEXIBLE:"#C8DBE8",HELIX_2:"#32B432",Helix:"#FF1919",HYDROGEN_BOND:"#FFFFFF33",INTERFACE:"#FFFFFF",MolecularSurface:"#C8641E",N_TERM:"#315E87",Parallel_Strand:"#1919FF",PCORE:"#3C321E",PE:"#F7B848B3",PLANE:"#FFFFFF1A",POLAIRE_F_AB_ANIONIQUE:"#38608E",
POLAIRE_F_AB_CATIONIQUE:"#A73638",POLAIRE_F_AB_NEUTRE:"#F6F7F0",POLAIRE_SANS_F_AB:"#F9B58F",PSURFACE:"#141496",RIM:"#1428FF",SELECTION:"#FDB45D",SSE_B:"#6A68E6",SSE:"#FB9B27",SSE_HA:"#DC5456",SSE_T:"#FAFAFA",STABLE:"#385E96",SURFACE:"#FF0000",Turn:"#FFB419",UNSTABLE:"#BA3938",VDW:"#008CB1E1",Void_mo:"#9BFAB4",Void_pi:"#BEFF64",Void_po:"#C8C8C8",Void_pp:"#787878",Void_pr:"#6464FF"},Ed={white:{r:1,g:1,b:1},black:{r:0,g:0,b:0},grey:{r:.5,g:.5,b:.5},lightgrey:{r:.7,g:.7,b:.7},darkgrey:{r:.3,g:.3,b:.3},
red:{r:1,g:0,b:0},darkred:{r:.5,g:0,b:0},lightred:{r:1,g:.5,b:.5},green:{r:0,g:1,b:0},darkgreen:{r:0,g:.5,b:0},lightgreen:{r:.5,g:1,b:.5},blue:{r:0,g:0,b:1},darkblue:{r:0,g:0,b:.5},lightblue:{r:.5,g:.5,b:1},yellow:{r:1,g:1,b:0},darkyellow:{r:.5,g:.5,b:0},lightyellow:{r:1,g:1,b:.5},cyan:{r:0,g:1,b:1},darkcyan:{r:0,g:.5,b:.5},lightcyan:{r:.5,g:1,b:1},magenta:{r:1,g:0,b:1},darkmagenta:{r:.5,g:0,b:.5},lightmagenta:{r:1,g:.5,b:1},orange:{r:1,g:.5,b:0},darkorange:{r:.5,g:.25,b:0},lightorange:{r:1,g:.75,
b:.5}},Fd={Ac:"Actinium 7Act 20 f 89 [227] 2.15 2".split(" "),Al:"Aluminium 3 13 p 13 26.982 1.21 2".split(" "),Am:"Americium 7Act 20 f 95 [243] 1.8 2".split(" "),Sb:"Antimony 5 15 p 51 121.76 1.39 2".split(" "),Ar:"Argon 3 18 p 18 39.948 1.51 1.88".split(" "),As:"Arsenic 4 15 p 33 74.922 1.21 1.85".split(" "),At:"Astatine 6 17 p 85 [210] 1.21 2".split(" "),Ba:"Barium 6 2 s 56 137.327 2.15 2".split(" "),Bk:"Berkelium 7Act 20 f 97 [247] 1.54 2".split(" "),Be:"Beryllium 2 2 s 4 9.012 0.96 2".split(" "),
Bi:"Bismuth 6 15 p 83 208.98 1.48 2".split(" "),Bh:"Bohrium 7 7 d 107 [264] 1.5 2".split(" "),B:"Boron 2 13 p 5 10.811 0.83 2".split(" "),Br:"Bromine 4 17 p 35 79.904 1.21 1.85".split(" "),Cd:"Cadmium 5 12 d 48 112.411 1.54 1.58".split(" "),Cs:"Caesium 6 1 s 55 132.905 2.44 2".split(" "),Ca:"Calcium 4 2 s 20 40.078 1.76 2".split(" "),Cf:"Californium 7Act 20 f 98 [251] 1.83 2".split(" "),C:"Carbon 2 14 p 6 12.011 0.68 1.7".split(" "),Ce:"Cerium 6Lan 19 f 58 140.116 2.04 2".split(" "),Cl:"Chlorine 3 17 p 17 35.453 0.99 1.75".split(" "),
Cr:"Chromium 4 6 d 24 51.996 1.39 2".split(" "),Co:"Cobalt 4 9 d 27 58.933 1.26 2".split(" "),Cu:"Copper 4 11 d 29 63.546 1.32 1.4".split(" "),Cm:"Curium 7Act 20 f 96 [247] 1.69 2".split(" "),Ds:"Darmstadtium 7 10 d 110 [271] 1.5 2".split(" "),Db:"Dubnium 7 5 d 105 [262] 1.5 2".split(" "),Dy:"Dysprosium 6Lan 19 f 66 162.5 1.92 2".split(" "),Es:"Einsteinium 7Act 20 f 99 [252] 1.5 2".split(" "),Er:"Erbium 6Lan 19 f 68 167.26 1.89 2".split(" "),Eu:"Europium 6Lan 19 f 63 151.964 1.98 2".split(" "),Fm:"Fermium 7Act 20 f 100 [257] 1.5 2".split(" "),
F:"Fluorine 2 17 p 9 18.998 0.64 1.47".split(" "),Fr:"Francium 7 1 s 87 [223] 2.6 2".split(" "),Gd:"Gadolinium 6Lan 19 f 64 157.25 1.96 2".split(" "),Ga:"Gallium 4 13 p 31 69.723 1.22 1.87".split(" "),Ge:"Germanium 4 14 p 32 72.61 1.17 2".split(" "),Au:"Gold 6 11 d 79 196.967 1.36 1.66".split(" "),Hf:"Hafnium 6 4 d 72 178.49 1.75 2".split(" "),Hs:"Hassium 7 8 d 108 [269] 1.5 2".split(" "),He:"Helium 1 18 p 2 4.003 1.5 1.4".split(" "),Ho:"Holmium 6Lan 19 f 67 164.93 1.92 2".split(" "),H:"Hydrogen 1 1 s 1 1.008 0.23 1.09".split(" "),
In:"Indium 5 13 p 49 114.818 1.42 1.93".split(" "),I:"Iodine 5 17 p 53 126.904 1.4 1.98".split(" "),Ir:"Iridium 6 9 d 77 192.217 1.41 2".split(" "),Fe:"Iron 4 8 d 26 55.845 1.52 2".split(" "),Kr:"Krypton 4 18 p 36 83.8 1.5 2.02".split(" "),La:"Lanthanum 6Lan 19 f 57 138.906 2.07 2".split(" "),"Lr (Lw)":"Lawrencium 7 3 d 103 [262] 1.5 2".split(" "),Lr:"Lawrencium 7 3 d 103 [262] 1.5 2".split(" "),Lw:"Lawrencium 7 3 d 103 [262] 1.5 2".split(" "),Pb:"Lead 6 14 p 82 207.2 1.46 2.02".split(" "),Li:"Lithium 2 1 s 3 6.941 1.28 1.82".split(" "),
Lu:"Lutetium 6 3 d 71 174.967 1.87 2".split(" "),Mg:"Magnesium 3 2 s 12 24.305 1.41 1.73".split(" "),Mn:"Manganese 4 7 d 25 54.938 1.61 2".split(" "),Mt:"Meitnerium 7 9 d 109 [268] 1.5 2".split(" "),Md:"Mendelevium 7Act 20 f 101 [258] 1.5 2".split(" "),Hg:"Mercury 6 12 d 80 200.59 1.32 1.55".split(" "),Mo:"Molybdenum 5 6 d 42 95.94 1.54 2".split(" "),Nd:"Neodymium 6Lan 19 f 60 144.24 2.01 2".split(" "),Ne:"Neon 2 18 p 10 20.18 1.5 1.54".split(" "),Np:"Neptunium 7Act 20 f 93 [237] 1.9 2".split(" "),
Ni:"Nickel 4 10 d 28 58.693 1.24 1.63".split(" "),Nb:"Niobium 5 5 d 41 92.906 1.64 2".split(" "),N:"Nitrogen 2 15 p 7 14.007 0.68 1.55".split(" "),No:"Nobelium 7Act 20 f 102 [259] 1.5 2".split(" "),Os:"Osmium 6 8 d 76 190.23 1.44 2".split(" "),O:"Oxygen 2 16 p 8 15.999 0.68 1.52".split(" "),Pd:"Palladium 5 10 d 46 106.42 1.39 1.63".split(" "),P:"Phosphorus 3 15 p 15 30.974 1.05 1.8".split(" "),Pt:"Platinum 6 10 d 78 195.078 1.36 1.72".split(" "),Pu:"Plutonium 7Act 20 f 94 [244] 1.87 2".split(" "),
Po:"Polonium 6 16 p 84 [210] 1.4 2".split(" "),K:"Potassium 4 1 s 19 39.098 2.03 2.75".split(" "),Pr:"Praseodymium 6Lan 19 f 59 140.908 2.03 2".split(" "),Pm:"Promethium 6Lan 19 f 61 [145] 1.99 2".split(" "),Pa:"Protactinium 7Act 20 f 91 231.036 2 2".split(" "),Ra:"Radium 7 2 s 88 [226] 2.21 2".split(" "),Rn:"Radon 6 18 p 86 [222] 1.5 2".split(" "),Re:"Rhenium 6 7 d 75 186.207 1.51 2".split(" "),Rh:"Rhodium 5 9 d 45 102.906 1.42 2".split(" "),Rb:"Rubidium 5 1 s 37 85.468 2.2 2".split(" "),Ru:"Ruthenium 5 8 d 44 101.07 1.46 2".split(" "),
Rf:"Rutherfordium 7 4 d 104 [261] 1.5 2".split(" "),Sm:"Samarium 6Lan 19 f 62 150.36 1.98 2".split(" "),Sc:"Scandium 4 3 d 21 44.956 1.7 2".split(" "),Sg:"Seaborgium 7 6 d 106 [266] 1.5 2".split(" "),Se:"Selenium 4 16 p 34 78.96 1.22 1.9".split(" "),Si:"Silicon 3 14 p 14 28.086 1.2 2.1".split(" "),Ag:"Silver 5 11 d 47 107.868 1.45 1.72".split(" "),Na:"Sodium 3 1 s 11 22.991 1.66 2.27".split(" "),Sr:"Strontium 5 2 s 38 87.62 1.95 2".split(" "),S:"Sulphur 3 16 p 16 32.066 1.02 1.8".split(" "),Ta:"Tantalum 6 5 d 73 180.948 1.7 2".split(" "),
Tc:"Technetium 5 7 d 43 [98] 1.47 2".split(" "),Te:"Tellurium 5 16 p 52 127.6 1.47 2.06".split(" "),Tb:"Terbium 6Lan 19 f 65 158.925 1.94 2".split(" "),Tl:"Thallium 6 13 p 81 204.383 1.45 1.96".split(" "),Th:"Thorium 7Act 20 f 90 232.038 2.06 2".split(" "),Tm:"Thulium 6Lan 19 f 69 168.934 1.9 2".split(" "),Sn:"Tin 5 14 p 50 118.71 1.39 2.17".split(" "),Ti:"Titanium 4 4 d 22 47.867 1.6 2".split(" "),W:"Tungsten 6 6 d 74 183.84 1.62 2".split(" "),U:"Uranium 7Act 20 f 92 238.029 1.96 1.86".split(" "),
V:"Vanadium 4 5 d 23 50.942 1.53 2".split(" "),Xe:"Xenon 5 18 p 54 131.29 1.5 2.16".split(" "),Yb:"Ytterbium 6Lan 19 f 70 173.04 1.87 2".split(" "),Y:"Yttrium 5 3 d 39 88.906 1.9 2".split(" "),Zn:"Zinc 4 12 d 30 65.39 1.22 1.39".split(" "),Zr:"Zirconium 5 4 d 40 91.224 1.75 2".split(" "),XXXX:["Unknown",null,null,null,null,null,"1.5","2"]};function jb(e){e=e[0].toUpperCase()+e.substr(1).toLowerCase();null==Fd[e]&&(e="XXXX");return Fd[e]}
function Gd(){Element.call(this);this.wj=!0;this.xc=this.Ic=null;this.Mf=!1}Gd.prototype=Object.create(Element.prototype);Gd.prototype.constructor=Gd;Gd.prototype.Kd=function(){return this.xc};function Hd(e,f){if(e.Ic===f)return e.xc;if(e.xc===f)return e.Ic;console.warn(e.Ic,NaN+e.xc+":"+f);console.warn("Node "+f+" is not part of edge "+e.ta())}Gd.prototype.toString=function(){var e;e=""+this.Ic;e=this.Mf?e+"->":e+"--";return e+=this.xc};function Element(){this.Zd=this._id=null;this.Tg=[]}
Element.prototype.ta=function(){return this._id};Element.prototype.getAttributes=function(){return this.Tg};Element.prototype.getAttribute=function(e){return this.Tg[e]};Element.prototype.setAttribute=function(e,f){this.Tg[e]=f};function yb(){this.ca=this.ea=0;this.Ae=new Fa;this.u=new Fa;this.v=new Fa;this.sd=new Fa}z=yb.prototype;z.clear=function(){this.Ae.clear();this.u.clear();this.v.clear();this.sd.clear()};z.gk=function(){this.u.clear();this.sd.clear()};
z.ah=function(e,f){void 0===f&&(f=null);var g=new Node,h=f;void 0!==e&&(g._id=e);void 0!==this&&(g.Zd=this);void 0!==h&&null!==h&&(g.rd=h);null==g&&console.warn("Error : node undefined or null in Graph");g.Zd!==this&&console.warn("Error : node with id ",g," must belong to this in graph");h=this.Ae.get(g.ta());null!=h&&h!==g?console.warn("Error : node with id ",g.ta()," already exists in graph"):(this.Ae.set(g.ta(),g),this.v.bd(g.rd)||this.v.set(g.rd,g));return g};
z.Sf=function(e){var f;do f=this.ea++;while(null!=this.Ae.get(f));return this.ah(f,e)};z.values=function(){var e=[],f=!0,g=!1,h=void 0;try{for(var k=this.Ae.values()[Symbol.iterator](),m;!(f=(m=k.next()).done);f=!0)e.push(m.value.rd)}catch(l){g=!0,h=l}finally{try{!f&&k["return"]&&k["return"]()}finally{if(g)throw h;}}return e};z.findNode=function(e){return this.v.get(e)};
z.$g=function(e,f,g){!0!==g&&(g=!1);var h;do h=this.ca++;while(null!=this.u.get(h));var k=g;!0!==k&&(k=!1);g=new Gd;void 0!==h&&(g._id=h);void 0!==this&&(g.Zd=this);this===e.Zd&&this===f.Zd||console.warn("Error : nodes ",g.Ic,", ",g.xc," and edge ",h," must all be part of same graph ",this);g.Ic=e;g.xc=f;!0!==k&&(k=!1);g.Mf=k;null===g&&console.warn("Error : edge is null in GRAPH");g.Zd!==this&&console.warn("Error : edge with id ",g," must belong to this in graph");e=this.u.get(g.ta());if(null!=e&&
e!==g)console.warn("Error : edge with id ",g.ta()," already exists in graph");else{this.u.set(g.ta(),g);e=[];e=e.concat(g.Ic);e=e.concat(g.xc);for(var m in e)f=this.sd.get(e[m]),null===f&&(f=[],this.sd.set(e[m],f)),f.push(g)}return g};z.Gl=function(e){!0!==e.wj&&(e=this.u.get(e));var f=e;if(f.wj?null!==f&&this.u.get(f.ta())===f:null==this.u.get(f))this.u.remove(e.ta()),f=this.sd.get(e.Ic),null!==f&&delete f[e],f=this.sd.get(e.xc),null!==f&&delete f[e]};
z.ed=function(){var e=[],f=!0,g=!1,h=void 0;try{for(var k=this.u.values()[Symbol.iterator](),m;!(f=(m=k.next()).done);f=!0)e.push(m.value)}catch(l){g=!0,h=l}finally{try{!f&&k["return"]&&k["return"]()}finally{if(g)throw h;}}return e};function Node(){Element.call(this);this.rd=null}Node.prototype=Object.create(Element.prototype);z=Node.prototype;z.constructor=Node;z.ed=function(){return this.Zd.sd.get(this)};
z.pj=function(e){a:{var f=this.ed();if(f)for(var g=f.length,h=0;h<g;h++)if(Hd(f[h],this)===e){e=h;break a}e=void 0}return void 0!==e};z.Qk=function(e){a:{var f=this.ed();if(f)for(var g=f.length,h=0;h<g;h++){var k=f[h];if(k.Mf&&k.Ic===e&&k.Kd()===this){e=k;break a}}e=void 0}return void 0!==e};z.toString=function(){return this.ta()};z.Fb=function(){return this.ta()};z.Ik=function(e){var f=this.ed();if(f)for(var g=f.length,h=0;h<g;h++){var k=f[h];if(k.Mf&&k.Ic==this&&k.Kd()==e)return k}};
function ob(e,f){this.u=Array(8);this.u[0]=new THREE.Vector3(e.x,e.y,e.z);this.u[1]=new THREE.Vector3(f.x,e.y,e.z);this.u[2]=new THREE.Vector3(e.x,f.y,e.z);this.u[3]=new THREE.Vector3(e.x,e.y,f.z);this.u[4]=new THREE.Vector3(f.x,f.y,e.z);this.u[5]=new THREE.Vector3(f.x,e.y,f.z);this.u[6]=new THREE.Vector3(e.x,f.y,f.z);this.u[7]=new THREE.Vector3(f.x,f.y,f.z)}z=ob.prototype;z.applyMatrix4=function(e){for(var f=this.u.length,g=0;g<f;g++)this.u[g].applyMatrix4(e);return this};
z.Ue=function(){for(var e=this.u[0].clone(),f=this.u.length,g=1;g<f;g++)e.min(this.u[g].clone());return e};z.Qe=function(){for(var e=this.u[0].clone(),f=this.u.length,g=1;g<f;g++)e.max(this.u[g].clone());return e};function Id(e){var f=e.Ue();e=e.Qe();return f.add(e).multiplyScalar(.5)}z.length=function(){return Jd(this).length()};function Jd(e){var f=e.Ue();return e.Qe().sub(f)}z.merge=function(e){var f=this.Ue(),g=this.Qe();f.min(e.Ue());g.max(e.Qe());return new ob(f,g)};
z.clone=function(){return new ob(this.Ue(),this.Qe())};function Kd(e){this.u=new Fa;for(var f=e.length,g=0;g<f;g++){var h=e[g];this.u.set(h.getName(),h)}}Kd.prototype.ee=function(e){return this.u.get(e)};function vc(e,f){this.ea=e;this.u=f;this.v=this.ca=null}function Ld(e,f){e.u=f;e.ca=null;e.v=null}vc.prototype.getName=function(){return this.ea};function Md(e,f){if(null!==e.u&&(null===e.v&&Nd(e),null!==e.v))return e.v[f];throw Error("Can't find index ",f," in sequence");}
vc.prototype.ka=function(){if(null!==this.u&&(null===this.ca&&Nd(this),null!==this.ca))return this.ca[0];throw Error("Can't find index ",0," in sequence");};function Nd(e){if(null!==e.u){var f=e.u.length;e.ca=Array(f);var g=0;e.v=Array(f);for(var h=0;h<f;h++){var k=e.u.charAt(h);"A"<=k&&"Z">=k||"a"<=k&&"z">=k?(e.ca[g]=h,e.v[h]=g,g++):e.v[h]=-1}e.ca=e.ca.slice(0,g)}else e.v=null}function uc(e){e?this.v=e:this.v=Od;this.u=null;this.ea=this.ka=NaN}
var Qd=new Pd("ABCDEFGHIKLMNPQRSTVWXYZ",[[24,0,5,-3,0,-23,5,-8,-8,-4,-12,-7,-3,3,-2,-6,11,6,1,-36,0,-22,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[5,0,115,-32,-30,-8,-20,-13,-11,-28,-15,-9,-18,-31,-24,-22,1,-5,0,-10,0,-5,0],[-3,0,-32,47,27,-45,1,4,-38,5,-40,-30,22,-7,9,-3,5,0,-29,-52,0,-28,0],[0,0,-30,27,36,-39,-8,4,-27,12,-28,-20,9,-5,17,4,2,-1,-19,-43,0,-27,0],[-23,0,-8,-45,-39,70,-52,-1,10,-33,20,16,-31,-38,-26,-32,-28,-22,1,36,0,51,0],[5,0,-20,1,-8,-52,66,-14,-45,-11,-44,-35,4,-16,-10,
-10,4,-11,-33,-40,0,-40,0],[-8,0,-13,4,4,-1,-14,60,-22,6,-19,-13,12,-11,12,6,-2,-3,-20,-8,0,22,0],[-8,0,-11,-38,-27,10,-45,-22,40,-21,28,25,-28,-26,-19,-24,-18,-6,31,-18,0,-7,0],[-4,0,-28,5,12,-33,-11,6,-21,32,-21,-14,8,-6,15,27,1,1,-17,-35,0,-21,0],[-12,0,-15,-40,-28,20,-44,-19,28,-21,40,28,-30,-23,-16,-22,-21,-13,18,-7,0,0,0],[-7,0,-9,-30,-20,16,-35,-13,25,-14,28,43,-22,-24,-10,-17,-14,-6,16,-10,0,-2,0],[-3,0,-18,22,9,-31,4,12,-28,8,-30,-22,38,-9,7,3,9,5,-22,-36,0,-14,0],[3,0,-31,-7,-5,-38,-16,
-11,-26,-6,-23,-24,-9,76,-2,-9,4,1,-18,-50,0,-31,0],[-2,0,-24,9,17,-26,-10,12,-19,15,-16,-10,7,-2,27,15,2,0,-15,-27,0,-17,0],[-6,0,-22,-3,4,-32,-10,6,-24,27,-22,-17,3,-9,15,47,-2,-2,-20,-16,0,-18,0],[11,0,1,5,2,-28,4,-2,-18,1,-21,-14,9,4,2,-2,22,15,-10,-33,0,-19,0],[6,0,-5,0,-1,-22,-11,-3,-6,1,-13,-6,5,1,0,-2,15,25,0,-35,0,-19,0],[1,0,0,-29,-19,1,-33,-20,31,-17,18,16,-22,-18,-15,-20,-10,0,34,-26,0,-11,0],[-36,0,-10,-52,-43,36,-40,-8,-18,-35,-7,-10,-36,-50,-27,-16,-33,-35,-26,142,0,41,0],[0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-22,0,-5,-28,-27,51,-40,22,-7,-21,0,-2,-14,-31,-17,-18,-19,-19,-11,41,0,78,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]),Rd=new Pd("ARNBDCQZEGHILKMFPSTWYVX*",[[1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,
-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,
-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,
-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,
-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,
-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,0,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,
-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,0]]),Od=Qd;
uc.prototype.align=function(e){if(0===e.length)return new Kd;for(var f=e.length,g=0;g<f;g++){var h=e[g];Ld(h,h.u.toUpperCase())}if(2===e.length){var f=e[0].u,g=e[1].u,k=this.v.clone(),h=0;this.v===Od?h=10:this.v===Rd&&(h=100);for(var m=h,l=k.pb.length,q=0;q<l;q++)for(var r=k.pb[q].length,t=0;t<r;t++)k.pb[q][t]*=m;k=this.u=k;m=k.pb.length-1;l=0;q=k.pb.length;for(r=0;r<q;r++)for(t=0;t<=r;t++)r!==t&&(l+=k.pb[r][t]);this.ka=0>=-(l/((m*m-m)/2))?2*(10+Math.log(Math.min(f.length,g.length)))*h:2*(10+Math.log(Math.min(f.length,
g.length)));this.ea=.1*h;var h=f.length,k=g.length,w=this.ca(2,k),m=this.ca(h,k),x=[k];x.fill(0);for(var B=Number.MIN_VALUE,q=l=-1,r=0;r<h;r++){for(t=0;t<k;t++)if(0===r||0===t)w[1][t]=this.u.getValue(f.charAt(r),g.charAt(t)),0===r&&0!==t&&(w[1][t]-=Sd(this,r,h,2===x[t-1]),x[t]=2),0===t&&0!==r&&(w[1][t]-=Sd(this,t,k,1===x[t]),x[t]=1),m[r][t]=0;else{var C=w[0][t-1]+this.u.getValue(f.charAt(r),g.charAt(t)),G=w[1][t-1]-Sd(this,r,h,2===x[t-1]),I=w[0][t]-Sd(this,t,k,1===x[t]);w[1][t]=Math.max(Math.max(C,
G),I);if(w[1][t]===C)m[r][t]=1,x[t]=0;else if(w[1][t]===G)m[r][t]=3,x[t]=2;else if(w[1][t]===I)m[r][t]=2,x[t]=1;else throw"Error when filling traceback matrix";(r===h-1||t===k-1)&&w[1][t]>B&&(B=w[1][t],l=r,q=t)}t=w[0];w[0]=w[1];w[1]=t}x=w="";r=h-1;for(t=k-1;r>l&&0<=r;)w+=f.charAt(r),x+="-",r--;for(;t>q&&0<=t;)w+="-",x+=g.charAt(t),t--;for(;0<=r&&0<=t;)0<r&&3===m[r][t]?(w+="-",x+=g.charAt(t),t--):0<t&&2===m[r][t]?(w+=f.charAt(r),x+="-",r--):(w+=f.charAt(r),x+=g.charAt(t),r--,t--);for(;0<=r;)w+=f.charAt(r),
x+="-",r--;for(;0<=t;)w+="-",x+=g.charAt(t),t--;f=[w.split("").reverse().join(""),x.split("").reverse().join("")];Ld(e[0],f[0]);Ld(e[1],f[1]);e=new Kd(e)}else throw"Alignment must be computed with only 2 sequences, for advanced alignement, use Bioviz Java";return e};uc.prototype.ca=function(e){var f=Array(e||0),g=e;if(1<arguments.length)for(var h=Array.prototype.slice.call(arguments,1);g--;)f[e-1-g]=this.ca.apply(this,h);return f};function Sd(e,f,g,h){return 0===f||f===g-1?0:h?e.ea:e.ka}
function Pd(e,f){this.v=e;this.u=new Fa;this.pb=f}Pd.prototype.setValue=function(e){this.pb=e.slice(0)};Pd.prototype.getValue=function(e,f){return this.u.bd(e)&&this.u.bd(f)?this.pb[this.u.get(e)][this.u.get(f)]:0};Pd.prototype.clone=function(){var e=new Pd;e.setValue(this.pb);var f=this.v;e.v=f;for(var g=f.length,h=0;h<g;h++)e.u.set(f[h],h);return e};function Td(){this.ca=this.v=null;this.u=NaN}
Td.prototype.align=function(e,f){this.ca=this.v=null;this.u=NaN;if(e&&f)if(e!==f){var g=e.Od()?new uc:new uc(Rd),h=[];h.push(Ud("SRC:",e));h.push(Ud("DST:",f));this.v=g.align(h);var g=Vd(e,this.v.ee("SRC:"+e.toString())),h=Vd(f,this.v.ee("DST:"+f.toString())),k;if(null===g||null===h||g.length!==h.length)throw"Illegal argument exception";var m=[];k=[];for(var l=g.length,q=0;q<l;q++){var r=g[q],t=h[q];null!==r&&null!==t&&(m.push([r.x,r.y,r.z]),k.push([t.x,t.y,t.z]))}k=[m,k];m=k[0];k=k[1];if(3>g.length)console.error("Need at least 3 paired coordinates. Found only "+
g.length);else{k=numeric.transpose(k);k=numeric.dot(k,m);m=numeric.svd(k);k=[[1,0,0],[0,1,0],[0,0,Math.sign(numeric.det(k))]];k=numeric.dot(numeric.dot(m.V,k),numeric.transpose(m.U));m=new THREE.Matrix4;m.set(k[0][0],k[1][0],k[2][0],0,k[0][1],k[1][1],k[2][1],0,k[0][2],k[1][2],k[2][2],0,0,0,0,1);this.u=0;k=g.length;for(l=0;l<k;l++)r=g[l],q=h[l],null!==r&&null!==q&&(r=r.clone().applyMatrix4(m),q=q.clone(),this.u+=r.distanceToSquared(q));this.ca=m;this.u=Math.sqrt(this.u/g.length)}}else console.warn("Same src and dst molecule, resolving alignement"),
g=[],g.push(Ud("SRC:",e)),g.push(Ud("DST:",f)),this.v=new Kd(g),this.ca=new THREE.Matrix4,this.u=0;else console.error("Source ("+e+") or dest ("+f+") is not a polymer")};function Vd(e,f){for(var g=[],h=e.ga.slice(0),k=f.u,m=e.Ya(),l=e.Od()?"CA":"C4'",q=k.length,r=0;r<q;r++)if("-"!=k.charAt(r)){var t=h[Md(f,r)].nc(l);if(null!==t){var w=new THREE.Vector3;w.subVectors(t.pos,m);g.push(w)}else g.push(null)}else g.push(null);return g}
function Ud(e,f){return new vc((null!==e?e:"")+f.toString(),f.ee(!1))}function Tb(e,f,g){this.Wa=e;this.Va=f;this.Za=new THREE.Vector3((e.x+f.x)/2,(e.y+f.y)/2,(e.z+f.z)/2);this.Ha=null;this.Hc=g;void 0===g&&(this.Hc=32);this.pb=[]}z=Tb.prototype;
z.add=function(e){if(e.il){var f=e.Pf.pos;Wd(this,f)||console.warn("Error : "+f+" can't fit into [ "+this.Wa+" , "+this.Va+" ]");if(null==this.Ha){if(this.pb.push(e),this.pb.length>this.Hc){null!=this.Ha&&console.warn("Error : This octant was already split ");this.Ha=[];this.Ha.push(new Tb(new THREE.Vector3(this.Wa.x,this.Wa.y,this.Wa.z),new THREE.Vector3(this.Za.x,this.Za.y,this.Za.z),this.Hc));this.Ha.push(new Tb(new THREE.Vector3(this.Za.x,this.Wa.y,this.Wa.z),new THREE.Vector3(this.Va.x,this.Za.y,
this.Za.z),this.Hc));this.Ha.push(new Tb(new THREE.Vector3(this.Wa.x,this.Za.y,this.Wa.z),new THREE.Vector3(this.Za.x,this.Va.y,this.Za.z),this.Hc));this.Ha.push(new Tb(new THREE.Vector3(this.Za.x,this.Za.y,this.Wa.z),new THREE.Vector3(this.Va.x,this.Va.y,this.Za.z),this.Hc));this.Ha.push(new Tb(new THREE.Vector3(this.Wa.x,this.Wa.y,this.Za.z),new THREE.Vector3(this.Za.x,this.Za.y,this.Va.z),this.Hc));this.Ha.push(new Tb(new THREE.Vector3(this.Za.x,this.Wa.y,this.Za.z),new THREE.Vector3(this.Va.x,
this.Za.y,this.Va.z),this.Hc));this.Ha.push(new Tb(new THREE.Vector3(this.Wa.x,this.Za.y,this.Za.z),new THREE.Vector3(this.Za.x,this.Va.y,this.Va.z),this.Hc));this.Ha.push(new Tb(new THREE.Vector3(this.Za.x,this.Za.y,this.Za.z),new THREE.Vector3(this.Va.x,this.Va.y,this.Va.z),this.Hc));e=0;f=this.pb.length;a:for(;e<f;e++)for(var g=this.pb[e],h=g.Pf.pos,k=0,m=this.Ha.length;k<m;k++){var l=this.Ha[k];if(Wd(l,h)){l.add(g);continue a}}this.pb=[]}}else for(g=0,h=this.Ha.length;g<h;g++)if(k=this.Ha[g],
Wd(k,f)){k.add(e);break}}else if(0<e.length)for(g=0,h=e.length;g<h;g++)this.add(e[g])};z.optimize=function(){if(null!=this.Ha){for(var e=0,f=0,g=this.Ha.length;f<g;f++){var h=this.Ha[f];h.optimize();h.isEmpty()&&null==h.Ha&&(this.Ha[f]=null,e++)}if(0!==e)if(e===this.Ha.length)this.Ha=[];else for(e=this.Ha.slice(),this.Ha=[],f=0,g=e.length;f<g;f++)h=e[f],null!=h&&this.Ha.push(h)}};z.isEmpty=function(){return 0===this.pb.length};
function Wd(e,f){return f.x>=e.Wa.x&&f.y>=e.Wa.y&&f.z>=e.Wa.z&&f.x<=e.Va.x&&f.y<=e.Va.y&&f.z<=e.Va.z}
z.$f=function(e,f,g){g=g||[];var h;if(h=!Wd(this,e)){var k=h=0,m=0;e.x<this.Wa.x?h=e.x-this.Wa.x:e.x>this.Va.x&&(h=e.x-this.Va.x);e.y<this.Wa.y?k=e.y-this.Wa.y:e.y>this.Va.y&&(k=e.y-this.Va.y);e.z<this.Wa.z?m=e.z-this.Wa.z:e.z>this.Va.z&&(m=e.z-this.Va.z);h=!(0<f*f-(h*h+k*k+m*m))}if(h)return g;if(null!=this.Ha)for(h=0,k=this.Ha.length;h<k;h++)this.Ha[h].$f(e,f,g);else for(h=0,k=this.pb.length;h<k;h++)m=this.pb[h],m.getPoint().distanceToSquared(e)<=f*f&&g.push(m);return g};
z.trace=function(){var e=0;void 0===e&&(e=0);for(var f=0;f<e;f++)console.log(f==e-1?"\u2514-":"  ");console.log(this.toString()+": "+this.pb.length);if(null!=this.Ha){e++;for(var g in this.Ha)this.Ha[g].trace(e)}};z.toString=function(){return"[("+this.Wa.x+","+this.Wa.y+","+this.Wa.z+"),("+this.Va.x+","+this.Va.y+","+this.Va.z+")]"};function gc(e){this.il=!0;this.Pf=e}gc.prototype.getPoint=function(){return this.Pf};gc.prototype.toString=function(){return this.Pf.toString()};
function Xd(e,f,g,h){this.ia=null;this.he=f;this.lm=e;this.km=g;this.hl=null!=h?h:!1;this.Ig=new Worker("webworker.js");this.blob=null}Xd.prototype.load=function(){var e=this;return new Promise(function(f,g){e.Ig.onmessage=function(h){h.Tf=e.km;if(h.data instanceof Blob)e.blob=h.data;else{var k=JSON.parse(h.data);k.ml?(k.__proto__=ed.prototype,e.ia=k,e.ia.blob=e.blob):"error"===k.type?g(Error(k.msg)):(e.ia.qk(k),null!=h.Tf&&e.ia.qc(h.Tf),e.Ig.terminate(),f(e.ia))}};e.Ig.postMessage([e.lm,e.he,e.hl])})};
function Yd(e,f){this.hb=f;this.renderer=e;this.Sd=new THREE.WebGLRenderTarget(this.hb.width(),this.hb.height(),{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat});this.Sd.depthTexture=new THREE.DepthTexture;this.Sd.texture.generateMipmaps=!1;this.Sd.stencilBuffer=!1;this.Yd=new THREE.WebGLRenderTarget(this.hb.width(),this.hb.height(),{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat});this.Yd.depthTexture=new THREE.DepthTexture;
this.Yd.texture.generateMipmaps=!1;this.Yd.stencilBuffer=!1;kd.Yc.bind(this.Sd,this.hb);kd.Yc.bind(this.Yd,this.hb);this.kh=new THREE.ShaderMaterial({uniforms:{tOpaque:{type:"t",value:this.Sd.texture},tTransparent:{type:"t",value:this.Yd.texture},tOpaqueDepth:{type:"t",value:this.Sd.depthTexture},tTransparentDepth:{type:"t",value:this.Yd.depthTexture},cameraNear:{type:"f",value:null},cameraFar:{type:"f",value:null}},vertexShader:THREE.ShaderChunk.transparencyQuad_vert,fragmentShader:THREE.ShaderChunk.transparencyQuad_frag});
this.El=new THREE.OrthographicCamera(-1,1,1,-1,0,1);this.Ej=new THREE.Scene;this.Ej.add(new THREE.Mesh(new THREE.PlaneGeometry(2,2),this.kh))}
Yd.prototype.render=function(e,f){this.renderer.clearTarget(this.Sd);this.renderer.clearTarget(this.Yd);var g=new Map;e.traverse(function(e){e.material&&(g.set(e.id,e.visible),e.material.transparent&&(e.visible=!1))});this.renderer.render(e,f,this.Sd);e.traverse(function(e){e.material&&(e.material.transparent||(e.visible=!1),e.material.transparent&&(e.visible=g.get(e.id)))});this.renderer.render(e,f,this.Yd);e.traverse(function(e){e.material&&!e.material.transparent&&(e.visible=g.get(e.id))});this.kh.uniforms.cameraNear.value=
f.near;this.kh.uniforms.cameraFar.value=f.far;this.renderer.render(this.Ej,this.El)};function Zd(e,f,g,h){var k=1;void 0!==h&&(k=h);var m=e.dd();h=e.wb().length()/2;var l=new THREE.Matrix4;l.copy(e.matrixWorld);e=new THREE.Matrix4;e.makeTranslation(m.x,m.y,m.z);l.multiply(e);e=new THREE.Matrix4;e.makeTranslation(-l.elements[12],-l.elements[13],-l.elements[14]);e.multiply(f.scene.matrix);e.elements[14]=g?e.elements[14]-(1/k*h*2-f.camera.position.z):f.scene.matrix.elements[14];return e}
function $d(e,f){var g=new THREE.Vector4(e.x,e.y,e.z,1),h=new THREE.Vector4(f.normal.x,f.normal.y,f.normal.z,f.constant);return g.dot(h)}
function ae(e,f,g,h){if(0===f.length)return null;var k=new THREE.Raycaster;k.linePrecision=.2;k.params.Points.threshold=2.75;var m=e.Ph,l=e.rh;g=new THREE.Vector2(g,h);k.setFromCamera(g,e.camera);f=k.intersectObjects(f);if(g=f.length){e=null;h=Infinity;for(var q=0;q<g;q++){var r=f[q],t=r.object,w=r.distance,x=t.geometry,B=null!=r.index?r.index:r.face.a;if(t instanceof THREE.Points){var w=x.attributes.radius.array[B],C=x.attributes.position.array,G=new THREE.Vector3;G.fromArray(C,3*B);x=x.attributes.dir;
C=new THREE.Vector3;x&&C.fromArray(x.array,3*B);if(0===C.length())B=new THREE.Sphere(G,w),B.applyMatrix4(t.matrixWorld),t=k.ray.intersectSphere(B);else{B=new THREE.Lg(G,C,w);B.applyMatrix4(t.matrixWorld);t=k.ray;w=B;x=t.origin;G=t.direction;G.normalize();C=w.radius;B=w.Ad;t=w.direction.length();w=w.direction.clone();w.normalize();var I=(new THREE.Vector3).crossVectors(G,w);if(1E-4>=I.length())console.warn("May need to resolve equation when cylinder direction and ray direction colinear"),t=null;else{var D=
I.clone().normalize(),J=(new THREE.Vector3).subVectors(x,B),F=Math.abs(J.dot(D));F>C?t=null:(I=-J.clone().cross(w).dot(D)/I.length(),D=(new THREE.Vector3).crossVectors(D,w),D.normalize(),F=Math.abs(Math.sqrt(C*C-F*F)/G.dot(D)),C=I-F,F=I+F,C>F&&(I=C,C=F,F=I),C=(new THREE.Vector3).addVectors(x,G.clone().multiplyScalar(C)),x=(new THREE.Vector3).addVectors(x,G.clone().multiplyScalar(F)),G=(new THREE.Vector3).subVectors(C,B).dot(w),B=(new THREE.Vector3).subVectors(x,B).dot(w),t=G<=t&&0<=G?C:B<=t&&0<=B?
x:null)}}!t||0>$d(t,m)||0>$d(t,l)||(t=t.distanceTo(k.ray.origin),t<h&&(e=r,h=t))}else!(0>$d(r.point,m)||0>$d(r.point,l))&&w<h&&(e=r,h=w)}if(e){k=e.object;x=k.geometry;if(x instanceof THREE.Geometry)return x.vertices[e.face.a].qa;if(x instanceof THREE.BufferGeometry)return k.Ja.ja[x.attributes.atomIndex.array[null!=e.index?e.index:e.face.a]];console.warn("Unknown type of geometry for raycasting real object")}}return null}
function md(e,f){var g=NaN,h=Zd(e,e,!0),k=e.wb().clone(),g=Jd(k).length(),h=Id(k.applyMatrix4(h)),h=Math.abs(f.position.z-h.z)+.5*g,g=Math.max(Math.qh(2*Math.atan(g/(2*h))),Math.qh(2*Math.atan(Math.tan(2*Math.atan(g/(2*h))/2)/f.aspect)));isNaN(g)&&(g=Math.qh(2*Math.atan(Math.tan(Math.Fl()/2)*f.aspect)));return g}
function be(e,f){var g=new THREE.SpriteMaterial({map:e});g.depthTest=!1;g.depthWrite=!1;var h=g.map.image.width,k=g.map.image.height,g=new THREE.Sprite(g);g.position.set(f.x,f.y,f.z);g.scale.set(h/40,k/40,1);return g}function ce(e){this.geometry=new THREE.BufferGeometry;this.uc=[];this.lf=e?[]:null;this.Vg=[];this.Yg=[];this.Zc=[];this.ye=null;this.Zg=new Map}
function de(e,f,g,h,k,m){e.uc.push(f,g,h);f=null!=k?k:new THREE.Color(1,1,1);e.Vg.push(f.r,f.g,f.b);m=null!=m?m:new THREE.Vector2(0,1);e.Yg.push(m.x,m.y)}function ee(e,f,g,h){null!=e.lf?e.lf.push(f,g,h):console.warn("This BufferGeometry is not indexed")}ce.prototype.gd=function(){this.ye=Array(this.uc.length/3);this.ye.fill(0);return this.ye};
THREE.BufferGeometry.prototype.gd=function(){var e=Array(this.attributes.position.count);e.fill(0);e=new Float32Array(e);this.addAttribute("highlight",new THREE.BufferAttribute(e,1))};
function fe(e){null==e.ye&&e.gd();e.geometry.addAttribute("position",THREE.Float32Attribute(e.uc,3));e.uc=void 0;null!=e.lf&&(e.geometry.setIndex(THREE.Uint32Attribute(e.lf,1)),e.lf=void 0);var f=THREE.Float32Attribute(e.Vg,3);f.dynamic=!0;e.geometry.addAttribute("color",f);e.Vg=void 0;e.geometry.addAttribute("highlight",THREE.Float32Attribute(e.ye,1));e.ye=void 0;e.geometry.addAttribute("uv",THREE.Float32Attribute(e.Yg,2));e.Yg=void 0;e.geometry.addAttribute("atomIndex",THREE.Float32Attribute(e.Zc,
1));e.Zc=void 0;e.geometry.computeVertexNormals();e.geometry.normalizeNormals();return e.geometry}THREE.Lg=function(e,f,g){this.Ad=void 0!==e?e:new THREE.Vector3;this.direction=void 0!==f?f:new THREE.Vector3;this.radius=void 0!==g?g:0};
THREE.Lg.prototype={constructor:THREE.Lg,set:function(e,f,g){this.Ad.copy(e);this.direction.copy(f);this.radius=g;return this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.Ad.copy(e.Ad);this.direction.copy(e.direction);this.radius=e.radius;return this},empty:function(){return 0>=this.radius||0===this.direction.length()},containsPoint:function(){console.error("THREE.Cylinder.containsPoint not implemented yet")},distanceToPoint:function(){console.error("THREE.Cylinder.distanceToPoint not implemented yet")},
clampPoint:function(){console.error("THREE.Cylinder.clampPoint not implemented yet")},applyMatrix4:function(e){this.Ad.applyMatrix4(e);var f=(new THREE.Matrix4).extractRotation(e);this.direction.applyMatrix4(f);this.radius=this.radius*e.getMaxScaleOnAxis();return this},translate:function(e){this.Ad.add(e);return this},equals:function(e){return e.Ad.equals(this.Ad)&&e.radius===this.radius&&e.direction.equals(this.direction)}};
function ge(e){null===e.boundingSphere&&(e.boundingSphere=new THREE.Sphere);var f=new THREE.Box3,g=new THREE.Vector3,h=e.attributes.position;if(h){var h=h.array,k=e.attributes.radius.array,m=e.boundingSphere.center;f.setFromArray(h);f.center(m);for(var l=f=0,q=h.length;l<q;l+=3)g.fromArray(h,l),f=Math.max(f,m.distanceTo(g)+k[l/3]);e.boundingSphere.radius=f;isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',
e)}}Math.Fl=function(){return 22.5*Math.PI/180};Math.qh=function(e){return 180*e/Math.PI};THREE.Vector3.prototype.Fb=function(){return this.x+":"+this.y+":"+this.z};function he(e,f){var g=new THREE.Vector3;g.x=f.x*e.elements[0];g.y=f.x*e.elements[1];g.z=f.x*e.elements[2];g.x+=f.y*e.elements[4];g.y+=f.y*e.elements[5];g.z+=f.y*e.elements[6];g.x+=f.z*e.elements[8];g.y+=f.z*e.elements[9];g.z+=f.z*e.elements[10];return g}
function ie(e,f,g,h,k){var m=Math.sqrt(g*g+h*h+k*k);0==m&&(m=.01);g/=m;h/=m;k/=m;m=Math.sin(f);f=Math.cos(f);var l=1-f;e.elements[0]=l*g*g+f;e.elements[4]=l*g*h-m*k;e.elements[8]=l*g*k+m*h;e.elements[1]=l*h*g+m*k;e.elements[5]=l*h*h+f;e.elements[9]=l*h*k-m*g;e.elements[2]=l*k*g-m*h;e.elements[6]=l*k*h+m*g;e.elements[10]=l*k*k+f;e.elements[3]=0;e.elements[7]=0;e.elements[11]=0;e.elements[12]=0;e.elements[13]=0;e.elements[14]=0;e.elements[15]=1}
THREE.Matrix4.prototype.lerp=function(e,f,g){var h=new THREE.Matrix4;h.copy(e);h.elements[12]=e.elements[12]+g*(f.elements[12]-e.elements[12]);h.elements[13]=e.elements[13]+g*(f.elements[13]-e.elements[13]);h.elements[14]=e.elements[14]+g*(f.elements[14]-e.elements[14]);this.copy(h)};
THREE.Matrix4.prototype.slerp=function(e,f,g){var h=je(e),h=e.normalize(h);e=je(f);e=f.normalize(e);var k=h[0]*e[0]+h[1]*e[1]+h[2]*e[2]+h[3]*e[3];0>k&&(e[0]=-e[0],e[1]=-e[1],e[2]=-e[2],e[3]=-e[3],k=-k);f=1-g;var m=g;.1<1-k&&(m=Math.acos(k),k=1/Math.sin(m),f=Math.sin((1-g)*m)*k,m=Math.sin(g*m)*k);g=[];g.push(f*h[0]+m*e[0]);g.push(f*h[1]+m*e[1]);g.push(f*h[2]+m*e[2]);g.push(f*h[3]+m*e[3]);this.setFromQuaternion(g)};
function je(e){var f=e.elements[0]+e.elements[5]+e.elements[10],g,h,k;if(0<=f){var m=Math.sqrt(f+1);k=.5*m;m=.5/m;f=(e.elements[9]-e.elements[6])*m;g=(e.elements[2]-e.elements[8])*m;h=(e.elements[4]-e.elements[1])*m}else e.elements[0]>e.elements[5]&&e.elements[0]>e.elements[10]?(m=Math.sqrt(1+e.elements[0]-e.elements[5]-e.elements[10]),f=.5*m,m=.5/m,g=(e.elements[4]+e.elements[1])*m,h=(e.elements[2]+e.elements[8])*m,k=(e.elements[9]-e.elements[6])*m):e.elements[5]>e.elements[10]?(m=Math.sqrt(1+e.elements[5]-
e.elements[0]-e.elements[10]),g=.5*m,m=.5/m,f=(e.elements[4]+e.elements[1])*m,h=(e.elements[9]+e.elements[6])*m,k=(e.elements[2]-e.elements[8])*m):(m=Math.sqrt(1+e.elements[10]-e.elements[0]-e.elements[5]),h=.5*m,m=.5/m,f=(e.elements[2]+e.elements[8])*m,g=(e.elements[9]+e.elements[6])*m,k=(e.elements[4]-e.elements[1])*m);return[f,g,h,k]}
THREE.Matrix4.prototype.setFromQuaternion=function(e){this.setPosition(new THREE.Vector3(0,0,0));var f=ke(e),f=1==f?2:0<f?2/f:0,g=e[0]*f,h=e[1]*f,k=e[2]*f,f=e[0]*g,m=e[0]*h,l=e[0]*k,g=e[3]*g,q=e[1]*h,r=e[1]*k,h=e[3]*h,t=e[2]*k;e=e[3]*k;this.elements[0]=1-(q+t);this.elements[1]=m-e;this.elements[2]=l+h;this.elements[4]=m+e;this.elements[5]=1-(f+t);this.elements[6]=r-g;this.elements[8]=l-h;this.elements[9]=r+g;this.elements[10]=1-(f+q)};
function ke(e){return e[3]*e[3]+e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}THREE.Matrix4.prototype.normalize=function(e){var f=1/Math.sqrt(ke(e));e[0]*=f;e[1]*=f;e[2]*=f;e[3]*=f;return e};THREE.Vector3.prototype.rb=function(e,f){return new THREE.Vector3(this.x+e.x*f,this.y+e.y*f,this.z+e.z*f)};
THREE.Vector3.u=function(e,f,g){if(e.Fh&&f.Fh&&g.Fh){var h=new THREE.Vector3(f.x,f.y,f.z);h.sub(new THREE.Vector3(e.x,e.y,e.z));h.cross((new THREE.Vector3(g.x,g.y,g.z)).sub(new THREE.Vector3(f.x,f.y,f.z)))}else h=new THREE.Vector3,h.copy(f),h.sub(e),h.cross(g.clone().sub(f));return h};
THREE.Vector3.ca=function(e,f,g,h,k){var m=k*k,l=m*k;if(null===e||null===f||null===g||null===h)return null;var q=null,r=null,q=f.clone().sub(e).add(g.clone().sub(f)).multiplyScalar(.5),r=g.clone().sub(f).add(h.clone().sub(g)).multiplyScalar(.5);e=2*l-3*m+1;k=l-2*m+k;h=l-m;m=-2*l+3*m;return f.clone().multiplyScalar(e).rb(q,k).rb(r,h).rb(g,m)};THREE.Vector3.Cc=function(e,f,g){return null===e|null===f?new THREE.Vector3:e.clone().multiplyScalar(1-g).rb(f,g)};
function le(e,f,g){return Math.atan2(e.clone().dot(g),e.clone().dot(f))}THREE.Vector3.v=function(e,f,g){return e.clone().multiplyScalar(Math.cos(g)).rb(f,Math.sin(g))};function me(e){var f=Math.abs(e.x),g=Math.abs(e.y),h=Math.abs(e.z);return f<=g&&f<=h?e.clone().cross(new THREE.Vector3(1,0,0)).normalize():g<=f&&g<=h?e.clone().cross(new THREE.Vector3(0,1,0)).normalize():e.clone().cross(new THREE.Vector3(0,0,1)).normalize()}
function ne(e,f,g,h){var k=me(e);e=e.clone().cross(k).normalize();var m=f.length(),l=g.length();f=le(f,k,e);g=le(g,k,e);Math.abs(f-g)>Math.PI&&(g<f?g+=2*Math.PI:f+=2*Math.PI);g=THREE.Math.Cc(f,g,h);h=THREE.Math.Cc(m,l,h);return THREE.Vector3.v(k,e,g).multiplyScalar(h)}THREE.Color.Cc=function(e,f,g){return null===e|null===f?null:e.clone().multiplyScalar(1-g).rb(f,g)};THREE.Color.prototype.rb=function(e,f){return new THREE.Color(this.r+e.r*f,this.g+e.g*f,this.b+e.b*f)};
THREE.Math.Cc=function(e,f,g){return e*(1-g)+f*g};THREE.GeometryUtils.vk=function(e,f,g,h,k,m,l,q,r,t,w,x,B,C,G,I){var D=k*f-e*m,J=r*f-e*t;e=B*f-e*C;f=r*m-k*t;k=B*m-k*C;r=B*t-r*C;return(r*l-k*w+f*G)*h-(r*g-e*w+J*G)*q+(k*g-e*l+D*G)*x-(f*g-J*l+D*w)*I};THREE.GeometryUtils.cm=function(e,f,g,h){return THREE.GeometryUtils.dm(e.x,e.y,e.z,e.weight,f.x,f.y,f.z,f.weight,g.x,g.y,g.z,g.weight,h.x,h.y,h.z,h.weight)};THREE.GeometryUtils.tf=function(e,f,g,h,k,m,l,q,r){return(e*k-h*f)*r-(e*q-l*f)*m+(h*q-l*k)*g};
THREE.GeometryUtils.cd=function(e,f,g,h){return e*h-g*f};
THREE.GeometryUtils.dm=function(e,f,g,h,k,m,l,q,r,t,w,x,B,C,G,I){k=k-e;m=m-f;l=l-g;q=THREE.GeometryUtils.Fa(k)+THREE.GeometryUtils.Fa(m)+THREE.GeometryUtils.Fa(l)-q+h;r=r-e;t=t-f;w=w-g;x=THREE.GeometryUtils.Fa(r)+THREE.GeometryUtils.Fa(t)+THREE.GeometryUtils.Fa(w)-x+h;e=B-e;f=C-f;g=G-g;C=THREE.GeometryUtils.Fa(e)+THREE.GeometryUtils.Fa(f)+THREE.GeometryUtils.Fa(g)-I+h;I=THREE.GeometryUtils.tf(m,l,q,t,w,x,f,g,C);G=THREE.GeometryUtils.tf(k,l,q,r,w,x,e,g,C);q=THREE.GeometryUtils.tf(k,m,q,r,t,x,e,f,C);
k=THREE.GeometryUtils.tf(k,m,l,r,t,w,e,f,g);if(0===k)throw"den==0 in squared_radius_orthogonal_sphereC3_detailedParams";return(THREE.GeometryUtils.Fa(I)+THREE.GeometryUtils.Fa(G)+THREE.GeometryUtils.Fa(q))*THREE.GeometryUtils.Fa(.5/k)-h};THREE.GeometryUtils.Fa=function(e){return e*e};THREE.GeometryUtils.rj=function(e,f,g,h){return THREE.GeometryUtils.bl(e.x,e.y,e.z,e.weight,f.x,f.y,f.z,f.weight,g.x,g.y,g.z,g.weight,h.x,h.y,h.z,h.weight)};
THREE.GeometryUtils.bl=function(e,f,g,h,k,m,l,q,r,t,w,x,B,C,G,I){k=k-e;m=m-f;l=l-g;r=r-e;t=t-f;w=w-g;var D=THREE.GeometryUtils.Fa(k)+THREE.GeometryUtils.Fa(m)+THREE.GeometryUtils.Fa(l),J=THREE.GeometryUtils.Fa(r)+THREE.GeometryUtils.Fa(t)+THREE.GeometryUtils.Fa(w),F=k*r+m*t+l*w,K=D-q+h,N=J-x+h;x=THREE.GeometryUtils.cd(D,F,F,J);q=THREE.GeometryUtils.cd(K,F,N,J);D=THREE.GeometryUtils.cd(D,K,F,N);e=B-e;f=C-f;g=G-g;G=THREE.GeometryUtils.Fa(e)+THREE.GeometryUtils.Fa(f)+THREE.GeometryUtils.Fa(g);if(0==
x)throw"den==0 in in_sphere_detailedParams";return THREE.GeometryUtils.sign(x*(G-I+h)-q*(e*k+f*m+g*l)-D*(e*r+f*t+g*w))};THREE.GeometryUtils.sign=function(e){return 0<e?1:0>e?-1:0};
THREE.GeometryUtils.fm=function(e,f,g,h,k,m,l,q,r,t,w,x){k=k-e;m=m-f;l=l-g;q=THREE.GeometryUtils.Fa(k)+THREE.GeometryUtils.Fa(m)+THREE.GeometryUtils.Fa(l)-q+h;e=r-e;f=t-f;g=w-g;var B=THREE.GeometryUtils.Fa(e)+THREE.GeometryUtils.Fa(f)+THREE.GeometryUtils.Fa(g)-x+h;t=m*g-l*f;r=l*e-k*g;var C=k*f-m*e;x=q*THREE.GeometryUtils.cd(f,g,r,C)-B*THREE.GeometryUtils.cd(m,l,r,C);w=q*THREE.GeometryUtils.cd(e,g,t,C)-B*THREE.GeometryUtils.cd(k,l,t,C);q=q*THREE.GeometryUtils.cd(e,f,t,r)-B*THREE.GeometryUtils.cd(k,
m,t,r);k=THREE.GeometryUtils.tf(k,m,l,e,f,g,t,r,C);if(0==k)throw"den==0";return(THREE.GeometryUtils.Fa(x)+THREE.GeometryUtils.Fa(w)+THREE.GeometryUtils.Fa(q))*THREE.GeometryUtils.Fa(.5/k)-h};THREE.GeometryUtils.em=function(e,f,g){return THREE.GeometryUtils.fm(e.x,e.y,e.z,e.weight,f.x,f.y,f.z,f.weight,g.x,g.y,g.z,g.weight)};
function oe(e,f){this.ba=e;this.div=f;this.menu=null;this.ya=!1;this.$d();this.Ma=this.Ua=this.ea=this.u=this.ca=this.Oa=this.v=this.ka=null;this.Ee=this.Ie=!1;this.aa=this.ba.aa;this.scene3D=this.aa.scene3D;this.tb=""}oe.prototype.moveTo=function(e){this.menu.getMenu().detach().appendTo(e)};
oe.prototype.$d=function(){var e=this,f=pe(this),g=qe(this),h=re(this),k=se(this);te();var m=ue(this),l=ve(this),q=we(),r=xe(),t={title:"Move",cmd:"move"},w={title:"Reset&nbspposition",cmd:"resetPos"},x={title:"Center",cmd:"center"},B={title:"Zoom",cmd:"zoom"},C={title:"As&nbsprotation&nbspanchor",cmd:"anchor"},G={title:"Structure&nbspname",cmd:"labelStr"},I={title:"Molecule&nbspname",cmd:"labelMol"},D={title:"Residue&nbspname",cmd:"labelRes"},J={title:"Atom&nbspname",cmd:"labelAtom"},F={title:"vdW",
cmd:"labelVdw"},K={title:"Clear",cmd:"labelClear"},N={title:"Remove",cmd:"remove"},O=this.ba.li,O=O.split("${id}")[0];this.menu=this.div.contextmenu({delegate:".hasContextMenu",autoTrigger:!1,preventContextMenuForPopup:!0,menu:[{title:"File",children:[{title:"Load",cmd:"load",children:[{title:"Load&nbspURL",cmd:"loadUrl"},{title:"Load&nbspFrom&nbsp"+O,cmd:"loadPDB"},{title:"Load&nbspFrom&nbspLocal&nbspFile",cmd:"loadFile"},{title:"Load&nbspScript",cmd:"loadScript"},{title:"Load&nbspScript&nbspFile",
cmd:"loadScriptFile"}]},{title:"Options",cmd:"options"},{title:"Reset",cmd:"reset"}]},{title:"Model",cmd:"model",children:[{title:"Clear&nbsprotation&nbspanchor",cmd:"clearAnchor"},{title:"Manage&nbsprepresentations",cmd:"manageRep"}]},{title:"Tools",children:[{title:"Legend",cmd:"legend"},{title:"Stereoscopy",cmd:"stereo"},{title:"Anaglyph",cmd:"anaglyph"},{title:"Zoom",children:[{title:"25%",cmd:"zoom25"},{title:"50%",cmd:"zoom50"},{title:"100%",cmd:"zoom100"},{title:"200%",cmd:"zoom200"},{title:"400%",
cmd:"zoom400"}]},{title:"Spin",cmd:"spin"},{title:"Measurements",cmd:"measurements"}]},{title:"About",children:[{title:"Controls",cmd:"controls"},{title:"BiovizJS",cmd:"biovizJS"},{title:"System",cmd:"System"}]}],position:function(e){return{my:"left top",at:"left+"+e.extraData.pageX+" top+"+e.extraData.pageY,of:parent.$(document),collision:e.extraData.xj?"none":"fit"}},beforeOpen:function(f){e.ca=f.extraData.target;null!==e.ca?(f=e.ba.aa,e.Oa=e.ca.Aa(),e.v=e.Oa.xa,e.ka=e.v.Bc(),e.u=f.gb(e.ka.ta())[0],
e.ea=ye(f,e.ka.ta(),e.v.type,e.v.id)[0],e.div.contextmenu("setEntry","model",{title:"Model",cmd:"model",children:[{title:"Clear&nbsprotation&nbspanchor",cmd:"clearAnchor"},{title:"----"},{title:e.ka.toString(),cmd:"structure",children:[t,w,C,{title:"----"},x,B,{title:"----"},{title:"Labels",children:[G,I,D,J,F,{title:"----"},K]},{title:"----"},N]},{title:e.v.toString(),cmd:"molecule",children:[t,w,C,{title:"----"},x,B,{title:"----"},{title:"Labels",children:[I,D,J,F,{title:"----"},K]}]},{title:e.Oa.toString(),
cmd:"residue",children:[C,{title:"----"},x,B,{title:"----"},{title:"Labels",children:[D,J,F,{title:"----"},K]}]},{title:e.ca.toString(),cmd:"atom",children:[C,{title:"----"},x,B,{title:"----"},{title:"Labels",children:[J,F,{title:"----"},K]}]},{title:"----"},{title:"Manage&nbsprepresentations",cmd:"manageRep"}]})):e.div.contextmenu("setEntry","model",{title:"Model",cmd:"model",children:[{title:"Clear&nbsprotation&nbspanchor",cmd:"clearAnchor"},{title:"Manage&nbsprepresentations",cmd:"manageRep"}]})},
select:function(t,w){t.stopPropagation();switch(w.cmd){case "loadUrl":e.ya=!0;f.dialog("open");break;case "loadPDB":e.ya=!1;f.dialog("open");break;case "loadFile":g.dialog("open");break;case "loadScript":h.dialog("open");break;case "loadScriptFile":k.dialog("open");break;case "reset":e.scene3D.reset();break;case "options":m.dialog("open");break;case "legend":ze(e.ba.If,"Legend");break;case "stereo":e.Ie=!e.Ie;e.Ee=e.aa.Ie(e.Ie);break;case "anaglyph":e.Ee=!e.Ee;e.Ie=e.aa.Ee(e.Ee);break;case "zoom25":case "zoom50":case "zoom100":case "zoom200":case "zoom400":var x=
w.cmd.split("zoom").pop()/100,B=e.aa;B.v=x;Ae(B,null!=B.Sa?B.Sa:B.scene3D,!0);break;case "spin":null===e.aa.ne?e.aa.Dg():e.aa.Ef();break;case "measurements":ze(e.ba.If,"MeasureWidget");break;case "controls":l.dialog("open");break;case "biovizJS":r.dialog("open");break;case "System":q.dialog("open");break;case "move":B=w.item.context.parentElement.parentElement.dataset.command;switch(B){case "structure":e.aa.eb=e.u;e.scene3D.aa.Sa=e.u;break;case "molecule":e.aa.eb=e.ea;e.scene3D.aa.Sa=e.ea;break;default:throw Error("Parent command type "+
B+" is not handled");}break;case "resetPos":B=w.item.context.parentElement.parentElement.dataset.command;switch(B){case "structure":e.u.le();break;case "molecule":e.ea.le();break;default:throw Error("Parent command type "+B+" is not handled");}break;case "clearAnchor":e.scene3D.aa.Sa=null;break;case "anchor":B=w.item.context.parentElement.parentElement.dataset.command;switch(B){case "structure":e.scene3D.aa.Sa=e.u;break;case "molecule":e.scene3D.aa.Sa=e.ea;break;case "residue":Be(e);e.scene3D.aa.Sa=
e.Ua;break;case "atom":Ce(e);e.scene3D.aa.Sa=e.Ma;break;default:throw Error("Parent command type "+B+" is not handled");}break;case "center":B=w.item.context.parentElement.parentElement.dataset.command;switch(B){case "structure":Ae(e.aa,e.u);break;case "molecule":Ae(e.aa,e.ea);break;case "residue":Be(e);Ae(e.aa,e.Ua);break;case "atom":Ce(e);Ae(e.aa,e.Ma);break;default:throw Error("Parent command type "+B+" is not handled");}break;case "zoom":B=w.item.context.parentElement.parentElement.dataset.command;
switch(B){case "structure":De(e.aa.scene3D,e.u);break;case "molecule":De(e.aa.scene3D,e.ea);break;case "residue":Be(e);De(e.aa.scene3D,e.Ua);break;case "atom":Ce(e);De(e.aa.scene3D,e.Ma);break;default:throw Error("Parent command type "+B+" is not handled");}break;case "remove":Ee(e.aa,e.u);break;case "labelStr":B=w.item.context.parentElement.parentElement.parentElement.parentElement.dataset.command;Fe(e,B);var C;"structure"===B&&(C=e.ka);e.u.cc(C,M.u.Qg);break;case "labelMol":B=w.item.context.parentElement.parentElement.parentElement.parentElement.dataset.command;
Fe(e,B);"molecule"===B&&(C=e.v);e.u.cc(C,M.u.sc);break;case "labelRes":B=w.item.context.parentElement.parentElement.parentElement.parentElement.dataset.command;Fe(e,B);switch(B){case "structure":break;case "molecule":C=e.v;break;case "residue":C=e.Oa;break;default:throw Error("Parent command type "+B+" is not handled");}e.u.cc(C,M.u.jc);break;case "labelAtom":B=w.item.context.parentElement.parentElement.parentElement.parentElement.dataset.command;Fe(e,B);switch(B){case "structure":e.u.cc(void 0,M.u.ob);
break;case "molecule":e.u.cc(e.v,M.u.ob);break;case "residue":e.u.cc(e.Oa,M.u.ob);break;case "atom":e.u.cc(e.ca,M.u.ob);break;default:throw Error("Parent command type "+B+" is not handled");}break;case "labelVdw":B=w.item.context.parentElement.parentElement.parentElement.parentElement.dataset.command;Fe(e,B);switch(B){case "structure":e.u.cc(void 0,M.u.Xc);break;case "molecule":e.u.cc(e.v,M.u.Xc);break;case "residue":B=e.Oa.Ea();for(x in B)e.u.cc(B[x],M.u.Xc);break;case "atom":e.u.cc(e.ca,M.u.Xc);
break;default:throw Error("Parent command type "+B+" is not handled");}break;case "labelClear":B=w.item.context.parentElement.parentElement.parentElement.parentElement.dataset.command;Fe(e,B);break;case "manageRep":ze(e.ba.If,"RepresentationManager");e.ba.If.ff.RepresentationManager.hh(e.ca);break;default:throw Error("Command "+w.cmd+" not handled by ContextMenu");}}}).contextmenu("instance")};
function Fe(e,f){switch(f){case "structure":Ge(e.u);break;case "molecule":Ge(e.u,e.ea);Ge(e.u,e.ea.ra.ga);Ge(e.u,e.ea.ra.Ea());break;case "residue":Ge(e.u,e.Oa);Ge(e.u,e.Oa.Ea());break;case "atom":Ge(e.u,e.ca);break;default:throw Error("Parent command type "+f+" is not handled");}}
function pe(e){var f,g,h;h='<div id="load-structure-dialog-form" title="Load New Structure"><p class="validateTips">All form fields are required.</p><form><fieldset>';h+='<label id ="structIDLabel" for="structID">Structure ID : </label>';h+='<input type="text" name="structID" id="structID" class="text ui-widget-content ui-corner-all">';h+="<br>";h+='<label for="isPDBX">Load PDBX : </label>';h+='<input type="checkbox" name="isPDBX" id="isPDBX" class="button ui-widget-content ui-corner-all" checked>';
h+='<input type="submit" tabindex="-1" style="position:absolute; top:-1000px">';h+="</fieldset>";h+="</form>";h+="</div>";$(h).appendTo(document.body);var k=$("#structID"),m=$("#isPDBX"),l=$([]).add(k).add(m);f=$("#load-structure-dialog-form").dialog({autoOpen:!1,height:250,width:300,modal:!0,position:{my:"center",at:"center",of:$("#content")},buttons:{"Load Structure":function(){l.removeClass("ui-state-error");if(!e.ya){var g=/^[a-z0-9]+$/i;if(4!=k.val().length||!g.test(k.val())){k.addClass("ui-state-error");
return}}e.ba.he=m.is(":checked");biovizAPI.hd(k.val());f.dialog("close")},Cancel:function(){f.dialog("close")}},open:function(){e.ya?$("#structIDLabel").html("Structure URL : "):$("#structIDLabel").html("Structure ID : ")},close:function(){g[0].reset();l.removeClass("ui-state-error")}});g=f.find("form").on("submit",function(f){f.preventDefault();e.hd()});return $("#load-structure-dialog-form")}
function qe(e){var f,g,h;h='<div id="load-structure-file-dialog-form" title="Load New Structure"><p class="validateTips">All form fields are required.</p><form><fieldset>';h+='<label id ="structIDLabel" for="file">Structure file : </label>';h+='<input type="file" name="file" id="file">';h+="<br>";h+='<label for="isPDBX2">Load PDBX : </label>';h+='<input type="checkbox" name="isPDBX2" id="isPDBX2" class="button ui-widget-content ui-corner-all" checked>';h+='<input type="submit" tabindex="-1" style="position:absolute; top:-1000px">';
h+="</fieldset>";h+="</form>";h+="</div>";$(h).appendTo(document.body);var k=$("#isPDBX2");f=$("#load-structure-file-dialog-form").dialog({autoOpen:!1,height:250,width:300,modal:!0,position:{my:"center",at:"center",of:$("#content")},buttons:{"Load Structure":function(){var g=$("#file")[0].files,h=new FileReader;h.onload=function(){return function(g){e.ba.he=k.is(":checked");biovizAPI.ng(g.target.result);f.dialog("close")}}(g);h.readAsText(g[0])},Cancel:function(){f.dialog("close")}},open:function(){e.ya?
$("#structIDLabel").html("Structure URL : "):$("#structIDLabel").html("Structure ID : ")},close:function(){g[0].reset()}});g=f.find("form").on("submit",function(f){f.preventDefault();e.hd()});return $("#load-structure-file-dialog-form")}
function re(e){var f,g,h;h='<div id="load-script-dialog-form" title="Load New Script"><form><fieldset><label id ="scriptLabel" for="script">Script (string or url) : </label>';h+='<input type="text" name="script" id="script" class="text ui-widget-content ui-corner-all">';h+="<br>";h+='<input type="submit" tabindex="-1" style="position:absolute; top:-1000px">';h+="</fieldset>";h+="</form>";h+="</div>";$(h).appendTo(document.body);var k=$("#script"),m=$([]).add(k);f=$("#load-script-dialog-form").dialog({autoOpen:!1,
height:250,width:300,modal:!0,position:{my:"center",at:"center",of:$("#content")},buttons:{"Load Script":function(){function g(h){try{He(e.ba,h),f.dialog("close")}catch(l){k.addClass("ui-state-error"),console.warn("Didn't succeed to get script")}}m.removeClass("ui-state-error");var h=k.val();$.ajax({async:!0,crossDomain:!0,url:h,success:function(e){g(e)},error:function(){g(h)}})},Cancel:function(){f.dialog("close")}},close:function(){g[0].reset();m.removeClass("ui-state-error")}});g=f.find("form").on("submit",
function(f){f.preventDefault();e.hc()});return $("#load-script-dialog-form")}
function se(e){var f,g,h;h='<div id="load-local-script-dialog-form" title="Load New Script"><form><fieldset><label id ="scriptLabel" for="scriptFile">Script (string or url) : </label>';h+='<input type="file" name="scriptFile" id="scriptFile">';h+="<br>";h+='<input type="submit" tabindex="-1" style="position:absolute; top:-1000px">';h+="</fieldset>";h+="</form>";h+="</div>";$(h).appendTo(document.body);f=$("#load-local-script-dialog-form").dialog({autoOpen:!1,height:250,width:300,modal:!0,position:{my:"center",
at:"center",of:$("#content")},buttons:{"Load Script":function(){var g=$("#scriptFile")[0].files,h=new FileReader;h.onload=function(){return function(g){console.log(g.target.result);He(e.ba,g.target.result);f.dialog("close");f.dialog("close")}}(g);h.readAsText(g[0])},Cancel:function(){f.dialog("close")}},close:function(){g[0].reset()}});g=f.find("form").on("submit",function(f){f.preventDefault();e.hc()});return $("#load-local-script-dialog-form")}
function te(){var e;$('<div id="not-implemented-dialog-form" title="Feature not available"><p class="info">This feature will be added soon</p></div>').appendTo(document.body);e=$("#not-implemented-dialog-form").dialog({autoOpen:!1,height:250,width:300,modal:!0,position:{my:"center",at:"center",of:$("#content")},buttons:{Cancel:function(){e.dialog("close")}}});$("#not-implemented-dialog-form")}
function ve(e){function f(e,f){return function(){return e.apply(f,arguments)}}var g;g='<div id="biovizjsinfo" title="BiovizJS informations"><div id="keyboard" autofocus><div id="mouse"><label> Mouse </label>';g+='<div class="separator"></div>';g+="<table>";g+='<tr><td class="controlLine">Left-click</td><td> Rotate</td></tr>';g+='<tr><td class="controlLine">Right-click</td><td> Translate / Open context menu</td></tr>';g+='<tr><td class="controlLine">Double click</td><td> Select an object</td></tr>';
g+='<tr><td class="controlLine">Scroll Up / Down</td><td> Move object forward / backward</td></tr>';g+='<tr><td class="controlLine">Ctrl + Scroll</td><td> Control eye separation for stereoscopy and anaglyph effects</td></tr>';g+="</table>";g+="</div>";g+="<br/>";g+="<label> Keyboard shortcut </label>";g+='<div class="separator"></div>';g+="<table>";g+="<tr><td>I</td><td>Show controls</td></tr>";g+="<tr><td>R</td><td>Show representation manager</td></tr>";g+="<tr><td>L</td><td>Show color mapping legend</td></tr>";
g+="<tr><td>M</td><td>Show measuring tool</td></tr>";g+="<tr><td>C</td><td>Show clipping tool</td></tr>";g+="<tr><td>F</td><td>Enable / Disable BiovizJS full-screen</td></tr>";g+="</table>";g+="</div>";g+="</div>";g=$(g);g.appendTo(document.body);$("#keyboard").css({display:"flex","flex-direction":"column"});$(".keyboardItem").css({margin:"0"});$("#mouse").css({display:"flex","flex-direction":"column"});$(".mouseItem").css({margin:"0"});$(".separator").css({"border-style":"solid","border-width":"1px",
width:"60%"});$(".controlLine").css({overflow:"hidden","white-space":"nowrap"});var h=$("#biovizjsinfo").dialog({autoOpen:!1,modal:!0,position:{my:"center",at:"center",of:$("#content")}});g.css({"font-size":"0.8em"});g=f(function(e){73===e.which&&(window.localStorage.setItem("infoDiv",!0),$("#pInformation").hide(),h.dialog("close"))},e);document.addEventListener("keydown",f(function(e){73===e.which&&(window.localStorage.setItem("infoDiv",!0),$("#pInformation").hide(),h.dialog("open"))},e),!1);document.addEventListener("keyup",
g,!1);return h}
function we(){var e=new ClientJS,f;f='<div id="systemInfo" title="System informations"><div id="sysInfo" autofocus><table>'+('<tr><td class="controlLine">Browser</td><td>'+e.getBrowser()+"</td></tr>");f+='<tr><td class="controlLine">Browser Version</td><td>'+e.getBrowserVersion()+"</td></tr>";f+='<tr><td class="controlLine">Operating System</td><td>'+e.getOS()+"</td></tr>";f+='<tr><td class="controlLine">OS Version</td><td>'+e.getOSVersion()+"</td></tr>";f+='<tr><td class="controlLine">CPU</td><td>'+e.getCPU()+
"</td></tr>";f+="</table>";f+="</div>";e=$(f);e.appendTo(document.body);$("#sysInfo").css({display:"flex","flex-direction":"column"});$(".controlLine").css({overflow:"hidden","white-space":"nowrap"});f=$("#systemInfo").dialog({autoOpen:!1,modal:!0,position:{my:"center",at:"center",of:$("#content")}});e.css({"font-size":"0.8em"});return f}
function xe(){var e;e='<div id="biovizJSInfo" title="About Bioviz JS"><div id="bvInfo" autofocus><p>Bioviz JS, a molecular 3D viewer for browser and mobile devices</p><p>More information about BIONEXT <a id="bvLink" href="http://bionext.com">here</a>.</p>';e+="<p>&copy; 2015-"+(new Date).getFullYear()+" BIONEXT SA</p>";e+="</div>";e=$(e);e.appendTo(document.body);$("#bvInfo").css({display:"flex","flex-direction":"column"});$("#bvLink").attr("target","_blank");var f=$("#biovizJSInfo").dialog({autoOpen:!1,
modal:!0,position:{my:"center",at:"center",of:$("#content")}});e.css({"font-size":"0.8em"});return f}
function ue(e){function f(){q=m.ab;r=m.ug.antialias;t=m.De;w="#"+m.bgColor.getHexString();x=m.nf;B=q;C=t;G=x;I="";$("#quality").find('option[value="'+q+'"]').attr("selected",!0);$("#quality").selectmenu("refresh");$("#antialias").prop("checked",r);$("#textSize").slider("value",t);$("#textSizeInfo").html(t+"%");$("#mouse3D").val("");var e=[],f=l.Pe.values(),g;for(g in f){var h=f[g];e.push('<option value="'+h.index+'">'+h.id+"</option>")}$("#mouse3D").append(e.join(""));null!=l.ub&&(I=l.ub.id,G=l.ub.index,
$("#mouse3D").find('option[value="'+G+'"]').attr("selected",!0),$("#mouse3D").selectmenu("refresh"));$("#colorpicker").minicolors("value",w)}function g(){Ie(m,B);q=B;var f=$("#antialias").prop("checked");window.localStorage.setItem("antialias",f);r=antialias;m.De=C;window.localStorage.setItem("textRatio",m.De);t=C;$("#saveBg").prop("checked")?(f=e.tb,window.localStorage.setItem("background",f),m.Dd(new THREE.Color(f))):m.Dd(new THREE.Color(e.tb));w=e.tb;l.ub=l.Pe.get(G);f=I;m.nf=f;window.localStorage.setItem("3DController",
f);x=G}var h,k;k='<div id="config-dialog-form" title="BiovizJS Configuration"><label for="quality">Select a quality : </label><select name="quality" id="quality"><option value="LOW">Low</option>';k+='<option value="MEDIUM">Medium</option>';k+='<option value="HIGH">High</option>';k+="</select>";k+="<br/>";k+='<label for="antialias">Antialiasing (needs page refresh) : </label>';k+='<input type="checkbox" name="Antialiasing" id="antialias" class="button ui-widget-content ui-corner-all">';k+="<br/>";
k+='<label for="mouse3D">Select a 3D Mouse : </label>';k+='<select name="mouse3D" id="mouse3D">';k+="</select>";k+="<br/>";k+='<label for="colorpicker">Background color : </label>';k+='<div id="colorpicker" value="colorpicker"></div>';k+='<label for="saveBg" style="display: inline-block">Save background configuration : </label>';k+='<input type="checkbox" name="saveBg" id="saveBg" class="button ui-widget-content ui-corner-all" style="display: inline-block">';k+="<br/>";k+='<label for="textSize">Text Size : </label>';
k+='<span id="textSizeInfo"></span>';k+='<div id="textSize"></div>';k+="<br/>";k=$(k);k.appendTo(document.body);var m=Je(),l=e.ba.aa.scene3D.Aj,q=m.ab,r=m.ug.antialias,t=m.De,w="#"+m.bgColor.getHexString(),x=m.nf,B=q,C=t,G=x,I="";h=$("#config-dialog-form").dialog({autoOpen:!1,height:250,width:300,modal:!0,position:{my:"center",at:"center",of:$("#content")},buttons:{Reset:function(){m.ug.antialias=!0;m.ab="MEDIUM";m.De=20;m.bgColor=new THREE.Color(0,0,0);m.nf="";$("#saveBg").prop("checked",!0);f();
g()},Apply:function(){g();h.dialog("close")},Cancel:function(){h.dialog("close")}},open:function(){f()}});$("#quality").selectmenu({width:"200px",select:function(e,f){B=f.item.value}});$("#mouse3D").selectmenu({width:"200px",select:function(e,f){G=f.item.value;I=f.item.label}});$("#textSize").slider({slide:function(e,f){C=f.value;$("#textSizeInfo").html(C+"%")}});$("#colorpicker").minicolors({control:"hue",defaultValue:"#4fc8db",format:"hex",keywords:"",letterCase:"lowercase",swatches:[],change:function(f){f&&
"object"===("undefined"===typeof console?"undefined":ia(console))&&(e.tb=f)}});w="#"+m.bgColor.getHexString();$("#colorpicker").minicolors("value",w);k.find("select").css({width:"150%"});k.find("select").find(".options-small").css({"font-size":"0.8em"});k.find("label").css({display:"block"});return $("#config-dialog-form")}function Be(e){e.Ua=e.ba.aa.gc(e.ka.ta(),e.v.type,e.v.id,e.Oa._id,!0)[0]}function Ce(e){e.Ma=e.ba.aa.Id(e.ka.ta(),e.v.type,e.v.id,e.ca.id,e.ca.zd,!0)[0]}
function EventTarget(e){this._listeners={};var f=this;e&&!e.addListener&&(e.addListener=function(e,h){f.addListener(e,h)},e.removeListener=function(e,h){f.removeListener(e,h)},e.jb=function(e){f.fire(e)})}EventTarget.prototype.addListener=function(e,f){void 0===this._listeners[e]&&(this._listeners[e]=[]);this._listeners[e].push(f)};EventTarget.prototype.removeListener=function(e,f){var g=this._listeners[e];if(void 0!==g)for(var h=g.length,k=0;k<h;k++)if(g[k]===f){g.splice(k,1);break}};
EventTarget.prototype.fire=function(e){"string"===typeof e&&(e={type:e});e.target||(e.target=this);if(!e.type)throw Error("Event object type must be defined");var f=this._listeners[e.type];if(void 0!==f)for(var g=f.length,h=0;h<g;h++)f[h].call(this,e)};
var Me=function Ke(){if("object"===ia(Ke.u))return Ke.u;Ke.u=this;this.bgColor=new THREE.Color(0,0,0);var f=window.localStorage.getItem("quality"),g=window.localStorage.getItem("antialias"),h=window.localStorage.getItem("textRatio"),k=window.localStorage.getItem("background"),m=window.localStorage.getItem("3DController");this.pg=this.Qc=this.Ye=this.Qd=this.Ma=this.hc=this.tb=this.Rd=this.og=null;Le(this);this.Uc={Atoms:this.Ma,"Amino Acids":this.hc,"Nucleic Acids":this.tb,Molecules:this.Rd,"Secondary Structure":this.Qc,
Rainbow:this.Ye,Hydrophobicity:this.Qd};this.ca={Atoms:[],Residues:[],Molecules:[],SST:[]};g="string"==typeof g?JSON.parse(g):g;this.ug={antialias:null!=g?g:!0,Dm:"0c0c0c"};this.ab=null!=f?f:"MEDIUM";this.De=null!=h?h:7;null!=k&&(this.bgColor=new THREE.Color(k));this.nf=m;this.Dk=30;this.fps=60;this.ka=this.ea=this.ya=this.Ua=null;this.u={ma:{radius:1,widthSegments:16,heightSegments:8,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI},pa:{radius:1,widthSegments:10,heightSegments:6,phiStart:0,
phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI},oa:{radius:1,widthSegments:6,heightSegments:3,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI}};this.sa={ma:{radius:.3,widthSegments:12,heightSegments:8,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI},pa:{radius:.3,widthSegments:8,heightSegments:5,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI},oa:{radius:.3,widthSegments:5,heightSegments:3,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI}};
this.va={ma:{radiusTop:.2,radiusBottom:.2,height:1,Td:12,heightSegments:1,openEnded:!1},pa:{radiusTop:.2,radiusBottom:.2,height:1,Td:5,heightSegments:1,openEnded:!1},oa:{radiusTop:.2,radiusBottom:.2,height:1,Td:3,heightSegments:1,openEnded:!1}};this.v={ma:{radius:this.va.ma.radiusTop,widthSegments:12,heightSegments:8,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI},pa:{radius:this.va.ma.radiusTop,widthSegments:6,heightSegments:4,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI},
oa:{radius:this.va.ma.radiusTop,widthSegments:5,heightSegments:3,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI}};this.lineWidth=1.5;this.gi=1;this.Rc=[]};function Je(){return new Me}Me.prototype.subscribe=function(e){if(void 0!==e.update)this.Rc.push(e);else throw Error("Class must have a update function to subscribe to modellingProperties");};Me.prototype.unsubscribe=function(e){void 0!==e.update&&this.Rc.splice(this.Rc.indexOf(e))};
function Ne(e,f){for(var g=e.Rc.length,h=0;h<g;h++)e.Rc[h].update(f)}Me.prototype.setLineWidth=function(e){this.lineWidth=e;e=new Oe;e.lineWidth=!0;Ne(this,e)};Me.prototype.Dd=function(e){this.bgColor=e;e=new Oe;e.bgColor=!0;Ne(this,e)};
function af(e,f,g){if("A"===g)return void 0===e.ca.Atoms[f]?(g=new THREE.Color(e.Ma[f]),e.ca.Atoms[f]=g):e.ca.Atoms[f];if("M"===g)return void 0===e.ca.Molecules[f]?(g=new THREE.Color(e.Rd[f]),e.ca.Molecules[f]=g):e.ca.Molecules[f];if("R"===g)return void 0===e.ca.Residues[f]?(g=e.hc[f],void 0===g&&(g=e.tb[f]),g=new THREE.Color(g),e.ca.Residues[f]=g):e.ca.Residues[f];if("SST"===g)return void 0===e.ca.SST[f]?(g=e.Qc[f],g=new THREE.Color(g),e.ca.SST[f]=g):e.ca.SST[f]}
function Ie(e,f){if("LOW"===f||"MEDIUM"===f||"HIGH"===f){e.ab=f;var g=new Oe;g.Af=!0;"HIGH"===e.ab?(e.ya=new THREE.SphereGeometry(e.u.ma.radius,e.u.ma.widthSegments,e.u.ma.heightSegments,e.u.ma.phiStart,e.u.ma.phiLength,e.u.ma.thetaStart,e.u.ma.thetaLength),e.ea=new THREE.SphereGeometry(e.sa.ma.radius,e.sa.ma.widthSegments,e.sa.ma.heightSegments,e.sa.ma.phiStart,e.sa.ma.phiLength,e.sa.ma.thetaStart,e.sa.ma.thetaLength),e.ka=new THREE.CylinderGeometry(e.va.ma.radiusTop,e.va.ma.radiusBottom,e.va.ma.height,
e.va.ma.Td,e.va.ma.wf,e.va.ma.openEnded)):"MEDIUM"===e.ab?(e.ya=new THREE.SphereGeometry(e.u.pa.radius,e.u.pa.widthSegments,e.u.pa.heightSegments,e.u.pa.phiStart,e.u.pa.phiLength,e.u.pa.thetaStart,e.u.pa.thetaLength),e.ea=new THREE.SphereGeometry(e.sa.pa.radius,e.sa.pa.widthSegments,e.sa.pa.heightSegments,e.sa.pa.phiStart,e.sa.pa.phiLength,e.sa.pa.thetaStart,e.sa.pa.thetaLength),e.ka=new THREE.CylinderGeometry(e.va.pa.radiusTop,e.va.pa.radiusBottom,e.va.pa.height,e.va.pa.Td,e.va.pa.wf,e.va.pa.openEnded)):
"LOW"===e.ab&&(e.ya=new THREE.SphereGeometry(e.u.oa.radius,e.u.oa.widthSegments,e.u.oa.heightSegments,e.u.oa.phiStart,e.u.oa.phiLength,e.u.oa.thetaStart,e.u.oa.thetaLength),e.ea=new THREE.SphereGeometry(e.sa.oa.radius,e.sa.oa.widthSegments,e.sa.oa.heightSegments,e.sa.oa.phiStart,e.sa.oa.phiLength,e.sa.oa.thetaStart,e.sa.oa.thetaLength),e.ka=new THREE.CylinderGeometry(e.va.oa.radiusTop,e.va.oa.radiusBottom,e.va.oa.height,e.va.oa.Td,e.va.oa.wf,e.va.oa.openEnded));Ne(e,g);window.localStorage.setItem("quality",
e.ab)}}
function bf(e){null===e.ea&&("HIGH"===e.ab?e.ea=new THREE.SphereGeometry(e.sa.ma.radius,e.sa.ma.widthSegments,e.sa.ma.heightSegments,e.sa.ma.phiStart,e.sa.ma.phiLength,e.sa.ma.thetaStart,e.sa.ma.thetaLength):"MEDIUM"===e.ab?e.ea=new THREE.SphereGeometry(e.sa.pa.radius,e.sa.pa.widthSegments,e.sa.pa.heightSegments,e.sa.pa.phiStart,e.sa.pa.phiLength,e.sa.pa.thetaStart,e.sa.pa.thetaLength):"LOW"===e.ab&&(e.ea=new THREE.SphereGeometry(e.sa.oa.radius,e.sa.oa.widthSegments,e.sa.oa.heightSegments,e.sa.oa.phiStart,
e.sa.oa.phiLength,e.sa.oa.thetaStart,e.sa.oa.thetaLength)));return e.ea}function cf(e,f){if(null===f||void 0===f)f=30;return df(e,{fontsize:f,sh:{r:255,g:255,b:255,a:1},strokeStyle:!0})}
function df(e,f){void 0===f&&(f={});var g=void 0!==f.Ek?f.Ek:"Arial",h=void 0!==f.fontsize?f.fontsize:20,k=void 0!==f.sh?f.sh:{r:1,g:0,b:0,a:1},m=f.maxWidth,l=f.maxHeight,q=document.createElement("canvas"),r=q.getContext("2d");r.font=h+"px "+g;var t=r.measureText(e).width,h=Math.ceil(h);null!=m&&t>m&&(h=Math.ceil(h*m/t),r.font=h+"px "+g,t=m);null!=l&&h>l&&(t*=l/h,h=l,r.font=h+"px "+g);q.width=t;q.height=h;r.fillStyle="rgba("+k.r+","+k.g+","+k.b+","+k.a+")";r.font=h+"px "+g;r.textAlign="center";r.textBaseline=
"middle";f.strokeStyle&&(r.strokeStyle="rgba(0,0,0,1.0)",r.lineWidth=2,r.strokeText(e,t/2,h/2));r.fillText(e,t/2,h/2);g=new THREE.Texture(q);g.minFilter=THREE.LinearFilter;g.needsUpdate=!0;return g}function ef(e,f){return parseFloat(jb(f.symbol.charAt(0).toUpperCase()+f.symbol.slice(1).toLowerCase())[7])}
function ff(e){var f=new THREE.MeshPhongMaterial({vertexColors:THREE.VertexColors});e.ef&&(f.blendEquation=THREE.AddEquation,f.blendEquationAlpha=THREE.AddEquation,f.blendSrc=THREE.SrcAlphaFactor,f.blendDst=THREE.ZeroFactor,f.blendSrcAlpha=THREE.OneFactor,f.blendDstAlpha=THREE.ZeroFactor);return f}
function Le(e){e.og=JSON.parse(window.localStorage.getItem("def"))||nd;e.Rd=JSON.parse(window.localStorage.getItem("moleculeColor"))||od;e.tb=JSON.parse(window.localStorage.getItem("nucleicAcidColor"))||pd;e.hc=JSON.parse(window.localStorage.getItem("residueColor"))||qd;e.Ma=JSON.parse(window.localStorage.getItem("atomColor"))||rd;e.Qd=JSON.parse(window.localStorage.getItem("hydroColor"))||Ad;e.Ye=JSON.parse(window.localStorage.getItem("rainbowColor"))||Bd;e.Qc=JSON.parse(window.localStorage.getItem("sstColor"))||
Cd;e.pg=JSON.parse(window.localStorage.getItem("unsortedProperties"))||Dd;e.Uc={Atoms:e.Ma,"Amino Acids":e.hc,"Nucleic Acids":e.tb,Molecules:e.Rd,"Secondary Structure":e.Qc,Rainbow:e.Ye,Hydrophobicity:e.Qd}}function Oe(){this.ki=this.lineWidth=this.gi=this.Af=!1;this.jh=this.jh=null;this.bgColor=!1}function gf(e,f){var g=new THREE.Matrix4,h=(new THREE.Matrix4).multiplyMatrices(f.matrixWorldInverse,e.matrixWorld);g.getInverse(h);this.value=g}
function hf(e,f){var g=new THREE.Matrix4;g.getInverse(f.projectionMatrix);this.value=g}function jf(e){this.value=e.material.opacity}
function kf(e){var f=THREE.ShaderChunk.sphereImpostor_vert,g=THREE.ShaderChunk.sphereImpostor_frag,h=THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights,THREE.UniformsLib.fog,{viewport:{type:"v4",value:new THREE.Vector4},modelViewMatrixInverse:(new THREE.Uniform(new THREE.Matrix4)).onUpdate(gf),projectionMatrixInverse:(new THREE.Uniform(new THREE.Matrix4)).onUpdate(hf),emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",
value:30},diffuse:new THREE.Uniform(new THREE.Color(16777215)),opacity:(new THREE.Uniform(1)).onUpdate(jf),fog:!0}]),f=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(h),vertexShader:f,fragmentShader:g,lights:!0,vertexColors:THREE.VertexColors,fog:!0,clipping:!0,transparent:!0});e.ef&&(f.blendEquation=THREE.AddEquation,f.blendEquationAlpha=THREE.AddEquation,f.blendSrc=THREE.SrcAlphaFactor,f.blendDst=THREE.ZeroFactor,f.blendSrcAlpha=THREE.OneFactor,f.blendDstAlpha=THREE.ZeroFactor);f.extensions.fragDepth=
!0;return f}
function lf(e){var f=THREE.ShaderChunk.cylinderImpostor_vert,g=THREE.ShaderChunk.cylinderImpostor_frag,h=THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights,THREE.UniformsLib.fog,{viewport:{type:"v4",value:new THREE.Vector4},modelViewMatrixInverse:(new THREE.Uniform(new THREE.Matrix4)).onUpdate(gf),projectionMatrixInverse:(new THREE.Uniform(new THREE.Matrix4)).onUpdate(hf),emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",
value:30},diffuse:new THREE.Uniform(new THREE.Color(16777215)),opacity:(new THREE.Uniform(1)).onUpdate(jf),fog:!0}]),f=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(h),vertexShader:f,fragmentShader:g,lights:!0,vertexColors:THREE.VertexColors,fog:!0,clipping:!0,transparent:!0});e.ef&&(f.blendEquation=THREE.AddEquation,f.blendEquationAlpha=THREE.AddEquation,f.blendSrc=THREE.SrcAlphaFactor,f.blendDst=THREE.ZeroFactor,f.blendSrcAlpha=THREE.OneFactor,f.blendDstAlpha=THREE.ZeroFactor);f.extensions.fragDepth=
!0;return f}function mf(){var e={scale:{type:"f",value:.2},color:{type:"c",value:new THREE.Color(.9,.8,.2)}};return new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(e),vertexShader:THREE.ShaderChunk.outline_vert,fragmentShader:THREE.ShaderChunk.outline_frag,depthFunc:THREE.LessDepth})}
function nf(e){this.Ig=new Worker("webworker.js");this.ba=e;this.fa=new Me;e=$("#content").width()/$("#content").height();this.camera=new THREE.PerspectiveCamera(45,e,10,1E3);this.eb=this.scene3D=new of(this);this.Sa=null;this.domElement=this.scene3D.renderer.domElement;this.effect=null;this.Jc=this.df=!1;this.u=null;this.v=1;this.ne=null}function pf(e){e.ba.jb({type:"requestWidgetUpdate",data:null!=e.Sa?e.Sa.ia._id:null})}z=nf.prototype;z.fh=function(e){this.ba.fh(e)};
z.hd=function(e,f){var g=this;if(void 0===e)throw Error("Structure's identifier to load is undefined");var h;-1!=e.indexOf("/")?h=e:(h=this.ba.li.slice().replace("${id}",e),h=h.replace("${divided}",e.substring(1,2)));qf(this.ba,"Downloading "+e,!0);return(new Xd(h,this.ba.he,f)).load().then(function(e){qf(g.ba);return e})["catch"](function(e){qf(g.ba,e.message);return e})};
z.ng=function(e,f){var g=this;qf(this.ba,"Parsing...",!0);return(new Xd(e,this.ba.he,f,!0)).load().then(function(e){qf(g.ba);return e})["catch"](function(e){console.warn("Error : ",e)})};function rf(e,f,g){qf(e.ba,"Loading 3D Objects",!0);if(null!==f&&void 0!==f){var h=new M(f);null!=g&&h.ia.qc(g);f=f.v[0].ca;g=f.length;for(var k=0;k<g;k++)h.qb(f[k]);qf(e.ba);return h}return null}
function sf(e,f){qf(e.ba,"Loading 3D Representations...",!0);var g=tf(f),h=g.length,k=f.ia.Oi;return function l(e){return(new Promise(function(f){var h=g[e];setTimeout(function(){25E4>k?uf(h):h.show(P.hf);f(e+1)},40)})).then(function(e){if(e<h)return l(e)})}(0).then(function(){return new Promise(function(f){qf(e.ba);f()})})}
function vf(e){var f=1.5*e.scene3D.wb().length();0===f&&(f=1E3);e.camera.far=f;wf=f/5E3;e.camera.fov=md(e.scene3D,e.camera);e.camera.updateProjectionMatrix();xf(e.scene3D,0,100);e=e.scene3D;e.Jb.fog.near=e.camera.far-(e.camera.far-e.camera.near)*e.fa.Dk/100;e.Jb.fog.far=e.camera.far}function Ee(e,f){f.traverse(function(f){f===e.Sa&&(e.Sa=null);f===e.eb&&(e.eb=e.scene3D)});var g=e.scene3D.na.indexOf(f);0<=g&&e.scene3D.na.splice(g,1);f["delete"]();vf(e);pf(e)}
z.translate=function(e,f,g){e=new THREE.Vector3(e,f,g);this.eb===this.scene3D?(e=(new THREE.Matrix4).setPosition(e),e=e.multiply(this.eb.matrixWorld),this.eb.matrix.copy(e)):(f=new THREE.Matrix4,f.copy(this.eb.matrixWorld),g=new THREE.Matrix4,g.getInverse(f),f=he(g,e),e=new THREE.Matrix4,e.makeTranslation(f.x,f.y,f.z),f=new THREE.Matrix4,f.copy(this.eb.matrix),f.multiply(e),this.eb.matrix.copy(f));this.eb.updateMatrixWorld(!0)};
z.rotate=function(e,f,g){var h=null!==this.eb?this.eb:this.scene3D.scene,k=null!==this.Sa?this.Sa:h,m=new THREE.Matrix4;m.copy(h.matrixWorld);var l=new THREE.Matrix4;l.getInverse(m);var q=new THREE.Matrix4;q.copy(h.matrixWorld);m=new THREE.Matrix4;m.getInverse(q);var q=new THREE.Vector3(m.elements[0],m.elements[1],m.elements[2]),r=new THREE.Vector3(m.elements[4],m.elements[5],m.elements[6]),t=(new THREE.Vector3).crossVectors(q,r),m=new THREE.Matrix4;ie(m,e,r.x,r.y,r.z);e=new THREE.Matrix4;ie(e,f,
q.x,q.y,q.z);f=new THREE.Matrix4;ie(f,g,t.x,t.y,t.z);g=new THREE.Matrix4;g=f.multiply(e).multiply(m);f=new THREE.Vector3;f.copy(k.dd());f=(new THREE.Matrix4).makeTranslation(f.x,f.y,f.z);l=(new THREE.Matrix4).copy(l);l.multiply(k.matrixWorld).multiply(f);k=(new THREE.Matrix4).getInverse(l);l=[l,k];k=new THREE.Matrix4;k=k.multiply(l[0]).multiply(g).multiply(l[1]);l=new THREE.Matrix4;h.matrix.copy((null!==h.matrix?h.matrix:l).multiply(k));h.updateMatrixWorld(!0)};
function Ae(e,f,g){var h=Zd(f,e.scene3D,g,e.v);e.scene3D.scene.matrix.copy(h);e.scene3D.scene.matrixWorldNeedsUpdate=!0;g&&(e.scene3D.aa.Sa=f)}z.Dg=function(e){null!==this.ne&&this.Ef();void 0==e&&(e=.25);this.ne=new yf(this.scene3D,e);this.scene3D.Gf.yc(this.ne)};z.Ef=function(){this.ne&&(this.ne.stop(),this.ne=null)};z.Ie=function(e){(this.df=e)&&this.Jc&&(this.Jc=!1);return this.Jc};z.Ee=function(e){(this.Jc=e)&&this.df&&(this.df=!1);return this.df};
z.gb=function(e){for(var f in this.scene3D.na)if(this.scene3D.na[f].fd()===e)return[this.scene3D.na[f]]};
function ye(e,f,g,h){var k=[];if(void 0===g)for(var m in e.scene3D.na)e.scene3D.na[m].fd().toUpperCase()===f.toUpperCase()&&(k=k.concat(tf(e.scene3D.na[m])));else if(void 0===h)for(m in e.scene3D.na){if(e.scene3D.na[m].fd().toUpperCase()===f.toUpperCase()){var l=tf(e.scene3D.na[m]),q;for(q in l)g.toUpperCase()===l[q].ra.type.toUpperCase()&&k.push(l[q])}}else for(m in e.scene3D.na)if(e.scene3D.na[m].fd().toUpperCase()===f.toUpperCase())for(q in l=tf(e.scene3D.na[m]),l)if(g.toUpperCase()===l[q].ra.type.toUpperCase()&&
h.toUpperCase()===l[q].ra.id.toUpperCase())return[l[q]];return k}z.gc=function(e,f,g,h,k){e=ye(this,e,f,g)[0];if(null!==e){f=e.ra.ga;for(var m in f)if(g=f[m],g.ta()==h)return[e.gc(g,k)]}return null};z.Id=function(e,f,g,h,k,m){e=ye(this,e,f,g)[0];if(null!==e){f=e.ra.Ea();for(var l in f)if(f[l].id===h&&(null==k||f[l].zd===k)&&(g=e.gc(f[l].Aa(),m),null!==g&&void 0!==g))return[g.Id(f[l],m)]}return null};
function zf(e){this.u=null;this.scene3D=e;this.u=new THREE.DirectionalLight(16777215,1);this.u.position.set(this.scene3D.camera.position.x,this.scene3D.camera.position.y,this.scene3D.camera.position.z);this.u.matrixAutoUpdate=!0;this.scene3D.Jb.add(this.u)}function Af(e){this.fa=Je();this.duration=e;this.$a=0}Af.prototype.moveTo=function(e){if(1<e||0>e||isNaN(e))return 0;this.$a=this.duration*e};function If(e){new THREE.Clock;this.fa=Je();this.Kc=[];this.pause=!1;this.scene3D=e}If.prototype.yc=function(e){this.Kc.push(e)};
function Jf(e,f,g){if(!e.pause||g){g=e.Kc.length;for(var h=0;h<g;h++){var k=e.Kc[h];k.yd(f);-1!=k.duration&&k.$a>=k.duration&&(e.Kc.splice(h,1),g--)}}}function Kf(e,f,g,h){Af.call(this);this.duration=g;this.scene3D=f;this.Oe=new THREE.Matrix4;this.sj=new THREE.Matrix4;this.sj.copy(this.scene3D.scene.matrix);e=Zd(e,this.scene3D,h);this.Oe.copy(e)}Kf.prototype=Object.create(Af.prototype);Kf.prototype.constructor=Kf;
Kf.prototype.yd=function(e){this.$a+=e;e=this.$a/this.duration;1<e&&(e=1);var f=new THREE.Matrix4;f.lerp(this.sj,this.Oe,e);this.scene3D.scene.matrix.copy(f);this.scene3D.scene.matrixWorldNeedsUpdate=!0};function Lf(e,f,g,h){Af.call(this);this.r=e;this.g=f;this.b=g;this.duration=h;this.Fj=this.fa.bgColor.r;this.kj=this.fa.bgColor.g;this.Yi=this.fa.bgColor.b}Lf.prototype=Object.create(Af.prototype);Lf.prototype.constructor=Lf;
Lf.prototype.yd=function(e){this.$a+=e;e=this.$a/this.duration;1<e?this.fa.Dd(new THREE.Color(this.r,this.g,this.b)):this.fa.Dd(new THREE.Color(this.Fj+(this.r-this.Fj)*e,this.kj+(this.g-this.kj)*e,this.Yi+(this.b-this.Yi)*e))};function Mf(e){Af.call(this);this.$a=0;this.duration=e}Mf.prototype=Object.create(Af.prototype);Mf.prototype.constructor=Mf;Mf.prototype.yd=function(e){this.$a+=e};
function Nf(e,f){Af.call(this);this.duration=e;this.Ja=f;this.kg=[];this.b=this.g=this.r=null;this.Mh=!1;this.map=null}Nf.prototype=Object.create(Af.prototype);Nf.prototype.constructor=Nf;Nf.prototype.init=function(){var e=this.Ja.da.geometry,f=e.attributes.color,e=e.attributes.color.array;if(0===f.count)this.Ja.da.material.color=this.Ja.da.material.color.clone(),this.kg.push(this.Ja.da.material.color);else for(var f=f.count,g=0;g<f;g++){var h=(new THREE.Color(e[3*g],e[3*g+1],e[3*g+2])).clone();this.kg.push(h)}};
function Of(e,f,g,h){1<f?e.r=f/255:e.r=f;1<g?e.g=g/255:e.g=g;1<h?e.b=h/255:e.b=h;e.init()}
Nf.prototype.yd=function(e){this.$a+=e;e=this.$a/this.duration;1<e&&(e=1);for(var f=this.Ja.da.geometry.attributes.color,g=new Float32Array(f.array.length),h=this.kg.length,k=0;k<h;k++){var m=this.kg[k];if(1===e)if(this.Mh){var l=this.map[k];null!=l?(g[3*k]=l.r,g[3*k+1]=l.g,g[3*k+2]=l.b):(g[3*k]=m.r,g[3*k+1]=m.g,g[3*k+2]=m.b)}else g[3*k]=this.r,g[3*k+1]=this.g,g[3*k+2]=this.b;else this.Mh?(l=this.map[k],null!=l?(g[3*k]=m.r+(l.r-m.r)*e,g[3*k+1]=m.g+(l.g-m.g)*e,g[3*k+2]=m.b+(l.b-m.b)*e):(g[3*k]=m.r,
g[3*k+1]=m.g,g[3*k+2]=m.b)):(g[3*k]=m.r+(this.r-m.r)*e,g[3*k+1]=m.g+(this.g-m.g)*e,g[3*k+2]=m.b+(this.b-m.b)*e)}f.set(g);f.needsUpdate=!0};
function Pf(e,f,g,h){Af.call(this);this.duration=e;this.target=f;this.scene3D=g;this.zh=new THREE.Matrix4;this.zh.copy(this.target.matrix);this.dl=new THREE.Vector3;this.tj=new THREE.Quaternion;this.uj=new THREE.Vector3;this.zh.decompose(this.dl,this.tj,this.uj);this.Oe=h;this.Ak=new THREE.Vector3;this.hj=new THREE.Quaternion;this.ij=new THREE.Vector3;this.Oe.decompose(this.Ak,this.hj,this.ij);e=this.target.dd();this.Xh=new THREE.Vector3(-e.x,-e.y,-e.z);this.Wh=(new THREE.Matrix4).setPosition(this.Xh);
this.wg=e.clone();this.Jj=(new THREE.Matrix4).setPosition(this.wg);this.hi=new THREE.Vector3;f=new THREE.Matrix4;f.multiply(this.zh).multiply((new THREE.Matrix4).setPosition(e));this.hi.setFromMatrixPosition(f);f=new THREE.Vector3;g=new THREE.Matrix4;g.multiply(this.Oe).multiply((new THREE.Matrix4).setPosition(e));f.setFromMatrixPosition(g);this.Pj=new THREE.Vector3;this.Pj.subVectors(this.hi,e);this.bj=new THREE.Vector3;this.bj.subVectors(f,this.hi)}Pf.prototype=Object.create(Af.prototype);
Pf.prototype.constructor=Pf;
Pf.prototype.yd=function(e){this.$a+=e;e=this.$a/this.duration;if(1<e||isNaN(e))this.target.matrix.copy(this.Oe);else{var f=new THREE.Quaternion;THREE.Quaternion.slerp(this.tj,this.hj,f,e);var f=(new THREE.Matrix4).makeRotationFromQuaternion(f),g=new THREE.Vector3;g.lerp(this.bj,e);(new THREE.Matrix4).setPosition(g);var h=new THREE.Vector3;h.lerpVectors(this.uj,this.ij,e);(new THREE.Matrix4).scale(h);e=(new THREE.Matrix4).setPosition(g.add(this.wg).add(this.Pj));e.multiply(f);e.multiply(this.Wh);
this.target.matrix.copy(e)}this.target.matrixWorldNeedsUpdate=!0};Mf=function(e,f,g){Af.call(this);this.yh=null;this.opacity=e;this.Ja=g;this.$a=0;this.duration=f;this.Ja.da.material.transparent=!0;this.yh=this.Ja.da.material.opacity};Mf.prototype=Object.create(Af.prototype);Mf.prototype.constructor=Mf;Mf.prototype.yd=function(e){this.$a+=e;e=this.$a/this.duration;1<e&&(e=1);this.Ja.da.material.opacity=1===e?this.opacity:this.yh+(this.opacity-this.yh)*e};
function yf(e,f){Af.call(this);this.duration=-1;this.speed=f;this.target=e;var g=this.target.dd();this.Xh=new THREE.Vector3(-g.x,-g.y,-g.z);this.Wh=(new THREE.Matrix4).setPosition(this.Xh);this.wg=g.clone();this.Jj=(new THREE.Matrix4).setPosition(this.wg)}yf.prototype=Object.create(Af.prototype);yf.prototype.constructor=yf;
yf.prototype.yd=function(e){var f=new THREE.Matrix4;f.copy(this.target.matrixWorld);var g=new THREE.Matrix4;g.getInverse(f);var f=new THREE.Vector3(g.elements[0],g.elements[1],g.elements[2]),h=new THREE.Vector3(g.elements[4],g.elements[5],g.elements[6]),k=(new THREE.Vector3).crossVectors(f,h),g=new THREE.Matrix4;ie(g,e/1E3*this.speed*2*Math.PI,h.x,h.y,h.z);e=new THREE.Matrix4;ie(e,0,f.x,f.y,f.z);f=new THREE.Matrix4;ie(f,0,k.x,k.y,k.z);k=new THREE.Matrix4;k=f.multiply(e).multiply(g);g=(new THREE.Matrix4).multiply(this.Jj).multiply(k).multiply(this.Wh);
this.target.matrix.copy(this.target.matrix.multiply(g))};yf.prototype.stop=function(){this.duration=0};function Qf(e,f,g,h){Af.call(this);this.duration=g;this.scene3D=f;this.text=e;this.position=h}Qf.prototype=Object.create(Af.prototype);Qf.prototype.constructor=Qf;Qf.prototype.yd=function(e){this.$a+=e;this.$a>=this.duration&&(this.scene3D.Wd[this.position]=void 0,this.scene3D.Gc.remove(this.text),this.scene3D.renderer.render(this.scene3D.Gc,this.scene3D.ce))};
function Rf(e,f){Sf.call(this,e,f);(this.lj="getGamepads"in navigator)||console.warn("Gamepad API not supported, you can't use any 3D device to control BiovizJS");var g=this;this.Pe=new Fa;this.ub=null;this.Eh=this.Dh=this.Ih=this.Jh=!1;window.addEventListener("gamepadconnected",function(e){Tf(g,e.ub)});window.addEventListener("gamepaddisconnected",function(e){e=e.ub;g.ub.index==e.index&&(g.ub=null);g.Pe.remove(e.index)});this.Rk="GamepadEvent"in window;var h=window.chrome,k=window.navigator.vendor,
m=-1<window.navigator.userAgent.indexOf("OPR"),l=-1<window.navigator.userAgent.indexOf("Edge");this.isChrome=null!==h&&void 0!==h&&"Google Inc."===k&&0==m&&0==l}Rf.prototype=Object.create(Sf.prototype);Rf.prototype.constructor=Rf;
Rf.prototype.update=function(){if(this.lj){if(!this.Rk||this.isChrome)for(var e=navigator.getGamepads(),f=0;f<e.length;f++){var g=e[f];g&&(this.Pe.bd(g.index)?this.Pe.set(g.index,g):Tf(this,g))}if(null!=this.ub){(e=this.ub.buttons[0])&&e.pressed?this.Dh||(this.Jh=!this.Jh,this.Dh=!0):this.Dh=!1;(e=this.ub.buttons[1])&&e.pressed?this.Eh||(this.Ih=!this.Ih,this.Eh=!0):this.Eh=!1;var e=this.ub.axes[0]*Uf,f=this.ub.axes[1]*Uf,g=this.ub.axes[2]*Uf,h=this.ub.axes[3]*Vf,k=this.ub.axes[4]*Vf,m=this.ub.axes[5]*
Vf;if(0!==e||0!==f||0!==g||0!==h||0!==k||0!==m)this.Ih||this.scene3D.aa.rotate(-m,h,k),this.Jh||this.scene3D.aa.translate(e,-g,f)}}};function Tf(e,f){f.Fb=function(){return this.index+":"+this.id};e.Pe.set(f.index,f);if(null==e.ub||f.id===Je().nf)e.ub=f}function Sf(e,f){this.scene3D=e;this.domElement=f;this.Ua=new THREE.Vector3;this.ya=new THREE.Vector3;this.ea=new THREE.Vector3;this.Ma=new THREE.Vector3;this.ka=new THREE.Vector3;this.ca=new THREE.Vector3;this.maxDistance=Infinity}
var wf=.4,Vf=.1,Uf=1.5;
function Wf(e,f){Sf.call(this,e,f);this.u={NONE:-1,pd:0,ue:1,se:2,ve:3};this.v=this.u.NONE;var g=this,h;this.Hh=!1;this.tb=function(e){ld(g.scene3D.aa.ba);h=e.timeStamp;Xf(!1);if(g.v===g.u.NONE)g.v=e.button;else if(g.v===g.u.pd||g.v===g.u.se)g.v=g.u.ve;g.v===g.u.pd?g.Ua=g.Ma=Yf(g,e.clientX,e.clientY):g.v===g.u.ue||g.v===g.u.ve?g.ya=g.ka=Yf(g,e.clientX,e.clientY):g.ea=g.ca=Yf(g,e.clientX,e.clientY)};this.Qc=function(e){Xf(!0);g.v=g.u.NONE;h=e.timeStamp-h;if(300>h&&5>Math.abs(g.ca.x-g.ea.x)&&5>Math.abs(g.ca.y-
g.ea.y)){var f=[],l;for(l in g.scene3D.na)f=f.concat(Zf(g.scene3D.na[l]));l=e.offsetX/$("#content").width()*2-1;var q=2*-(e.offsetY/$("#content").height())+1,f=ae(g.scene3D,f,l,q);if(2==e.button)l=g.scene3D.aa.ba,e={target:null!=f?f:null,pageX:e.pageX,pageY:e.pageY},l.contextMenu.menu.getMenu()[0].parentElement!==l.lh[0]?(e.xj=!0,f=l.gj.offset(),e.pageX+=f.left,e.pageY+=f.top):e.xj=!1,l.contextMenu.div.contextmenu("open",l.mk,e);else if(0==e.button){for(l=0;l<g.callback.length;l++)if("function"===
typeof g.callback[l]&&null!=f)g.callback[l](f);if(null!=f&&g.Hh&&(e=g.scene3D,f!=e.ze)){if(e.aa.eb!==e)throw"In order to measure, you must have the scene as camera target";l=f.Aa().xa;var q=l.Bc(),r=ye(e.aa,q.ta(),l.type,l.id)[0];void 0!=e.ze&&(ye(e.aa,q.ta(),l.type,l.id),e.tc=e.ze.pos.clone(),e.tc.applyMatrix4(r.matrixWorld),e.tc.applyMatrix4((new THREE.Matrix4).getInverse(e.scene.matrixWorld)));e.tc?e.wd||(e.wd=f.pos.clone(),e.wd.applyMatrix4(r.matrixWorld),e.wd.applyMatrix4((new THREE.Matrix4).getInverse(e.scene.matrixWorld)),
f=new THREE.Geometry,f.vertices.push(e.tc),f.vertices.push(e.wd),f.computeLineDistances(),l=new THREE.LineDashedMaterial({color:16760576,dashSize:.7,gapSize:.3,linewidth:1.5}),f=new THREE.Line(f,l),e.scene.add(f),l=e.tc.distanceTo(e.wd).toFixed(2),l=cf(l),l=new THREE.SpriteMaterial({map:l}),l.depthTest=!1,l.depthWrite=!1,q=new THREE.Sprite(l),r=(new THREE.Vector3).addVectors(e.tc,e.wd).multiplyScalar(.5),q.position.set(r.x,r.y,r.z),q.scale.set(l.map.image.width/40,l.map.image.height/40,1),e.scene.add(q),
e.mf.push(f),e.mf.push(q),e.tc=null,e.wd=null):(e.tc=f.pos.clone(),e.tc.applyMatrix4(r.matrixWorld),e.tc.applyMatrix4((new THREE.Matrix4).getInverse(e.scene.matrixWorld)))}}}};this.Qd=function(e){e.preventDefault()};this.hc=function(e){if(g.v===g.u.NONE){var f=[],h;for(h in g.scene3D.na)f=f.concat(Zf(g.scene3D.na[h]));h=e.offsetX/$("#content").width()*2-1;e=2*-(e.offsetY/$("#content").height())+1;f=ae(g.scene3D,f,h,e);e=null;null!=f&&(e=f.$b());g.scene3D.aa.fh(e)}else g.v===g.u.pd?g.Ma=Yf(g,e.clientX,
e.clientY):g.v===g.u.ue||g.v===g.u.ve?g.ka=Yf(g,e.clientX,e.clientY):g.v===g.u.se&&(g.ca=Yf(g,e.clientX,e.clientY))};this.Rc=function(e){e.preventDefault();e.stopPropagation();if(!0===e.ctrlKey){var f=g.scene3D;e=g.scene3D.aj+.05*e.deltaY;f.aj=e;f.camera.focus=e}else g.scene3D.aa.translate(0,0,-e.deltaY*e.deltaFactor*wf)};this.update=function(){if(g.v!==g.u.NONE)if(g.v===g.u.pd){var e=.025*(this.Ma.x-this.Ua.x),f=.025*(this.Ma.y-this.Ua.y);g.scene3D.aa.rotate(e,f,0);this.Ua=this.Ma}else g.v===g.u.ue||
g.v===g.u.ve?(e=this.ka.y-this.ya.y,e=this.v===this.u.ve?2*e:e*wf,g.scene3D.aa.translate(0,0,1*e),this.ya=this.ka):g.v===g.u.se&&(e=.2*(this.ca.x-this.ea.x),f=.2*(this.ca.y-this.ea.y),g.scene3D.aa.translate(e,-f,0),this.ea=this.ca)};this.callback=[];this.nj=function(e){this.callback.push(e)};this.Gj=function(){this.callback=[]};this.hh=function(e){var f=[],h;for(h in g.scene3D.na)f=f.concat(Zf(g.scene3D.na[h]));h=e.offsetX/$("#content").width()*2-1;var q=2*-(e.offsetY/$("#content").height())+1,f=
ae(g.scene3D,f,h,q);null!==f?(f=g.scene3D.aa.gb(f.Aa().xa.Bc().ta())[0],!0===e.ctrlKey&&(g.scene3D.aa.eb=f),g.scene3D.aa.Sa=f,pf(g.scene3D.aa)):(g.scene3D.aa.eb=g.scene3D,g.scene3D.aa.Sa=null)};$(this.domElement).on("mousemove",this.hc);$(this.domElement).on("mousedown",this.tb);$(this.domElement).on("mouseup",this.Qc);$(document.body).on("dragstart ondrop",function(){return!1});$(this.domElement).on("click",function(){clearTimeout(void 0)});$(this.domElement).on("dblclick",function(e){e.preventDefault();
e.stopPropagation();clearTimeout(void 0);g.hh(e);return!1});$(this.domElement).on("contextmenu",this.Qd);$(this.domElement).on("mousewheel",this.Rc)}Wf.prototype=Object.create(Sf.prototype);Wf.prototype.constructor=Wf;function Yf(e,f,g){e=e.domElement.getBoundingClientRect();return{x:f-e.left,y:g-e.top}}
function $f(e,f){Sf.call(this,e,f);this.u={NONE:-1,pd:0,ue:1,se:2,ve:3};this.v=this.u.NONE;var g=this,h=new Hammer.Manager(this.domElement),k=new Hammer.Swipe({direction:Hammer.DIRECTION_ALL}),m=new Hammer.Pan({direction:Hammer.DIRECTION_ALL,pointers:0,threshold:50}),l=new Hammer.Pinch({enable:!0,threshold:.3}),q=new Hammer.Tap({enable:!0});h.add(k);h.add(m);h.add(l);h.add(q);m.recognizeWith(k);this.tb=function(e){if(g.v===g.u.NONE&&"mouse"!==e.pointerType)switch(e.type){case "panstart":if(.5<Math.abs(e.velocity)||
0===e.velocity)break;var f=e.center;g.ea={x:f.x,y:f.y};g.ca={x:f.x,y:f.y};g.v=1===e.pointers.length?g.u.pd:g.u.se;break;case "pinchstart":g.ya=e.scale;g.ka=e.scale;g.v=g.u.ue;break;case "swipeup":g.scene3D.aa.ba.md.show();break;case "swipeleft":g.scene3D.aa.ba.ql.show(!0);break;case "swiperight":g.scene3D.aa.ba.ik.show();break;case "swipedown":g.scene3D.aa.ba.md.hide(),g.scene3D.aa.ba.ql.show(!1),g.scene3D.aa.ba.ik.hide()}};this.Ma=function(){g.v=g.u.NONE};this.Ua=function(e){if("mouse"!==e.pointerType)switch(e.type){case "panmove":e=
g.v===g.u.pd?{x:e.pointers[0].clientX,y:e.pointers[0].clientY}:e.center;g.ca={x:e.x,y:e.y};break;case "pinchmove":g.ka=e.scale}};this.update=function(){if(this.v!==this.u.NONE)if(this.v===this.u.pd){var e=.0125*(this.ca.x-this.ea.x),f=.0125*(this.ca.y-this.ea.y);this.scene3D.aa.rotate(e,f,0);this.ea=this.ca}else this.v===this.u.ue?(this.scene3D.aa.translate(0,0,30*(this.ka-this.ya)),this.ya=this.ka):this.v===this.u.se&&(e=.1*(this.ca.x-this.ea.x),f=.1*(this.ca.y-this.ea.y),this.scene3D.aa.translate(e,
-f,0),this.ea=this.ca)};h.on("panstart pinchstart swipeleft swiperight swipeup swipedown press tap",this.tb);h.on("panend pinchend",this.Ma);h.on("panmove pinchmove",this.Ua)}$f.prototype=Object.create(Sf.prototype);$f.prototype.constructor=$f;function R(e){this.wa=e;this.ja=this.wa.ja;this.Ia=this.wa.qa;this.parent=this.wa;this.fa=Je();this.fa.subscribe(this);this.visible=!0;this.da=null;this.pc=[];this.u=null}z=R.prototype;
z.Ka=function(){throw"This method must be defined by childrens of Representation";};z["delete"]=function(){this.fa.unsubscribe(this);if(null!=this.da)if(this.parent.remove(this.da),this.da.geometry.dispose(),this.da.material instanceof THREE.MultiMaterial)for(var e=this.da.material.materials,f=0;f<e.length;f++)e[f].dispose();else this.da.material.dispose()};z.nd=function(){this.wa instanceof ag?this.color(V.ob):this.wa instanceof bg?this.color(V.jc):this.color(V.ob)};
z.yb=function(e,f){null==this.da&&this.Ka();var g=this.da.geometry.attributes.highlight;if(null!=g){var h=e?1:0,k=g.array.slice();if(null!=f){for(var m=[],l=this.da.geometry.attributes.atomIndex.array,q=0;q<f.length;q++)m.push(this.ja.indexOf(f[q]));for(var q=g.count,r=0;r<q;r++)-1!==m.indexOf(l[r])&&(k[r]=h)}else k.fill(h);g.set(k);g.needsUpdate=!0}};z.show=function(){null===this.da&&this.Ka();null!==this.da&&(this.visible=this.da.visible=!0)};
z.hide=function(){null!==this.da&&(this.visible=this.da.visible=!1)};
z.color=function(e,f){this.u=e;var g,h,k,m;if("string"===typeof e){if(void 0!=Ed[e])h=Ed[e].r,k=Ed[e].g,m=Ed[e].b;else if("#"==e.substring(0,1))g=e.replace("#",""),e=[parseInt(g.substring(0,2),16),parseInt(g.substring(2,4),16),parseInt(g.substring(4,6),16)],h=e[0],k=e[1],m=e[2];else if("rgb("==e.substring(0,4))e=e.replace("rgb(",""),e=e.replace(")",""),e=e.split(","),h=e[0],k=e[1],m=e[2];else throw Error("unrecognized color");if(void 0!=f)return g=new Nf(f,this),Of(g,h,k,m),g;cg(this,h,k,m)}else{a:{for(g in V)if(V[g]===
e){g=!0;break a}g=!1}if(g){if(void 0!=f)return h=dg(this,e),k=g=new Nf(f,this),k.Mh=!0,k.map=h,k.init(),g;g=e;if(null!==this.da)if(h=this.da.geometry,h instanceof THREE.BufferGeometry){k=h.attributes.color.array;m=h.attributes.atomIndex.array.length;for(var l=0;l<m;l++){var q;q=g;var r=l;null==this.pc[q.id]&&(this.pc[q.id]=dg(this,q));q=this.pc[q.id][r];void 0!=q&&(k[3*l]=q.r,k[3*l+1]=q.g,k[3*l+2]=q.b)}h.attributes.color.needsUpdate=!0}else console.warn("Unknown type of geometry for coloring by atom ",
h)}else if(3===e.length){h=e[0];k=e[1];m=e[2];if(0<f)return g=new Nf(f,this),Of(g,h,k,m),g;cg(this,h,k,m)}else if(Array.isArray(e)){if(g=e,this.wa instanceof ag||console.warn("Buffer coloring is only managed for Molecule3D"),null!==this.da)if(h=this.da.geometry,h instanceof THREE.BufferGeometry){k=h.attributes.color.array;m=h.attributes.atomIndex.array;l=m.length;if(this.wa.ra.ga.length!==g.length)for(q=0;q<l;q++){var t=m[q],t=this.ja[t],w=t.u-1,t=g[w];if(null==t)console.warn("Unknow color for residue id ",
w,". Buffer size is ",g.length);else{var w=t[0],x=t[1],t=t[2];if(1<w||1<x||1<t)w/=255,x/=255,t/=255;k[3*q]=w;k[3*q+1]=x;k[3*q+2]=t}}else{var B=r=-1;for(q=0;q<l;q++)if(t=m[q],t=this.ja[t],w=t.u-1,w!==r&&(B++,r=w),t=g[B],null==t)console.warn("Unknow color for residue id ",B,". Buffer size is ",g.length);else{w=t[0];x=t[1];t=t[2];if(1<w||1<x||1<t)w/=255,x/=255,t/=255;k[3*q]=w;k[3*q+1]=x;k[3*q+2]=t}}h.attributes.color.needsUpdate=!0}else console.warn("Unknown type of geometry for coloring by buffer ",
h)}else throw Error("unrecognized color");}};
function dg(e,f){var g=e.pc,h=f.id,k;if(f===V.zi){var m=[];e.wa instanceof ag?m=e.wa.ra.Ea():e.wa instanceof bg?m=e.wa.Ab.Ea():e.wa instanceof eg&&(m=[e.wa.Em]);k=new Fa;for(var l=m.length,q=0;q<l;q++)k.set(m[q],(new THREE.Color).setHSL(q/l*.8,1,.42));if(null!==e.da){q=e.da.geometry;m=[];if(q instanceof THREE.BufferGeometry)for(l=q.attributes.atomIndex.array,q=0;q<l.length;q++){var r=k.get(e.ja[l[q]]);m.push(r)}else console.warn("Unknown type of geometry for mapping by rainbow ",q);k=m}else k=void 0}else if(f===
V.xi)if(e.wa instanceof ag?e.wa.ra.Ea():e.wa instanceof bg&&e.wa.Ab.Ea(),l=e.da.geometry,k=[],q="IVLFCMAGTWSYPHEZQDBNKR".split(""),m=[45,42,38,28,25,19,18,-4,-7,-9,-8,-13,-16,-32,-35,-35,-35,-35,-35,-35,-39,-45],null!=e.da)for(l=l.attributes.atomIndex.array,r=0;r<l.length;r++){var t=null,t=e.ja[l[r]].Aa();if("Peptide"==t.type||"Protein"==t.type||"Small Peptide"==t.type){var w;for(w=0;w<q.length&&q[w]!=t.oj().toUpperCase();w++);w==q.length?t=new THREE.Color(1,1,1):(t=m[w],t=0<t?new THREE.Color(1,1-
t/45,1-t/45):new THREE.Color(1-t/-45,1-t/-45,1))}else t=new THREE.Color(1,1,1);k.push(t)}else k=void 0;else if(null!==e.da){k=e.da.geometry.attributes.atomIndex.array;q=k.length;m=[];for(l=0;l<q;l++){var r=e,t=k[l],x=w=w=w=void 0,x=void 0;switch(f){case V.sc:w=r.ja[t].Aa().xa.id.toUpperCase();w=af(r.fa,w,"M");break;case V.jc:w=r.ja[t].Aa().xb().toUpperCase();w=af(r.fa,w,"R");break;case V.ob:x=r.ja[t];x=x.symbol.charAt(0).toUpperCase()+x.symbol.slice(1).toLowerCase();w=af(r.fa,x,"A");break;case V.vi:x=
r.ja[t];"C"===x.symbol&&(x=x.symbol.charAt(0).toUpperCase()+x.symbol.slice(1).toLowerCase(),w=af(r.fa,x,"A"));break;case V.wi:x=r.ja[t];"C"!==x.symbol&&(x=x.symbol.charAt(0).toUpperCase()+x.symbol.slice(1).toLowerCase(),w=af(r.fa,x,"A"));break;case V.Ai:x=r.ja[t],w=af(r.fa,x.Aa().nb.name,"SST")}m.push(w)}k=m}else k=void 0;g[h]=k;return e.pc[f.id]}
function cg(e,f,g,h){1<f&&(f=f/255);1<g&&(g=g/255);1<h&&(h=h/255);if(null!==e.da)if(e=e.da.geometry,e instanceof THREE.BufferGeometry){for(var k=e.attributes.color.array,m=k.length/3,l=0;l<m;l++)k[3*l]=f,k[3*l+1]=g,k[3*l+2]=h;e.attributes.color.needsUpdate=!0}else console.warn("Unknown type of geometry for coloring by atom ",e)}
z.yg=function(e,f){if(null!==this.da)if(void 0===f||0===f){if(this.da.material instanceof THREE.MultiMaterial)for(var g=0,h=this.da.material.materials.length;g<h;g++){var k=this.da.material.materials[g];k.transparent=1!==e;k.blending=k.transparent&&this.fa.ef?THREE.CustomBlending:THREE.NormalBlending;k.opacity=e}this.da.material.transparent=1!==e;this.da.material.blending=this.da.material.transparent&&this.fa.ef?THREE.CustomBlending:THREE.NormalBlending;this.da.material.opacity=e}else return new Mf(e,
f,this);return null};z.update=function(e){if(e.ki){e=e.jh;if(void 0!=e){if("Amino Acids"===e||"Nucleic Acids"===e)e=V.jc;this.pc[e]=null}else this.pc=[];this.color(this.u)}};
var V={sc:{name:"Molecules",id:"molecule"},jc:{name:"Residues",id:"residue"},ob:{name:"Atoms",id:"atom"},vi:{name:"Carbon atom",id:"carbon"},wi:{name:"Heteroatom",id:"heteroatom"},Ai:{name:"Secondary Structure",id:"sse"},zi:{name:"Rainbow",id:"rainbow"},xi:{name:"Hydrophobicity",id:"hydrophobicity"},Mk:function(){var e=[],f;for(f in this){var g=this[f];this.hasOwnProperty(f)&&"object"===("undefined"===typeof g?"undefined":ia(g))&&e.push(g.name)}return e},uh:function(e){for(var f in this)if(this[f].id===
e)return this[f];return null},eg:function(e){for(var f in this)if(this[f].name===e)return this[f];return null}};function fg(e,f,g){this.name=e;this.commandName=f;this.Ja=g;var h=arguments.length-3;1<=h&&(this.ol=arguments[3]);2<=h&&(this.mm=arguments[4])}var P={};P.NONE=new fg("","NONE",null);P.hg=function(e){for(var f in P)if(P[f].commandName===e)return P[f]};var gg=Object;
gg.Ck=function(e,f){for(var g=null,h=hg(e),k=h.length,m=0;m<k;m++)g=h[m],g.lb=!1,g.alpha=THREE.GeometryUtils.cm(g.a,g.b,g.c,g.d),g.Oc=g.alpha>f;for(var l=new Fa,h=hg(e),k=h.length,m=0;m<k;m++){for(var g=h[m],q=[],r=ig(g),t=0;4>t;t++){var w=jg(g,t);q.push(gg.fl(g,w[3],r[t],w[0],w[1],w[2],f))}l.set(g,q)}w=[];h=hg(e);k=h.length;for(m=0;m<k;m++)if(g=h[m],g.lb=!1,g.Oc=!1,null==g.Hb||null==g.Lb||null==g.Mb||null==g.Ob){r=ig(g);q=l.get(g);for(t=0;4>t;t++)null!=r[t]||q[t]||(g.Oc=!0);g.Oc&&w.push(g)}for(;0!==
w.length;)for(m=w[w.length-1],w.splice(w.length-1),m.lb=!0,m.Oc=!0,r=ig(m),q=l.get(m),t=0;4>t;t++)null==r[t]||r[t].lb||q[t]||w.push(r[t]);h=hg(e);k=h.length;for(m=0;m<k;m++)if(g=h[m],g.lb=!1,!g.Oc)for(r=ig(g),q=l.get(g),t=0;4>t;t++)null==r[t]||r[t].Oc||(q[t]=!1);return l};
gg.nk=function(e,f,g){g=gg.Ck(f,g);f=hg(f);for(var h=[],k=Array(3),m=f.length,l=0;l<m;l++){for(var q=f[l],r=ig(q),t=g.get(q),r=r.length,w=0;w<r;w++)if(t[w]){for(var x=jg(q,w),B=0;3>B;B++){var C=x[B],G=h.indexOf(C);-1===G&&(G=h.push(C)-1,de(e,C.x,C.y,C.z));k[B]=G}q.Oc?ee(e,k[2],k[1],k[0]):ee(e,k[0],k[1],k[2])}q.lb=!0}return h};
gg.fl=function(e,f,g,h,k,m,l){if(null==e)throw"!!";var q=e.Oc,r=null==g||g.Oc;return q!=r||q&&r&&(null==g||0<THREE.GeometryUtils.rj(h,k,m,kg(e,g)))&&0<THREE.GeometryUtils.rj(h,k,m,f)&&l>=THREE.GeometryUtils.em(h,k,m)?!0:!1};function lg(){this.Cj=1.4;this.alpha=0;this.Xi=new Fa}function mg(){this.Ia=[];this.jj=[];this.ag=0}function ng(e){return e.Ia.length-e.ag}function og(e,f,g){THREE.Vector3.call(this);this.Fh=!0;this.x=e;this.y=f;this.z=g;this.radius=this.weight=1;this.Ib=[]}
og.prototype.set=function(e,f){this.weight=e;this.radius=f};og.prototype.toString=function(){return this.x+":"+this.y+":"+this.z};og.prototype.Fb=function(){return this.x+":"+this.y+":"+this.z};function pg(e,f,g,h){for(var k=e.Ib.length,m=0;m<k;m++){var l=e.Ib[m];if(qg(l,g)&&qg(l,h)&&l!=f)return l}return null}og.prototype.remove=function(){for(var e=[],f=this.Ib.length,g=0;g<f;g++)e.push(this.Ib[g]);f=e.length;for(g=0;g<f;g++)e[g].disconnect()};
function rg(){this.Zi=this.Mc=this.Bd=this.lc=this.max=this.min=null;this.qf=0;this.Lc=[];this.ae=[];this.cb=[];this.iterator=null;this.pl=0}rg.prototype.toString=function(){return"Tesselation"};function sg(e,f){var g=Math.trunc((f.x-e.min.x)*e.lc/(e.max.x-e.min.x)),h=Math.trunc((f.y-e.min.y)*e.Bd/(e.max.y-e.min.y)),k=Math.trunc((f.z-e.min.z)*e.Mc/(e.max.z-e.min.z));0>g&&(g=0);g>=e.lc&&(g=e.lc-1);0>h&&(h=0);h>=e.Bd&&(h=e.Bd-1);0>k&&(k=0);k>=e.Mc&&(k=e.Mc-1);return g+h*e.lc+k*e.lc*e.Mc}
function tg(e,f,g){f.cf=!0;e.ae.push(f);var h=f.Hb;null==h||void 0===h||h.lb||(h.lb=!0,0<ug(h,g)&&tg(e,h,g));h=f.Lb;null==h||void 0===h||h.lb||(h.lb=!0,0<ug(h,g)&&tg(e,h,g));h=f.Mb;null==h||void 0===h||h.lb||(h.lb=!0,0<ug(h,g)&&tg(e,h,g));h=f.Ob;null==h||void 0===h||h.lb||(h.lb=!0,0<ug(h,g)&&tg(e,h,g))}
function vg(e,f){f.lb=!1;var g;g=f.Hb;null!=g&&void 0!==g&&g.lb&&vg(e,g);g=f.Lb;null!=g&&void 0!==g&&g.lb&&vg(e,g);g=f.Mb;null!=g&&void 0!==g&&g.lb&&vg(e,g);g=f.Ob;null!=g&&void 0!==g&&g.lb&&vg(e,g)}function hg(e){var f=0;e.iterator=new wg(e);for(var g=[];null!=e.iterator.bb;){var h=e.iterator.next();void 0!==h&&g.push(h);f++}return g}
function wg(e){this.Xd=e;this.Ub=this.Wb=0;for(this.bb=this.Xd.Lc[this.Wb];this.Wb<this.Xd.qf&&(null==this.bb||void 0==this.bb||0==ng(this.bb));)this.Wb++,this.bb=this.Wb<this.Xd.qf?this.Xd.Lc[this.Wb]:null;if(null!=this.bb&&void 0!=this.bb)for(;this.Ub<this.bb.Ia.length&&(null==this.bb.Ia[this.Ub]||void 0==this.bb.Ia[this.Ub]);)this.Ub++}
wg.prototype.next=function(){var e=this.Xd.Lc[this.Wb].Ia[this.Ub];for(this.Ub++;this.Ub<this.bb.Ia.length&&(null==this.bb.Ia[this.Ub]||void 0===this.bb.Ia[this.Ub]);)this.Ub++;if(this.Ub>=this.bb.Ia.length){this.Ub=0;for(this.Wb++;this.Wb<this.Xd.qf;){this.bb=this.Xd.Lc[this.Wb];if(null!==this.bb&&void 0!==this.bb&&0<ng(this.bb))break;this.Wb++}this.Wb>=this.Xd.qf&&(this.bb=null)}if(null!=this.bb&&void 0!=this.bb)for(;this.Ub<this.bb.Ia.length&&null==this.bb.Ia[this.Ub];)this.Ub++;return e};
function xg(){this.lb=!1;this.Oc=null;this.alpha=-1;this.cf=!1;this.box=this.d=this.c=this.b=this.a=this.Sh=null;this.Wb=-1;this.id=this.Ob=this.Mb=this.Lb=this.Hb=null}xg.prototype.toString=function(){return this.Sh+":"+this.id};xg.prototype.Fb=function(){return this.Sh+":"+this.id};
xg.prototype.set=function(e,f,g,h,k,m){this.Sh=e;this.a=f;this.b=g;this.c=h;this.d=k;this.cf=!1;this.id=e.pl++;var l=new THREE.Vector3((this.a.x+this.b.x+this.c.x+this.d.x)/4,(this.a.y+this.b.y+this.c.y+this.d.y)/4,(this.a.z+this.b.z+this.c.z+this.d.z)/4),l=sg(e,l);if(void 0===e.Lc[l]||null===e.Lc[l])e.Lc[l]=new mg;e=e.Lc[l];this.box=e;e=this.box;l=0<e.ag?e.jj[--e.ag]:e.Ia.length;e.Ia[l]=this;this.Wb=l;f.Ib.push(this);g.Ib.push(this);h.Ib.push(this);k.Ib.push(this);null!=m?this.Hb=m:this.Hb=pg(this.a,
this,this.b,this.c);null!=this.Hb&&yg(this.Hb,this.a,this.b,this.c,this);this.Lb=pg(this.a,this,this.c,this.d);null!=this.Lb&&yg(this.Lb,this.a,this.c,this.d,this);this.Mb=pg(this.a,this,this.d,this.b);null!=this.Mb&&yg(this.Mb,this.a,this.d,this.b,this);this.Ob=pg(this.b,this,this.d,this.c);null!=this.Ob&&yg(this.Ob,this.b,this.d,this.c,this)};
function ug(e,f){var g=e.a.x-f.x,h=e.a.y-f.y,k=e.a.z-f.z,m=e.b.x-f.x,l=e.b.y-f.y,q=e.b.z-f.z,r=e.c.x-f.x,t=e.c.y-f.y,w=e.c.z-f.z,x=e.d.x-f.x,B=e.d.y-f.y,C=e.d.z-f.z;return-THREE.GeometryUtils.sign(THREE.GeometryUtils.vk(g,h,k,g*g+h*h+k*k+(f.weight-e.a.weight),m,l,q,m*m+l*l+q*q+(f.weight-e.b.weight),r,t,w,r*r+t*t+w*w+(f.weight-e.c.weight),x,B,C,x*x+B*B+C*C+(f.weight-e.d.weight)))}
function yg(e,f,g,h,k){if(f===e.a||g===e.a||h===e.a)if(f===e.c||g===e.c||h===e.c)f===e.b||g===e.b||h===e.b?e.Hb=k:e.Lb=k;else{if(f!==e.d&&g!==e.d&&h!==e.d)throw"This tetrahedron doesn't have the right vertices";e.Mb=k}else if(f===e.b||g===e.b||h===e.b)e.Ob=k;else throw"This tetrahedron doesn't have the right vertices - ("+f+"),("+g+"),("+h+") - ("+a+"),("+b+"),("+c+"),("+d+")";}function ig(e){var f=[];f.push(e.Hb);f.push(e.Lb);f.push(e.Mb);f.push(e.Ob);return f}
function jg(e,f){if(0==f)return[e.c,e.b,e.a,e.d];if(1==f)return[e.d,e.c,e.a,e.b];if(2==f)return[e.b,e.d,e.a,e.c];if(3==f)return[e.c,e.d,e.b,e.a];throw"i :"+f+" not between 0 and 3";}function qg(e,f){return e.a.x===f.x&&e.a.y===f.y&&e.a.z===f.z||e.b.x===f.x&&e.b.y===f.y&&e.b.z===f.z||e.c.x===f.x&&e.c.y===f.y&&e.c.z===f.z||e.d.x===f.x&&e.d.y===f.y&&e.d.z===f.z}
xg.prototype.disconnect=function(){var e=this.box,f=this.Wb;e.Ia[f]=null;e.jj[e.ag++]=f;null!=this.Hb&&yg(this.Hb,this.a,this.b,this.c,null);null!=this.Lb&&yg(this.Lb,this.a,this.c,this.d,null);null!=this.Mb&&yg(this.Mb,this.a,this.d,this.b,null);null!=this.Ob&&yg(this.Ob,this.b,this.d,this.c,null);this.a.Ib.splice(this.a.Ib.indexOf(this),1);this.b.Ib.splice(this.b.Ib.indexOf(this),1);this.c.Ib.splice(this.c.Ib.indexOf(this),1);this.d.Ib.splice(this.d.Ib.indexOf(this),1);this.Ob=this.Mb=this.Lb=this.Hb=
this.d=this.c=this.b=this.a=null};function kg(e,f){if(f.Hb==e)return f.d;if(f.Lb==e)return f.b;if(f.Mb==e)return f.c;if(f.Ob==e)return f.a;throw"getOtherVertex: Tetrahedra "+e+" and "+f+" not touching";}function zg(e,f){R.call(this,e);this.wireframe=f}zg.prototype=Object.create(R.prototype);zg.prototype.constructor=zg;P.Kg=new fg("Alpha Shape","ASHAPE",zg,!1);P.oi=new fg("Alpha Shape Wireframe","ASHAPEM",zg,!0);
zg.prototype.Ka=function(){var e=ff(this.fa),f=null;if(this.wireframe)e.wireframe=!0,e.wireframeLinewidth=2,f=Sg(this.wa,P.Kg),null===f.da&&(f.Ka(),f.hide()),f=f.da.geometry.clone();else{e.side=THREE.DoubleSide;e.shading=THREE.FlatShading;for(var f=new lg,g=this.ja,h=[],k=g.length,m=0;m<k;m++){var l=g[m];f.Xi.set(l.pos,l);var q=ef(Je(),l),r=(q+f.Cj)*(q+f.Cj),l=new og(l.pos.x,l.pos.y,l.pos.z);l.set(r,q);h.push(l)}l=new rg;if(4>h.length)throw"Too few points to tesselate";l.min=new THREE.Vector3(Infinity,
Infinity,Infinity);l.max=new THREE.Vector3(-Infinity,-Infinity,-Infinity);k=h.length;for(m=0;m<k;m++)q=h[m],l.min.x=Math.min(l.min.x,q.x),l.min.y=Math.min(l.min.y,q.y),l.min.z=Math.min(l.min.z,q.z),l.max.x=Math.max(l.max.x,q.x),l.max.y=Math.max(l.max.y,q.y),l.max.z=Math.max(l.max.z,q.z);var r=(l.min.x+l.max.x)/2,t=(l.min.y+l.max.y)/2,w=(l.min.z+l.max.z)/2,x=l.min.distanceTo(l.max);l.lc=8;l.Bd=8;l.Mc=8;l.Zi=Math.max(l.lc,Math.max(l.Bd,l.Mc));l.qf=l.lc*l.Bd*l.Mc;k=new og(r-x,t-x,w-x);m=new og(r+x,t+
x,w-x);q=new og(r-x,t+x,w+x);r=new og(r+x,t-x,w+x);(new xg).set(l,k,m,q,r,null);t=h.length;for(w=0;w<t;w++){var x=l,B=h[w];x.ae=[];var C=!1,G=x.Lc[sg(x,B)];if(void 0!==G&&null!==G){var I=void 0;for(I in G.Ia){var D=G.Ia[I];if(null!=D){var J=ug(D,B);0===J&&console.warn(">1 point on the same power sphere");if(null!==D&&void 0!==D&&0<J){D.lb=!0;tg(x,D,B);vg(x,D);C=!0;break}}}}if(!C)for(var G=!1,J=Math.trunc((B.x-x.min.x)*x.lc/(x.max.x-x.min.x)),F=Math.trunc((B.y-x.min.y)*x.Bd/(x.max.y-x.min.y)),K=Math.trunc((B.z-
x.min.z)*x.Mc/(x.max.z-x.min.z)),C=1;C<x.Zi&&!G;C++)for(var N=-C;N<=C&&!G;N++)for(var O=-C;O<=C&&!G;O++)for(var U=-C;U<=C&&!G;U++)if(Math.abs(U)==C||Math.abs(O)==C||Math.abs(N)==C){var D=J+U,aa=F+O,pa=K+N;if(!(0>D||D>=x.lc||0>aa||aa>=x.Bd||0>pa||pa>=x.Mc)&&(D=x.Lc[Math.trunc(D+aa*x.lc+pa*x.lc*x.Mc)],null!=D))for(I in aa=D.Ia,aa)if(D=aa[I],null!=D&&void 0!=D&&0<ug(D,B)){D.lb=!0;tg(x,D,B);vg(x,D);G=!0;break}}x.cb=[];G=x.ae.length;for(C=0;C<G;C++)D=x.ae[C],null!=D.Hb&&D.Hb.cf||(x.cb.push(D.Hb),x.cb.push(D.a),
x.cb.push(D.b),x.cb.push(D.c)),null!=D.Lb&&D.Lb.cf||(x.cb.push(D.Lb),x.cb.push(D.a),x.cb.push(D.c),x.cb.push(D.d)),null!=D.Mb&&D.Mb.cf||(x.cb.push(D.Mb),x.cb.push(D.a),x.cb.push(D.d),x.cb.push(D.b)),null!=D.Ob&&D.Ob.cf||(x.cb.push(D.Ob),x.cb.push(D.b),x.cb.push(D.d),x.cb.push(D.c));for(C=0;C<G;C++)D=x.ae[C],D.disconnect();D=0;G=x.cb.length;for(C=0;C<G;C+=4)J=x.cb[C],F=x.cb[C+1],K=x.cb[C+2],N=x.cb[C+3],O=(new THREE.Vector3((F.x+K.x+N.x)/3,(F.y+K.y+N.y)/3,(F.z+K.z+N.z)/3)).sub(B),O=0>THREE.Vector3.u(F,
K,N).dot(O),U=D<x.ae.length?x.ae[D++]:new xg,O?U.set(x,F,K,N,B,J):U.set(x,N,K,F,B,J)}k.remove();m.remove();q.remove();r.remove();I=new ce(!0);h=gg.nk(I,l,f.alpha);k=h.length;for(l=0;l<k;l++){m=h[l];q=f.Xi.get(m);r=g.indexOf(q);if(void 0===q)throw"Couldn't get atom for position :"+m.x+", "+m.y+", "+m.z;I.Zc.push(r)}f=fe(I);f.computeVertexNormals()}e=new THREE.Mesh(f,e);e.Ja=this;this.parent.add(e);this.da=e;this.color(V.ob)};zg.prototype.update=function(e){R.prototype.update.call(this,e)};
function Tg(e){R.call(this,e)}Tg.prototype=Object.create(R.prototype);Tg.prototype.constructor=Tg;P.re=new fg("Atoms","ATOMS",Tg);
Tg.prototype.Ka=function(){for(var e=new THREE.BufferGeometry,f=[],g=[],h=[],k=this.ja.length,m=0;m<k;m++){var l=this.ja[m],q=l.pos.clone();q.qa=l;q.x-=.5;var r=l.pos.clone();r.qa=l;r.x+=.5;var t=l.pos.clone();t.qa=l;t.y-=.5;var w=l.pos.clone();w.qa=l;w.y+=.5;var x=l.pos.clone();x.qa=l;x.z-=.5;var B=l.pos.clone();B.qa=l;B.z+=.5;f.push(q.x,q.y,q.z,r.x,r.y,r.z,t.x,t.y,t.z,w.x,w.y,w.z,x.x,x.y,x.z,B.x,B.y,B.z);for(l=0;18>l;l++)g.push(1);for(l=0;6>l;l++)h.push(m)}e.addAttribute("position",THREE.Float32Attribute(f,
3));f=THREE.Float32Attribute(g,3);f.dynamic=!0;e.addAttribute("color",f);e.addAttribute("atomIndex",THREE.Float32Attribute(h,1));e.gd();h=new THREE.LineBasicMaterial({linewidth:this.fa.gi,vertexColors:THREE.VertexColors});e=new THREE.LineSegments(e,h);e.Ja=this;this.parent.add(e);this.da=e;this.nd()};Tg.prototype.update=function(e){R.prototype.update.call(this,e);e.gi&&(this.parent.remove(this.da),this.da=null,this.Ka())};function Ug(e){R.call(this,e)}Ug.prototype=Object.create(R.prototype);
Ug.prototype.constructor=Ug;P.gf=new fg("Balls & sticks","BSTICKS",Ug);
Ug.prototype.Ka=function(){if(this.fa.jg){var e=Sg(this.wa,P.kc);null===e.da&&(e.Ka(),e.hide());var f=e.da.geometry.clone(),g=f.attributes.radius.array;g.fill(this.fa.sa.ma.radius,0,e.uf);var h=kf(this.fa),k=lf(this.fa),k=new THREE.MultiMaterial([h,k]);k.opacity=h.opacity;f.addGroup(0,e.uf,0);f.addGroup(e.uf,g.length,1);e=new THREE.Points(f,k)}else{var f=bf(this.fa),e=ff(this.fa),m=(new THREE.BufferGeometry).fromGeometry(f),l=this.ja.length,q=m.attributes.position.array.length/m.attributes.position.itemSize,
k=l*q,g=Sg(this.wa,P.kc);null===g.da&&(g.Ka(),g.hide());for(var f=new THREE.BufferGeometry,g=g.da.geometry,r=Array(3*k),t=Array(3*k),w=Array(3*k),h=Array(2*k),k=Array(k),x=0;x<l;x++){var B=this.ja[x],C=new THREE.Matrix4;C.setPosition(B.pos);B=m.clone();B.applyMatrix(C);for(var G=B.attributes.position.array,C=0;C<G.length;C++)r[x*G.length+C]=G[C];G=B.attributes.normal.array;for(C=0;C<G.length;C++)t[x*G.length+C]=G[C];G=B.attributes.color.array;for(C=0;C<G.length;C++)w[x*G.length+C]=G[C];B=B.attributes.uv.array;
for(C=0;C<B.length;C++)h[x*B.length+C]=B[C];for(C=0;C<q;C++)k[x*q+C]=x}m=new Float32Array(r);l=new Float32Array(t);w=new Float32Array(w);h=new Float32Array(h);k=new Float32Array(k);q=new Float32Array(m.length+g.attributes.position.array.length);q.set(g.attributes.position.array);q.set(m,g.attributes.position.array.length);m=new Float32Array(l.length+g.attributes.normal.array.length);m.set(g.attributes.normal.array);m.set(l,g.attributes.normal.array.length);l=new Float32Array(w.length+g.attributes.color.array.length);
l.set(g.attributes.color.array);l.set(w,g.attributes.color.array.length);w=new Float32Array(h.length+g.attributes.uv.array.length);w.set(g.attributes.uv.array);w.set(h,g.attributes.uv.array.length);h=new Float32Array(k.length+g.attributes.atomIndex.array.length);h.set(g.attributes.atomIndex.array);h.set(k,g.attributes.atomIndex.array.length);f.addAttribute("position",new THREE.BufferAttribute(q,3));f.addAttribute("normal",new THREE.BufferAttribute(m,3));G=new THREE.BufferAttribute(l,3);G.dynamic=
!0;f.addAttribute("color",G);f.addAttribute("uv",new THREE.BufferAttribute(w,2));f.addAttribute("atomIndex",new THREE.BufferAttribute(h,1));f.gd();this.fa.jg&&ge(f);e=new THREE.Mesh(f,e)}e.Ja=this;this.parent.add(e);this.da=e;this.nd()};Ug.prototype.update=function(e){R.prototype.update.call(this,e);e.Af&&(this.pc=[],e=Sg(this.wa,P.kc),e.parent.remove(e.da),e.da=null,e=this.da.visible,this.parent.remove(this.da),this.da=null,this.Ka(),this.da.visible=e)};function Vg(e){R.call(this,e)}
Vg.prototype=Object.create(R.prototype);Vg.prototype.constructor=Vg;P.Jf=new fg("Cartoon","CARTOON",Vg);Vg.ya=.075;Vg.ka=1.2;Vg.ea=.25;Vg.tb=1.3;Vg.Ua=.5;Vg.ca=.175;Vg.v=.175;Vg.Ma=34;Vg.hc=12;
Vg.prototype.Ka=function(){var e=af(this.fa,this.wa.ra.id,"M"),f=null;if(this.Ia.Od()){var g=this.Ia;g.Vi();var h=[],f=[];h.push(f);for(var k=g.ga,g=g.Ea(),m=["N","CA","C"],l=null,q=k.length,r=0;r<q;r++){var t=k[r];if(null!==l){var w=0;isNaN(parseFloat(t.ta()))||(w+=parseFloat(t.ta()));isNaN(parseFloat(l.ta()))||(w-=parseFloat(l.ta()));isNaN(t.Bb().charCodeAt(0))||(w+=t.Bb().charCodeAt(0));isNaN(l.Bb().charCodeAt(0))||(w-=l.Bb().charCodeAt(0));1<w&&(f=[],h.push(f))}for(var x in m)if(l=t.nc(m[x]),
void 0!==l&&null!==l){var w=new Wg(l),B=g.indexOf(l);w.fc=e;w.qa=l;w.Xa=B;w.od="CA"!==l.name;switch(t.nb.name){case H.u.name:w.width=Vg.ya;w.height=Vg.ka;w.mc=Vg.ea;break;case H.v.name:case H.ea.name:w.width=Vg.tb;w.height=Vg.Ua;w.Cb=!0;w.de=Vg.Ma;break;default:w.width=Vg.ca,w.height=Vg.v}f.push(w)}l=t}f=h}else if(this.Ia.We()){g=this.Ia;x=[];f=[];x.push(f);k=g.ga;g=g.Ea();m=["P","O5'","O3'"];l=null;q=k.length;for(r=0;r<q;r++){t=k[r];null!==l&&1<t.ta()-l.ta()+t.Bb().charCodeAt(0)-l.Bb().charCodeAt(0)&&
(f=[],x.push(f));for(h in m)l=t.nc(m[h]),null!==l&&void 0!==l&&(w=new Wg(l),B=g.indexOf(l),w.fc=e,w.qa=l,w.Xa=B,w.od=!0,w.width=Vg.ya,w.height=Vg.ka,w.mc=Vg.ea,w.de=Vg.hc,f.push(w));l=t}f=x}x=new ce(!0);if(null!==f){var h=new Xg,C;for(C in f)2<f[C].length&&Yg(h,x,f[C],e);e=fe(x);C=ff(this.fa);e=new THREE.Mesh(e,C);e.qa=this.Ia;e.Ja=this;this.parent.add(e);this.da=e;this.color(V.sc)}};Vg.prototype.nd=function(){this.color(V.sc)};
Vg.prototype.update=function(e){R.prototype.update.call(this,e);e.gm&&(e=this.da.visible,this.pc=[],this.parent.remove(this.da),this.da=null,this.Ka(),this.da.visible=e)};function W(e){R.call(this,e)}W.prototype=Object.create(R.prototype);W.prototype.constructor=W;P.ti=new fg("Cylinder","CYLINDER",W);W.ya=.075;W.ka=1.2;W.ea=.25;W.tb=1.3;W.Ua=.5;W.ca=.175;W.v=.175;W.Ma=34;W.hc=12;W.u=20;W.Qc=2.5;
W.prototype.Ka=function(){var e=af(this.fa,this.wa.ra.id,"M"),f=null,g=[],h=[],k=[],m=[],l=[],q=[],r=[],t=[];if(this.Ia.Od()){var w=this.Ia;w.Vi();for(var x=w.ga,B=w.Ea(),C=[],G=[],I=[],D=[],J=[],F=[],K=[],N=[],O=!1,U=!1,aa=["N","CA","C"],pa=null,Gb=x.length,Sb=0;Sb<Gb;Sb++){var ga=x[Sb];if(null!==pa){var ca=0;isNaN(parseFloat(ga.ta()))||(ca+=parseFloat(ga.ta()));isNaN(parseFloat(pa.ta()))||(ca-=parseFloat(pa.ta()));isNaN(ga.Bb().charCodeAt(0))||(ca+=ga.Bb().charCodeAt(0));isNaN(pa.Bb().charCodeAt(0))||
(ca-=pa.Bb().charCodeAt(0));1<ca&&(O?(I.push(D),O=!1):U&&(C.push(G),U=!1))}for(var xa in aa){var Hb=ga.nc(aa[xa]);if(void 0!==Hb&&null!==Hb){var Y=new Wg(Hb),n=B.indexOf(Hb);Y.fc=e;Y.qa=Hb;Y.Xa=n;Y.od="CA"!==Hb.name;switch(ga.nb.name){case H.u.name:O||(U&&(J.push(C.length),F.push(I.length),C.push(G),U=!1),D=[],O=!0);D.push(Hb);break;case H.v.name:case H.ea.name:Y.width=W.tb;Y.height=W.Ua;Y.Cb=!0;Y.de=W.Ma;O?(N.push(I.length),K.push(C.length),I.push(D),O=!1,G=[],U=!0):U||(G=[],U=!0);G.push(Y);break;
default:Y.width=W.ca,Y.height=W.v,O?(N.push(I.length),K.push(C.length),I.push(D),O=!1,G=[],U=!0):U||(G=[],U=!0),G.push(Y)}}}pa=ga}O?I.push(D):U&&C.push(G);f=[C,I,J,F,K,N];g=f[0];h=f[1];k=f[2];m=f[3];l=f[4];q=f[5]}else this.Ia.We()&&console.warn("Cylinder representation not available for nucleic molecules");var y=new ce(!0);if(null!==g){var Ib=new Xg,da;for(da in h){var zb=null,wc=null;if(2<h[da].length){var bb,ua=y,Ab=h[da],gd=e;console.assert(2<Ab.length,"Helix number must be > 2");for(var Ub,cb=
Ab,pb=0,db=0,qb=0,sa=0,eb=0,Qa=0,rb=0,Bb=0,Ra=0,ra=cb.length,Q=null,S=0;S<ra;S++)Q=cb[S],pb+=Q.pos.x,db+=Q.pos.y,qb+=Q.pos.z,sa+=Q.pos.x*Q.pos.x,eb+=Q.pos.y*Q.pos.y,Qa+=Q.pos.z*Q.pos.z,rb+=Q.pos.x*Q.pos.y,Bb+=Q.pos.y*Q.pos.z,Ra+=Q.pos.z*Q.pos.x;for(var sb=ra*sa-pb*pb,La=(ra*rb-pb*db)/sb,Vb=(-pb*rb+sa*db)/sb,Kc=ra*eb-db*db,kc=(ra*Bb-db*qb)/Kc,Wb=(-db*Bb+eb*qb)/Kc,Lc=ra*Qa-qb*qb,lc=(ra*Ra-qb*pb)/Lc,Cb=(-qb*Ra+Qa*pb)/Lc,mc=1-La*kc*lc,Ma=(kc*lc*Vb+lc*Wb+Cb)/mc,Wa=(Vb+La*lc*Wb+La*Cb)/mc,fb=(kc*Vb+Wb+La*
kc*Cb)/mc,ea=void 0,qa=void 0,ma=void 0,Da=0,Db=0,tb=Number.POSITIVE_INFINITY,ub=0;180>=ub;ub+=10)for(var Na=Math.PI*ub/180,Eb=0;360>Eb;Eb+=10){for(var ta=Math.PI*Eb/180,ea=Math.cos(ta)*Math.sin(Na),qa=Math.sin(ta)*Math.sin(Na),ma=Math.cos(Na),Sa=0,S=0;S<ra;S++)var Q=cb[S],na=(ea*(Q.pos.x-Ma)+qa*(Q.pos.y-Wa)+ma*(Q.pos.z-fb))/(ea*ea+qa*qa+ma*ma),Xa=ea*na+Ma,va=qa*na+Wa,gb=ma*na+fb,Sa=Sa+((Q.pos.x-Xa)*(Q.pos.x-Xa)+(Q.pos.y-va)*(Q.pos.y-va)+(Q.pos.z-gb)*(Q.pos.z-gb));Sa<tb&&(tb=Sa,Da=Na,Db=ta)}for(var xc=
Da,yc=Db,Xb=-10;10>=Xb;Xb++)for(var Na=xc+Math.PI*Xb/180,ya=-10;10>=ya;ya++){ta=yc+Math.PI*ya/180;ea=Math.cos(ta)*Math.sin(Na);qa=Math.sin(ta)*Math.sin(Na);ma=Math.cos(Na);for(S=Sa=0;S<ra;S++)Q=cb[S],na=(ea*(Q.pos.x-Ma)+qa*(Q.pos.y-Wa)+ma*(Q.pos.z-fb))/(ea*ea+qa*qa+ma*ma),Xa=ea*na+Ma,va=qa*na+Wa,gb=ma*na+fb,Sa+=(Q.pos.x-Xa)*(Q.pos.x-Xa)+(Q.pos.y-va)*(Q.pos.y-va)+(Q.pos.z-gb)*(Q.pos.z-gb);Sa<tb&&(tb=Sa,Da=Na,Db=ta)}for(var ea=Math.cos(Db)*Math.sin(Da),qa=Math.sin(Db)*Math.sin(Da),ma=Math.cos(Da),oa=
[],za=[],Mc=!1;!Mc;){for(S=0;S<cb.length;S++)Q=cb[S],na=(ea*(Q.pos.x-Ma)+qa*(Q.pos.y-Wa)+ma*(Q.pos.z-fb))/(ea*ea+qa*qa+ma*ma),za[S]=na,Xa=ea*na+Ma,va=qa*na+Wa,gb=ma*na+fb,oa[S]=new THREE.Vector3(Xa,va,gb);za[0]>za[za.length-1]?(ea=-ea,qa=-qa,ma=-ma):Mc=!0}for(S=0;S<cb.length;S++)for(var Ea=S+1;Ea<cb.length;Ea++)za[S]>za[Ea]&&(Na=za[S],za[S]=za[Ea],za[Ea]=Na,ta=oa[S],oa[S]=oa[Ea],oa[Ea]=ta);Ub=[oa,ea,qa,ma];var Jb=Ub[0],Nc=Ub[1],Oc=Ub[2],Yb=Ub[3],Ta=Jb[0],Oa=Jb[Jb.length-1],nc=Oa.clone().sub(Ta).normalize(),
zc=me(nc.clone()),oc=nc.clone().cross(zc).normalize(),hb=ua.uc.length/3,Kb=NaN,Ya=0,Lb=Ta.clone();Lb.qa=Ab[0];var pc=this.ja.indexOf(Ab[0]);Lb.Xa=pc;de(ua,Lb.x,Lb.y,Lb.z,gd);ua.Zc.push(Lb.Xa);var hb=ua.uc.length/3,Fb=hb-1;Zg(this,ua,zc,oc,Ta,Ab[0],gd);for(var Ya=hb,hb=ua.uc.length/3,wa=0;wa<W.u;wa++){var Ua=(wa+1)%W.u;ee(ua,Fb,Ya+wa,Ya+Ua)}for(var A=1;A<Ab.length;A++){var vb=Ab[A],Oa=Jb[A];Zg(this,ua,zc,oc,Oa,vb,gd);Kb=Ya;Ya=hb;hb=ua.uc.length/3;for(wa=0;wa<W.u;wa++)Ua=(wa+1)%W.u,ee(ua,Kb+wa,Ya+wa,
Ya+Ua),ee(ua,Kb+wa,Ya+Ua,Kb+Ua)}var ja=Oa.clone();ja.qa=Ab[Ab.length-1];pc=this.ja.indexOf(Ab[Ab.length-1]);ja.Xa=pc;de(ua,ja.x,ja.y,ja.z,gd);ua.Zc.push(ja.Xa);hb=ua.uc.length/3;for(wa=0;wa<W.u;wa++)Ua=(wa+1)%W.u,ee(ua,hb-1,Ya+Ua,Ya+wa);Ta.add((new THREE.Vector3(Nc,Oc,Yb)).multiplyScalar(.3));Oa.add((new THREE.Vector3(-Nc,-Oc,-Yb)).multiplyScalar(.3));bb=[Ta,Oa];zb=bb[0];wc=bb[1]}r.push(zb);t.push(wc)}for(da=0;da<k.length;da++){var Zb=k[da],L=m[da];if(null!=r[L]){var Aa=g[Zb],ib=h[L],ka=ib[0],fa=
new Wg(ka),Vc=this.ja.indexOf(ka);fa.fc=e;fa.qa=ka;fa.Xa=Vc;fa.width=W.ca;fa.height=W.v;fa.pos=r[L];Aa.push(fa.clone());Aa.push(fa.clone());Aa.push(fa.clone())}}for(da=0;da<l.length;da++)L=q[da],Zb=l[da],null!=r[L]&&(Aa=g[Zb],ib=h[L],ka=ib[ib.length-1],fa=new Wg(ka),Vc=this.ja.indexOf(ka),fa.fc=e,fa.qa=ka,fa.Xa=Vc,fa.width=W.ca,fa.height=W.v,fa.pos=t[L],Aa.splice(0,0,fa.clone()),Aa.splice(0,0,fa.clone()),Aa.splice(0,0,fa.clone()));for(da in g)2<g[da].length&&Yg(Ib,y,g[da],e);var $b=fe(y),hd=ff(this.fa);
hd.vertexColors=THREE.FaceColors;var ac=new THREE.Mesh($b,hd);ac.qa=this.Ia;ac.Ja=this;this.parent.add(ac);this.da=ac;this.color(V.sc)}};function Zg(e,f,g,h,k,m,l){for(var q=0;q<W.u;q++){var r=q*Math.PI*2/W.u,t=W.Qc*Math.sin(r),r=W.Qc*Math.cos(r),t=g.clone().multiplyScalar(t).add(h.clone().multiplyScalar(r)),t=k.clone().add(t);t.qa=m;t.Xa=e.ja.indexOf(m);de(f,t.x,t.y,t.z,l);f.Zc.push(t.Xa)}}W.prototype.nd=function(){this.color(V.sc)};W.prototype.update=function(e){R.prototype.update.call(this,e)};
function $g(e){R.call(this,e);this.Vb=this.wa.qa.Vb()}$g.prototype=Object.create(R.prototype);$g.prototype.constructor=$g;P.LINES=new fg("Lines","LINES",$g);
$g.prototype.Ka=function(){for(var e=new THREE.BufferGeometry,f=[],g=[],h=[],k=this.ja.length,m=0;m<k;m++){var l=this.ja[m],q=this.Vb.findNode(l);if(q){var r=q.ed();if(r)for(var t=r.length,w=0;w<t;w++){var x=Hd(r[w],q).rd;if(this.ja.includes(x)){var B=l.pos,x=x.pos,x=new THREE.Vector3((B.x+x.x)/2,(B.y+x.y)/2,(B.z+x.z)/2);f.push(B.x);f.push(B.y);f.push(B.z);f.push(x.x);f.push(x.y);f.push(x.z);for(B=0;6>B;B++)g.push(1);h.push(m);h.push(m)}}}}e.addAttribute("position",THREE.Float32Attribute(f,3));f=
THREE.Float32Attribute(g,3);f.dynamic=!0;e.addAttribute("color",f);e.addAttribute("atomIndex",THREE.Float32Attribute(h,1));e.gd();h=new THREE.LineBasicMaterial({linewidth:this.fa.lineWidth,vertexColors:THREE.VertexColors});e=new THREE.LineSegments(e,h);e.Ja=this;this.da=e;this.parent.add(e);this.nd()};$g.prototype.update=function(e){R.prototype.update.call(this,e);e.lineWidth&&(this.parent.remove(this.da),this.da=null,this.Ka())};
var ah=[[],[0,8,3],[0,1,9],[1,8,3,9,8,1],[1,2,10],[0,8,3,1,2,10],[9,2,10,0,2,9],[2,8,3,2,10,8,10,9,8],[3,11,2],[0,11,2,8,11,0],[1,9,0,2,3,11],[1,11,2,1,9,11,9,8,11],[3,10,1,11,10,3],[0,10,1,0,8,10,8,11,10],[3,9,0,3,11,9,11,10,9],[9,8,10,10,8,11],[4,7,8],[4,3,0,7,3,4],[0,1,9,8,4,7],[4,1,9,4,7,1,7,3,1],[1,2,10,8,4,7],[3,4,7,3,0,4,1,2,10],[9,2,10,9,0,2,8,4,7],[2,10,9,2,9,7,2,7,3,7,9,4],[8,4,7,3,11,2],[11,4,7,11,2,4,2,0,4],[9,0,1,8,4,7,2,3,11],[4,7,11,9,4,11,9,11,2,9,2,1],[3,10,1,3,11,10,7,8,4],[1,11,
10,1,4,11,1,0,4,7,11,4],[4,7,8,9,0,11,9,11,10,11,0,3],[4,7,11,4,11,9,9,11,10],[9,5,4],[9,5,4,0,8,3],[0,5,4,1,5,0],[8,5,4,8,3,5,3,1,5],[1,2,10,9,5,4],[3,0,8,1,2,10,4,9,5],[5,2,10,5,4,2,4,0,2],[2,10,5,3,2,5,3,5,4,3,4,8],[9,5,4,2,3,11],[0,11,2,0,8,11,4,9,5],[0,5,4,0,1,5,2,3,11],[2,1,5,2,5,8,2,8,11,4,8,5],[10,3,11,10,1,3,9,5,4],[4,9,5,0,8,1,8,10,1,8,11,10],[5,4,0,5,0,11,5,11,10,11,0,3],[5,4,8,5,8,10,10,8,11],[9,7,8,5,7,9],[9,3,0,9,5,3,5,7,3],[0,7,8,0,1,7,1,5,7],[1,5,3,3,5,7],[9,7,8,9,5,7,10,1,2],[10,
1,2,9,5,0,5,3,0,5,7,3],[8,0,2,8,2,5,8,5,7,10,5,2],[2,10,5,2,5,3,3,5,7],[7,9,5,7,8,9,3,11,2],[9,5,7,9,7,2,9,2,0,2,7,11],[2,3,11,0,1,8,1,7,8,1,5,7],[11,2,1,11,1,7,7,1,5],[9,5,8,8,5,7,10,1,3,10,3,11],[5,7,0,5,0,9,7,11,0,1,0,10,11,10,0],[11,10,0,11,0,3,10,5,0,8,0,7,5,7,0],[11,10,5,7,11,5],[10,6,5],[0,8,3,5,10,6],[9,0,1,5,10,6],[1,8,3,1,9,8,5,10,6],[1,6,5,2,6,1],[1,6,5,1,2,6,3,0,8],[9,6,5,9,0,6,0,2,6],[5,9,8,5,8,2,5,2,6,3,2,8],[2,3,11,10,6,5],[11,0,8,11,2,0,10,6,5],[0,1,9,2,3,11,5,10,6],[5,10,6,1,9,2,
9,11,2,9,8,11],[6,3,11,6,5,3,5,1,3],[0,8,11,0,11,5,0,5,1,5,11,6],[3,11,6,0,3,6,0,6,5,0,5,9],[6,5,9,6,9,11,11,9,8],[5,10,6,4,7,8],[4,3,0,4,7,3,6,5,10],[1,9,0,5,10,6,8,4,7],[10,6,5,1,9,7,1,7,3,7,9,4],[6,1,2,6,5,1,4,7,8],[1,2,5,5,2,6,3,0,4,3,4,7],[8,4,7,9,0,5,0,6,5,0,2,6],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9],[3,11,2,7,8,4,10,6,5],[5,10,6,4,7,2,4,2,0,2,7,11],[0,1,9,4,7,8,2,3,11,5,10,6],[9,2,1,9,11,2,9,4,11,7,11,4,5,10,6],[8,4,7,3,11,5,3,5,1,5,11,6],[5,1,11,5,11,6,1,0,11,7,11,4,0,4,11],[0,5,9,0,6,5,0,3,6,11,
6,3,8,4,7],[6,5,9,6,9,11,4,7,9,7,11,9],[10,4,9,6,4,10],[4,10,6,4,9,10,0,8,3],[10,0,1,10,6,0,6,4,0],[8,3,1,8,1,6,8,6,4,6,1,10],[1,4,9,1,2,4,2,6,4],[3,0,8,1,2,9,2,4,9,2,6,4],[0,2,4,4,2,6],[8,3,2,8,2,4,4,2,6],[10,4,9,10,6,4,11,2,3],[0,8,2,2,8,11,4,9,10,4,10,6],[3,11,2,0,1,6,0,6,4,6,1,10],[6,4,1,6,1,10,4,8,1,2,1,11,8,11,1],[9,6,4,9,3,6,9,1,3,11,6,3],[8,11,1,8,1,0,11,6,1,9,1,4,6,4,1],[3,11,6,3,6,0,0,6,4],[6,4,8,11,6,8],[7,10,6,7,8,10,8,9,10],[0,7,3,0,10,7,0,9,10,6,7,10],[10,6,7,1,10,7,1,7,8,1,8,0],[10,
6,7,10,7,1,1,7,3],[1,2,6,1,6,8,1,8,9,8,6,7],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9],[7,8,0,7,0,6,6,0,2],[7,3,2,6,7,2],[2,3,11,10,6,8,10,8,9,8,6,7],[2,0,7,2,7,11,0,9,7,6,7,10,9,10,7],[1,8,0,1,7,8,1,10,7,6,7,10,2,3,11],[11,2,1,11,1,7,10,6,1,6,7,1],[8,9,6,8,6,7,9,1,6,11,6,3,1,3,6],[0,9,1,11,6,7],[7,8,0,7,0,6,3,11,0,11,6,0],[7,11,6],[7,6,11],[3,0,8,11,7,6],[0,1,9,11,7,6],[8,1,9,8,3,1,11,7,6],[10,1,2,6,11,7],[1,2,10,3,0,8,6,11,7],[2,9,0,2,10,9,6,11,7],[6,11,7,2,10,3,10,8,3,10,9,8],[7,2,3,6,2,7],[7,0,8,7,6,0,6,
2,0],[2,7,6,2,3,7,0,1,9],[1,6,2,1,8,6,1,9,8,8,7,6],[10,7,6,10,1,7,1,3,7],[10,7,6,1,7,10,1,8,7,1,0,8],[0,3,7,0,7,10,0,10,9,6,10,7],[7,6,10,7,10,8,8,10,9],[6,8,4,11,8,6],[3,6,11,3,0,6,0,4,6],[8,6,11,8,4,6,9,0,1],[9,4,6,9,6,3,9,3,1,11,3,6],[6,8,4,6,11,8,2,10,1],[1,2,10,3,0,11,0,6,11,0,4,6],[4,11,8,4,6,11,0,2,9,2,10,9],[10,9,3,10,3,2,9,4,3,11,3,6,4,6,3],[8,2,3,8,4,2,4,6,2],[0,4,2,4,6,2],[1,9,0,2,3,4,2,4,6,4,3,8],[1,9,4,1,4,2,2,4,6],[8,1,3,8,6,1,8,4,6,6,10,1],[10,1,0,10,0,6,6,0,4],[4,6,3,4,3,8,6,10,3,
0,3,9,10,9,3],[10,9,4,6,10,4],[4,9,5,7,6,11],[0,8,3,4,9,5,11,7,6],[5,0,1,5,4,0,7,6,11],[11,7,6,8,3,4,3,5,4,3,1,5],[9,5,4,10,1,2,7,6,11],[6,11,7,1,2,10,0,8,3,4,9,5],[7,6,11,5,4,10,4,2,10,4,0,2],[3,4,8,3,5,4,3,2,5,10,5,2,11,7,6],[7,2,3,7,6,2,5,4,9],[9,5,4,0,8,6,0,6,2,6,8,7],[3,6,2,3,7,6,1,5,0,5,4,0],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8],[9,5,4,10,1,6,1,7,6,1,3,7],[1,6,10,1,7,6,1,0,7,8,7,0,9,5,4],[4,0,10,4,10,5,0,3,10,6,10,7,3,7,10],[7,6,10,7,10,8,5,4,10,4,8,10],[6,9,5,6,11,9,11,8,9],[3,6,11,0,6,3,0,5,6,0,
9,5],[0,11,8,0,5,11,0,1,5,5,6,11],[6,11,3,6,3,5,5,3,1],[1,2,10,9,5,11,9,11,8,11,5,6],[0,11,3,0,6,11,0,9,6,5,6,9,1,2,10],[11,8,5,11,5,6,8,0,5,10,5,2,0,2,5],[6,11,3,6,3,5,2,10,3,10,5,3],[5,8,9,5,2,8,5,6,2,3,8,2],[9,5,6,9,6,0,0,6,2],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8],[1,5,6,2,1,6],[1,3,6,1,6,10,3,8,6,5,6,9,8,9,6],[10,1,0,10,0,6,9,5,0,5,6,0],[0,3,8,5,6,10],[10,5,6],[11,5,10,7,5,11],[11,5,10,11,7,5,8,3,0],[5,11,7,5,10,11,1,9,0],[10,7,5,10,11,7,9,8,1,8,3,1],[11,1,2,11,7,1,7,5,1],[0,8,3,1,2,7,1,7,5,7,2,11],
[9,7,5,9,2,7,9,0,2,2,11,7],[7,5,2,7,2,11,5,9,2,3,2,8,9,8,2],[2,5,10,2,3,5,3,7,5],[8,2,0,8,5,2,8,7,5,10,2,5],[9,0,1,5,10,3,5,3,7,3,10,2],[9,8,2,9,2,1,8,7,2,10,2,5,7,5,2],[1,3,5,3,7,5],[0,8,7,0,7,1,1,7,5],[9,0,3,9,3,5,5,3,7],[9,8,7,5,9,7],[5,8,4,5,10,8,10,11,8],[5,0,4,5,11,0,5,10,11,11,3,0],[0,1,9,8,4,10,8,10,11,10,4,5],[10,11,4,10,4,5,11,3,4,9,4,1,3,1,4],[2,5,1,2,8,5,2,11,8,4,5,8],[0,4,11,0,11,3,4,5,11,2,11,1,5,1,11],[0,2,5,0,5,9,2,11,5,4,5,8,11,8,5],[9,4,5,2,11,3],[2,5,10,3,5,2,3,4,5,3,8,4],[5,10,
2,5,2,4,4,2,0],[3,10,2,3,5,10,3,8,5,4,5,8,0,1,9],[5,10,2,5,2,4,1,9,2,9,4,2],[8,4,5,8,5,3,3,5,1],[0,4,5,1,0,5],[8,4,5,8,5,3,9,0,5,0,3,5],[9,4,5],[4,11,7,4,9,11,9,10,11],[0,8,3,4,9,7,9,11,7,9,10,11],[1,10,11,1,11,4,1,4,0,7,4,11],[3,1,4,3,4,8,1,10,4,7,4,11,10,11,4],[4,11,7,9,11,4,9,2,11,9,1,2],[9,7,4,9,11,7,9,1,11,2,11,1,0,8,3],[11,7,4,11,4,2,2,4,0],[11,7,4,11,4,2,8,3,4,3,2,4],[2,9,10,2,7,9,2,3,7,7,4,9],[9,10,7,9,7,4,10,2,7,8,7,0,2,0,7],[3,7,10,3,10,2,7,4,10,1,10,0,4,0,10],[1,10,2,8,7,4],[4,9,1,4,1,
7,7,1,3],[4,9,1,4,1,7,0,8,1,8,7,1],[4,0,3,7,4,3],[4,8,7],[9,10,8,10,11,8],[3,0,9,3,9,11,11,9,10],[0,1,10,0,10,8,8,10,11],[3,1,10,11,3,10],[1,2,11,1,11,9,9,11,8],[3,0,9,3,9,11,1,2,9,2,11,9],[0,2,11,8,0,11],[3,2,11],[2,3,8,2,8,10,10,8,9],[9,10,2,0,9,2],[2,3,8,2,8,10,0,1,8,1,10,8],[1,10,2],[1,3,8,9,1,8],[0,9,1],[0,3,8],[]];
function bh(e){R.call(this,e);this.da=[];this.labels=[];this.pf=[];this.oe=this.wa.gb();this.params={Le:.2,Fd:8,xk:1,cj:1023,el:!1};e=tf(this.oe);for(var f=0;f<e.length;f++)if(this.params.el||"Solvent"!=e[f].ra.type)this.pf=this.pf.concat(e[f].ja)}bh.prototype=Object.create(R.prototype);bh.prototype.constructor=bh;P.Ng=new fg("Molecular interactions","MOLECULARINTERACTIONS",bh);function ch(e){for(var f="",g=0;g<e.length;g++)f+=e[g].charCodeAt(0).toString(2);return f}
function dh(e,f,g){var h,k;h="Ligand"===f.Aa().xa.type?f.Aa().$b():f.Aa().xa.$b();k="Ligand"===g.Aa().xa.type?g.Aa().$b():g.Aa().xa.$b();h=parseInt(ch(h),2)+parseInt(ch(k),2);h%=e.params.cj;h=(new THREE.Color).setHSL(h/e.params.cj,1,.42);f=af(e.fa,f.Aa().xa.ta(),"M");e=af(e.fa,g.Aa().xa.ta(),"M");return new THREE.Color((h.r+(1-(f.r+e.r)/2))/2,(h.g+(1-(f.g+e.g)/2))/2,(h.b+(1-(f.b+e.b)/2))/2)}z=bh.prototype;
z.makeGeometry=function(e,f,g,h){e.addAttribute("position",THREE.Float32Attribute(f,3));e.addAttribute("color",THREE.Float32Attribute(g,3));f=h?new THREE.LineBasicMaterial({linewidth:3,vertexColors:THREE.VertexColors}):new THREE.LineBasicMaterial({linewidth:1.5,vertexColors:THREE.VertexColors});e=new THREE.LineSegments(e,f);e.Ja=this;this.da.push(e);this.parent.add(e)};
z.Ka=function(){for(var e=new THREE.BufferGeometry,f=[],g=[],h=new THREE.BufferGeometry,k=[],m=[],l=0,q=0,r=new THREE.Vector3(Infinity,Infinity,Infinity),t=new THREE.Vector3(-Infinity,-Infinity,-Infinity),w=this.pf.length,x=0;x<w;x++){var B=this.pf[x].pos;r.x=Math.min(r.x,B.x);r.y=Math.min(r.y,B.y);r.z=Math.min(r.z,B.z);t.x=Math.max(t.x,B.x);t.y=Math.max(t.y,B.y);t.z=Math.max(t.z,B.z)}r=new Tb(r,t,32);for(x=0;x<w;x++)r.add(new gc(this.pf[x]));r.optimize();for(w=0;w<this.ja.length;w++)for(x=r.$f(this.ja[w].pos,
4),t=x.length,B=0;B<t;B++){var C=x[B].getPoint(),G;if(G=this.ja[w].Aa().xa!=C.Aa().xa){G=this.ja[w].name.substring(0,1);var I=C.name.substring(0,1);G="O"!==G&&"N"!==G||"O"!==I&&"N"!==I?!1:!0}if(G){G=this.ja[w].pos.distanceTo(C.pos).toFixed(this.params.xk);var I=(new THREE.Vector3).addVectors(this.ja[w].pos,C.pos).multiplyScalar(.5),D;a:{D=this.ja[w];var J=C,F=D.Aa(),K=J.Aa();if(3.5>D.pos.distanceTo(J.pos)){var N=D.name.substring(0,1),O=D.name.substring(0,1);if("SER"===F.xb()&&"OG"===D.name&&("N"===
O||"O"===O)||"SER"===K.xb()&&"OG"===J.name&&("N"===N||"O"===N)){D=!0;break a}}D=!1}if(D){D=this.ja[w];J=C;F=f;C=g;F.push(D.pos.x);F.push(D.pos.y);F.push(D.pos.z);F.push((21.5*D.pos.x+2.5*J.pos.x)/24);F.push((21.5*D.pos.y+2.5*J.pos.y)/24);F.push((21.5*D.pos.z+2.5*J.pos.z)/24);F.push((20.5*D.pos.x+3.5*J.pos.x)/24);F.push((20.5*D.pos.y+3.5*J.pos.y)/24);F.push((20.5*D.pos.z+3.5*J.pos.z)/24);F.push((17.5*D.pos.x+6.5*J.pos.x)/24);F.push((17.5*D.pos.y+6.5*J.pos.y)/24);F.push((17.5*D.pos.z+6.5*J.pos.z)/24);
F.push((16.5*D.pos.x+7.5*J.pos.x)/24);F.push((16.5*D.pos.y+7.5*J.pos.y)/24);F.push((16.5*D.pos.z+7.5*J.pos.z)/24);F.push((13.5*D.pos.x+10.5*J.pos.x)/24);F.push((13.5*D.pos.y+10.5*J.pos.y)/24);F.push((13.5*D.pos.z+10.5*J.pos.z)/24);F.push((10.5*D.pos.x+13.5*J.pos.x)/24);F.push((10.5*D.pos.y+13.5*J.pos.y)/24);F.push((10.5*D.pos.z+13.5*J.pos.z)/24);F.push((7.5*D.pos.x+16.5*J.pos.x)/24);F.push((7.5*D.pos.y+16.5*J.pos.y)/24);F.push((7.5*D.pos.z+16.5*J.pos.z)/24);F.push((6.5*D.pos.x+17.5*J.pos.x)/24);F.push((6.5*
D.pos.y+17.5*J.pos.y)/24);F.push((6.5*D.pos.z+17.5*J.pos.z)/24);F.push((3.5*D.pos.x+20.5*J.pos.x)/24);F.push((3.5*D.pos.y+20.5*J.pos.y)/24);F.push((3.5*D.pos.z+20.5*J.pos.z)/24);F.push((2.5*D.pos.x+21.5*J.pos.x)/24);F.push((2.5*D.pos.y+21.5*J.pos.y)/24);F.push((2.5*D.pos.z+21.5*J.pos.z)/24);F.push(J.pos.x);F.push(J.pos.y);F.push(J.pos.z);D=dh(this,D,J);for(J=0;12>J;J++)C.push(D.r),C.push(D.g),C.push(D.b);q++;eh(this,G,I)}else{a:{D=this.ja[w];J=D.Aa();F=C.Aa();if("GLU"===J.xb()&&"LYS"===F.xb()){if(("OE1"===
D.name||"OE2"===D.name)&&"NZ"===C.name){D=!0;break a}}else if("GLU"===F.xb()&&"LYS"===J.xb()&&("OE1"===C.name||"OE2"===C.name)&&"NZ"===D.name){D=!0;break a}K=D.name.substring(0,1);N=D.name.substring(0,1);D="GLU"===J.xb()&&("OE1"===D.name||"OE2"==D.name)&&"O"===N||"GLU"===F.xb()&&("OE1"===C.name||"OE2"==C.name)&&"O"===K?!1:!0}if(D){D=this.ja[w];F=C;K=k;C=m;for(J=0;J<this.params.Fd;J++)N=new THREE.Vector3((J*D.pos.x+(this.params.Fd-1-J)*F.pos.x)/(this.params.Fd-1),(J*D.pos.y+(this.params.Fd-1-J)*F.pos.y)/
(this.params.Fd-1),(J*D.pos.z+(this.params.Fd-1-J)*F.pos.z)/(this.params.Fd-1)),O=K,O.push(N.x-this.params.Le),O.push(N.y),O.push(N.z),O.push(N.x+this.params.Le),O.push(N.y),O.push(N.z),O.push(N.x),O.push(N.y-this.params.Le),O.push(N.z),O.push(N.x),O.push(N.y+this.params.Le),O.push(N.z),O.push(N.x),O.push(N.y),O.push(N.z-this.params.Le),O.push(N.x),O.push(N.y),O.push(N.z+this.params.Le);D=dh(this,D,F);for(J=0;J<6*this.params.Fd;J++)C.push(D.r),C.push(D.g),C.push(D.b);l++;eh(this,G,I)}}}}0<l&&this.makeGeometry(h,
k,m,!1);0<q&&this.makeGeometry(e,f,g,!0)};function eh(e,f,g){f=cf(f,15);f=new THREE.SpriteMaterial({map:f});f.depthTest=!1;f.depthWrite=!1;var h=new THREE.Sprite(f);h.position.set(g.x,g.y,g.z);h.scale.set(f.map.image.width/40,f.map.image.height/40,1);e.labels.push(h);e.parent.add(h)}z.update=function(){};z.color=function(){};z.hide=function(){if(0!==this.da.length){var e;for(e=0;e<this.da.length;e++)this.da[e].visible=!1;for(e=0;e<this.labels.length;e++)this.labels[e].visible=!1;this.visible=!1}};
z.show=function(){0===this.da.length&&this.Ka();if(0!==this.da.length){var e;for(e=0;e<this.da.length;e++)this.da[e].visible=!0;for(e=0;e<this.labels.length;e++)this.labels[e].visible=!0;this.visible=!0}};z.yb=function(){};z["delete"]=function(){this.fa.unsubscribe(this);if(0<this.da.length){var e;for(e=0;e<this.da.length;e++)this.parent.remove(this.da[e]),this.da[e].geometry.dispose(),this.da[e].material.dispose();for(e=0;e<this.labels.length;e++)this.parent.remove(this.labels[e])}};z.nd=function(){};
function Xg(){this.Fg=24;this.ii=2;this.bm=3;this.Dl=!1;this.Zj=3;this.Qh=20;this.Rd=new THREE.Color(16777215)}function Wg(e){e instanceof $a?this.pos=e.pos.clone():this.pos=e;this.fc=null;this.qa=e;this.height=this.width=1;this.mc=0;this.Cb=this.xf=!1;this.od=!0;this.de=0;this.fb=this.Hd=this.za=null;this.Ke=0}
Wg.prototype.clone=function(){var e=new Wg;e.pos=this.pos.clone();e.fc=this.fc;e.qa=this.qa;e.Xa=this.Xa;e.width=this.width;e.height=this.height;e.mc=this.mc;e.xf=this.xf;e.Cb=this.Cb;e.od=this.od;e.de=this.de;e.za=this.za;e.Hd=this.Hd;e.fb=this.fb;e.Ke=this.Ke;return e};
function Yg(e,f,g,h){if(!(2>g.length)){e.Rd=h;fh(e,g);gh(g);hh(e,g);ih(g);jh(e,g);g=kh(e,g);g.forEach(function(e){var f=e.fb.clone().cross(e.za).normalize();e.Hd=f});h=0;for(var k=g.length-1;0<=k;k--){var m=g[k];m.Cb?(1<k&&(h+=m.pos.distanceTo(g[k-1].pos)),m.Ke=h):h=0}lh(e,f,g)}}
function fh(e,f){for(var g=f.length,h=0;h<e.bm;h++){var k=[];if(e.Dl)for(var m=0;m<g;m++)f[m].od&&(k[m]=f[m-1].pos.clone().add(f[m+1].pos.clone()).multiplyScalar(.5));else for(f[1].od&&(k[1]=f[0].pos.clone().add(f[1].pos.clone()).multiplyScalar(.5)),f[g-1].od&&(k[g-1]=f[g-2].pos.add(f[g-1].pos.clone()).multiplyScalar(.5)),m=2;m<g-2;m++)f[m].od&&(k[m]=(new THREE.Vector3).rb(f[m-2].pos.clone(),-.25).rb(f[m-1].pos.clone(),.5).rb(f[m].pos.clone(),.5).rb(f[m+1].pos.clone(),.5).rb(f[m+2].pos.clone(),-.25));
for(m=1;m<g-1;m++){var l=k[m];void 0!==l&&null!==l&&(f[m].pos=l.clone())}}for(var q=0,h=0;h<g;h++)k=f[h].de,k>q&&(q=k);for(h=0;h<q;h++){k=[];for(m=1;m<g-1;m++)f[m].de>h&&(k[m]=f[m].pos.clone().add(f[m-1].pos.clone().add(f[m+1].pos.clone()).multiplyScalar(.5)).multiplyScalar(.5));for(m=1;m<g-1;m++)l=k[m],null!==l&&void 0!==l&&(f[m].pos=l.clone())}}
function jh(e,f){for(var g=f.length,h=0;h<e.Zj;h++)for(var k=[],m=1;m<g-1;m++)k[m]=f[m-1].fb.clone().add(f[m+1].fb.clone()).rb(f[m].fb.clone(),2).normalize(),ne(k[m],f[m-1].za.clone(),f[m+1].za.clone(),.5).normalize()}
function kh(e,f){var g=f.length;if(1<e.ii){var h=[],k=0;h[k++]=f[0];for(var m=0;m<g-3;m++)for(var l=0;l<e.ii;l++){var q=h,r=k++,t=f[m+1],w=f[m+2],x=f[m+3],B=l/e.ii,x=THREE.Vector3.ca(f[m].pos.clone(),t.pos.clone(),w.pos.clone(),x.pos.clone(),B),x=new Wg(x);x.qa=.5>B?t.qa:w.qa;x.Xa=.5>B?t.Xa:w.Xa;t.Cb==w.Cb?(x.width=THREE.Math.Cc(t.width,w.width,B),x.height=THREE.Math.Cc(t.height,w.height,B),x.mc=THREE.Math.Cc(t.mc,w.mc,B),x.fc=THREE.Color.Cc(t.fc,w.fc,B),x.Cb=t.Cb):(x.width=t.Cb?w.width:t.width,x.height=
t.Cb?w.height:t.height,x.mc=t.Cb?w.mc:t.mc,x.fc=t.Cb?w.fc:t.fc,x.Cb=!1);x.xf=t.xf;x.Hd=THREE.Vector3.Cc(t.Hd,w.Hd,B).normalize();x.fb=THREE.Vector3.Cc(t.fb,w.fb,B).normalize();null!==t.za&&null!==w.za&&null!==x.fb&&void 0!==t.za&&void 0!==w.za&&void 0!==x.fb?x.za=ne(x.fb.clone(),t.za,w.za,B):x.za=THREE.Vector3.Cc(t.za,w.za,B).normalize();q[r]=x}h[k++]=f[g-1];return h}return f}
function gh(e){e[0].fb=e[1].pos.clone().sub(e[0].pos).normalize();for(var f=e.length,g=1;g<f-1;g++)e[g].fb=e[g+1].pos.clone().sub(e[g-1].pos).normalize();e[f-1].fb=e[f-1].pos.clone().sub(e[f-2].pos).normalize()}
function hh(e,f){for(var g=f.length,h=0;h<g;h++){var k=f[h];if(k.width!==k.height){for(var m=new THREE.Vector3,l=0,q=new THREE.Vector3,r=0,t=0,w=h-1;0<=w;w--){var t=t+f[w].pos.distanceTo(f[w+1].pos),x=(e.Qh-t)/t*t;if(0>=x)break;m=m.rb(f[w].pos,x);l+=x}t=0;for(w=h+1;w<g;w++){t+=f[w].pos.distanceTo(f[w-1].pos);x=(e.Qh-t)/t*t;if(0>=x)break;q=q.rb(f[w].pos,x);r+=x}q=q.multiplyScalar(1/r);m=m.multiplyScalar(1/l);0===l&&(q=m);0===r&&(m=q);k.za=k.pos.clone().sub(q).add(k.pos.clone().sub(m)).multiplyScalar(1/
e.Qh);l=k.za.clone().cross(k.fb.clone());if(.1>Math.sqrt(l.x*l.x+l.y*l.y+l.z*l.z))k.za=null;else if(k.za=k.fb.clone().cross(k.za.clone()).cross(k.fb.clone()).normalize(),0===k.mc)for(l=h-1;0<=l;l--)if(r=f[l].za,m=k.za,null!==r&&void 0!==r){0>m.x*r.x+m.y*r.y+m.z*r.z&&(f[h].za=m.multiplyScalar(-1));break}}}}
function ih(e){for(var f=[],g=e.length,h=0;h<g;h++){var k=e[h];if(null===k.za||void 0===k.za){for(var m=h;0<=m&&(null===e[m].za||void 0===e[m].za);)m--;for(var l=h;l<g&&(null===e[l].za||void 0===e[l].za);)l++;l===g&&(l=-1);if(0>m&&0>l)f[h]=me(k.fb);else if(0<=m&&0<=l){var q=(h-m)/(l-m),k=k.fb.clone();f[h]=ne(k,e[m].za,e[l].za,q)}else f[h]=0<=m?e[m].za.clone():e[l].za.clone()}}g=f.length;for(h=0;h<g;h++)m=f[h],null!==m&&void 0!==m&&(l=m.clone(),l.qa=m.qa,l.Xa=m.Xa,e[h].za=l)}
function lh(e,f,g){var h=mh(g[0],e.Fg,!0),k=!1;nh(e,f,h,!1);for(var m=g.length,l=1;l<m;l++){var q=g[l],r=mh(q,e.Fg,!0),t=q.Cb&&q.Ke<2*q.width;if(t&&!k)k=mh(q,e.Fg,!1),q=mh(q,e.Fg,!0),oh(e,f,h,k),oh(e,f,k,q);else{for(var k=r.length,w=0;w<k;w++).01>=r[w].clone().sub(h[w].clone()).dot(q.fb.clone())&&(r[w]=h[w].clone(),r[w].normal=h[w].normal,r[w].qa=h[w].qa,r[w].Xa=h[w].Xa);oh(e,f,h,r)}h=r;k=t}nh(e,f,h,!0)}
function ph(e,f,g){for(var h=g.length,k=f.uc.length/3,m=0;m<h;m++){var l=g[m];de(f,l.x,l.y,l.z,e.Rd);f.Zc.push(l.Xa)}return k}function oh(e,f,g,h){if(g.length!==h.length)throw"meshFill impossible, a.length !== b.length";g=g.length;e=ph(e,f,h);for(h=0;h<g;h++){var k=(h+1)%g,m=e-g+h,l=e-g+k,k=e+k;ee(f,m,e+h,k);ee(f,m,k,l)}}function nh(e,f,g,h){var k=g.length;e=ph(e,f,g);for(g=0;g<k-1;g++){var m=e+g,l=e+g+1,q=e+k-g-1;h?ee(f,m,q,l):ee(f,m,l,q)}}
function mh(e,f,g){for(var h=[],k=0;k<f;k++){var m=2*(k+.5)*Math.PI/f,l;if(e.xf){l=f/4;var q=l+2,r=3*f/4,t=r+2,w=.1*e.width;k==l||k==l+1||k==t||k==t+1?(l=k==l||k==l+1?w:-w,m=e.height-2*e.width):k==q||k==q+1||k==r||k==r+1?(l=k==q||k==q+1?w:-w,m=2*e.width-e.height):k<l||k>t?(l=Math.sin(2*m)*e.width,m=e.height-e.width+Math.cos(2*m)*e.width):(l=Math.sin(Math.PI+2*m)*e.width,m=e.width-e.height+Math.cos(Math.PI+2*m)*e.width)}else l=Math.sin(m)*e.width,m=Math.cos(m)*e.height,e.Cb?(q=e.width,e.Cb&&e.Ke<2*
e.width&&g&&(q=e.Ke),l=q*(0<=l?1:-1),m=e.height*(0<=m?1:-1)):l+=e.mc*Math.cos(Math.PI*m/e.height);q=null;e.pos instanceof $a?q=e.pos.pos.clone().rb(e.za,l).rb(e.Hd,m):q=e.pos.clone().rb(e.za,l).rb(e.Hd,m);q.qa=e.qa;q.Xa=e.Xa;h.push(q)}for(k=0;k<f;k++)g=(k+f-1)%f,m=(k+1)%f,l=new THREE.Vector3,l=h[m].clone().sub(h[g].clone()),h[k].normal=l.cross(e.fb).normalize();return h}function qh(e,f){R.call(this,e);this.mi=null==f?!0:f}qh.prototype=Object.create(R.prototype);qh.prototype.constructor=qh;
P.hf=new fg("Spheres","SPHERES",qh);P.pi=new fg("Balls","BALLS",qh,!1);
qh.prototype.Ka=function(){var e=this.ja.length,f=null,g=this.fa.jg;if(g)f=e;else{var h;this.mi?(h=this.fa,null===h.ya&&("HIGH"===h.ab?h.ya=new THREE.SphereGeometry(h.u.ma.radius,h.u.ma.widthSegments,h.u.ma.heightSegments,h.u.ma.phiStart,h.u.ma.phiLength,h.u.ma.thetaStart,h.u.ma.thetaLength):"MEDIUM"===h.ab?h.ya=new THREE.SphereGeometry(h.u.pa.radius,h.u.pa.widthSegments,h.u.pa.heightSegments,h.u.pa.phiStart,h.u.pa.phiLength,h.u.pa.thetaStart,h.u.pa.thetaLength):"LOW"===h.ab&&(h.ya=new THREE.SphereGeometry(h.u.oa.radius,
h.u.oa.widthSegments,h.u.oa.heightSegments,h.u.oa.phiStart,h.u.oa.phiLength,h.u.oa.thetaStart,h.u.oa.thetaLength))),h=h.ya):h=bf(this.fa);var k=(new THREE.BufferGeometry).fromGeometry(h),m=k.attributes.position.array.length/k.attributes.position.itemSize,f=e*m}h=new THREE.BufferGeometry;var l=new Float32Array(3*f),q=new Float32Array(3*f),r=new Float32Array(f);if(g)var t=new Float32Array(f);else var w=new Float32Array(3*f),x=new Float32Array(2*f);for(f=0;f<e;f++){var B=this.ja[f],C=ef(0,B);if(g)l[3*
f]=B.pos.x,l[3*f+1]=B.pos.y,l[3*f+2]=B.pos.z,t[f]=this.mi?C:this.fa.sa.ma.radius,r[f]=f;else{var G=new THREE.Matrix4;G.setPosition(B.pos);this.mi&&(B=new THREE.Matrix4,B.makeScale(C,C,C),G.multiply(B));var I=k.clone();I.applyMatrix(G);for(var G=I.attributes.position.array,C=I.attributes.normal.array,B=I.attributes.color.array,I=I.attributes.uv.array,D=G.length/3,J=0;J<D;J++){for(var F=0;3>F;F++)l[f*G.length+3*J+F]=G[3*J+F],w[f*C.length+3*J+F]=C[3*J+F],q[f*B.length+3*J+F]=B[3*J+F];for(F=0;2>F;F++)x[f*
I.length+2*J+F]=I[2*J+F];r[f*m+J]=f}}}h.addAttribute("position",new THREE.BufferAttribute(l,3));B=new THREE.BufferAttribute(q,3);B.dynamic=!0;h.addAttribute("color",B);h.addAttribute("atomIndex",new THREE.BufferAttribute(r,1));g?h.addAttribute("radius",new THREE.BufferAttribute(t,1)):h.addAttribute("normal",new THREE.BufferAttribute(w,3));h.gd();g&&ge(h);e=null;e=g?kf(this.fa):ff(this.fa);t=null;t=g?new THREE.Points(h,e):new THREE.Mesh(h,e);t.Ja=this;this.parent.add(t);this.da=t;this.nd()};
qh.prototype.update=function(e){R.prototype.update.call(this,e);e.Af&&(this.pc=[],this.parent.remove(this.da),e=this.da.visible,this.da=null,this.Ka(),this.da.visible=e)};function rh(e){R.call(this,e)}rh.prototype=Object.create(R.prototype);rh.prototype.constructor=rh;P.kc=new fg("Sticks","STICKS",rh);
rh.prototype.Ka=function(){if(this.fa.jg){var e=null;this.wa instanceof ag?e=this.wa.ra.Kb.Vb():this.wa instanceof bg?e=this.wa.Ab.xa.Kb.Vb():console.warn("Sticks representation unavailable for this data type");for(var f=new THREE.BufferGeometry,g=[],h=[],k=[],m=[],l=this.ja.length,q=0;q<l;q++){var r=this.ja[q],t=e.findNode(r);"HOH"!==this.ja[q].xb()&&(g.push(r.pos.x),g.push(r.pos.y),g.push(r.pos.z),h.push(this.fa.va.ma.radiusBottom),k.push(0),k.push(0),k.push(0),m.push(q))}this.uf=m.length;for(q=
0;q<l;q++){var r=this.ja[q],t=e.findNode(r),w=t.ed();if(w)for(var x=w.length,B=0;B<x;B++){var C=Hd(w[B],t).rd;if(this.ja.includes(C)){var G=r.pos,C=C.pos,C=(new THREE.Vector3).subVectors(C,G);C.divideScalar(2);g.push(G.x);g.push(G.y);g.push(G.z);k.push(C.x);k.push(C.y);k.push(C.z);h.push(this.fa.va.ma.radiusTop);m.push(q)}}}f.addAttribute("position",THREE.Float32Attribute(g,3));e=new Float32Array(3*h.length);e=THREE.Float32Attribute(e,3);e.dynamic=!0;f.addAttribute("color",e);f.addAttribute("radius",
THREE.Float32Attribute(h,1));f.addAttribute("dir",THREE.Float32Attribute(k,3));f.addAttribute("atomIndex",THREE.Float32Attribute(m,1));f.gd();ge(f);h=kf(this.fa);k=lf(this.fa);k=new THREE.MultiMaterial([h,k]);k.opacity=h.opacity;f.addGroup(0,this.uf,0);f.addGroup(this.uf,m.length,1);f=new THREE.Points(f,k)}else{f=null;this.wa instanceof ag?f=this.wa.ra.Kb.Vb():this.wa instanceof bg?f=this.wa.Ab.xa.Kb.Vb():console.warn("Sticks representation unavailable for this data type");m=this.fa;null===m.ka&&
("HIGH"===m.ab?m.ka=new THREE.CylinderGeometry(m.va.ma.radiusTop,m.va.ma.radiusBottom,m.va.ma.height,m.va.ma.Td,m.va.ma.wf,m.va.ma.openEnded):"MEDIUM"===m.ab?m.ka=new THREE.CylinderGeometry(m.va.pa.radiusTop,m.va.pa.radiusBottom,m.va.pa.height,m.va.pa.Td,m.va.pa.wf,m.va.pa.openEnded):"LOW"===m.ab&&(m.ka=new THREE.CylinderGeometry(m.va.oa.radiusTop,m.va.oa.radiusBottom,m.va.oa.height,m.va.oa.Td,m.va.oa.wf,m.va.oa.openEnded)));m=m.ka;m=(new THREE.BufferGeometry).fromGeometry(m);h=this.fa;null===h.Ua&&
("HIGH"===h.ab?h.Ua=new THREE.SphereGeometry(h.v.ma.radius,h.v.ma.widthSegments,h.v.ma.heightSegments,h.v.ma.phiStart,h.v.ma.phiLength,h.v.ma.thetaStart,h.v.ma.thetaLength):"MEDIUM"===h.ab?h.Ua=new THREE.SphereGeometry(h.v.pa.radius,h.v.pa.widthSegments,h.v.pa.heightSegments,h.v.pa.phiStart,h.v.pa.phiLength,h.v.pa.thetaStart,h.v.pa.thetaLength):"LOW"===h.ab&&(h.Ua=new THREE.SphereGeometry(h.v.oa.radius,h.v.oa.widthSegments,h.v.oa.heightSegments,h.v.oa.phiStart,h.v.oa.phiLength,h.v.oa.thetaStart,h.v.oa.thetaLength)));
h=h.Ua;k=(new THREE.BufferGeometry).fromGeometry(h);e=k.attributes.position.array.length/k.attributes.position.itemSize;g=m.attributes.position.array.length/m.attributes.position.itemSize;h=new THREE.BufferGeometry;l=[];q=[];r=[];t=[];w=[];x=new THREE.Matrix4;x.makeRotationX(.5*Math.PI);B=this.ja.length;for(G=0;G<B;G++){var C=this.ja[G],I=f.findNode(C);if("HOH"!==this.ja[G].xb()){var D=new THREE.Matrix4;D.setPosition(C.pos);var J=k.clone();J.applyMatrix(D);for(var F=J.attributes.position.array,K=
0;K<F.length;K++)l.push(F[K]);F=J.attributes.normal.array;for(K=0;K<F.length;K++)q.push(F[K]);F=J.attributes.color.array;for(K=0;K<F.length;K++)r.push(F[K]);F=J.attributes.uv.array;for(K=0;K<F.length;K++)t.push(F[K]);for(K=0;K<e;K++)w.push(G)}if(J=I.ed())for(var D=J.length,N=0;N<D;N++)if(K=Hd(J[N],I).rd,this.ja.includes(K)){var F=C.pos,O=K.pos,K=F.clone(),U=new THREE.Vector3((F.x+O.x)/2,(F.y+O.y)/2,(F.z+O.z)/2),O=K.distanceTo(U),aa=U.clone().add(K).divideScalar(2),F=new THREE.Matrix4;F.lookAt(K,U,
new THREE.Vector3(0,1,0));F.multiply(x);F.setPosition(aa);K=new THREE.Matrix4;K.makeScale(1,O,1);F.multiply(K);O=m.clone();O.applyMatrix(F);F=O.attributes.position.array;for(K=0;K<F.length;K++)l.push(F[K]);F=O.attributes.normal.array;for(K=0;K<F.length;K++)q.push(F[K]);F=O.attributes.color.array;for(K=0;K<F.length;K++)r.push(F[K]);F=O.attributes.uv.array;for(K=0;K<F.length;K++)t.push(F[K]);for(K=0;K<g;K++)w.push(G)}}h.addAttribute("position",THREE.Float32Attribute(l,3));h.addAttribute("normal",THREE.Float32Attribute(q,
3));F=THREE.Float32Attribute(r,3);F.dynamic=!0;h.addAttribute("color",F);h.addAttribute("uv",THREE.Float32Attribute(t,2));h.addAttribute("atomIndex",THREE.Float32Attribute(w,1));h.gd();f=ff(this.fa);f=new THREE.Mesh(h,f)}f.Ja=this;this.parent.add(f);this.da=f;this.nd()};rh.prototype.update=function(e){R.prototype.update.call(this,e);if(e=e.Af)e=void 0===this.wa.ke.Jd(P.gf);e&&(e=this.da.visible,this.pc=[],this.parent.remove(this.da),this.da=null,this.Ka(),this.da.visible=e)};
var th=function sh(f,g,h){R.call(this,f);this.Wj=h;this.wireframe=g;this.bh=h?sh.u:sh.v;this.startTime=null};th.v=0;th.u=1.4;th.prototype=Object.create(R.prototype);th.prototype.constructor=th;P.ni=new fg("Accessible Surface Wireframe","ASM",th,!0,!0);P.Jg=new fg("Accessible Surface","AS",th,!1,!0);P.yi=new fg("Molecular Surface Wireframe","MSM",th,!0,!1);P.Og=new fg("Molecular Surface","MS",th,!1,!1);
th.prototype.Ka=function(){var e,f;if("Solvent"!==this.Ia.type){if(this.wireframe){var g=ff(this.fa);g.wireframe=!0;var h=this.Wj?Sg(this.wa,P.Jg):Sg(this.wa,P.Og);null===h.da&&(h.Ka(),h.hide());h=h.da.geometry.clone()}else{var g=ff(this.fa),k;h=this.fa;k="LOW"===h.ab?.5:"MEDIUM"===h.ab?1:"HIGH"===h.ab?1.5:void 0;var m=this.Ia.Ea(),h=this.zc(m),l=h[0],h=h[1],q=6*Math.ceil(k)+1;l.x-=q;h.x+=q;l.y-=q;h.y+=q;l.z-=q;h.z+=q;for(var r=Math.trunc((h.x-l.x)*k),t=Math.trunc((h.y-l.y)*k),w=Math.trunc((h.z-l.z)*
k),h=Array(r),q=0;q<r;q++)for(var x=0;x<t;x++)for(var B=0;B<w;B++)void 0===h[q]&&(h[q]=Array(t)),void 0===h[q][x]&&(h[q][x]=Array(w)),h[q][x][B]=new THREE.Vector3(q/k+l.x,x/k+l.y,B/k+l.z),h[q][x][B].Eb=[],h[q][x][B].state=0;r=m.length;q=null;for(t=0;t<r;t++)for(var w=m[t],C=ef(0,w),G=Math.trunc((C+this.bh)*k)+1,I=Math.trunc((w.pos.x-l.x)*k),D=Math.trunc((w.pos.y-l.y)*k),J=Math.trunc((w.pos.z-l.z)*k),F=I-G;F<=I+G;F++)for(f=D-G;f<=D+G;f++)for(e=J-G;e<=J+G;e++)q=F/k+l.x,x=f/k+l.y,B=e/k+l.z,w.Ya().distanceTo(new THREE.Vector3(q,
x,B))<C+this.bh&&(q=h[F][f][e],q.Eb.push(w),q.qa=w,q.Xa=t,q.state=1);k=new ce(!0);m=h.length;for(l=1;l<m;l++)for(q=h[l].length,x=1;x<q;x++)for(B=h[l][x].length,r=1;r<B;r++){G=0;1===h[l-1][x][r].state&&(G|=128);1===h[l][x][r].state&&(G|=64);1===h[l][x-1][r].state&&(G|=32);1===h[l-1][x-1][r].state&&(G|=16);1===h[l-1][x][r-1].state&&(G|=8);1===h[l][x][r-1].state&&(G|=4);1===h[l][x-1][r-1].state&&(G|=2);1===h[l-1][x-1][r-1].state&&(G|=1);t=k;C=h[l-1][x-1][r-1];I=h[l][x-1][r-1];D=h[l][x][r-1];J=h[l-1][x][r-
1];F=h[l-1][x-1][r];f=h[l][x-1][r];e=h[l][x][r];for(var K=h[l-1][x][r],w=[C,I,D,J,F,f,e,K,C,I,D,J],C=[I,D,J,C,f,e,K,F,F,f,e,K],D=ah[G],J=D.length,G=[],I=0;I<J;I++){F=D[I];f=w[F];e=C[F];F=void 0;for(K=0;8>K;K++)if(F=new THREE.Vector3((f.x+e.x)/2,(f.y+e.y)/2,(f.z+e.z)/2),F.Eb=[],0<f.Eb.length)uh(this,F,f.Eb)?(Array.prototype.push.apply(F.Eb,f.Eb),f=F):uh(this,F,e.Eb)||(e=F);else if(0<e.Eb.length)uh(this,F,e.Eb)?(Array.prototype.push.apply(F.Eb,e.Eb),e=F):uh(this,F,f.Eb)||(f=F);else break;Array.prototype.push.apply(F.Eb,
f.Eb);Array.prototype.push.apply(F.Eb,e.Eb);e=f=F;for(var K=F.Eb,N=Infinity,O=null,U=K.length,aa=0;aa<U;aa++){var pa=K[aa],Gb=e.distanceTo(pa.Ya());Gb<N&&(N=Gb,O=pa)}f.qa=O;F.Xa=this.ja.indexOf(F.qa);e=t;K=F.x;N=F.y;O=F.z;f=!1;U=-1;aa=K+":"+N+":"+O;e.Zg.has(aa)?U=e.Zg.get(aa):(U=e.uc.length/3,de(e,K,N,O,void 0,void 0),e.Zg.set(aa,U),f=!0);e=U;f&&t.Zc.push(F.Xa);G.push(e)}I=0;for(w=G.length/3;I<w;I++)ee(t,G[3*I],G[3*I+2],G[3*I+1])}h=fe(k)}g=new THREE.Mesh(h,g);g.qa=this.Ia;g.Ja=this;this.parent.add(g);
this.da=g;this.color(V.ob)}};th.prototype.zc=function(e){for(var f=new THREE.Vector3(Infinity,Infinity,Infinity),g=new THREE.Vector3(-Infinity,-Infinity,-Infinity),h=e.length,k=0;k<h;k++){var m=e[k].pos;f.x=Math.min(f.x,m.x);f.y=Math.min(f.y,m.y);f.z=Math.min(f.z,m.z);g.x=Math.max(g.x,m.x);g.y=Math.max(g.y,m.y);g.z=Math.max(g.z,m.z)}return[f,g]};function uh(e,f,g){for(var h=g.length,k=!1,m=0;m<h;m++){var l=g[m];if(l.Ya().distanceTo(f)<parseFloat(jb(l.symbol)[7])+e.bh){k=!0;break}}return k}
th.prototype.update=function(e){R.prototype.update.call(this,e);e.Af&&(e=this.da.visible,this.pc=[],this.parent.remove(this.da),this.da=null,this.Ka(),this.da.visible=e)};function vh(){THREE.Object3D.call(this);this.matrixAutoUpdate=!1;this.matrixWorldNeedsUpdate=!0;this.wa=this;this.ke=new Ka;this.labels=new THREE.Object3D;this.add(this.labels)}vh.prototype=Object.create(THREE.Object3D.prototype);vh.prototype.constructor=vh;function wh(){this.map=[]}wh.prototype.get=function(e){return this.map[e.constructor]};
function xh(e){var f=yh;e=e.toLowerCase();if("structure"===e||"molecule"===e)return f.map[ag];if("residue"===e)return f.map[bg];if("atom"===e)return f.map[eg]}wh.prototype.add=function(e,f){this.map[e]=f};var yh=new wh;z=vh.prototype;z["delete"]=function(){for(var e=this.ke.keys(),f=0,g=e.length;f<g;f++)e[f]["delete"]()};z.bg=function(){for(var e=[],f=xh(this instanceof bg?"residue":this instanceof eg?"atom":"molecule"),g=0;g<f.length;g++)e.push(f[g]);return e};
z.show=function(e){if(void 0!==e){if(e=Sg(this,e),null!=e)return e.show(),e}else this.visible=!0};z.hide=function(e){void 0!==e?(e=Sg(this,e),null!=e&&e.hide()):this.visible=!1};z.yb=function(e,f,g){if(void 0!==f)f=Sg(this,f),null!=f&&f.yb(e,g);else{f=this.Zb();for(var h=0;h<f.length;h++)f[h].yb(e,g)}};
function Sg(e,f){if(null!==f){var g=e.ke.Jd(f);void 0===g&&-1!==yh.get(e).indexOf(f)&&(void 0!==f&&null!==f?(g=new f.Ja(e,f.ol,f.mm),g.ld=f.name):g=void 0,void 0!==g&&(g.zf=void 0),e.ke.set(g,f));return g}}z.mg=function(e){var f=this.ke.Jd(e);return void 0===f||-1===yh.get(this).indexOf(e)?!1:f.visible};z.Zb=function(){var e=[],f=this.ke.keys(),g;for(g in f){var h=f[g];h.visible&&e.push(h)}return e};
function Zf(e){var f=[],g=null,h=e.children.length;if(0!==h)for(var k=0;k<h;k++)g=e.children[k],g instanceof THREE.Mesh||g instanceof THREE.Line||g instanceof THREE.Points?void 0===g.qa&&void 0==g.geometry.attributes.atomIndex||f.push(g):null!=g&&g instanceof vh&&(f=f.concat(Zf(g)));else if(e instanceof THREE.Mesh||e instanceof THREE.Line||e instanceof THREE.Points)if(void 0!==e.qa||void 0!=e.geometry.attributes.atomIndex)return[e];return f}
function eg(e,f){vh.call(this);this.fa=Je();this.be=f;this.tg=e;this.tg.add(this);this.ja=[f];this.qa=this.be;this.updateMatrixWorld()}eg.prototype=Object.create(vh.prototype);eg.prototype.constructor=eg;yh.add(eg,[P.hf,P.re]);z=eg.prototype;z["delete"]=function(){vh.prototype["delete"].call(this);this.parent.remove(this)};z.gb=function(){return this.tg.gb()};z.qb=function(){return this.tg.qb()};z.gc=function(){return this.tg};z.dd=function(){return this.be.Ya()};z.wb=function(){return this.be.zc()};
function ag(e,f){vh.call(this);this.oe=e;this.oe.add(this);this.ra=f;this.fa=Je();this.Ud=new Fa;this.ja=this.ra.Ea();this.qa=this.ra;this.updateMatrixWorld()}ag.prototype=Object.create(vh.prototype);ag.prototype.constructor=ag;yh.add(ag,[P.hf,P.gf,P.LINES,P.kc,P.re,P.Jf,P.ti,P.Og,P.yi,P.Jg,P.ni,P.Kg,P.oi,P.Ng]);z=ag.prototype;z["delete"]=function(){vh.prototype["delete"].call(this);for(var e=this.Ud.values(),f=0,g=e.length;f<g;f++)e[f]["delete"]();this.parent.remove(this)};z.gb=function(){return this.oe};
z.clear=function(e){e=Sg(this,e);null!==e&&void 0!==e&&e.clear()};function zh(e){if(null!==e.ra.type)switch(e.ra.type){case "Protein":case "Peptide":return P.Jf;case "Small Peptide":return P.gf;case "RNA":case "DNA":return P.Jf;case "Ligand":return P.kc;case "Ion":return P.re;case "Solvent":return P.NONE}console.warn("Error, cannot draw : ",e.ra.type);return null}function uf(e){e=Sg(e,zh(e));null!==e&&void 0!==e&&e.show()}
z.gc=function(e,f){"string"===typeof e&&(e=e.includes(":")?this.ra.Aa(e.split(":")[1]):this.ra.Aa(e));if(e.xa!==this.ra)throw e.toString()+" don't belongs to "+this.ra.toString();var g=this.Ud.get(e);null==g&&f&&(g=new bg(this,e),this.Ud.set(e,g));return g};z.reset=function(){for(var e=this.Zb(),f=0;f<e.length;f++){var g=e[f];g.nd();g.yb(!1);g.hide();if(g=e[f].da)g.material.opacity=1,g.material.transparent=!1}uf(this);e=this.Ud.values();g=e.length;for(f=0;f<g;f++)this.remove(e[f]);this.Ud.clear()};
z.le=function(){this.matrix.identity();this.matrixWorldNeedsUpdate=!0};z.dd=function(){return Id(this.ra.zc())};z.wb=function(){return this.ra.zc()};z.Fb=function(){return this.ra.Fb()};function bg(e,f){vh.call(this);this.fa=Je();this.Ab=f;this.Lh=e;this.Uf=new Fa;this.Lh.add(this);this.ja=this.Ab.Ea();this.qa=this.Ab;this.updateMatrixWorld()}bg.prototype=Object.create(vh.prototype);bg.prototype.constructor=bg;yh.add(bg,[P.hf,P.gf,P.LINES,P.kc,P.re,P.Ng]);z=bg.prototype;
z["delete"]=function(){vh.prototype["delete"].call(this);for(var e=this.Uf.values(),f=0,g=e.length;f<g;f++)e[f]["delete"]();this.parent.remove(this)};z.gb=function(){return this.Lh.oe};z.qb=function(){return this.Lh};z.Id=function(e,f){"string"===typeof e&&(e=e.includes(":")?this.Ab.mj(e.split(":")[1]):this.Ab.mj(e));if(e.Oa!==this.Ab)throw e.toString()+" don't belongs to "+this.Ab.toString();var g=this.Uf.get(e);null==g&&f&&(g=new eg(this,e),this.Uf.set(e,g));return g};z.dd=function(){return Id(this.Ab.zc())};
z.wb=function(){return this.Ab.zc()};
function of(e){THREE.Group.call(this);this.Jb=new THREE.Scene;this.scene=this;this.scene.qa=this;this.Jb.add(this);this.hb=e.ba.canvas;this.na=[];this.light=this.camera=this.renderer=null;this.fa=Je();this.animations=new If(this);this.Gf=new If(this);this.Qb=new ScriptEngine(this);this.aa=e;this.Gc=this.ce=null;this.Wd=[];this.wd=this.tc=this.ze=null;this.mf=[];if(this.aa.ba.Lj){this.ib={enabled:!0};this.Yf=1;e=THREE.ShaderLib.depthRGBA;var f=THREE.UniformsUtils.clone(e.uniforms);new THREE.ShaderMaterial({fragmentShader:e.fragmentShader,
vertexShader:e.vertexShader,uniforms:f,blending:THREE.NoBlending})}this.Ph=new THREE.Plane(new THREE.Vector3(0,0,-1),0);this.rh=new THREE.Plane(new THREE.Vector3(0,0,1),0);this.init();kd.Gb.$j()&&kd.Gb.ak({element:$(this.renderer.domElement.parent).get(0),ba:this.aa.ba});e=this.hb.width();f=this.hb.height();this.Wf=new THREE.EffectComposer(this.renderer);var g=new THREE.RenderPass(this.Jb,this.camera);new THREE.SMAAPass(e,f);var h=new THREE.ShaderPass(THREE.CopyShader);h.renderToScreen=!0;this.Wf.addPass(g);
this.Wf.addPass(h);this.Uh=new THREE.ParallaxBarrierEffect(this.renderer);this.Uh.setSize(e,f);this.Jc=new THREE.AnaglyphEffect(this.renderer);this.Jc.setSize(e,f);kd.Yc.bind(this.Uh,this.hb);kd.Yc.bind(this.Jc,this.hb);kd.Yc.bind(this.Wf,this.hb);this.om=new Yd(this.renderer,this.hb);this.aj=this.camera.focus;this.wl=mf();this.Aj=new Rf(this,this.renderer.domElement);this.je=new Wf(this,this.renderer.domElement);this.ul=new $f(this,this.renderer.domElement);this.Ff=!1;this.Dj=null;var k=this,m=new THREE.Clock;
requestAnimationFrame(function q(){requestAnimationFrame(q);var e=m.getDelta();k.Qb.Pc?0!==k.Gf.Kc.length&&Jf(k.Gf,1E3*e):k.Qb.update(1E3*e);k.je.update();k.Aj.update();k.ul.update();Ah(k,k.Jb);Bh(k)});this.fa.subscribe(this)}of.prototype=Object.create(THREE.Group.prototype);of.prototype.constructor=of;var Ch=Object;Ch.location=[];Ch.location.ea="CENTER";Ch.location.ka="TOP";Ch.location.u="BOTTOM";Ch.location.LEFT="LEFT";Ch.location.RIGHT="RIGHT";Ch.location.ya="TOP_LEFT";Ch.location.v="BOTTOM_LEFT";
Ch.location.ca="BOTTOM_RIGHT";Ch.location.Ma="TOP_RIGHT";z=of.prototype;z.ji=function(){kd.Gb.toggle(this.aa.ba,$(this.renderer.domElement.parent).get(0))};function Dh(e){return new Promise(function(f){e.Ff=!0;e.Dj=f})}function xf(e,f,g){var h=1.5*e.wb().length();null!=f&&(e.Ph.constant=-(e.camera.near-e.camera.position.z+f/100*(h-e.camera.near)));null!=g&&(e.rh.constant=e.camera.near-e.camera.position.z+g/100*(h-e.camera.near))}
function Eh(e,f){for(var g=e.na.length,h=f.fd(),k=0,m=0;m<g;m++)e.na[m].fd().substring(0,4)===h&&k++;0<k&&f.ia.qc(h+"_"+k);e.add(f);e.na.push(f)}
function Bh(e){e.renderer.clear();e.aa.df?e.Uh.render(e.Jb,e.camera):e.aa.Jc?e.Jc.render(e.Jb,e.camera):(e.fa.ef?e.om.render(e.Jb,e.camera):e.renderer.render(e.Jb,e.camera),e.Jb.overrideMaterial=e.wl,e.renderer.render(e.Jb,e.camera),e.Jb.overrideMaterial=null);null!=e.Gc&&(e.renderer.clearDepth(),e.renderer.render(e.Gc,e.ce));e.Ff&&(e.Ff=!1,e.renderer.domElement.toBlob(function(f){e.Dj(f)},"image/png"))}
function Ah(e,f){var g=new THREE.Vector4(0,0,e.renderer.domElement.offsetWidth,e.renderer.domElement.offsetHeight);f.traverse(function(e){if(e.material){var f=e.material.uniforms,m=e.material.materials;if(f||m)for(f&&(m=[e.material]),e=0;e<m.length;e++)f=m[e].uniforms,f.viewport&&(f.viewport.value=g)}})}
z.init=function(){this.camera=this.aa.camera;this.camera.position.set(0,0,30);this.light=new zf(this);this.scene.matrixAutoUpdate=!1;var e=new THREE.AmbientLight(6710886);this.Jb.add(e);this.Jb.fog=new THREE.Fog(this.fa.bgColor,0,0);this.renderer=new THREE.WebGLRenderer({antialias:this.fa.ug.antialias});this.renderer.autoClear=!1;this.renderer.setSize(this.hb.width(),this.hb.height());this.renderer.setPixelRatio(window.devicePixelRatio);this.renderer.setClearColor(this.fa.bgColor,1);this.renderer.domElement.className+=
" hasContextMenu";this.hb.prepend(this.renderer.domElement);this.renderer.getContext();this.renderer.clippingPlanes=[this.Ph,this.rh];kd.Yc.bind(this.renderer,this.hb,this.camera,this);var f=this.renderer.getContext(),e=this.fa,g=f.getSupportedExtensions(),h=f.getExtension("EXT_frag_depth"),k=f.getExtension("WEBGL_depth_texture"),f=f.getParameter(f.ALIASED_POINT_SIZE_RANGE);console.info("Available WEBGL extensions : ",g);console.info("WebGL Point Size Range : "+f[0]+"-"+f[1]);h&&1024<=f[1]?(e.jg=
!0,console.info("BiovizJS is using advanced impostor representation for Spheres, Sticks and Balls & Sticks")):console.info("BiovizJS is using standard representation for Spheres, Sticks and Balls & Sticks");k&&(e.ef=!1);this.aa.ba.Lj&&(this.ib.scene=new THREE.Scene,this.ib.camera=new THREE.OrthographicCamera(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,-1E4,1E4),this.ib.camera.position.z=1,e={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter},this.ib.Ml=
new THREE.WebGLRenderTarget(window.innerWidth*this.Yf,window.innerHeight*this.Yf,e),this.ib.Ll=new THREE.WebGLRenderTarget(window.innerWidth,window.innerHeight,e),e=THREE.SSAOShader,this.ib.ssao_uniforms=THREE.UniformsUtils.clone(e.uniforms),this.ib.ssao_uniforms.tDiffuse.value=this.ib.Ll,this.ib.ssao_uniforms.tDepth.value=this.ib.Ml,this.ib.ssao_uniforms.size.value.set(window.innerWidth*this.Yf,window.innerHeight*this.Yf),this.ib.ssao_uniforms.cameraNear.value=this.camera.near,this.ib.ssao_uniforms.cameraFar.value=
this.camera.far,this.ib.ssao_uniforms.onlyAO.value=!1,this.ib.tl=new THREE.ShaderMaterial({uniforms:this.ib.ssao_uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.ib.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(window.innerWidth,window.innerHeight),this.ib.tl),this.ib.quad.position.z=-500,this.ib.scene.add(this.ib.quad),new SSAOConfig(this.renderer,this.ib))};z.clear=function(){for(var e=0;e<this.na.length;e++)this.scene.remove(this.na);this.na=[]};
z.Dd=function(e,f){null==f&&(f=.1);var g=new Lf(e.r,e.g,e.b,f);this.animations.yc(g)};function De(e,f,g,h){void 0===f&&(f=e.na[0]);void 0===g&&(g=1E3);void 0===h&&(h=!0);g=new Kf(f,e,g,h);e.Gf.yc(g);h&&(e.aa.Sa=f)}function Fh(e,f,g,h){void 0===f&&(f=e.na[0]);void 0===h&&(h=1E3);f=new Pf(h,f,e,g);e.animations.yc(f)}z.toString=function(){return"scene"};z.update=function(e){e.bgColor&&(this.renderer.setClearColor(this.fa.bgColor,1),this.Jb.fog.color=this.fa.bgColor)};
z.xg=function(e,f,g,h,k){function m(e){return"#"===e.charAt(0)?e.substring(1,7):"x"===e.charAt(1)?e.substring(2,8):e}var l=this.hb.height(),q=this.hb.width();null==f&&(f=Ch.location.Ma);null!=g?"string"===typeof g&&g.endsWith("%")&&(g=l*g.substr(0,g.length-1)/100):g=l*this.fa.De/100;null==h&&(h="#00ff00");null==k&&(k=2E3);if(null===this.Gc){this.ce=new THREE.OrthographicCamera(-q/2,q/2,l/2,-l/2,1,10);this.ce.position.z=10;this.Gc=new THREE.Scene;kd.Yc.bind(this.renderer,this.hb,this.ce,this);var r=
new THREE.RenderPass(this.Gc,this.ce);this.Wf.addPass(r,1)}""===e?void 0!==this.Wd[f]&&(this.Gc.remove(this.Wd[f]),this.Wd[f]=void 0,this.renderer.render(this.Gc,this.ce)):void 0!==e&&(e=df(e,{fontsize:g,sh:{r:parseInt(m(h).substring(0,2),16),g:parseInt(m(h).substring(2,4),16),b:parseInt(m(h).substring(4,6),16),a:1},maxWidth:q,maxHeight:l}),h=new THREE.SpriteMaterial({map:e}),e=h.map.image.width,g=h.map.image.height,h=new THREE.Sprite(h),h.scale.set(e,g,1),void 0!==this.Wd[f]&&this.Gc.remove(this.Wd[f]),
this.Wd[f]=h,Gh(this),this.Gc.add(h),void 0!==k&&(f=new Qf(h,this,k,f),this.Qb.Pc?this.Gf.yc(f):this.animations.yc(f)))};
function Gh(e){var f=e.hb.width()/2,g=e.hb.height()/2,h;for(h in Ch.location){var k=Ch.location[h],m=e.Wd[k];if(void 0!==m){var l=m.material.map.image.width/2,q=m.material.map.image.height/2;switch(k){case Ch.location.ea:m.position.set(0,0,1);break;case Ch.location.ka:m.position.set(0,g-q,1);break;case Ch.location.u:m.position.set(0,-g+q,1);break;case Ch.location.LEFT:m.position.set(-f+l,0,1);break;case Ch.location.RIGHT:m.position.set(f-l,0,1);break;case Ch.location.ya:m.position.set(-f+l,g-q,1);
break;case Ch.location.v:m.position.set(-f+l,-g+q,1);break;case Ch.location.ca:m.position.set(f-l,-g+q,1);break;default:m.position.set(f-l,g-q,1)}}}}z.vg=function(){for(var e=0;e<this.na.length;e++)this.na[e].vg()};z.Ze=function(){for(var e=0;e<this.na.length;e++)this.na[e].Ze();this.aa.ba.jb({type:"requestWidgetUpdate"})};z.Vh=function(){this.scene.matrix.identity();for(var e=0;e<this.na.length;e++)this.na[e].le();this.scene.updateMatrixWorld(!0);Ae(this.aa,this.aa.eb,!0)};
z.reset=function(){this.scene.matrix.identity();for(var e=0;e<this.na.length;e++)this.na[e].reset();this.scene.updateMatrixWorld(!0);Ae(this.aa,this.aa.eb,!0);this.aa.ba.jb({type:"requestWidgetUpdate"})};z.Ya=function(){return new THREE.Vector3};z.dd=function(){return Id(this.wb())};z.wb=function(){for(var e=null,f=this.na.length,g=0;g<f;g++){var h=this.na[g],k=h.wb().clone();k.applyMatrix4(h.matrix);e=null===e?k:e.merge(k)}f=new THREE.Vector3;return null!==e?e:new ob(f,f)};
z.Cg=function(e){this.je.Hh=!0;void 0!=e?this.ze=e:this.ze=null};z.Df=function(){this.ze=null;this.je.Hh=!1};z.ih=function(){for(var e=this.mf.length,f=0;f<e;f++)this.scene.remove(this.mf[f]);this.mf.splice()};function M(e){vh.call(this);this.nl=!0;this.ia=e;this.qa=this.ia.fg();this.fa=Je();this.Da=new Ka;this.updateMatrixWorld();this.Wc=new Fa}M.prototype=Object.create(vh.prototype);z=M.prototype;z.constructor=M;z.gb=function(){return this};
z["delete"]=function(){vh.prototype["delete"].call(this);for(var e=this.Da.values(),f=0,g=e.length;f<g;f++)e[f]["delete"]();this.parent.remove(this)};z.show=function(e){for(var f=0;f<this.Da.keys().length;f++)this.Da.get(this.Da.keys()[f]).show(e)};z.hide=function(e){for(var f=0;f<this.Da.keys().length;f++)this.Da.get(this.Da.keys()[f]).hide(e)};z.mg=function(e){for(var f=!0,g=this.Da.keys(),h=0;h<g.length&&(f=this.Da.get(g[h]).mg(e),f);h++);return f};
z.Zb=function(){for(var e=[],f=this.Da.values(),g=0,h=f.length;g<h;g++)for(var k=f[g].ke.keys(),m=0;m<k.length;m++){var l=k[m];l.visible&&e.push(l)}return e};z.dd=function(){return Id(this.wb())};z.wb=function(){var e=null,f;for(f in this.Da.keys()){var g=this.Da.get(this.Da.keys()[f]),h=g.wb().clone();h.applyMatrix4(g.matrix);e=null===e?h:e.merge(h)}return e};z.toString=function(){return this.ia.Mi};z.Fb=function(){return this.toString()};z.fd=function(){return this.ia._id};
function Hh(e,f){for(var g=e.Da.keys(),h=0;h<g.length;h++){var k=g[h];if(k.toString()===f)return e.Da.get(k)}}function tf(e){for(var f=[],g=e.Da.keys(),h=0;h<g.length;h++)f.push(e.Da.get(g[h]));return f}z.qb=function(e){var f=this.Da.get(e);void 0===f&&(f=new ag(this,e),this.Da.set(e,f));return f};z.reset=function(){Ge(this);this.le();this.Ze();this.vg()};
z.vg=function(){for(var e=tf(this),f=0;f<e.length;f++){e[f].yb(!1);for(var g=e[f].Ud.values();f<g.length;f++){g[0].yb(!1);for(var h=g[0].Uf.values();f<h.length;f++)h[0].yb(!1)}}};z.le=function(){this.matrix.identity();this.matrixWorldNeedsUpdate=!0;for(var e=tf(this),f=0;f<e.length;f++)e[f].le()};z.Ze=function(){Ge(this);var e=tf(this);this.show();for(var f=0;f<e.length;f++)e[f].reset()};
z.cc=function(e,f,g){var h,k;if(e instanceof ed||void 0==e)switch(f){case void 0:case M.u.Qg:Ih(this,this.ia,this.ia.toString(),this.ia.Ya(),this,g);break;case M.u.sc:e=this.Da.keys();for(var m in e)k=this.Da.get(e[m]),Ih(this,k.ra,k.ra.toString(),k.ra.Ya(),k,g);break;case M.u.jc:e=this.Da.keys();for(m in e){k=this.Da.get(e[m]);f=k.ra.ga;for(var l=0;l<f.length;l++)h=f[l],Ih(this,h,h.toString(),h.th(),k,g)}break;case M.u.ob:case M.u.Xc:for(m in e=this.Da.keys(),e)for(k=this.Da.get(e[m]),h=k.ra.Ea(),
l=0;l<h.length;l++){var q=h[l];f===M.u.ob?Ih(this,q,q.toString(),q.Ya(),k,g):Ih(this,q,jb(q.symbol)[7],q.Ya(),k,g)}}else if(e instanceof Rb)switch(f){case M.u.ob:case M.u.Xc:h=e.Ea();k=this.qb(e);for(m=0;m<h.length;m++)q=h[m],f===M.u.ob?Ih(this,q,q.toString(),q.Ya(),k,g):Ih(this,q,jb(q.symbol)[7],q.Ya(),k,g);break;case M.u.jc:f=e.ga;k=this.qb(e);for(m=0;m<f.length;m++)h=f[m],Ih(this,h,h.toString(),h.th(),k,g);break;case M.u.sc:case void 0:k=this.qb(e),Ih(this,e,e.toString(),e.Ya(),k,g)}else if(e instanceof
Gc)switch(f){case void 0:case M.u.jc:k=this.qb(e.xa);Ih(this,e,e.toString(),e.th(),k,g);break;case M.u.ob:case M.u.Xc:for(m3D=this.qb(e.xa),h=e.Ea(),m=0;m<h.length;m++)q=h[m],f===M.u.ob?Ih(this,q,q.toString(),q.Ya(),k,g):Ih(this,q,jb(q.symbol)[7],q.Ya(),k,g)}else if(e instanceof $a)switch(f){case void 0:case M.u.ob:case M.u.Xc:k=this.qb(e.Oa.xa),f===M.u.ob||void 0===f?Ih(this,e,e.toString(),e.Ya(),k,g):Ih(this,e,jb(e.symbol)[7],e.Ya(),k,g)}};
function Ih(e,f,g,h,k,m){void 0==e.Wc.get(f)&&(g=cf(g,m),h=be(g,h),k.labels.add(h),e.Wc.set(f,h))}function Ge(e,f){var g,h;if(void 0===f){var k=e.Wc.keys();for(h=0;h<k.length;h++)g=e.Wc.get(k[h]),g.parent.remove(g);e.Wc.clear()}else if(Array.isArray(f))for(h=0;h<f.length;h++)g=e.Wc.get(f[h]),null!=g&&(e.Wc.remove(f[h]),g.parent.remove(g));else g=e.Wc.remove(f),null!=g&&g.parent.remove(g)}M.u={Qg:"structure",sc:"molecule",jc:"residue",ob:"atom",Xc:"vdw"};function Jh(){}Jh.prototype.kb=function(){};
function Kh(e,f,g){var h=[],k,m=P.re;switch(f.type){case Lh:e=tf(f.gb(e)[0]);for(var l in e)if(f=e[l],k=f.Zb(),void 0===g)0===k.length&&(k=Sg(f,m)),h=h.concat(k);else for(var q in k)k[q].ld===g.name&&h.push(k[q]);break;case Mh:e=f.Kd(e);for(l in e)if(f=e[l],k=f.Zb(),void 0===g)0===k.length&&(k=Sg(f,m)),h=h.concat(k);else for(q in k)k[q].ld===g.name&&h.push(k[q]);break;case Nh:f=f.qb(e)[0];k=f.Zb();if(void 0===g)0===k.length&&(k=Sg(f,m)),h=h.concat(k);else for(q in k)k[q].ld===g.name&&h.push(k[q]);
break;case Oh:l=f.gc(e)[0];if(null!==l&&void 0!==l)if(k=l.Zb(),void 0===g)0===k.length&&(k=Sg(l,m)),h=h.concat(k);else for(q in k)k[q].ld===g.name&&h.push(k[q]);break;case Ph:if(l=f.Id(e)[0],null!==l&&void 0!==l&&(k=l.Zb()),void 0===g)0===k.length&&(k=Sg(l,m)),h=h.concat(k);else for(q in k)k[q].ld===g.name&&h.push(k[q])}return h}function Qh(){this.Wi=this.eh=this.zb=this.jd=this.dc=this.Ec=this.type=null;this.Hj="\x00"}Qh.prototype=Object.create(Jh.prototype);Qh.prototype.constructor=Qh;
var Lh="STRUCTURE",Mh="MOL_TYPE",Nh="MOLECULE",Oh="RESIDUE",Ph="ATOM";z=Qh.prototype;z.kb=function(){};z.Kd=function(e){switch(this.type){case "SCENE":return e;case Lh:return e.gb(this.dc);case Mh:return ye(e,this.dc,this.Ec);case Nh:return ye(e,this.dc,this.Ec,this.jd);case Oh:return e.gc(this.dc,this.Ec,this.jd,this.zb,this.Hj,!0);case Ph:return e.Id(this.dc,this.Ec,this.jd,this.eh,this.Wi,!0);default:return null}};z.gb=function(e){return e.gb(this.dc)};
z.qb=function(e){return ye(e,this.dc,this.Ec,this.jd)};z.gc=function(e){return e.gc(this.dc,this.Ec,this.jd,this.zb,this.Hj,!0)};z.Id=function(e){return e.Id(this.dc,this.Ec,this.jd,this.eh,this.Wi,!0)};function Rh(e){this.v=Sh;this.aa=e;this.u=[];new EventTarget(Rh.prototype)}var ScriptEngine=function Th(f){this.scene3D=f;this.u=this.scene3D.animations;this.Pc=!0;this.u.pause=this.Pc;this.v=this.ka=this.ca=this.currentTime=this.ea=null;new EventTarget(Th.prototype)};z=ScriptEngine.prototype;
z.update=function(e){if(!this.Pc){this.currentTime+=e;if(0<this.ea)this.ea-=e;else for(var f=0;this.v.length;f++){var g=this.v.remove();if(!1===g)break;else void 0!==g&&void 0!==g.kb||console.warn("WARNING : the command didn't return a class with execute function");if(g instanceof Uh){this.ea=g.duration;break}else try{g.kb(this.scene3D.aa)}catch(h){console.warn("Error on parsing script : "+h+"\nOn stack : "+(h.stack?h.stack:"Unknown")+"\nComing from command "+g.constructor.name);break}}0!==this.u.Kc.length&&
Jf(this.u,e);this.currentTime>this.ca&&this.jb("endScript");this.jb({type:"timeChanged",data:{currentTime:this.currentTime,progress:this.currentTime/this.ca}})}};
function Vh(e,f){Wh(e);var g=e.u;g.Kc.splice(0,g.Kc.length);e.currentTime=f.value*e.ca;for(var h=0,g=[],k=0;e.v.length;k++){var m=e.v.remove();if(!1===m)break;else void 0!==m&&void 0!==m.kb||console.warn("The command didn't return a class with execute function");if(m instanceof Uh){for(var m=m.duration,l=g.length,k=0;k<l;k++)try{g[k].kb(e.scene3D.aa)}catch(q){console.warn("Error on parsing script : "+q+"\nOn stack : "+(q.stack?q.stack:"Unknown")+"\nComing from command "+g[k].constructor.name);break}g.splice(0,
g.length);if(h+m>e.currentTime){h=e.currentTime-h;Jf(e.u,h,!0);e.ea=m-h;break}else Jf(e.u,m,!0),h+=m}else g.push(m)}l=g.length;if(0<l){for(k=0;k<l;k++)try{g[k].kb(e.scene3D.aa)}catch(q){console.warn("Error on parsing script : "+q+"\nOn stack : "+(q.stack?q.stack:"Unknown")+"\nComing from command "+g[k].constructor.name);break}e.jb("endScript")}}z.yc=function(e){this.u.yc(e)};z.play=function(){this.Pc=!1;this.u.pause=this.Pc;Vh(this,{type:"update",value:this.currentTime/this.ca})};
z.stop=function(){this.Pc=!0;this.u.pause=this.Pc;Wh(this);var e=this.u;e.Kc.splice(0,e.Kc.length);this.scene3D.reset();this.jb({type:"timeChanged",data:{currentTime:this.currentTime,progress:this.currentTime/this.ca}})};z.pause=function(){this.Pc=!0;this.u.pause=this.Pc};function Wh(e){e.currentTime=0;e.ea=0;e.v=e.ka.slice(0);e.v.add=e.v.push;e.v.remove=e.v.shift}function Xh(e,f,g){this.Ki=e;this.xc=f;this.Ii=g?g.get("full"):!1;this.Hi=g?g.get("duration"):0}Xh.prototype=Object.create(Jh.prototype);
Xh.prototype.constructor=Xh;
Xh.prototype.kb=function(e){var f;var g=this.Ki.qb(e)[0],h=this.xc.qb(e)[0],k=new Td;k.align(g.ra,h.ra);k=k.ca;if(null!==k){var m=Yh(this,e).matrixWorld;f=(new THREE.Matrix4).getInverse(m);var l=g.matrixWorld,q=h.matrixWorld,m=(new THREE.Matrix4).extractRotation(m),r=(new THREE.Matrix4).extractRotation(q),t=this.Ii?(new THREE.Matrix4).extractRotation((new THREE.Matrix4).getInverse(g.matrix)):new THREE.Matrix4,g=g.ra.Ya().clone().applyMatrix4(l),q=h.ra.Ya().clone().applyMatrix4(q),h=new THREE.Vector3;
h.setFromMatrixPosition((new THREE.Matrix4).multiply(f).multiply((new THREE.Matrix4).setPosition(g)));g=(new THREE.Vector3).subVectors(q,g);f=(new THREE.Matrix4).multiply((new THREE.Matrix4).setPosition(he(f,g))).multiply((new THREE.Matrix4).setPosition(h)).multiply((new THREE.Matrix4).getInverse(m)).multiply(r).multiply(k).multiply(t).multiply((new THREE.Matrix4).setPosition(h.clone().negate()))}else f=null;k=Yh(this,e);0<=this.Hi?(f=k.matrix.clone().multiply(f),Fh(e.scene3D,k,f,this.Hi)):(k.matrix.multiply(f),
k.matrixWorldNeedsUpdate=!0)};function Yh(e,f){var g=e.Ki.qb(f)[0];return e.Ii?g.gb():g}function Zh(e,f,g,h){this.alpha=f;this.target=e;this.Fc=h;this.duration=g?g.get("duration"):void 0}Zh.prototype=Object.create(Jh.prototype);Zh.prototype.constructor=Zh;Zh.prototype.kb=function(e){for(var f=Kh(e,this.target,this.Fc),g=0;g<f.length;g++){var h=f[g].yg(this.alpha,this.duration);null!=h&&e.scene3D.animations.yc(h)}};function $h(e,f,g){this.target=e;this.zoom=g;this.duration=f?f.get("duration"):0}
$h.prototype=Object.create(Jh.prototype);$h.prototype.constructor=$h;$h.prototype.kb=function(e){var f=this.target.gb(e)[0];if(void 0!==f)if(0>=this.duration)Ae(e,f,this.zoom);else{e=e.scene3D;var g=this.duration,h=this.zoom;void 0===f&&(f=e.na[0]);void 0===g&&(g=1E3);void 0===h&&(h=!0);f=new Kf(f,e,g,h);e.animations.yc(f)}};function ai(e,f,g,h){this.target=e;this.duration=h?h.get("duration"):void 0}ai.prototype=Object.create(Jh.prototype);ai.prototype.constructor=ai;ai.prototype.kb=function(){console.log("Clip Command not supported yet")};
function bi(e,f,g,h){this.target=e;this.color=f;this.Fc=g;this.duration=h?h.get("duration"):void 0}bi.prototype=Object.create(Jh.prototype);bi.prototype.constructor=bi;bi.prototype.kb=function(e){var f=Kh(e,this.target,this.Fc),g,h=this.color;void 0!=V.uh(this.color)&&(h=V.uh(this.color));for(var k=0;k<f.length;k++)g=f[k].color(h,this.duration),null!=g&&e.scene3D.animations.yc(g)};
function ci(e,f){this.name="display";this.text=e;this.position=null==f?void 0:f.get("location");this.size=null==f?void 0:f.get("size");this.color=null==f?void 0:f.get("color");this.duration=null==f?void 0:f.get("duration")}ci.prototype=Object.create(Jh.prototype);ci.prototype.constructor=ci;ci.prototype.kb=function(e){e.scene3D.xg(this.text,this.position,this.size,this.color,this.duration)};function di(e,f,g){this.target=e;this.Fc=f;this.enable=g}di.prototype=Object.create(Jh.prototype);
di.prototype.constructor=di;di.prototype.kb=function(e){var f=this.target.Kd(e);switch(this.target.type){case Lh:f=tf(f);for(e=0;e<f.length;e++)f[e].yb(this.enable,this.Fc);break;case Mh:case Nh:for(e=0;e<f.length;e++)f[e].yb(this.enable,this.Fc);break;case Oh:e=f[0];e.yb(this.enable,this.Fc);f=e.qb();f.yb(this.enable,this.Fc,e.Ab.Ea());break;case Ph:var g=f[0];g.yb(this.enable,this.Fc);e=g.gc();e.yb(this.enable,this.Fc,[g.be]);f=g.qb();f.yb(this.enable,this.Fc,[g.be])}};
function ei(e,f){this.name="load";this.wh=e;this.Tf=f}ei.prototype=Object.create(Jh.prototype);ei.prototype.constructor=ei;ei.prototype.kb=function(){biovizAPI.hd(this.wh,this.Tf)};function fi(e,f,g){this.target=e;this.matrix=f;this.duration=g?g.get("duration"):0}fi.prototype=Object.create(Jh.prototype);fi.prototype.constructor=fi;
fi.prototype.kb=function(e){var f;if("SCENE"==this.target.type)f=e.scene3D;else if(this.target.type==Lh)f=this.target.gb(e)[0];else if(this.target.type==Nh)f=this.target.Kd(e)[0];else throw"MoveCommand only applies to Scene, Structure and Molecule targets";var g=new THREE.Matrix4;g.set(this.matrix[0],this.matrix[4],this.matrix[8],this.matrix[12],this.matrix[1],this.matrix[5],this.matrix[9],this.matrix[13],this.matrix[2],this.matrix[6],this.matrix[10],this.matrix[14],this.matrix[3],this.matrix[7],
this.matrix[11],this.matrix[15]);void 0!==f&&Fh(e.scene3D,f,g,this.duration)};function gi(e){this.wh=e}gi.prototype=Object.create(Jh.prototype);gi.prototype.constructor=gi;gi.prototype.kb=function(e){var f=e.gb(this.wh);void 0!==f&&void 0!==f[0].remove&&Ee(e,f[0])};function hi(e,f,g){this.target=e;this.Ja=f;this.enable=g}hi.prototype=Object.create(Jh.prototype);hi.prototype.constructor=hi;
hi.prototype.kb=function(e){e=this.target.Kd(e);for(var f in e){var g;e[f].nl?g=tf(e[f]):g=[e[f]];for(var h in g)this.enable?g[h].show(this.Ja):g[h].hide(this.Ja)}};function ii(){}ii.prototype=Object.create(Jh.prototype);ii.prototype.constructor=ii;ii.prototype.kb=function(e){e.scene3D.reset()};function ji(e,f,g){this.sm=e;this.value=f;this.duration=null==g?void 0:g.get("duration")}ji.prototype=Object.create(Jh.prototype);ji.prototype.constructor=ji;
ji.prototype.kb=function(e){switch(this.sm){case "background":var f=new THREE.Color(this.value),g=this.duration;g&&0<g?e.scene3D.Dd(f,g):e.fa.Dd(f);break;case "quality":Ie(e.bc,this.value)}};function ki(e,f){this.target=e;this.show=f}ki.prototype=Object.create(Jh.prototype);ki.prototype.constructor=ki;ki.prototype.kb=function(e){var f="SCENE"==this.target.type?e.scene3D.na:this.target.Kd(e);for(e=0;e<f.length;e++)this.show?f[e].show():f[e].hide()};function Uh(e){this.duration=e}Uh.prototype=Object.create(Jh.prototype);
Uh.prototype.constructor=Uh;Uh.prototype.kb=function(){};
var Sh=function(){function e(f,g,h,k){this.message=f;this.location=k;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}(function(e,g){function h(){this.constructor=e}h.prototype=g.prototype;e.prototype=new h})(e,Error);return{SyntaxError:e,parse:function(f){function g(e){var g=Bf[e],h,k;if(g)return g;for(h=e-1;!Bf[h];)h--;g=Bf[h];for(g={line:g.line,sb:g.sb,ic:g.ic};h<e;)k=f.charAt(h),"\n"===k?(g.ic||g.line++,g.sb=1,g.ic=!1):"\r"===k||"\u2028"===k||
"\u2029"===k?(g.line++,g.sb=1,g.ic=!0):(g.sb++,g.ic=!1),h++;return Bf[e]=g}function h(e,f){var h=g(e),k=g(f);return{start:{offset:e,line:h.line,sb:h.sb},end:{offset:f,line:k.line,sb:k.sb}}}function k(e){p<Za||(p>Za&&(Za=p,Ag=[]),Ag.push(e))}function m(){var e,f,g,h;e=p;f=[];for(g=l();g!==n;)f.push(g),g=l();if(f!==n){g=[];for(f=xa();f!==n;)g.push(f),f=xa();if(g!==n){f=[];for(h=l();h!==n;)f.push(h),h=l();if(f!==n){e=g;g=[];for(var k in e)g.push(e[k]);e=g}else p=e,e=n}else p=e,e=n}else p=e,e=n;if(e===
n)for(e=[],f=l();f!==n;)e.push(f),f=l();return e}function l(){var e;32===f.charCodeAt(p)?(e=da,p++):(e=n,0===E&&k(zb));e===n&&(9===f.charCodeAt(p)?(e=wc,p++):(e=n,0===E&&k(bb)));return e}function q(){var e;La.test(f.charAt(p))?(e=f.charAt(p),p++):(e=n,0===E&&k(Vb));return e}function r(){var e;Kc.test(f.charAt(p))?(e=f.charAt(p),p++):(e=n,0===E&&k(kc));return e}function t(){var e,g,h;e=p;Wb.test(f.charAt(p))?(g=f.charAt(p),p++):(g=n,0===E&&k(Lc));g!==n?(h=G(),h!==n?e=g=[g,h]:(p=e,e=n)):(p=e,e=n);return e}
function w(){var e;32===f.charCodeAt(p)?(e=da,p++):(e=n,0===E&&k(zb));e===n&&(33===f.charCodeAt(p)?(e=lc,p++):(e=n,0===E&&k(Cb)),e===n&&(35===f.charCodeAt(p)?(e=sa,p++):(e=n,0===E&&k(eb)),e===n&&(36===f.charCodeAt(p)?(e=mc,p++):(e=n,0===E&&k(Ma)),e===n&&(37===f.charCodeAt(p)?(e=Wa,p++):(e=n,0===E&&k(fb)),e===n&&(38===f.charCodeAt(p)?(e=ea,p++):(e=n,0===E&&k(qa)),e===n&&(40===f.charCodeAt(p)?(e=ma,p++):(e=n,0===E&&k(Da)),e===n&&(41===f.charCodeAt(p)?(e=Db,p++):(e=n,0===E&&k(tb)),e===n&&(42===f.charCodeAt(p)?
(e=ub,p++):(e=n,0===E&&k(Na)),e===n&&(43===f.charCodeAt(p)?(e=Eb,p++):(e=n,0===E&&k(ta)),e===n&&(44===f.charCodeAt(p)?(e=Sa,p++):(e=n,0===E&&k(na)),e===n&&(45===f.charCodeAt(p)?(e=Xa,p++):(e=n,0===E&&k(va)),e===n&&(46===f.charCodeAt(p)?(e=gb,p++):(e=n,0===E&&k(xc)),e===n&&(47===f.charCodeAt(p)?(e=yc,p++):(e=n,0===E&&k(Xb)),e===n&&(La.test(f.charAt(p))?(e=f.charAt(p),p++):(e=n,0===E&&k(Vb)),e===n&&(58===f.charCodeAt(p)?(e=ya,p++):(e=n,0===E&&k(oa)),e===n&&(59===f.charCodeAt(p)?(e=db,p++):(e=n,0===
E&&k(qb)),e===n&&(60===f.charCodeAt(p)?(e=za,p++):(e=n,0===E&&k(Mc)),e===n&&(61===f.charCodeAt(p)?(e=Ea,p++):(e=n,0===E&&k(Jb)),e===n&&(62===f.charCodeAt(p)?(e=Nc,p++):(e=n,0===E&&k(Oc)),e===n&&(63===f.charCodeAt(p)?(e=Yb,p++):(e=n,0===E&&k(Ta)),e===n&&(64===f.charCodeAt(p)?(e=Oa,p++):(e=n,0===E&&k(nc)),e===n&&(zc.test(f.charAt(p))?(e=f.charAt(p),p++):(e=n,0===E&&k(oc)),e===n&&(91===f.charCodeAt(p)?(e=hb,p++):(e=n,0===E&&k(Kb)),e===n&&(92===f.charCodeAt(p)?(e=Ya,p++):(e=n,0===E&&k(Lb)),e===n&&(93===
f.charCodeAt(p)?(e=pc,p++):(e=n,0===E&&k(Fb)),e===n&&(94===f.charCodeAt(p)?(e=wa,p++):(e=n,0===E&&k(Ua)),e===n&&(95===f.charCodeAt(p)?(e=A,p++):(e=n,0===E&&k(vb)),e===n&&(96===f.charCodeAt(p)?(e=ja,p++):(e=n,0===E&&k(Zb)),e===n&&(L.test(f.charAt(p))?(e=f.charAt(p),p++):(e=n,0===E&&k(Aa)),e===n&&(123===f.charCodeAt(p)?(e=ib,p++):(e=n,0===E&&k(ka)),e===n&&(47===f.charCodeAt(p)?(e=yc,p++):(e=n,0===E&&k(Xb)),e===n&&(125===f.charCodeAt(p)?(e=fa,p++):(e=n,0===E&&k(Vc)),e===n&&(126===f.charCodeAt(p)?(e=
$b,p++):(e=n,0===E&&k(hd)))))))))))))))))))))))))))))))))));return e}function x(){var e;44===f.charCodeAt(p)?(e=Sa,p++):(e=n,0===E&&k(na));return e}function B(){var e,f,g,h,k;e=p;f=[];for(g=l();g!==n;)f.push(g),g=l();if(f!==n)if(g=x(),g!==n){h=[];for(k=l();k!==n;)h.push(k),k=l();h!==n?e=f=[f,g,h]:(p=e,e=n)}else p=e,e=n;else p=e,e=n;return e}function C(){var e,f;e=[];f=q();if(f!==n)for(;f!==n;)e.push(f),f=q();else e=n;e!==n&&(e=parseInt(e.join(""),10));return e}function G(){var e,g,h;e=p;43===f.charCodeAt(p)?
(g=Eb,p++):(g=n,0===E&&k(ta));g===n&&(45===f.charCodeAt(p)?(g=Xa,p++):(g=n,0===E&&k(va)));g===n&&(g=null);g!==n?(h=C(),h!==n?e=g=parseInt(g+h,10):(p=e,e=n)):(p=e,e=n);return e}function I(){var e,g,h,l,m,r,w;e=p;g=G();g!==n?(h=t(),h!==n?e=g=parseFloat(g+h.join("")):(p=e,e=n)):(p=e,e=n);if(e===n)if(e=p,43===f.charCodeAt(p)?(g=Eb,p++):(g=n,0===E&&k(ta)),g===n&&(45===f.charCodeAt(p)?(g=Xa,p++):(g=n,0===E&&k(va))),g===n&&(g=null),g!==n){l=h=p;m=[];for(r=q();r!==n;)m.push(r),r=q();m!==n?(46===f.charCodeAt(p)?
(r=gb,p++):(r=n,0===E&&k(xc)),r!==n?(w=C(),w!==n?l=m=[m,r,w]:(p=l,l=n)):(p=l,l=n)):(p=l,l=n);if(l===n){l=p;m=[];r=q();if(r!==n)for(;r!==n;)m.push(r),r=q();else m=n;m!==n?(46===f.charCodeAt(p)?(r=gb,p++):(r=n,0===E&&k(xc)),r!==n?l=m=[m,r]:(p=l,l=n)):(p=l,l=n)}h=l!==n?f.substring(h,p):l;h!==n?(l=t(),l===n&&(l=null),l!==n?e=g=parseFloat((g?g:"")+(h?h:"")+(l?l.join(""):"")):(p=e,e=n)):(p=e,e=n)}else p=e,e=n;return e}function D(){var e;e=I();e===n&&(e=G());return e}function J(){var e,g,h,m,q,r,t,w,x,y,
A,ib,C,F,G,ka,fa,I,J;e=p;91===f.charCodeAt(p)?(g=hb,p++):(g=n,0===E&&k(Kb));if(g!==n){h=[];for(g=l();g!==n;)h.push(g),g=l();if(h!==n)if(g=D(),g!==n)if(h=B(),h!==n)if(h=D(),h!==n)if(m=B(),m!==n)if(m=D(),m!==n)if(q=B(),q!==n)if(q=D(),q!==n)if(r=B(),r!==n)if(r=D(),r!==n)if(t=B(),t!==n)if(t=D(),t!==n)if(w=B(),w!==n)if(w=D(),w!==n)if(x=B(),x!==n)if(x=D(),x!==n)if(y=B(),y!==n)if(y=D(),y!==n)if(A=B(),A!==n)if(A=D(),A!==n)if(ib=B(),ib!==n)if(ib=D(),ib!==n)if(C=B(),C!==n)if(C=D(),C!==n)if(F=B(),F!==n)if(F=
D(),F!==n)if(G=B(),G!==n)if(G=D(),G!==n)if(ka=B(),ka!==n)if(ka=D(),ka!==n)if(fa=B(),fa!==n)if(fa=D(),fa!==n){I=[];for(J=l();J!==n;)I.push(J),J=l();I!==n?(93===f.charCodeAt(p)?(J=pc,p++):(J=n,0===E&&k(Fb)),J!==n?e=g=[g,h,m,q,r,t,w,x,y,A,ib,C,F,G,ka,fa]:(p=e,e=n)):(p=e,e=n)}else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=
e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n}else p=e,e=n;return e}function F(){var e,g;e=[];li.test(f.charAt(p))?(g=f.charAt(p),p++):(g=n,0===E&&k(mi));if(g!==n)for(;g!==n;)e.push(g),li.test(f.charAt(p))?(g=f.charAt(p),p++):(g=n,0===E&&k(mi));else e=n;e!==n&&(e=e.join(""));return e}function K(){var e,g,h,l;e=p;39===f.charCodeAt(p)?(g=Qa,p++):(g=n,0===E&&k(rb));
if(g!==n){h=[];f.substr(p,2)===Bb?(l=Bb,p+=2):(l=n,0===E&&k(Ra));l===n&&(34===f.charCodeAt(p)?(l=ra,p++):(l=n,0===E&&k(Q)),l===n&&(l=w()));for(;l!==n;)h.push(l),f.substr(p,2)===Bb?(l=Bb,p+=2):(l=n,0===E&&k(Ra)),l===n&&(34===f.charCodeAt(p)?(l=ra,p++):(l=n,0===E&&k(Q)),l===n&&(l=w()));h!==n?(39===f.charCodeAt(p)?(l=Qa,p++):(l=n,0===E&&k(rb)),l!==n?e=g=[g,h,l]:(p=e,e=n)):(p=e,e=n)}else p=e,e=n;if(e===n)if(e=p,34===f.charCodeAt(p)?(g=ra,p++):(g=n,0===E&&k(Q)),g!==n){h=[];f.substr(p,2)===S?(l=S,p+=2):
(l=n,0===E&&k(sb));l===n&&(39===f.charCodeAt(p)?(l=Qa,p++):(l=n,0===E&&k(rb)),l===n&&(l=w()));for(;l!==n;)h.push(l),f.substr(p,2)===S?(l=S,p+=2):(l=n,0===E&&k(sb)),l===n&&(39===f.charCodeAt(p)?(l=Qa,p++):(l=n,0===E&&k(rb)),l===n&&(l=w()));h!==n?(34===f.charCodeAt(p)?(l=ra,p++):(l=n,0===E&&k(Q)),l!==n?e=g=[g,h,l]:(p=e,e=n)):(p=e,e=n)}else p=e,e=n;return e}function N(){var e,g,h,m,q,t;g=p;var w,x,y;e=p;35===f.charCodeAt(p)?(h=sa,p++):(h=n,0===E&&k(eb));h===n&&(f.substr(p,2)===ni?(h=ni,p+=2):(h=n,0===
E&&k(Uj)));h!==n?(m=r(),m!==n?(q=r(),q!==n?(t=r(),t!==n?(w=r(),w!==n?(x=r(),x!==n?(y=r(),y!==n?e=h=[h,m,q,t,w,x,y]:(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n);h=e;e=g=h!==n?f.substring(g,p):h;if(e===n)if(e=p,f.substr(p,4)===oi?(g=oi,p+=4):(g=n,0===E&&k(Vj)),g!==n){h=[];for(g=l();g!==n;)h.push(g),g=l();if(h!==n)if(g=D(),g!==n)if(h=B(),h!==n)if(h=D(),h!==n)if(m=B(),m!==n)if(m=D(),m!==n){q=[];for(t=l();t!==n;)q.push(t),t=l();q!==n?(41===f.charCodeAt(p)?(t=Db,p++):(t=n,
0===E&&k(tb)),t!==n?e=g="#"+("0"+g.toString(16)).slice(-2)+("0"+h.toString(16)).slice(-2)+("0"+m.toString(16)).slice(-2):(p=e,e=n)):(p=e,e=n)}else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n;else p=e,e=n}else p=e,e=n;return e}function O(){var e;e=N();e===n&&(e=F());return e}function U(){var e,g;e=p;var h,l,m,q;g=p;84===f.charCodeAt(p)?(h=ac,p++):(h=n,0===E&&k(Nb));h===n&&(116===f.charCodeAt(p)?(h=rc,p++):(h=n,0===E&&k(Ba)));h!==n?(82===f.charCodeAt(p)?(l=sd,p++):(l=n,0===E&&k(Bg)),
l===n&&(114===f.charCodeAt(p)?(l=td,p++):(l=n,0===E&&k(Ob))),l!==n?(85===f.charCodeAt(p)?(m=Wj,p++):(m=n,0===E&&k(Xj)),m===n&&(117===f.charCodeAt(p)?(m=Yj,p++):(m=n,0===E&&k(Zj))),m!==n?(69===f.charCodeAt(p)?(q=Bc,p++):(q=n,0===E&&k(Qc)),q===n&&(101===f.charCodeAt(p)?(q=sc,p++):(q=n,0===E&&k(tc))),q!==n?g=h=[h,l,m,q]:(p=g,g=n)):(p=g,g=n)):(p=g,g=n)):(p=g,g=n);g===n&&(g=p,79===f.charCodeAt(p)?(h=Pe,p++):(h=n,0===E&&k(Qe)),h===n&&(111===f.charCodeAt(p)?(h=Re,p++):(h=n,0===E&&k(Se))),h!==n?(78===f.charCodeAt(p)?
(l=Cc,p++):(l=n,0===E&&k(Pb)),l===n&&(110===f.charCodeAt(p)?(l=Dc,p++):(l=n,0===E&&k(Qb))),l!==n?g=h=[h,l]:(p=g,g=n)):(p=g,g=n));if(g===n){var r;g=p;70===f.charCodeAt(p)?(h=Cg,p++):(h=n,0===E&&k(Dg));h===n&&(102===f.charCodeAt(p)?(h=Eg,p++):(h=n,0===E&&k(Fg)));h!==n?(65===f.charCodeAt(p)?(l=Te,p++):(l=n,0===E&&k(Ue)),l===n&&(97===f.charCodeAt(p)?(l=Ve,p++):(l=n,0===E&&k(We))),l!==n?(76===f.charCodeAt(p)?(m=Xe,p++):(m=n,0===E&&k(Ye)),m===n&&(108===f.charCodeAt(p)?(m=Ze,p++):(m=n,0===E&&k($e))),m!==
n?(83===f.charCodeAt(p)?(q=Gg,p++):(q=n,0===E&&k(Hg)),q===n&&(115===f.charCodeAt(p)?(q=Ig,p++):(q=n,0===E&&k(Jg))),q!==n?(69===f.charCodeAt(p)?(r=Bc,p++):(r=n,0===E&&k(Qc)),r===n&&(101===f.charCodeAt(p)?(r=sc,p++):(r=n,0===E&&k(tc))),r!==n?g=h=[h,l,m,q,r]:(p=g,g=n)):(p=g,g=n)):(p=g,g=n)):(p=g,g=n)):(p=g,g=n);g===n&&(g=p,79===f.charCodeAt(p)?(h=Pe,p++):(h=n,0===E&&k(Qe)),h===n&&(111===f.charCodeAt(p)?(h=Re,p++):(h=n,0===E&&k(Se))),h!==n?(70===f.charCodeAt(p)?(l=Cg,p++):(l=n,0===E&&k(Dg)),l===n&&(102===
f.charCodeAt(p)?(l=Eg,p++):(l=n,0===E&&k(Fg))),l!==n?(70===f.charCodeAt(p)?(m=Cg,p++):(m=n,0===E&&k(Dg)),m===n&&(102===f.charCodeAt(p)?(m=Eg,p++):(m=n,0===E&&k(Fg))),m!==n?g=h=[h,l,m]:(p=g,g=n)):(p=g,g=n)):(p=g,g=n))}e=g!==n?f.substring(e,p):g;e!==n&&(e="true"===e.toLowerCase()||"on"===e.toLowerCase());return e}function aa(){var e;e=N();if(e===n){var g,h;e=p;g=D();g!==n?(37===f.charCodeAt(p)?(h=Wa,p++):(h=n,0===E&&k(fb)),h!==n?e=g=[g,h]:(p=e,e=n)):(p=e,e=n);e!==n&&(e=e.join(""));e===n&&(e=D(),e===
n&&(e=ca(),e===n&&(e=J(),e===n&&(e=K(),e===n&&(e=U(),e===n&&(e=F()))))))}return e}function pa(){var e,g,h,m;e=p;40===f.charCodeAt(p)?(g=ma,p++):(g=n,0===E&&k(Da));if(g!==n){var q,r;g=p;h=F();if(h!==n){m=[];for(q=l();q!==n;)m.push(q),q=l();if(m!==n)if(61===f.charCodeAt(p)?(q=Ea,p++):(q=n,0===E&&k(Jb)),q!==n){q=[];for(m=l();m!==n;)q.push(m),m=l();if(q!==n)if(m=aa(),m!==n){q=[];for(r=l();r!==n;)q.push(r),r=l();q!==n?g=h=[h,m]:(p=g,g=n)}else p=g,g=n;else p=g,g=n}else p=g,g=n;else p=g,g=n}else p=g,g=n;
h=g;if(h!==n){g=[];for(m=Gb();m!==n;)g.push(m),m=Gb();if(g!==n)if(41===f.charCodeAt(p)?(m=Db,p++):(m=n,0===E&&k(tb)),m!==n){e=new Map;e.set(h[0],h[1]);for(var t in g)h=g[t],e.set(h[0],h[1])}else p=e,e=n;else p=e,e=n}else p=e,e=n}else p=e,e=n;return e}function Gb(){var e,g,h,m,q;e=p;g=[];for(h=l();h!==n;)g.push(h),h=l();if(g!==n)if(h=x(),h!==n){h=[];for(g=l();g!==n;)h.push(g),g=l();if(h!==n)if(g=F(),g!==n){h=[];for(m=l();m!==n;)h.push(m),m=l();if(h!==n)if(61===f.charCodeAt(p)?(m=Ea,p++):(m=n,0===E&&
k(Jb)),m!==n){m=[];for(h=l();h!==n;)m.push(h),h=l();if(m!==n)if(h=aa(),h!==n){m=[];for(q=l();q!==n;)m.push(q),q=l();m!==n?e=g=[g,h]:(p=e,e=n)}else p=e,e=n;else p=e,e=n}else p=e,e=n;else p=e,e=n}else p=e,e=n;else p=e,e=n}else p=e,e=n;else p=e,e=n;return e}function Sb(){var e,g,h,l,m,q,r,t;e=p;80===f.charCodeAt(p)?(g=Kg,p++):(g=n,0===E&&k(Lg));g===n&&(112===f.charCodeAt(p)?(g=Mg,p++):(g=n,0===E&&k(Ng)));g!==n?(69===f.charCodeAt(p)?(h=Bc,p++):(h=n,0===E&&k(Qc)),h===n&&(101===f.charCodeAt(p)?(h=sc,p++):
(h=n,0===E&&k(tc))),h!==n?(80===f.charCodeAt(p)?(l=Kg,p++):(l=n,0===E&&k(Lg)),l===n&&(112===f.charCodeAt(p)?(l=Mg,p++):(l=n,0===E&&k(Ng))),l!==n?(84===f.charCodeAt(p)?(m=ac,p++):(m=n,0===E&&k(Nb)),m===n&&(116===f.charCodeAt(p)?(m=rc,p++):(m=n,0===E&&k(Ba))),m!==n?(73===f.charCodeAt(p)?(q=Cf,p++):(q=n,0===E&&k(Df)),q===n&&(105===f.charCodeAt(p)?(q=Ef,p++):(q=n,0===E&&k(Ff))),q!==n?(68===f.charCodeAt(p)?(r=Og,p++):(r=n,0===E&&k(Pg)),r===n&&(100===f.charCodeAt(p)?(r=Qg,p++):(r=n,0===E&&k(Rg))),r!==n?
(69===f.charCodeAt(p)?(t=Bc,p++):(t=n,0===E&&k(Qc)),t===n&&(101===f.charCodeAt(p)?(t=sc,p++):(t=n,0===E&&k(tc))),t!==n?e=g=[g,h,l,m,q,r,t]:(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n);return e}function ga(){var e,g,h,m,q,r,t,w;e=p;80===f.charCodeAt(p)?(g=Kg,p++):(g=n,0===E&&k(Lg));g===n&&(112===f.charCodeAt(p)?(g=Mg,p++):(g=n,0===E&&k(Ng)));g!==n?(82===f.charCodeAt(p)?(h=sd,p++):(h=n,0===E&&k(Bg)),h===n&&(114===f.charCodeAt(p)?(h=td,p++):(h=n,0===E&&k(Ob))),h!==n?(79===
f.charCodeAt(p)?(m=Pe,p++):(m=n,0===E&&k(Qe)),m===n&&(111===f.charCodeAt(p)?(m=Re,p++):(m=n,0===E&&k(Se))),m!==n?(84===f.charCodeAt(p)?(q=ac,p++):(q=n,0===E&&k(Nb)),q===n&&(116===f.charCodeAt(p)?(q=rc,p++):(q=n,0===E&&k(Ba))),q!==n?(69===f.charCodeAt(p)?(r=Bc,p++):(r=n,0===E&&k(Qc)),r===n&&(101===f.charCodeAt(p)?(r=sc,p++):(r=n,0===E&&k(tc))),r!==n?(73===f.charCodeAt(p)?(t=Cf,p++):(t=n,0===E&&k(Df)),t===n&&(105===f.charCodeAt(p)?(t=Ef,p++):(t=n,0===E&&k(Ff))),t!==n?(78===f.charCodeAt(p)?(w=Cc,p++):
(w=n,0===E&&k(Pb)),w===n&&(110===f.charCodeAt(p)?(w=Dc,p++):(w=n,0===E&&k(Qb))),w!==n?e=g=[g,h,m,q,r,t,w]:(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n);e===n&&(e=Sb(),e===n&&(e=p,83===f.charCodeAt(p)?(g=Gg,p++):(g=n,0===E&&k(Hg)),g===n&&(115===f.charCodeAt(p)?(g=Ig,p++):(g=n,0===E&&k(Jg))),g!==n?(77===f.charCodeAt(p)?(h=ak,p++):(h=n,0===E&&k(bk)),h===n&&(109===f.charCodeAt(p)?(h=ck,p++):(h=n,0===E&&k(dk))),h!==n?(65===f.charCodeAt(p)?(m=Te,p++):(m=n,0===E&&k(Ue)),m===
n&&(97===f.charCodeAt(p)?(m=Ve,p++):(m=n,0===E&&k(We))),m!==n?(76===f.charCodeAt(p)?(q=Xe,p++):(q=n,0===E&&k(Ye)),q===n&&(108===f.charCodeAt(p)?(q=Ze,p++):(q=n,0===E&&k($e))),q!==n?(76===f.charCodeAt(p)?(r=Xe,p++):(r=n,0===E&&k(Ye)),r===n&&(108===f.charCodeAt(p)?(r=Ze,p++):(r=n,0===E&&k($e))),r!==n?(t=l(),t!==n?(w=Sb(),w!==n?e=g=[g,h,m,q,r,t,w]:(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n),e===n&&(e=p,82===f.charCodeAt(p)?(g=sd,p++):(g=n,0===E&&k(Bg)),g===n&&(114===f.charCodeAt(p)?
(g=td,p++):(g=n,0===E&&k(Ob))),g!==n?(78===f.charCodeAt(p)?(h=Cc,p++):(h=n,0===E&&k(Pb)),h===n&&(110===f.charCodeAt(p)?(h=Dc,p++):(h=n,0===E&&k(Qb))),h!==n?(65===f.charCodeAt(p)?(m=Te,p++):(m=n,0===E&&k(Ue)),m===n&&(97===f.charCodeAt(p)?(m=Ve,p++):(m=n,0===E&&k(We))),m!==n?e=g=[g,h,m]:(p=e,e=n)):(p=e,e=n)):(p=e,e=n),e===n&&(e=p,68===f.charCodeAt(p)?(g=Og,p++):(g=n,0===E&&k(Pg)),g===n&&(100===f.charCodeAt(p)?(g=Qg,p++):(g=n,0===E&&k(Rg))),g!==n?(78===f.charCodeAt(p)?(h=Cc,p++):(h=n,0===E&&k(Pb)),h===
n&&(110===f.charCodeAt(p)?(h=Dc,p++):(h=n,0===E&&k(Qb))),h!==n?(65===f.charCodeAt(p)?(m=Te,p++):(m=n,0===E&&k(Ue)),m===n&&(97===f.charCodeAt(p)?(m=Ve,p++):(m=n,0===E&&k(We))),m!==n?e=g=[g,h,m]:(p=e,e=n)):(p=e,e=n)):(p=e,e=n),e===n&&(e=p,76===f.charCodeAt(p)?(g=Xe,p++):(g=n,0===E&&k(Ye)),g===n&&(108===f.charCodeAt(p)?(g=Ze,p++):(g=n,0===E&&k($e))),g!==n?(73===f.charCodeAt(p)?(h=Cf,p++):(h=n,0===E&&k(Df)),h===n&&(105===f.charCodeAt(p)?(h=Ef,p++):(h=n,0===E&&k(Ff))),h!==n?(71===f.charCodeAt(p)?(m=ek,
p++):(m=n,0===E&&k(fk)),m===n&&(103===f.charCodeAt(p)?(m=gk,p++):(m=n,0===E&&k(hk))),m!==n?(65===f.charCodeAt(p)?(q=Te,p++):(q=n,0===E&&k(Ue)),q===n&&(97===f.charCodeAt(p)?(q=Ve,p++):(q=n,0===E&&k(We))),q!==n?(78===f.charCodeAt(p)?(r=Cc,p++):(r=n,0===E&&k(Pb)),r===n&&(110===f.charCodeAt(p)?(r=Dc,p++):(r=n,0===E&&k(Qb))),r!==n?(68===f.charCodeAt(p)?(t=Og,p++):(t=n,0===E&&k(Pg)),t===n&&(100===f.charCodeAt(p)?(t=Qg,p++):(t=n,0===E&&k(Rg))),t!==n?e=g=[g,h,m,q,r,t]:(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=
e,e=n)):(p=e,e=n)):(p=e,e=n),e===n&&(e=p,73===f.charCodeAt(p)?(g=Cf,p++):(g=n,0===E&&k(Df)),g===n&&(105===f.charCodeAt(p)?(g=Ef,p++):(g=n,0===E&&k(Ff))),g!==n?(79===f.charCodeAt(p)?(h=Pe,p++):(h=n,0===E&&k(Qe)),h===n&&(111===f.charCodeAt(p)?(h=Re,p++):(h=n,0===E&&k(Se))),h!==n?(78===f.charCodeAt(p)?(m=Cc,p++):(m=n,0===E&&k(Pb)),m===n&&(110===f.charCodeAt(p)?(m=Dc,p++):(m=n,0===E&&k(Qb))),m!==n?e=g=[g,h,m]:(p=e,e=n)):(p=e,e=n)):(p=e,e=n),e===n&&(e=p,83===f.charCodeAt(p)?(g=Gg,p++):(g=n,0===E&&k(Hg)),
g===n&&(115===f.charCodeAt(p)?(g=Ig,p++):(g=n,0===E&&k(Jg))),g!==n?(79===f.charCodeAt(p)?(h=Pe,p++):(h=n,0===E&&k(Qe)),h===n&&(111===f.charCodeAt(p)?(h=Re,p++):(h=n,0===E&&k(Se))),h!==n?(76===f.charCodeAt(p)?(m=Xe,p++):(m=n,0===E&&k(Ye)),m===n&&(108===f.charCodeAt(p)?(m=Ze,p++):(m=n,0===E&&k($e))),m!==n?(86===f.charCodeAt(p)?(q=ik,p++):(q=n,0===E&&k(jk)),q===n&&(118===f.charCodeAt(p)?(q=kk,p++):(q=n,0===E&&k(lk))),q!==n?(69===f.charCodeAt(p)?(r=Bc,p++):(r=n,0===E&&k(Qc)),r===n&&(101===f.charCodeAt(p)?
(r=sc,p++):(r=n,0===E&&k(tc))),r!==n?(78===f.charCodeAt(p)?(t=Cc,p++):(t=n,0===E&&k(Pb)),t===n&&(110===f.charCodeAt(p)?(t=Dc,p++):(t=n,0===E&&k(Qb))),t!==n?(84===f.charCodeAt(p)?(w=ac,p++):(w=n,0===E&&k(Nb)),w===n&&(116===f.charCodeAt(p)?(w=rc,p++):(w=n,0===E&&k(Ba))),w!==n?e=g=[g,h,m,q,r,t,w]:(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n))))))));e!==n&&(e=e.join(""));return e}function ca(){var e;f.substr(p,5)===pi?(e=pi,p+=5):(e=n,0===E&&k(mk));e!==n&&(e=new Qh,e.type=
"SCENE");if(e===n){var g,h;e=p;f.substr(p,9)===qi?(g=qi,p+=9):(g=n,0===E&&k(nk));if(g!==n){h=[];for(g=l();g!==n;)h.push(g),g=l();h!==n?(g=F(),g!==n?(e=new Qh,e.type=Lh,e.dc=g.toUpperCase()):(p=e,e=n)):(p=e,e=n)}else p=e,e=n;if(e===n){e=p;f.substr(p,7)===ri?(g=ri,p+=7):(g=n,0===E&&k(ok));if(g!==n){h=[];for(g=l();g!==n;)h.push(g),g=l();h!==n?(g=F(),g!==n?(58===f.charCodeAt(p)?(h=ya,p++):(h=n,0===E&&k(oa)),h!==n?(h=ga(),h!==n?(e=new Qh,e.type=Mh,e.Ec=h.toUpperCase(),e.dc=g.toUpperCase()):(p=e,e=n)):
(p=e,e=n)):(p=e,e=n)):(p=e,e=n)}else p=e,e=n;if(e===n){var m;e=p;f.substr(p,8)===si?(g=si,p+=8):(g=n,0===E&&k(pk));if(g!==n){h=[];for(g=l();g!==n;)h.push(g),g=l();h!==n?(g=F(),g!==n?(58===f.charCodeAt(p)?(h=ya,p++):(h=n,0===E&&k(oa)),h!==n?(h=ga(),h!==n?(58===f.charCodeAt(p)?(m=ya,p++):(m=n,0===E&&k(oa)),m!==n?(m=F(),m!==n?(e=new Qh,e.type=Nh,e.dc=g.toUpperCase(),e.Ec=h.toUpperCase(),e.jd=m):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)}else p=e,e=n;if(e===n){var q,r,t,w;e=p;f.substr(p,
7)===ti?(g=ti,p+=7):(g=n,0===E&&k(qk));if(g!==n){h=[];for(g=l();g!==n;)h.push(g),g=l();h!==n?(g=F(),g!==n?(58===f.charCodeAt(p)?(h=ya,p++):(h=n,0===E&&k(oa)),h!==n?(h=ga(),h!==n?(58===f.charCodeAt(p)?(m=ya,p++):(m=n,0===E&&k(oa)),m!==n?(m=F(),m!==n?(58===f.charCodeAt(p)?(q=ya,p++):(q=n,0===E&&k(oa)),q!==n?(q=r=p,t=F(),t!==n?(58===f.charCodeAt(p)?(w=ya,p++):(w=n,0===E&&k(oa)),w!==n?q=t=[t,w]:(p=q,q=n)):(p=q,q=n),q===n&&(q=null),r=q!==n?f.substring(r,p):q,r!==n?(q=p,t=G(),q=t!==n?f.substring(q,p):t,
q!==n?(e=new Qh,e.type=Oh,e.dc=g.toUpperCase(),e.Ec=h.toUpperCase(),e.jd=m,e.zb=parseInt(q)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)}else p=e,e=n;if(e===n)if(e=p,f.substr(p,4)===ui?(g=ui,p+=4):(g=n,0===E&&k(rk)),g!==n){h=[];for(g=l();g!==n;)h.push(g),g=l();h!==n?(g=F(),g!==n?(58===f.charCodeAt(p)?(h=ya,p++):(h=n,0===E&&k(oa)),h!==n?(h=ga(),h!==n?(58===f.charCodeAt(p)?(m=ya,p++):(m=n,0===E&&k(oa)),m!==n?(m=F(),m!==n?(58===f.charCodeAt(p)?(q=
ya,p++):(q=n,0===E&&k(oa)),q!==n?(q=r=p,t=F(),t!==n?(58===f.charCodeAt(p)?(w=ya,p++):(w=n,0===E&&k(oa)),w!==n?q=t=[t,w]:(p=q,q=n)):(p=q,q=n),q===n&&(q=null),r=q!==n?f.substring(r,p):q,r!==n?(q=p,t=G(),q=t!==n?f.substring(q,p):t,q!==n?(e=new Qh,e.type=Ph,e.dc=g.toUpperCase(),e.Ec=h.toUpperCase(),e.jd=m,e.eh=parseInt(q)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)):(p=e,e=n)}else p=e,e=n}}}}return e}function xa(){var e,g,h,m,q;e=p;g=[];for(h=l();h!==n;)g.push(h),
h=l();if(g!==n){var r,t,w,x,y,A;r=p;f.substr(p,4)===vi?(t=vi,p+=4):(t=n,0===E&&k(sk));if(t!==n){w=[];for(x=l();x!==n;)w.push(x),x=l();if(w!==n)if(x=F(),x!==n){y=[];for(A=l();A!==n;)y.push(A),A=l();if(y!==n){var B,ib,D,G;B=p;f.substr(p,2)===wi?(ib=wi,p+=2):(ib=n,0===E&&k(tk));if(ib!==n){D=[];for(G=l();G!==n;)D.push(G),G=l();D!==n?(G=F(),G!==n?B=ib=G:(p=B,B=n)):(p=B,B=n)}else p=B,B=n;A=B;A===n&&(A=null);A!==n?r=t=new ei(x.toUpperCase(),A):(p=r,r=n)}else p=r,r=n}else p=r,r=n;else p=r,r=n}else p=r,r=
n;h=r;if(h===n){var ka,fa,Vc,$b,hd,L,ac;ka=p;f.substr(p,7)===xi?(fa=xi,p+=7):(fa=n,0===E&&k(uk));if(fa!==n){Vc=[];for($b=l();$b!==n;)Vc.push($b),$b=l();if(Vc!==n)if($b=pa(),$b===n&&($b=null),$b!==n){hd=[];for(L=l();L!==n;)hd.push(L),L=l();if(hd!==n)if(L=p,ac=K(),L=ac!==n?f.substring(L,p):ac,L!==n){var Q=L,Q=Q.substring(0).substring(Q.length-1,1);ka=fa=new ci(Q,$b)}else p=ka,ka=n;else p=ka,ka=n}else p=ka,ka=n;else p=ka,ka=n}else p=ka,ka=n;h=ka;if(h===n){var Nb,S,Y,rc;Nb=p;f.substr(p,6)===yi?(S=yi,
p+=6):(S=n,0===E&&k(vk));if(S!==n){Y=[];for(rc=l();rc!==n;)Y.push(rc),rc=l();Y!==n?(rc=F(),rc!==n?Nb=S=new gi(rc.toUpperCase()):(p=Nb,Nb=n)):(p=Nb,Nb=n)}else p=Nb,Nb=n;h=Nb;if(h===n){var Ba,aa,sd,ea,ma,da,qa,ga;Ba=p;f.substr(p,3)===zi?(aa=zi,p+=3):(aa=n,0===E&&k(wk));if(aa!==n){sd=[];for(ea=l();ea!==n;)sd.push(ea),ea=l();if(sd!==n)if(ea=F(),ea!==n){ma=[];for(da=l();da!==n;)ma.push(da),da=l();if(ma!==n)if(da=pa(),da===n&&(da=null),da!==n){qa=[];for(ga=l();ga!==n;)qa.push(ga),ga=l();if(qa!==n)if(ga=
N(),ga===n&&(ga=F()),ga!==n){var oa=ea,wa=da,ra=ga;"background"===oa?aa=new ji(oa,ra,wa):"quality"===oa?(ra=ra.toUpperCase(),aa=new ji(oa,ra,wa)):aa=new ji(oa,ra);Ba=aa}else p=Ba,Ba=n;else p=Ba,Ba=n}else p=Ba,Ba=n;else p=Ba,Ba=n}else p=Ba,Ba=n;else p=Ba,Ba=n}else p=Ba,Ba=n;h=Ba;if(h===n){var ja,na,ya,ta;ja=p;f.substr(p,4)===Ai?(na=Ai,p+=4):(na=n,0===E&&k(xk));na===n&&(f.substr(p,4)===Bi?(na=Bi,p+=4):(na=n,0===E&&k(yk)));if(na!==n){ya=[];for(ta=l();ta!==n;)ya.push(ta),ta=l();ya!==n?(ta=ca(),ta!==n?
ja=na=new ki(ta,"show"===na):(p=ja,ja=n)):(p=ja,ja=n)}else p=ja,ja=n;h=ja;if(h===n){var kb,Na,Sa,xa,Xa,za,Ya,Aa;kb=p;f.substr(p,4)===Ci?(Na=Ci,p+=4):(Na=n,0===E&&k(zk));if(Na!==n){Sa=[];for(xa=l();xa!==n;)Sa.push(xa),xa=l();if(Sa!==n)if(xa=ca(),xa!==n){Xa=[];for(za=l();za!==n;)Xa.push(za),za=l();if(Xa!==n)if(za=F(),za!==n){Ya=[];for(Aa=l();Aa!==n;)Ya.push(Aa),Aa=l();Ya!==n?(Aa=U(),Aa!==n?kb=Na=new hi(xa,P.hg(za.toUpperCase()),Aa):(p=kb,kb=n)):(p=kb,kb=n)}else p=kb,kb=n;else p=kb,kb=n}else p=kb,kb=
n;else p=kb,kb=n}else p=kb,kb=n;h=kb;if(h===n){var Ga,Wa,fb,va,gb,Ea,hb,Ob,bc,sa,Ra,Ma,bb,Qa;Ga=p;f.substr(p,5)===Di?(Wa=Di,p+=5):(Wa=n,0===E&&k(Ak));if(Wa!==n){fb=[];for(va=l();va!==n;)fb.push(va),va=l();if(fb!==n)if(va=pa(),va===n&&(va=null),va!==n){gb=[];for(Ea=l();Ea!==n;)gb.push(Ea),Ea=l();if(gb!==n)if(Ea=ca(),Ea!==n){hb=[];for(Ob=l();Ob!==n;)hb.push(Ob),Ob=l();if(hb!==n){bc=Ob=p;sa=F();if(sa!==n){Ra=p;E++;Ma=p;bb=[];for(Qa=l();Qa!==n;)bb.push(Qa),Qa=l();bb!==n?(Qa=O(),Qa!==n?Ma=bb=[bb,Qa]:(p=
Ma,Ma=n)):(p=Ma,Ma=n);E--;Ma!==n?(p=Ra,Ra=void 0):Ra=n;Ra!==n?bc=sa=[sa,Ra]:(p=bc,bc=n)}else p=bc,bc=n;bc===n&&(bc=null);Ob=bc!==n?f.substring(Ob,p):bc;if(Ob!==n){bc=[];for(sa=l();sa!==n;)bc.push(sa),sa=l();bc!==n?(sa=O(),sa!==n?Ga=Wa=new bi(Ea,sa,P.hg((Ob?Ob.toUpperCase():"").toUpperCase()),va):(p=Ga,Ga=n)):(p=Ga,Ga=n)}else p=Ga,Ga=n}else p=Ga,Ga=n}else p=Ga,Ga=n;else p=Ga,Ga=n}else p=Ga,Ga=n;else p=Ga,Ga=n}else p=Ga,Ga=n;h=Ga;if(h===n){var lb,rb,Bb,Da,Db,Ua,Gb,La;lb=p;f.substr(p,4)===Ei?(rb=Ei,
p+=4):(rb=n,0===E&&k(Bk));if(rb!==n){Bb=[];for(Da=l();Da!==n;)Bb.push(Da),Da=l();if(Bb!==n)if(Da=pa(),Da===n&&(Da=null),Da!==n){Db=[];for(Ua=l();Ua!==n;)Db.push(Ua),Ua=l();if(Db!==n)if(Ua=ca(),Ua!==n){Gb=[];for(La=l();La!==n;)Gb.push(La),La=l();if(Gb!==n){La=J();if(La===n){var tb;f.substr(p,6)===Fi?(tb=Fi,p+=6):(tb=n,0===E&&k(Ck));tb!==n&&(tb=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);La=tb}La!==n?lb=rb=new fi(Ua,La,Da):(p=lb,lb=n)}else p=lb,lb=n}else p=lb,lb=n;else p=lb,lb=n}else p=lb,lb=n;else p=lb,lb=
n}else p=lb,lb=n;h=lb;if(h===n){var mb,Eb,Jb,Oa,Lb,Za,Sb,eb;mb=p;f.substr(p,5)===Gi?(Eb=Gi,p+=5):(Eb=n,0===E&&k(Dk));if(Eb!==n){Jb=[];for(Oa=l();Oa!==n;)Jb.push(Oa),Oa=l();if(Jb!==n)if(Oa=pa(),Oa===n&&(Oa=null),Oa!==n){Lb=[];for(Za=l();Za!==n;)Lb.push(Za),Za=l();if(Lb!==n)if(Za=ca(),Za!==n){Sb=[];for(eb=l();eb!==n;)Sb.push(eb),eb=l();Sb!==n?(eb=ca(),eb!==n?mb=Eb=new Xh(Za,eb,Oa):(p=mb,mb=n)):(p=mb,mb=n)}else p=mb,mb=n;else p=mb,mb=n}else p=mb,mb=n;else p=mb,mb=n}else p=mb,mb=n;h=mb;if(h===n){var Ta,
Kb,Zb,sb;Ta=p;f.substr(p,4)===Hi?(Kb=Hi,p+=4):(Kb=n,0===E&&k(Ek));if(Kb!==n){Zb=[];for(sb=l();sb!==n;)Zb.push(sb),sb=l();Zb!==n?(sb=C(),sb!==n?Ta=Kb=new Uh(sb):(p=Ta,Ta=n)):(p=Ta,Ta=n)}else p=Ta,Ta=n;h=Ta;if(h===n){var cc,Vb,kc,Wc,lc,ub;cc=p;f.substr(p,4)===Ii?(Vb=Ii,p+=4):(Vb=n,0===E&&k(Fk));if(Vb!==n){kc=[];for(Wc=l();Wc!==n;)kc.push(Wc),Wc=l();if(kc!==n)if(Wc=pa(),Wc===n&&(Wc=null),Wc!==n){lc=[];for(ub=l();ub!==n;)lc.push(ub),ub=l();lc!==n?(ub=ca(),ub!==n?cc=Vb=new $h(ub,Wc,!0):(p=cc,cc=n)):(p=
cc,cc=n)}else p=cc,cc=n;else p=cc,cc=n}else p=cc,cc=n;h=cc;if(h===n){var nb,Xb,pc,vb,td,Rc,dc,Ec,Ib,zb,Wb,Cb;nb=p;f.substr(p,9)===Ji?(Xb=Ji,p+=9):(Xb=n,0===E&&k(Gk));if(Xb!==n){pc=[];for(vb=l();vb!==n;)pc.push(vb),vb=l();if(pc!==n)if(vb=ca(),vb!==n){td=[];for(Rc=l();Rc!==n;)td.push(Rc),Rc=l();if(td!==n){dc=Rc=p;Ec=F();if(Ec!==n){Ib=p;E++;zb=p;Wb=[];for(Cb=l();Cb!==n;)Wb.push(Cb),Cb=l();Wb!==n?(Cb=U(),Cb!==n?zb=Wb=[Wb,Cb]:(p=zb,zb=n)):(p=zb,zb=n);E--;zb!==n?(p=Ib,Ib=void 0):Ib=n;Ib!==n?dc=Ec=[Ec,Ib]:
(p=dc,dc=n)}else p=dc,dc=n;dc===n&&(dc=null);Rc=dc!==n?f.substring(Rc,p):dc;if(Rc!==n){dc=[];for(Ec=l();Ec!==n;)dc.push(Ec),Ec=l();dc!==n?(Ec=U(),Ec!==n?nb=Xb=new di(vb,P.hg((Rc?Rc.toUpperCase():"").toUpperCase()),Ec):(p=nb,nb=n)):(p=nb,nb=n)}else p=nb,nb=n}else p=nb,nb=n}else p=nb,nb=n;else p=nb,nb=n}else p=nb,nb=n;h=nb;if(h===n){var Ha,mc,xc,Xc,zc,Fb,Cc,Pb,Dc,Qb;Ha=p;f.substr(p,4)===Ki?(mc=Ki,p+=4):(mc=n,0===E&&k(Hk));if(mc!==n){xc=[];for(Xc=l();Xc!==n;)xc.push(Xc),Xc=l();if(xc!==n)if(Xc=pa(),Xc===
n&&(Xc=null),Xc!==n){zc=[];for(Fb=l();Fb!==n;)zc.push(Fb),Fb=l();if(zc!==n)if(Fb=ca(),Fb!==n){Cc=[];for(Pb=l();Pb!==n;)Cc.push(Pb),Pb=l();if(Cc!==n)if(Pb=I(),Pb!==n){Dc=[];for(Qb=l();Qb!==n;)Dc.push(Qb),Qb=l();Dc!==n?(Qb=I(),Qb!==n?Ha=mc=new ai(Fb,0,0,Xc):(p=Ha,Ha=n)):(p=Ha,Ha=n)}else p=Ha,Ha=n;else p=Ha,Ha=n}else p=Ha,Ha=n;else p=Ha,Ha=n}else p=Ha,Ha=n;else p=Ha,Ha=n}else p=Ha,Ha=n;h=Ha;if(h===n&&(h=Hb(),h===n)){var ec,wc,Kc,Yc,Lc,ud;ec=p;f.substr(p,6)===Li?(wc=Li,p+=6):(wc=n,0===E&&k(Ik));if(wc!==
n){Kc=[];for(Yc=l();Yc!==n;)Kc.push(Yc),Yc=l();if(Kc!==n)if(Yc=pa(),Yc===n&&(Yc=null),Yc!==n){Lc=[];for(ud=l();ud!==n;)Lc.push(ud),ud=l();Lc!==n?(ud=ca(),ud!==n?ec=wc=new $h(ud,Yc,!1):(p=ec,ec=n)):(p=ec,ec=n)}else p=ec,ec=n;else p=ec,ec=n}else p=ec,ec=n;h=ec;if(h===n){var Ia,yc,Mc,Zc,Nc,vd,Oc,Sc,fc,Fc,Yb,wd,nc,xd;Ia=p;f.substr(p,7)===Mi?(yc=Mi,p+=7):(yc=n,0===E&&k(Jk));if(yc!==n){Mc=[];for(Zc=l();Zc!==n;)Mc.push(Zc),Zc=l();if(Mc!==n)if(Zc=pa(),Zc===n&&(Zc=null),Zc!==n){Nc=[];for(vd=l();vd!==n;)Nc.push(vd),
vd=l();if(Nc!==n)if(vd=ca(),vd!==n){Oc=[];for(Sc=l();Sc!==n;)Oc.push(Sc),Sc=l();if(Oc!==n){fc=Sc=p;Fc=F();if(Fc!==n){Yb=p;E++;wd=p;nc=[];for(xd=l();xd!==n;)nc.push(xd),xd=l();nc!==n?(xd=I(),xd!==n?wd=nc=[nc,xd]:(p=wd,wd=n)):(p=wd,wd=n);E--;wd!==n?(p=Yb,Yb=void 0):Yb=n;Yb!==n?fc=Fc=[Fc,Yb]:(p=fc,fc=n)}else p=fc,fc=n;fc===n&&(fc=null);Sc=fc!==n?f.substring(Sc,p):fc;if(Sc!==n){fc=[];for(Fc=l();Fc!==n;)fc.push(Fc),Fc=l();fc!==n?(Fc=I(),Fc!==n?Ia=yc=new Zh(vd,Fc,Zc,P.hg((Sc?Sc.toUpperCase():"").toUpperCase())):
(p=Ia,Ia=n)):(p=Ia,Ia=n)}else p=Ia,Ia=n}else p=Ia,Ia=n}else p=Ia,Ia=n;else p=Ia,Ia=n}else p=Ia,Ia=n;else p=Ia,Ia=n}else p=Ia,Ia=n;h=Ia;if(h===n){var oc;f.substr(p,5)===Ni?(oc=Ni,p+=5):(oc=n,0===E&&k(Kk));oc!==n&&(oc=new ii);h=oc;if(h===n&&(h=Hb(),h===n)){var $c,Bc,Qc,yd;$c=p;f.substr(p,6)===Oi?(Bc=Oi,p+=6):(Bc=n,0===E&&k(Lk));if(Bc!==n){Qc=[];for(yd=l();yd!==n;)Qc.push(yd),yd=l();Qc!==n?(yd=ca(),yd!==n?$c=Bc=yd:(p=$c,$c=n)):(p=$c,$c=n)}else p=$c,$c=n;h=$c}}}}}}}}}}}}}}}}if(h!==n){m=[];for(q=l();q!==
n;)m.push(q),q=l();if(m!==n){var zd,sc,tc;zd=p;59===f.charCodeAt(p)?(sc=db,p++):(sc=n,0===E&&k(qb));if(sc!==n){var ad;10===f.charCodeAt(p)?(ad=ua,p++):(ad=n,0===E&&k(Ab));ad===n&&(13===f.charCodeAt(p)?(ad=gd,p++):(ad=n,0===E&&k(Ub)),ad===n&&(f.substr(p,2)===cb?(ad=cb,p+=2):(ad=n,0===E&&k(pb))));tc=ad;tc===n&&(tc=null);tc!==n?zd=sc=[sc,tc]:(p=zd,zd=n)}else p=zd,zd=n;q=zd;q!==n?e=g=h:(p=e,e=n)}else p=e,e=n}else p=e,e=n}else p=e,e=n;return e}function Hb(){var e,g,h;e=p;f.substr(p,6)===Gf?(g=Gf,p+=6):
(g=n,0===E&&k(Pi));if(g!==n){g=[];for(h=l();h!==n;)g.push(h),h=l();g!==n?e=null:(p=e,e=n)}else p=e,e=n;return e}function Hb(){var e;f.substr(p,6)===Gf?(e=Gf,p+=6):(e=n,0===E&&k(Pi));e!==n&&(e=!1);return e}var Y=1<arguments.length?arguments[1]:{},n={},y={start:m},Ib=m,da=" ",zb={type:"literal",value:" ",description:'" "'},wc="\t",bb={type:"literal",value:"\t",description:'"\\t"'},ua="\n",Ab={type:"literal",value:"\n",description:'"\\n"'},gd="\r",Ub={type:"literal",value:"\r",description:'"\\r"'},cb=
"\r\n",pb={type:"literal",value:"\r\n",description:'"\\r\\n"'},db=";",qb={type:"literal",value:";",description:'";"'},sa="#",eb={type:"literal",value:"#",description:'"#"'},Qa="'",rb={type:"literal",value:"'",description:'"\'"'},Bb="\\'",Ra={type:"literal",value:"\\'",description:'"\\\\\'"'},ra='"',Q={type:"literal",value:'"',description:'"\\""'},S='\\"',sb={type:"literal",value:'\\"',description:'"\\\\\\""'},La=/^[0-9]/,Vb={type:"class",value:"[0-9]",description:"[0-9]"},Kc=/^[0-9, A-F, a-f]/,kc=
{type:"class",value:"[0-9, A-F, a-f]",description:"[0-9, A-F, a-f]"},Wb=/^["e" \/ "E"]/,Lc={type:"class",value:'["e" / "E"]',description:'["e" / "E"]'},lc="!",Cb={type:"literal",value:"!",description:'"!"'},mc="$",Ma={type:"literal",value:"$",description:'"$"'},Wa="%",fb={type:"literal",value:"%",description:'"%"'},ea="&",qa={type:"literal",value:"&",description:'"&"'},ma="(",Da={type:"literal",value:"(",description:'"("'},Db=")",tb={type:"literal",value:")",description:'")"'},ub="*",Na={type:"literal",
value:"*",description:'"*"'},Eb="+",ta={type:"literal",value:"+",description:'"+"'},Sa=",",na={type:"literal",value:",",description:'","'},Xa="-",va={type:"literal",value:"-",description:'"-"'},gb=".",xc={type:"literal",value:".",description:'"."'},yc="/",Xb={type:"literal",value:"/",description:'"/"'},ya=":",oa={type:"literal",value:":",description:'":"'},za="<",Mc={type:"literal",value:"<",description:'"<"'},Ea="=",Jb={type:"literal",value:"=",description:'"="'},Nc=">",Oc={type:"literal",value:">",
description:'">"'},Yb="?",Ta={type:"literal",value:"?",description:'"?"'},Oa="@",nc={type:"literal",value:"@",description:'"@"'},zc=/^[A-Z]/,oc={type:"class",value:"[A-Z]",description:"[A-Z]"},hb="[",Kb={type:"literal",value:"[",description:'"["'},Ya="\\",Lb={type:"literal",value:"\\",description:'"\\\\"'},pc="]",Fb={type:"literal",value:"]",description:'"]"'},wa="^",Ua={type:"literal",value:"^",description:'"^"'},A="_",vb={type:"literal",value:"_",description:'"_"'},ja="`",Zb={type:"literal",value:"`",
description:'"`"'},L=/^[a-z]/,Aa={type:"class",value:"[a-z]",description:"[a-z]"},ib="{",ka={type:"literal",value:"{",description:'"{"'},fa="}",Vc={type:"literal",value:"}",description:'"}"'},$b="~",hd={type:"literal",value:"~",description:'"~"'},ac="T",Nb={type:"literal",value:"T",description:'"T"'},rc="t",Ba={type:"literal",value:"t",description:'"t"'},sd="R",Bg={type:"literal",value:"R",description:'"R"'},td="r",Ob={type:"literal",value:"r",description:'"r"'},Wj="U",Xj={type:"literal",value:"U",
description:'"U"'},Yj="u",Zj={type:"literal",value:"u",description:'"u"'},Bc="E",Qc={type:"literal",value:"E",description:'"E"'},sc="e",tc={type:"literal",value:"e",description:'"e"'},Pe="O",Qe={type:"literal",value:"O",description:'"O"'},Re="o",Se={type:"literal",value:"o",description:'"o"'},Cc="N",Pb={type:"literal",value:"N",description:'"N"'},Dc="n",Qb={type:"literal",value:"n",description:'"n"'},Cg="F",Dg={type:"literal",value:"F",description:'"F"'},Eg="f",Fg={type:"literal",value:"f",description:'"f"'},
Te="A",Ue={type:"literal",value:"A",description:'"A"'},Ve="a",We={type:"literal",value:"a",description:'"a"'},Xe="L",Ye={type:"literal",value:"L",description:'"L"'},Ze="l",$e={type:"literal",value:"l",description:'"l"'},Gg="S",Hg={type:"literal",value:"S",description:'"S"'},Ig="s",Jg={type:"literal",value:"s",description:'"s"'},oi="rgb(",Vj={type:"literal",value:"rgb(",description:'"rgb("'},Fi="origin",Ck={type:"literal",value:"origin",description:'"origin"'},li=/^[0-9a-zA-Z_]/,mi={type:"class",value:"[0-9a-zA-Z_]",
description:"[0-9a-zA-Z_]"},wi="as",tk={type:"literal",value:"as",description:'"as"'},ni="0x",Uj={type:"literal",value:"0x",description:'"0x"'},Kg="P",Lg={type:"literal",value:"P",description:'"P"'},Mg="p",Ng={type:"literal",value:"p",description:'"p"'},Cf="I",Df={type:"literal",value:"I",description:'"I"'},Ef="i",Ff={type:"literal",value:"i",description:'"i"'},Og="D",Pg={type:"literal",value:"D",description:'"D"'},Qg="d",Rg={type:"literal",value:"d",description:'"d"'},ak="M",bk={type:"literal",value:"M",
description:'"M"'},ck="m",dk={type:"literal",value:"m",description:'"m"'},ek="G",fk={type:"literal",value:"G",description:'"G"'},gk="g",hk={type:"literal",value:"g",description:'"g"'},ik="V",jk={type:"literal",value:"V",description:'"V"'},kk="v",lk={type:"literal",value:"v",description:'"v"'},pi="scene",mk={type:"literal",value:"scene",description:'"scene"'},qi="structure",nk={type:"literal",value:"structure",description:'"structure"'},ri="moltype",ok={type:"literal",value:"moltype",description:'"moltype"'},
si="molecule",pk={type:"literal",value:"molecule",description:'"molecule"'},ti="residue",qk={type:"literal",value:"residue",description:'"residue"'},ui="atom",rk={type:"literal",value:"atom",description:'"atom"'},xi="display",uk={type:"literal",value:"display",description:'"display"'},vi="load",sk={type:"literal",value:"load",description:'"load"'},yi="remove",vk={type:"literal",value:"remove",description:'"remove"'},zi="set",wk={type:"literal",value:"set",description:'"set"'},Li="center",Ik={type:"literal",
value:"center",description:'"center"'},Ai="show",xk={type:"literal",value:"show",description:'"show"'},Bi="hide",yk={type:"literal",value:"hide",description:'"hide"'},Ci="repr",zk={type:"literal",value:"repr",description:'"repr"'},Di="color",Ak={type:"literal",value:"color",description:'"color"'},Ei="move",Bk={type:"literal",value:"move",description:'"move"'},Gi="align",Dk={type:"literal",value:"align",description:'"align"'},Ii="zoom",Fk={type:"literal",value:"zoom",description:'"zoom"'},Ji="highlight",
Gk={type:"literal",value:"highlight",description:'"highlight"'},Ki="clip",Hk={type:"literal",value:"clip",description:'"clip"'},Gf="finish",Pi={type:"literal",value:"finish",description:'"finish"'},Hi="wait",Ek={type:"literal",value:"wait",description:'"wait"'},Mi="opacity",Jk={type:"literal",value:"opacity",description:'"opacity"'},Ni="reset",Kk={type:"literal",value:"reset",description:'"reset"'},Oi="target",Lk={type:"literal",value:"target",description:'"target"'},p=0,Bf=[{line:1,sb:1,ic:!1}],
Za=0,Ag=[],E=0,Hf;if("startRule"in Y){if(!(Y.Bf in y))throw Error("Can't start parsing from rule \""+Y.Bf+'".');Ib=y[Y.Bf]}Hf=Ib();if(Hf!==n&&p===f.length)return Hf;Hf!==n&&p<f.length&&k({type:"end",description:"end of input"});throw function(f,g,h,k){function m(e){var f=1;for(e.sort(function(e,f){return e.description<f.description?-1:e.description>f.description?1:0});f<e.length;)e[f-1]===e[f]?e.splice(f,1):f++}function l(e,f){function g(e){function f(e){return e.charCodeAt(0).toString(16).toUpperCase()}
return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+f(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+f(e)}).replace(/[\u0100-\u0FFF]/g,function(e){return"\\u0"+f(e)}).replace(/[\u1000-\uFFFF]/g,function(e){return"\\u"+f(e)})}var h=Array(e.length),k;for(k=0;k<e.length;k++)h[k]=e[k].description;h=1<e.length?h.slice(0,-1).join(", ")+
" or "+h[e.length-1]:h[0];k=f?'"'+g(f)+'"':"end of input";return"Expected "+h+" but "+k+" found."}null!==g&&m(g);return new e(null!==f?f:l(g,h),0,0,k)}(null,Ag,Za<f.length?f.charAt(Za):null,Za<f.length?h(Za,Za+1):h(Za,Za));}}}();THREE.ShaderChunk.cylinderImpostor_frag="// Inherits from Phong Shading in ThreeJS, allows compatibility with chunks\n#define PHONG\n\n#include <common>\n#include <fog_pars_fragment>\n#include <color_pars_fragment>\n#include <lights_pars>\n#include <bsdfs>\n#include <lights_phong_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\n// Normalize diagonal matrix (1)\nconst mat4 D = mat4(\n    vec4(1.0, 0.0, 0.0, 0.0),\n    vec4(0.0, 1.0, 0.0, 0.0),\n    vec4(0.0, 0.0, 0.0, 0.0),\n    vec4(0.0, 0.0, 0.0, -1.0)\n);\n\n// Create transpose method (not built-in OpenGL ES Shading Language)\nhighp mat4 transpose(in highp mat4 inMatrix) {\n    highp vec4 i0 = inMatrix[0];\n    highp vec4 i1 = inMatrix[1];\n    highp vec4 i2 = inMatrix[2];\n    highp vec4 i3 = inMatrix[3];\n\n    highp mat4 outMatrix = mat4(\n        vec4(i0.x, i1.x, i2.x, i3.x),\n        vec4(i0.y, i1.y, i2.y, i3.y),\n        vec4(i0.z, i1.z, i2.z, i3.z),\n        vec4(i0.w, i1.w, i2.w, i3.w)\n    );\n\n    return outMatrix;\n}\n\nvarying mat4 MTInverse;\nvarying mat4 VPInverse;\nvarying vec4 centernormclip;\n\n// Near, far, width and height\nvarying float n, f, w, h;\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\nuniform mat4 projectionMatrix;\nuniform mat4 projectionMatrixInverse;\n\nvarying vec3 vViewDirection;\nvarying float vLength;\n\nvoid main() {\n    gl_FragColor = vec4(1.0);\n    float c = (f - n) / (2.0 * n * f) * 2.0 / (gl_DepthRange.diff);\n    vec4 c3 = MTInverse[3] * c;\n\n    // Computing xprime (6)\n    vec4 xp = vec4(\n        (gl_FragCoord.x * 2.0 / w - 1.0),\n        (gl_FragCoord.y * 2.0 / h - 1.0),\n        -1.0,\n        1.0\n    );\n    xp = projectionMatrixInverse * xp;\n    xp.z = -1.0;\n    xp.w = (f + n) / (2.0 * f * n) - (n - f) /\n        (2.0 * f * n) * (gl_DepthRange.near + gl_DepthRange.far) / -gl_DepthRange.diff;\n    vec4 xpPrime = MTInverse * xp;\n\n    // Checking quadratic equation discriminant (7)\n    float c3TDc3 = dot(c3, D * c3);\n    float xpPrimeTDc3 = dot(xpPrime, D * c3);\n    float xpPrimeTDxpPrime = dot(xpPrime, D * xpPrime);\n    float A = c3TDc3, B = 2.0 * xpPrimeTDc3, C = xpPrimeTDxpPrime;\n    float discriminant = B * B - 4.0 * A * C;\n\n    gl_FragColor = vec4(1.0);\n    if (discriminant < 0.0) {\n        discard;\n    } else {\n        // Resolving solutions\n        float x1 = (-B - sqrt(discriminant)) / (2.0 * A);\n        float x2 = (-B + sqrt(discriminant)) / (2.0 * A);\n        float z = 1.0 - max(x1, x2);\n        gl_FragDepthEXT = z;\n\n        // Getting current pixel clip coordinate\n        vec4 vClipPos = vec4(\n            (gl_FragCoord.x * 2.0 - 1.0),\n            (gl_FragCoord.y * 2.0 - 1.0),\n            z * 2.0 - 1.0,\n            1.0\n        );\n\n        // Getting current pixel in NDC\n        vec3 fc = vec3(gl_FragCoord.xy, z);\n        fc.xy /= vec2(w, h);\n        fc *= 2.0;\n        fc -= 1.0;\n        // Getting current pixel in view coordinates\n        vec4 p = projectionMatrixInverse * vec4(fc, 1.0);\n        p /= p.w;\n\n        vec3 cylBase = p.xyz + vViewPosition.xyz;\n\n        float a = dot(cylBase,vViewDirection);\n        if (a < 0.0 || a > vLength + 0.000001) {\n        \tdiscard;\n        }\n\n        // Computing current pixel position in eye space\n        vec4 vViewPos = projectionMatrixInverse * vClipPos;\n        vViewPos = vViewPos / vViewPos.w;\n        vViewPos.z = - vViewPos.z;\n\n        // Performing clipping\n        #if NUM_CLIPPING_PLANES > 0\n        for ( int i = 0; i < NUM_CLIPPING_PLANES; ++ i ) {\n            vec4 plane = clippingPlanes[ i ];\n            if ( dot(vViewPos.xyz, plane.xyz ) > plane.w ) {\n                discard;\n            }\n        }\n        #endif\n\n        // Position in eye coordinates (8)\n        vec4 pe = vec4(\n            (gl_FragCoord.x * 2.0 / w - 1.0),\n            (gl_FragCoord.y * 2.0 / h - 1.0),\n            -1.0,\n            1.0\n        );\n        pe = projectionMatrixInverse * pe;\n        pe.z = -1.0;\n        pe.w = (f + n)/(2.0 * f * n) -\n            (n - f)/(2.0 * f * n) * (gl_DepthRange.near + gl_DepthRange.far) / gl_DepthRange.diff +\n            z * ((n - f) / (n * f) / gl_DepthRange.diff);\n        vec4 np = MTInverse * pe;\n        // Because the cylinder's axis is Z, we ignore z value of the vertex\n        np.z = 0.0;\n        vec4 ne = transpose(MTInverse) * np;\n\n        // Declaring normal to get compatibility with threejs Phong chunks\n        vec3 normal = normalize(ne.xyz);\n\n        // Starting to compute phong lighting\n        vec4 diffuseColor = vec4(diffuse, opacity);\n        ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n        vec3 totalEmissiveLight = emissive;\n        #include <color_fragment>\n        // Declaring specularStength to get compatibility with threejs chunks\n        float specularStrength = 1.0;\n        #include <lights_phong_fragment>\n        #include <lights_template>\n        vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse +\n                                reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;\n\n        gl_FragColor = vec4(outgoingLight, opacity);\n\n        #include <fog_fragment>\n    }\n}\n";
THREE.ShaderChunk.cylinderImpostor_vert="// Inherits from Phong Shading in ThreeJS, allows compatibility with chunks\n#define PHONG\n\n// Normalize diagonal matrix (1)\nconst mat4 D = mat4(\n    vec4(1.0, 0.0, 0.0, 0.0),\n    vec4(0.0, 1.0, 0.0, 0.0),\n    vec4(0.0, 0.0, 0.0, 0.0),\n    vec4(0.0, 0.0, 0.0, -1.0)\n);\n\nconst mat4 t1 = mat4(\n    vec4(1.0, 0.0, 0.0, 0.0),\n    vec4(0.0, 1.0, 0.0, 0.0),\n    vec4(0.0, 0.0, 0.0, 0.0),\n    vec4(0.0, 0.0, 1.0, 1.0)\n);\n\nconst mat4 t2 = mat4(\n    vec4(1.0, 0.0, 0.0, 0.0),\n    vec4(0.0, 1.0, 0.0, 0.0),\n    vec4(0.0, 0.0, 0.0, 0.0),\n    vec4(0.0, 0.0, -1.0, 1.0)\n);\n\n// Create transpose method (not built-in OpenGL ES Shading Language)\nhighp mat4 transpose(in highp mat4 inMatrix) {\n    highp vec4 i0 = inMatrix[0];\n    highp vec4 i1 = inMatrix[1];\n    highp vec4 i2 = inMatrix[2];\n    highp vec4 i3 = inMatrix[3];\n\n    highp mat4 outMatrix = mat4(\n        vec4(i0.x, i1.x, i2.x, i3.x),\n        vec4(i0.y, i1.y, i2.y, i3.y),\n        vec4(i0.z, i1.z, i2.z, i3.z),\n        vec4(i0.w, i1.w, i2.w, i3.w)\n    );\n\n    return outMatrix;\n}\n\n#include <common>\n#include <color_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nattribute float radius;\nattribute vec3 dir;\n\nuniform vec4 viewport;\nuniform mat4 modelViewMatrixInverse;\n\nvarying mat4 MTInverse;\nvarying mat4 VPInverse;\nvarying vec4 centernormclip;\n\n// Near, far, width and height\nvarying float n, f, w, h;\n\n// Compatibility with threejs chunks\nvarying vec3 vViewPosition;\nvarying vec3 vViewDirection;\nvarying float vLength;\n\nvec4 ComputeBoundsFromPMT(mat4 PMT) {\n    // Getting coefficients\n    vec4 r1 = PMT[0];\n    vec4 r2 = PMT[1];\n    vec4 r4 = PMT[3];\n\n    // Intermediate computations\n    float r4TDr4 = dot(r4, D * r4);\n    float r1TDr4 = dot(r1, D * r4);\n    float r1TDr1 = dot(r1, D * r1);\n    float r2TDr4 = dot(r2, D * r4);\n    float r2TDr2 = dot(r2, D * r2);\n\n    // Computing bounding box by resolving second degree equations (5)\n    vec2 yBounds;\n    vec2 xBounds;\n    float A, B, C;\n    A = r4TDr4; B = -2.0 * r1TDr4; C = r1TDr1;\n    xBounds[0] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );\n    xBounds[1] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );\n    A = r4TDr4; B = - 2.0 * r2TDr4; C = r2TDr2;\n    yBounds[0] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );\n    yBounds[1] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );\n\n    return vec4(xBounds, yBounds);\n}\n\nvoid main() {\n    // Chunck to color vertex with vertex color attribute\n    #include <color_vertex>\n\n    // Chunck to compute position in world space\n    #include <begin_vertex>\n    #include <project_vertex>\n    #include <logdepthbuf_vertex>\n    #include <clipping_planes_vertex>\n\n    vViewPosition = - mvPosition.xyz;\n\n    float zScale = length(dir);\n    vec3 normDir = normalize(dir);\n\n    // Computing T matrix with u,v,w and c as quadratic surface parameters (2)\n    // Note : ceil radius because low radius value seems to provoke precision errors\n    mat4 Tscalet = mat4(\n        vec4(ceil(radius), 0.0, 0.0,     0.0),\n        vec4(0.0, ceil(radius), 0.0,     0.0),\n        vec4(0.0, 0.0, zScale,   0.0),\n        vec4(0.0, 0.0, 0.0, 1.0)\n    );\n\n    // Finding up vector to compute rotation matrix from dir attribute\n    vec3 up;\n    bool yMain = abs(normDir[1]) > 0.9;\n    if (yMain) {\n    \tup = vec3( 1, 0, 0 );\n    } else {\n    \tup = vec3( 0, 1, 0 );\n    }\n    vec3 xAxis = normalize(cross(up, normDir.xyz));\n    vec3 yAxis = normalize(cross(normDir.xyz, xAxis));\n\n    mat4 Trott = mat4(\n        vec4(xAxis.xyz,     0.0),\n        vec4(yAxis.xyz,     0.0),\n        vec4(normDir.xyz,   0.0),\n        vec4(0.0, 0.0, 0.0, 1.0)\n    );\n\n    mat4 Ttranst = mat4(\n        vec4(1.0, 0.0, 0.0, 0.0),\n        vec4(0.0, 1.0, 0.0, 0.0),\n        vec4(0.0, 0.0, 1.0, 0.0),\n        vec4(position.x,    position.y,    position.z,    1.0)\n    );\n\n    mat4 Tt = Ttranst * Trott * Tscalet;\n\n    vViewDirection = vec3(modelViewMatrix * (Trott * (vec4(0.0, 0.0, 1.0, 0.0))));\n    vLength = zScale;\n\n    // Computing PMTt Matrix\n    mat4 PMTt = transpose(projectionMatrix * modelViewMatrix * Tt * t1);\n\n    vec4 firstBounds = ComputeBoundsFromPMT(PMTt);\n\n    // Computing PMTt Matrix\n    PMTt = transpose(projectionMatrix * modelViewMatrix * Tt * t2);\n\n    vec4 secBounds = ComputeBoundsFromPMT(PMTt);\n\n    vec2 vertBorders;\n    vec2 horizBorders;\n    horizBorders[0] = min(firstBounds[0], min(firstBounds[1], min(secBounds[0], secBounds[1])));\n  \thorizBorders[1] = max(firstBounds[0], max(firstBounds[1], max(secBounds[0], secBounds[1])));\n\n  \tvertBorders[1] = max(firstBounds[2], max(firstBounds[3], max(secBounds[2], secBounds[3])));\n    vertBorders[0] = min(firstBounds[2], min(firstBounds[3], min(secBounds[2], secBounds[3])));\n\n    // Getting bounding box size in window space\n    float bx = abs( horizBorders[ 0 ] - horizBorders[ 1 ] ) * 0.5 * viewport.z;\n    float by = abs( vertBorders[ 0 ] - vertBorders[ 1 ] ) * 0.5 * viewport.w;\n\n    // Getting bounding box center in clip space\n    float cx = 0.5 * (horizBorders.x + horizBorders.y);\n    float cy = 0.5 * (vertBorders.x + vertBorders.y);\n\n    // Setting point size\n    gl_PointSize = ceil(max(bx, by));\n\n    // Reposition vertex to fit with bounding box\n    //gl_Position.xy = vec2(cx, cy) * gl_Position.w;\n\n    // Prepare varyings for fragment shader\n    mat4 TscaleInv = mat4(\n        vec4(1.0 / radius,        0.0,           0.0,           0.0),\n        vec4(0.0,           1.0 / radius,        0.0,           0.0),\n        vec4(0.0,           0.0,           1.0 / zScale,        0.0),\n        vec4(0.0,           0.0,           0.0,           1.0)\n    );\n\n    mat4 TrotInv = transpose(Trott);\n\n    mat4 TtransInv = mat4(\n        vec4(1.0, 0.0, 0.0, 0.0),\n        vec4(0.0, 1.0, 0.0, 0.0),\n        vec4(0.0, 0.0, 1.0, 0.0),\n        vec4(-position, 1.0)\n    );\n\n    mat4 TInverse = TscaleInv * TrotInv * TtransInv;\n\n    MTInverse = TInverse * modelViewMatrixInverse;\n\n    // Getting near and far\n    n = projectionMatrix[3][2] / (projectionMatrix[2][2] - 1.0);\n    f = ((projectionMatrix[2][2] - 1.0) * n) / (projectionMatrix[2][2] + 1.0);\n\n    // Getting width and height of the viewport for fragment\n    w = viewport.z;\n    h = viewport.w;\n}\n";
THREE.ShaderChunk.outline_frag="uniform vec3 color;\n\nvarying float doHighlight;\nvarying float outputRadius;\n\nvoid main() {\n    if (doHighlight > 0.99) {\n        gl_FragColor = vec4( color, 1.0 );\n        /*gl_FragColor = vec4(vec3(outputRadius), 1.0 );*/\n    } else {\n        discard;\n    }\n}\n";THREE.ShaderChunk.outline_vert="uniform float scale;\n\nattribute float highlight;\nattribute float radius;\n\nvarying float doHighlight;\nvarying float outputRadius;\n\nvoid main() {\n    outputRadius = radius;\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n    vec4 pNormal = projectionMatrix * vec4( normalMatrix * normal, 0.0 );\n    vec2 xyNormal = pNormal.xy * scale;\n    doHighlight = highlight;\n    gl_Position = projectionMatrix * mvPosition + vec4( xyNormal, 0.15 , 0.0 );\n}\n";
THREE.ShaderChunk.sphereImpostor_frag="// Inherits from Phong Shading in ThreeJS, allows compatibility with chunks\n#define PHONG\n\n#include <common>\n#include <fog_pars_fragment>\n#include <color_pars_fragment>\n#include <lights_pars>\n#include <bsdfs>\n#include <lights_phong_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\n// Normalize diagonal matrix (1)\nconst mat4 D = mat4(\n    vec4(1.0, 0.0, 0.0, 0.0),\n    vec4(0.0, 1.0, 0.0, 0.0),\n    vec4(0.0, 0.0, 1.0, 0.0),\n    vec4(0.0, 0.0, 0.0, -1.0)\n);\n\n// Create transpose method (not built-in OpenGL ES Shading Language)\nhighp mat4 transpose(in highp mat4 inMatrix) {\n    highp vec4 i0 = inMatrix[0];\n    highp vec4 i1 = inMatrix[1];\n    highp vec4 i2 = inMatrix[2];\n    highp vec4 i3 = inMatrix[3];\n\n    highp mat4 outMatrix = mat4(\n        vec4(i0.x, i1.x, i2.x, i3.x),\n        vec4(i0.y, i1.y, i2.y, i3.y),\n        vec4(i0.z, i1.z, i2.z, i3.z),\n        vec4(i0.w, i1.w, i2.w, i3.w)\n    );\n\n    return outMatrix;\n}\n\nvarying mat4 MTInverse;\nvarying mat4 VPInverse;\nvarying vec4 centernormclip;\n\n// Near, far, width and height\nvarying float n, f, w, h;\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\nuniform mat4 projectionMatrix;\nuniform mat4 projectionMatrixInverse;\n\nvoid main() {\n    float c = (f - n) / (2.0 * n * f) * 2.0 / (gl_DepthRange.diff);\n    vec4 c3 = MTInverse[3] * c;\n\n    // Computing xprime (6)\n    vec4 xp = vec4(\n        (gl_FragCoord.x * 2.0 / w - 1.0),\n        (gl_FragCoord.y * 2.0 / h - 1.0),\n        -1.0,\n        1.0\n    );\n    xp = projectionMatrixInverse * xp;\n    xp.z = -1.0;\n    xp.w = (f + n) / (2.0 * f * n) - (n - f) /\n        (2.0 * f * n) * (gl_DepthRange.near + gl_DepthRange.far) / -gl_DepthRange.diff;\n    vec4 xpPrime = MTInverse * xp;\n\n    // Checking quadratic equation discriminant (7)\n    float c3TDc3 = dot(c3, D * c3);\n    float xpPrimeTDc3 = dot(xpPrime, D * c3);\n    float xpPrimeTDxpPrime = dot(xpPrime, D * xpPrime);\n    float A = c3TDc3, B = 2.0 * xpPrimeTDc3, C = xpPrimeTDxpPrime;\n    float discriminant = B * B - 4.0 * A * C;\n\n    gl_FragColor = vec4(1.0);\n    if (discriminant < 0.0) {\n        /*gl_FragColor = vec4(1.0, 0.5, 0.5, 1.0);*/\n        discard;\n    } else {\n        // Resolving solutions\n        float x1 = (-B - sqrt(discriminant)) / (2.0 * A);\n        float x2 = (-B + sqrt(discriminant)) / (2.0 * A);\n        float z = 1.0 - max(x1, x2);\n        gl_FragDepthEXT = z;\n\n        // Getting current pixel clip coordinate\n        vec4 vClipPos = vec4(\n            (gl_FragCoord.x * 2.0 - 1.0),\n            (gl_FragCoord.y * 2.0 - 1.0),\n            z * 2.0 - 1.0,\n            1.0\n        );\n\n        // Computing current pixel position in eye space\n        vec4 vViewPos = projectionMatrixInverse * vClipPos;\n        vViewPos = vViewPos / vViewPos.w;\n        vViewPos.z = - vViewPos.z;\n\n        // Performing clipping\n        #if NUM_CLIPPING_PLANES > 0\n        for ( int i = 0; i < NUM_CLIPPING_PLANES; ++ i ) {\n            vec4 plane = clippingPlanes[ i ];\n            if ( dot(vViewPos.xyz, plane.xyz ) > plane.w ) {\n                discard;\n            }\n        }\n        #endif\n\n        // Position in eye coordinates (8)\n        vec4 pe = vec4(\n            (gl_FragCoord.x * 2.0 / w - 1.0),\n            (gl_FragCoord.y * 2.0 / h - 1.0),\n            -1.0,\n            1.0\n        );\n        pe = projectionMatrixInverse * pe;\n        pe.z = -1.0;\n        pe.w = (f + n)/(2.0 * f * n) -\n            (n - f)/(2.0 * f * n) * (gl_DepthRange.near + gl_DepthRange.far) / gl_DepthRange.diff +\n            z * ((n - f) / (n * f) / gl_DepthRange.diff);\n        vec4 np = MTInverse * pe;\n        vec4 ne = transpose(MTInverse) * np;\n\n        // Declaring normal to get compatibility with threejs Phong chunks\n        vec3 normal = normalize(ne.xyz);\n\n        // Starting to compute phong lighting\n        vec4 diffuseColor = vec4(diffuse, opacity);\n        ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n        vec3 totalEmissiveLight = emissive;\n        #include <color_fragment>\n        // Declaring specularStength to get compatibility with threejs chunks\n        float specularStrength = 1.0;\n        #include <lights_phong_fragment>\n        #include <lights_template>\n        vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse +\n                                reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;\n\n        gl_FragColor = vec4(outgoingLight, opacity);\n\n        #include <fog_fragment>\n    }\n}\n";
THREE.ShaderChunk.sphereImpostor_vert="// Inherits from Phong Shading in ThreeJS, allows compatibility with chunks\n#define PHONG\n\n// Normalize diagonal matrix (1)\nconst mat4 D = mat4(\n    vec4(1.0, 0.0, 0.0, 0.0),\n    vec4(0.0, 1.0, 0.0, 0.0),\n    vec4(0.0, 0.0, 1.0, 0.0),\n    vec4(0.0, 0.0, 0.0, -1.0)\n);\n\n// Create transpose method (not built-in OpenGL ES Shading Language)\nhighp mat4 transpose(in highp mat4 inMatrix) {\n    highp vec4 i0 = inMatrix[0];\n    highp vec4 i1 = inMatrix[1];\n    highp vec4 i2 = inMatrix[2];\n    highp vec4 i3 = inMatrix[3];\n\n    highp mat4 outMatrix = mat4(\n        vec4(i0.x, i1.x, i2.x, i3.x),\n        vec4(i0.y, i1.y, i2.y, i3.y),\n        vec4(i0.z, i1.z, i2.z, i3.z),\n        vec4(i0.w, i1.w, i2.w, i3.w)\n    );\n\n    return outMatrix;\n}\n\n#include <common>\n#include <color_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nattribute float radius;\n\nuniform vec4 viewport;\nuniform mat4 modelViewMatrixInverse;\n\nvarying mat4 MTInverse;\nvarying mat4 VPInverse;\nvarying vec4 centernormclip;\n\n// Near, far, width and height\nvarying float n, f, w, h;\n\n// Compatibility with threejs chunks\nvarying vec3 vViewPosition;\n\nvoid main() {\n    // Chunck to color vertex with vertex color attribute\n    #include <color_vertex>\n\n    // Chunck to compute position in world space\n    #include <begin_vertex>\n    #include <project_vertex>\n    #include <logdepthbuf_vertex>\n    #include <clipping_planes_vertex>\n\n    vViewPosition = - mvPosition.xyz;\n\n    // Computing T matrix with u,v,w and c as quadratic surface parameters (2)\n    mat4 T = mat4(\n        // Three following vectors represents u, v, w axis of the quadric\n        vec4(radius,        0.0,           0.0,           0.0),\n        vec4(0.0,           radius,        0.0,           0.0),\n        vec4(0.0,           0.0,           radius,        0.0),\n        // Represents c, center of the quadric\n        vec4(position.x,    position.y,    position.z,    1.0)\n    );\n\n    // Computing PMTt Matrix\n    mat4 PMTt = transpose(projectionMatrix * modelViewMatrix * T);\n\n    // Getting coefficients\n    vec4 r1 = PMTt[0];\n    vec4 r2 = PMTt[1];\n    vec4 r4 = PMTt[3];\n\n    // Intermediate computations\n    float r4TDr4 = dot(r4, D * r4);\n    float r1TDr4 = dot(r1, D * r4);\n    float r1TDr1 = dot(r1, D * r1);\n    float r2TDr4 = dot(r2, D * r4);\n    float r2TDr2 = dot(r2, D * r2);\n\n    // Computing bounding box by resolving second degree equations (5)\n    vec2 vertBorders;\n    vec2 horizBorders;\n    float A, B, C;\n    A = r4TDr4; B = -2.0 * r1TDr4; C = r1TDr1;\n    horizBorders[0] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );\n    horizBorders[1] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );\n    A = r4TDr4; B = - 2.0 * r2TDr4; C = r2TDr2;\n    vertBorders[0] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );\n    vertBorders[1] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );\n\n    // Getting bounding box size in window space\n    float bx = abs( horizBorders[ 0 ] - horizBorders[ 1 ] ) * viewport.z;\n    float by = abs( vertBorders[ 0 ] - vertBorders[ 1 ] ) * viewport.w;\n\n    // Getting bounding box center in clip space\n    float cx = 0.5 * (horizBorders.x + horizBorders.y);\n    float cy = 0.5 * (vertBorders.x + vertBorders.y);\n\n    // Setting point size\n    gl_PointSize = max(bx, by) * 0.5;\n\n    // Reposition vertex to fit with bounding box\n    gl_Position.xy = vec2(cx, cy) * gl_Position.w;\n\n    // Prepare varyings for fragment shader\n    mat4 TInverse = mat4(\n        1.0,          0.0,          0.0,         0.0,\n        0.0,          1.0,          0.0,         0.0,\n        0.0,          0.0,          1.0,         0.0,\n        -position.x,  -position.y,  -position.z, radius\n    );\n    MTInverse = TInverse * modelViewMatrixInverse;\n\n    // Getting near and far\n    n = projectionMatrix[3][2] / (projectionMatrix[2][2] - 1.0);\n    f = ((projectionMatrix[2][2] - 1.0) * n) / (projectionMatrix[2][2] + 1.0);\n\n    // Getting width and height of the viewport for fragment\n    w = viewport.z;\n    h = viewport.w;\n}\n";
THREE.ShaderChunk.transparencyQuad_frag="#include <packing>\n\nvarying vec2 vUv;\n\nuniform sampler2D tOpaque;\nuniform sampler2D tTransparent;\nuniform sampler2D tOpaqueDepth;\nuniform sampler2D tTransparentDepth;\nuniform float cameraNear;\nuniform float cameraFar;\n\nfloat readDepth (sampler2D depthSampler, vec2 coord) {\n  float cameraFarPlusNear = cameraFar + cameraNear;\n  float cameraFarMinusNear = cameraFar - cameraNear;\n  float cameraCoef = 2.0 * cameraNear;\n  return cameraCoef / (cameraFarPlusNear - texture2D(depthSampler, coord).x * cameraFarMinusNear);\n}\n\nvoid main()\n{\n    vec4 opaque = texture2D( tOpaque, vUv );\n    vec4 transparent = texture2D( tTransparent, vUv );\n\n    float opaqueDepth = readDepth( tOpaqueDepth, vUv );\n    float transparentDepth = readDepth( tTransparentDepth, vUv );\n\n    if (opaqueDepth < transparentDepth) {\n        gl_FragColor = opaque;\n    } else {\n        gl_FragColor = transparent + opaque * (1.0 - transparent.a);\n    }\n}\n";
THREE.ShaderChunk.transparencyQuad_vert="varying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n";function Qi(e){this.parent=e;this.content=null}Qi.prototype.show=function(){Ri(this.parent);this.content.show();var e=[];e.visible=!0;this.update(e)};Qi.prototype.hide=function(){this.content.hide();var e=[];e.visible=!1;this.update(e);this.parent.ba.aa.scene3D.je.Gj()};
Qi.prototype.toggle=function(){this.content.is(":visible")?this.hide():this.show()};function Si(e,f,g){$(g?'<option selected value="'+f+'">'+f+"</option>":'<option value="'+f+'">'+f+"</option>").appendTo(e)}function Ti(e,f){var g;return g=""+('<input type="checkbox" id="widget'+e+'" title="'+f+'">')+('<label class="hasMenu " for="widget'+e+'" title="'+f+'">')+"</label>"}Qi.prototype.update=function(){};function Ui(e){Qi.call(this,e);this.ba=this.parent.ba;this.time=0;Vi(this);Wi(this)}
Ui.prototype=Object.create(Qi.prototype);Ui.prototype.constructor=Ui;
function Vi(e){e.content=$('<div id="clippingWidget"></div>');var f;f='<div><span id="clippingTitle" class="mapSelection"> Clipping tool </span><button id="closeClippingButton" class="mapSelection">Close</button></div>';e.content.appendTo(e.parent.qe);f=$(f);f.appendTo(e.content);$('<div id="nearFarSliderTitle">Near / Far</div><div id="slider-range2" style="width:90%;"></div>').appendTo(e.content);e.hk=$("#slider-range2").css({margin:"0 auto"});e.hk.slider({orientation:"horizontal",Hm:!0,step:.1,
values:[0,100],slide:function(f,h){xf(e.ba.aa.scene3D,h.values[0],h.values[1])}});$("#clippingTitle").css({color:"white"});$("#nearFarSliderTitle").css({color:"white"});$("#closeClippingButton").button({text:!1,label:"Quit",icons:{primary:"ui-icon-close"}}).click(function(){e.hide()});$("#closeClippingButton").css({width:"15px",position:"absolute",right:"0px","margin-right":"10px"})}
function Wi(e){document.addEventListener("keypress",function(e,g){return function(){return e.apply(g,arguments)}}(function(e){99===e.which&&this.toggle()},e),!1)}function Xi(e){Qi.call(this,e);this.Je=void 0;Yi(this);Zi(this)}Xi.prototype=Object.create(Qi.prototype);Xi.prototype.constructor=Xi;
function $i(e,f){$("#mapping").empty();void 0===f&&(f="Atoms");$("selectMap").text()!==f&&$("#selectMap").text(f);if("Atoms"===f||"Amino Acids"===f)aj(e,f,4);else if("Nucleic Acids"===f)aj(e,f,5);else if("Secondary Structure"===f)aj(e,f,2);else if("Molecules"===f)aj(e,f,4);else if("Rainbow"===f){$('<span class="gradientLabelLeft">First</span><span class="gradientLabelRight">Last</span></br><canvas id="gradient"></canvas><br/>').appendTo("#mapping");$("#gradient").css({width:"90%",height:"20px",border:"1px solid #555"});
for(var g=document.getElementById("gradient"),h=g.getContext("2d"),k=g.width,g=g.height,m=null,l=0;l<k;l++)for(var q=0;q<g;q++)m="hsl("+l+", 100%, 50%)",h.fillStyle=m,h.fillRect(l,q,1,1)}else"Hydrophobicity"===f?($('<span class="gradientLabelLeft">Hydrophilic</span><span class="gradientLabelRight">Hydrophobic</span></br><canvas id="gradient"></canvas><br/>').appendTo("#mapping"),$("#gradient").css({width:"90%",height:"20px",border:"1px solid #555"}),g=document.getElementById("gradient"),h=g.getContext("2d"),
k=g.width,g=g.height,m=h.createLinearGradient(0,0,k,0),m.addColorStop(0,e.bc.Uc.Hydrophobicity.Hydrophobic),m.addColorStop(.5,"rgb(255,255,255)"),m.addColorStop(1,e.bc.Uc.Hydrophobicity.Hydrophilic),h.fillStyle=m,h.fillRect(0,0,k,g)):console.warn("Unknown legend mapping name : ",f)}
function aj(e,f,g){var h=$('<table class="legend-array" style="display: inline-block;">'),k,m=e.bc.Uc[f],l=0,q;for(q in m){0===l%g&&(k=$("<tr></tr>"),k.appendTo(h));var r=$("<td></td>");r.appendTo(k);var t=$('<div class="legend-mapping"></div>');t.appendTo(r);$('<input type="text" value="'+q+'" readonly/>').appendTo(t);r='<div class="color-box" style="background-color:'+m[q]+';" data-mapping="'+f+'" data-mappingName="'+q+'" data-color="'+m[q]+'"></div>';r=$(r);r.click(function(){e.Je=$(this);e.Gg.map=
$(this).attr("data-mapping");e.Gg.name=$(this).attr("data-mappingName");$("#mcp").minicolors("value",$(this).attr("data-color"));$("#mapColPick").show()});$(r).appendTo(t);l++}h.appendTo("#mapping")}
function Yi(e){e.content=$('<div id="legend"></div>');var f;f='<button id="previousMapping" class="mapSelection">Previous</button><span id="selectMap" class="mapSelection"></span><button id="nextMapping" class="mapSelection">Next</button>';e.content.appendTo(e.parent.qe);$('<button id="closeLegend" class="mapSelection">Close</button>').appendTo(e.content);$('<div id="mappingSelection" style="text-align: center;"></div><div id="mapping" style="text-align: center;"></div>').appendTo(e.content);$("#mappingSelection").css({color:"white",
display:"inline-flex","justify-content":"center",width:"100%"});$(f).appendTo($("#mappingSelection"));$("#selectMap").css({width:"63%"});e.toggle();e.ck=$("#previousMapping");e.bk=$("#nextMapping");e.bc=Je();$("#previousMapping").css({width:"7%",right:"5px"});$("#nextMapping").css({width:"7%",left:"5px"});$("#closeLegend").button({text:!1,label:"Quit",icons:{primary:"ui-icon-close"}}).click(function(){e.hide()});$("#closeLegend").css({width:"15px",position:"absolute",right:"0px","margin-right":"10px"});
e.ck.button({text:!1,label:"Previous",icons:{primary:"ui-icon-triangle-1-w"}}).click(function(){void 0!=this&&this.blur();var f=$("#selectMap").text(),g=null,m;for(m in e.bc.Uc){if(null!=g&&m===f)break;g=m}$("#selectMap").text(g);$i(e,g);$("#mapColPick").hide();e.Je=void 0});e.bk.button({text:!1,label:"Previous",icons:{primary:"ui-icon-triangle-1-e"}}).click(function(){void 0!=this&&this.blur();var f=!1,g=$("#selectMap").text(),m=null,l;for(l in e.bc.Uc){if(f){m=l;break}l===g&&(f=!0)}if(null===m){for(var q in e.bc.Uc)break;
m=q}$("#selectMap").text(m);$i(e,m);$("#mapColPick").hide();e.Je=void 0});f=$(Ti("ResetButton","Reset")).button({text:!1,label:"Reset",icons:{primary:" ui-icon-arrowrefresh-1-e"}}).click(function(){var f=e.bc;f.ca={Atoms:[],Residues:[],Molecules:[],SST:[]};window.localStorage.setItem("def",JSON.stringify(nd));window.localStorage.setItem("moleculeColor",JSON.stringify(od));window.localStorage.setItem("nucleicAcidColor",JSON.stringify(pd));window.localStorage.setItem("residueColor",JSON.stringify(qd));
window.localStorage.setItem("atomColor",JSON.stringify(rd));window.localStorage.setItem("hydroColor",JSON.stringify(Ad));window.localStorage.setItem("rainbowColor",JSON.stringify(Bd));window.localStorage.setItem("sstColor",JSON.stringify(Cd));window.localStorage.setItem("unsortedProperties",JSON.stringify(Dd));Le(f);var g=new Oe;g.ki=!0;Ne(f,g);$("#mapColPick").hide();$i(e);this.blur()}).css({width:"10%",height:"1em"});var g=$(Ti("SaveButton","Save")).button({text:!1,label:"Save",icons:{primary:"ui-icon-arrowstop-1-s"}}).click(function(){var f=
e.bc;window.localStorage.setItem("def",JSON.stringify(f.og));window.localStorage.setItem("moleculeColor",JSON.stringify(f.Rd));window.localStorage.setItem("nucleicAcidColor",JSON.stringify(f.tb));window.localStorage.setItem("residueColor",JSON.stringify(f.hc));window.localStorage.setItem("atomColor",JSON.stringify(f.Ma));window.localStorage.setItem("hydroColor",JSON.stringify(f.Qd));window.localStorage.setItem("rainbowColor",JSON.stringify(f.Ye));window.localStorage.setItem("sstColor",JSON.stringify(f.Qc));
window.localStorage.setItem("unsortedProperties",JSON.stringify(f.pg));this.blur()}).css({width:"10%",height:"1em"});g.focus(function(){});f.focus(function(){});g.appendTo("#legend");f.appendTo("#legend");$('<div id="mapColPick"><div id="mcp"></div></div>').appendTo(e.content);$("#mcp").minicolors({control:"hue",defaultValue:"#4fc8db",format:"hex",keywords:"",inline:"true",letterCase:"lowercase",position:"bottom left",swatches:[],change:function(f){if(f&&"object"===("undefined"===typeof console?"undefined":
ia(console))){var g=e.bc,m=e.Gg.map,l=e.Gg.name;if(void 0!==g.Uc[m]&&void 0!==g.Uc[m][l]){g.Uc[m][l]=f;var q=m;"Amino Acids"===q||"Nucleic Acids"===q?q="Residues":"Secondary Structure"===q&&(q="SST");void 0!=g.ca[q]&&void 0!=g.ca[q][l]&&(g.ca[q][l]=g.ca[q][l].set(f),l=new Oe,l.ki=!0,l.jh=m,Ne(g,l))}void 0!==e.Je&&(e.Je.css("background-color",f),e.Je.attr("data-color",f))}}});$("#mapColPick").toggle();$("#mapColPick").hide()}
function Zi(e){document.addEventListener("keypress",function(e,g){return function(){return e.apply(g,arguments)}}(function(e){108===e.which&&this.toggle()},e),!1);$i(e);e.Gg={map:null,name:null,value:null}}function bj(e){Qi.call(this,e);this.hm="Star selection";this.zl="Pair selection";this.$i=" Click to select an atom ";cj(this);dj(this)}bj.prototype=Object.create(Qi.prototype);z=bj.prototype;z.constructor=bj;z.Cg=function(e){this.parent.ba.aa.scene3D.Cg(e)};z.Df=function(){this.parent.ba.aa.scene3D.Df()};
z.ih=function(){this.parent.ba.aa.scene3D.ih()};
function cj(e){e.content=$('<div id="measureWidget"></div>');var f;f='<div><span id="measureTitle" class="mapSelection"> Measuring tool </span><button id="closeMeasurementButton" class="mapSelection">Close</button></div>';e.content.appendTo(e.parent.qe);f=$(f);f.appendTo(e.content);f='<button id="clearMeasureButton"> Clear </button><div id="MeasurementTypeSelection"><input type="radio" id="starSelection" name="radioSelectionMeasure" checked="checked">'+('<label for="starSelection" title="starSelection">'+
e.hm+"</label>");f=f+'<input type="radio" id="pairSelection" name="radioSelectionMeasure">'+('<label for="pairSelection" title="pairSelection">'+e.zl+"</label>");f+="</div>";var g=$("<div></div>").css({display:"flex","justify-content":"center"});$(f).appendTo(g);g.appendTo(e.content);$("#clearMeasureButton").button({text:!1,label:"Clear",icons:{primary:" ui-icon-arrowrefresh-1-e"}}).css({height:"20px","font-size":"0.7em"}).click(function(){e.ih()});e.fi=$('<div id="starMeasureWidget"><button id="objectMeasurementSelection">'+
e.$i+"</button></div>");e.qg=$('<div id="pairMeasureWidget"></div>');e.fi.appendTo(e.content);e.qg.appendTo(e.content);e.qg.hide();$("#MeasurementTypeSelection").change(function(){var f=$("input[type='radio'][name='radioSelectionMeasure']:checked").attr("id");"starSelection"===f?(f=[],f.visible=!0,e.update(f),e.Df(),e.fi.show(),e.qg.hide()):"pairSelection"===f&&(e.fi.hide(),e.qg.show(),e.Cg())});$("#objectMeasurementSelection").button().css({width:"70%",height:"20px","font-size":"0.7em"}).click(function(){e.Df();
var f=[];f.visible=!0;e.update(f)});$("#MeasurementTypeSelection").buttonset().css({"font-size":"0.7em","margin-right":"0px",height:"100%",border:"0px"});$("#measureTitle").css({color:"white"});$("#closeMeasurementButton").button({text:!1,label:"Quit",icons:{primary:"ui-icon-close"}}).click(function(){e.hide()});$("#closeMeasurementButton").css({width:"15px",position:"absolute",right:"0px","margin-right":"10px"})}
function dj(e){document.addEventListener("keypress",function(e,g){return function(){return e.apply(g,arguments)}}(function(e){109===e.which&&this.toggle()},e),!1)}z.hide=function(){Qi.prototype.hide.call(this);this.Df()};z.update=function(e){var f=this;$("#objectMeasurementSelection").text(this.$i);e.visible&&this.parent.ba.aa.scene3D.je.nj(function(e){null!=e&&(f.Cg(e),$("#objectMeasurementSelection").text(e.$b()));f.parent.ba.aa.scene3D.je.Gj()})};
function ej(e){Qi.call(this,e);this.mb=this.Ed=this.oc=null;this.Nh=Je();this.Nj=" (visible)";this.Ri="All representations";this.vl="Click to select an object";fj(this);gj(this);var f=this;this.parent.ba.addListener("requestWidgetUpdate",function(){var e=hj(f),h=ij(),k=$("#objectSelection").html();f.mb=biovizAPI.Nc(k,h)[0];jj(f,h,e);kj(f)})}ej.prototype=Object.create(Qi.prototype);ej.prototype.constructor=ej;
function ij(){var e=$("input[type='radio'][name='radioSelectionLevel']:checked").attr("id"),e=e.replace("radioSelection","");return parseInt(e)}function lj(e){0<e&&5>e&&(e="#radioSelection"+e,$(e)[0].checked=!0,$(e).button("refresh"))}ej.prototype.hh=function(e){e instanceof $a&&($("#objectSelection").text(e.$b()),lj(2),this.mb=void 0,mj(this))};
function mj(e){$("#reprcolorpicker").hide();var f=e.mb,g=ij(),h=$("#objectSelection").html(),k=biovizAPI.Nc(h,g)[0];if(null!=f)if(f==k)4>g&&g++;else{for(var m=!1,l=g;f.parent!=k.parent&&0<g;)if(g--,f=f.parent,k=k.parent,null==f||null==f.parent){m=!0;break}m&&(g=l)}lj(g);k=biovizAPI.Nc(h,g)[0];e.mb=k;jj(e,g)}
function jj(e,f,g){if(void 0!=e.mb){var h=$("#objectSelection").html();e.mb=biovizAPI.Nc(h,f)[0];f=e.mb.bg();e.oc.html("<option selected>"+e.Ri+"</option>");for(var k in f){var m=f[k].name;biovizAPI.yf([e.mb],m)?(h=m+e.Nj,g===m?Si(e.oc,h,!0):Si(e.oc,h,!1)):g===m?Si(e.oc,m,!0):Si(e.oc,m,!1)}}}function hj(e){return null!=e.oc.val()&&e.oc.val()!==e.Ri?e.oc.val().replace(e.Nj,""):null}
function kj(e){var f=ij(),g=$("#objectSelection").html(),f=biovizAPI.Nc(g,f)[0];e=hj(e);null==f||null==e?$("#showhideRep").button({icons:{primary:" ui-icon-plus"},label:"Hide the representation"}):biovizAPI.yf([f],e)?$("#showhideRep").button({icons:{primary:" ui-icon-minus"},label:"Hide the representation"}):$("#showhideRep").button({icons:{primary:" ui-icon-plus"},label:"Show the representation"})}
function fj(e){e.content=$('<div id="reprManagement"></div>');var f;f='<span id="managementTitle" class="mapSelection">Representation management</span><button id="closeManagementButton" class="mapSelection">Close</button>';var g;g=$("<div></div>");e.content.appendTo(e.parent.qe);f=$(f);f.appendTo(g);f=$("<div></div>");var h='<button id="objectSelection"> '+e.vl+" </button> ",k;k='<div id="selectionLevel"><input type="radio" id="radioSelection1" name="radioSelectionLevel"><label for="radioSelection1" title="Structure">S</label><input type="radio" id="radioSelection2" name="radioSelectionLevel" checked="checked"><label for="radioSelection2" title="Molecule">M</label>';
k+='<input type="radio" id="radioSelection3" name="radioSelectionLevel">';k+='<label for="radioSelection3" title="Residue">R</label>';k+='<input type="radio" id="radioSelection4" name="radioSelectionLevel">';k+='<label for="radioSelection4" title="Atom">A</label>';k+="</div>";var m=$('<div id="selection"></div>');$(h).appendTo($(m));$(k).appendTo($(m));$(m).appendTo(f);h=$('<div id="selectDiv"></div>');$('<button id="showhideRep" class="mapSelection">Close</button>').appendTo(h);e.oc=$('<select name="repType" id="repType" onfocus="this.selectedIndex = -1;"><option selected disabled>Representation</option></select>');
e.Ed=$('<select name="col" id="col" onfocus="this.selectedIndex = 0;"><option selected disabled value="Coloration">Coloration</option></select>');e.Ed.keypress(function(){return!1});e.oc.appendTo(h);e.oc.keypress(function(){return!1});e.Ed.appendTo(h);h.appendTo(f);f.appendTo(g);g.appendTo(e.content);$('<div id="reprcolorpicker"><div id="colPicker"></div><button id="reprClosePicker" class="mapSelection">Close</button></div>').appendTo(e.content);$("#colPicker").minicolors({control:"hue",defaultValue:"#4fc8db",
format:"hex",keywords:"",inline:"true",letterCase:"lowercase",position:"bottom left",swatches:[],change:function(e){e&&void 0!=l.mb&&biovizAPI.Vf(e,[l.mb],hj(l))}});$("#reprcolorpicker").toggle();$("#reprcolorpicker").hide();$("#reprClosePicker").button({text:!1,label:"Quit",icons:{primary:"ui-icon-check"}}).click(function(){$("#reprcolorpicker").hide()});$("#reprcolorpicker").css({"align-self":"flex-end","float":"right"});$("#showhideRep").button({text:!1,label:"Show the representation",icons:{primary:"ui-icon-plus"}});
$("#showhideRep").css({width:"5%",top:"3px"});e.toggle();var l=e;$("#managementTitle").css({color:"white"});$("#closeManagementButton").button({text:!1,label:"Quit",icons:{primary:"ui-icon-close"}}).click(function(){l.hide()});$("#closeManagementButton").css({width:"15px",position:"absolute",right:"0px","margin-right":"10px"});$("#objectSelection").button().css({width:"63%",height:"20px"});$("#selectionLevel").buttonset().css({"margin-right":"0px",height:"100%",border:"0px"});$("#selection").css({"font-size":"0.7em",
display:"flex","align-items":"stretch",width:"100%","margin-bottom":"2px"});$("#selectDiv").css({height:"20px",display:"flex","align-items":"stretch",width:"100%"});$("#repType").css({width:"60%"});e.oc.change(function(){var e=hj(l);null===e||biovizAPI.yf([l.mb],e)||biovizAPI.Bg([l.mb],e);kj(l);var f=ij();jj(l,f,e);$('#col option[value="Coloration"]').prop("selected",!0);biovizAPI.jb({type:"requestWidgetUpdate"})});e.Ed.change(function(){if("Uniform color"===l.Ed.val()){var e=l,f=ij();1===f?$("#colPicker").minicolors("value",
"#D3D3D3"):2===f?$("#colPicker").minicolors("value","#"+af(e.Nh,e.mb.ra.id,"M").getHexString()):3===f?$("#colPicker").minicolors("value","#"+af(e.Nh,e.mb.Ab.xb(),"R").getHexString()):4===f&&(f=e.mb.be,f=f.symbol.charAt(0).toUpperCase()+f.symbol.slice(1).toLowerCase(),$("#colPicker").minicolors("value","#"+af(e.Nh,f,"A").getHexString()));$("#reprcolorpicker").show()}else $("#reprcolorpicker").hide(),biovizAPI.Vf(l.Ed.val(),[l.mb],hj(l))});$("#selectionLevel").change(function(){$("#reprcolorpicker").hide();
var e=hj(l),f=ij(),g=$("#objectSelection").html();l.mb=biovizAPI.Nc(g,f)[0];jj(l,f,e);null!=l.mb&&kj(l);$('#col option[value="Coloration"]').prop("selected",!0)});$("#showhideRep").click(function(){var e=hj(l);if(null!=e){biovizAPI.yf([l.mb],e)?biovizAPI.qj([l.mb],e):biovizAPI.Bg([l.mb],e);kj(l);var f=ij();jj(l,f,e);biovizAPI.jb({type:"requestWidgetUpdate"})}});g=V.Mk();for(var q in g)Si(e.Ed,g[q],!1);Si(e.Ed,"Uniform color",!1)}
function gj(e){document.addEventListener("keypress",function(e,g){return function(){return e.apply(g,arguments)}}(function(e){114===e.which&&this.toggle()},e),!1)}ej.prototype.update=function(e){if(e.visible){var f=this;f.parent.ba.aa.scene3D.je.nj(function(e){null!=e&&($("#objectSelection").text(e.$b()),mj(f),$('#col option[value="Coloration"]').prop("selected",!0))})}};
function nj(e){this.ba=e;this.div=this.ba.canvas;this.time=0;this.u=this.Kf=this.qd=null;new EventTarget(nj.prototype);this._listeners=[];this.$d()}
nj.prototype.$d=function(){var e=this,f;f='<div id="scriptPlayerDiv"><table style="width:100%"><tr><td><button id="play">Play</button></td>';f+='<td><button id="stop">Stop</button></td>';f+='<td id="progressbar" style="width:90%"></td>';f+="</tr>";f+="</table>";f+="</div>";$(f).css({position:"relative",top:"-50px",width:"95%","margin-left":"auto","margin-right":"auto"}).appendTo(this.div);this.kd=$("#scriptPlayerDiv");this.qd=$("#progressbar");this.Kf=$("#play");this.u=$("#stop");setTimeout(function(){e.kd.fadeTo(1E3,
0)},1E3);this.kd.on("mouseenter",function(){e.kd.stop().fadeTo(500,1)});this.kd.on("mouseleave",function(){e.kd.stop().fadeTo(500,0)});this.qd.progressbar({value:!1});this.qd.bind("click",function(f){f=(f.clientX-f.currentTarget.offsetLeft-f.currentTarget.offsetParent.offsetParent.offsetLeft)/f.currentTarget.clientWidth;e.qd.progressbar("option","value",100*f);e.jb({type:"update",value:f})});this.qd.bind("mousemove",function(f){1===f.buttons&&(f=(f.clientX-f.currentTarget.offsetLeft-f.currentTarget.offsetParent.offsetParent.offsetLeft)/
f.currentTarget.clientWidth,e.qd.progressbar("option","value",100*f),e.jb({type:"update",value:f}))});this.Kf.button({text:!1,label:"play",icons:{primary:"ui-icon-play"}}).click(function(){var f;"play"===$(this).text()?(f={label:"pause",icons:{primary:"ui-icon-pause"}},e.jb("play")):(f={label:"play",icons:{primary:"ui-icon-play"}},e.jb("pause"));$(this).button("option",f)});this.u.button({text:!1,icons:{primary:"ui-icon-stop"}}).click(function(){e.Kf.button("option",{label:"play",icons:{primary:"ui-icon-play"}});
e.jb("stop")});this.qd.find(".ui-progressbar-value")};nj.prototype.toggle=function(){this.kd.toggle()};nj.prototype.show=function(){this.kd.stop().fadeTo(0,1)};nj.prototype.hide=function(){this.kd.stop().fadeTo(0,0)};function oj(e){this.ba=e;this.canvas=this.ba.canvas;this.ff=[];this.qe=$('<div id="widgets"></div>').css({position:"absolute",top:"5px",right:"0px","text-align":"center",opacity:"0.9",width:"300px"});this.qe.appendTo(this.canvas);for(var f in pj)this.ff[f]=new pj[f](this);Ri(this)}
oj.prototype.update=function(e){for(var f in pj)this.ff[f].update(e)};function Ri(e){for(var f in pj)e.ff[f].hide()}function ze(e,f){void 0!=e.ff[f]&&e.ff[f].show(!0)}oj.prototype.show=function(){this.qe.show()};oj.prototype.hide=function(){this.qe.hide()};var pj={wm:Xi,zm:ej,tm:Ui,xm:bj};
function qj(){this.canvas=null;this.li="//pdb.bionext.com/pdbx/${id}";this.load=this.he=!0;this.Lj=!1;new EventTarget(qj.prototype);this.Yh=this.aa=null;this.canvas=$('<div id="content"></div>').css({tabindex:"0","z-index":"0",width:"100%",height:"100%",overflow:"hidden"})}qj.prototype.di=function(e,f){"urlTemplate"===e?this.li=f:"loadPDBX"===e?this.he=f:console.warn("Can't change unexisting option : "+e)};
function qf(e,f,g){e=e.cg();var h=$("#loadBar"),k=$("#loadLabel"),m;void 0==f?h.remove():(g?m='<img src="img/loader.gif" id="imgLoader" alt="loader">':(h.remove(),h=$("#loadBar"),setTimeout(function(){$("#loadBar").remove()},6E3)),0==h.length&&(g=$(m).css({display:"inline-block"}),k=$('<div id="loadLabel"> </div>').css({display:"inline-block",color:"white","font-size":"100%"}),h=$('<div id="loadBar" class="noselect"> </div>').css({position:"absolute",top:"2%",right:"0px"}),k.appendTo(h),g.appendTo(h),
h.appendTo(e)),k.text(f))}qj.prototype.fh=function(e){this.jb({type:"atomMouseOver",data:e})};function He(e,f){var g=e.Yh;g.u=g.v.parse(f).slice(0);g.u[0]instanceof ii||g.u.splice(0,0,new ii);g.u.add=g.u.push;g.u.remove=g.u.shift;g.jb({type:"commandParsed",data:g.u})}qj.prototype.cg=function(){return this.canvas};function ld(e){e.contextMenu.div.contextmenu("close")}
qj.prototype.$d=function(){if(!THREE.Detector.webgl)return THREE.Detector.addGetWebGLMessage({parent:this.canvas[0]}),!1;this.aa=new nf(this);this.Yh=new Rh(this.aa);this.contextMenu=new oe(this,$(document.body));this.mk=$(".hasContextMenu:first");this.lh=this.contextMenu.div;this.gj=this.Zf=null;this.Qb=this.aa.scene3D.Qb;this.If=new oj(this);$('<div id="bionextlogo" class="noselect"><img src="img/logo.png" alt="Bionext Logo" width="100%" /></div>').css({position:"absolute",top:"10px",width:"30%",
"margin-left":"10px","margin-right":"auto"}).appendTo(this.canvas);setTimeout(function(){$("#bionextlogo").fadeTo(2E3,.6)},4E3);rj(this);return!0};
function rj(e){e.md=new nj(e);e.Qb.addListener("timeChanged",function(f){e.md.qd.progressbar("option","value",100*f.data.progress)});e.Qb.addListener("endScript",function(){e.md.Kf.button("option",{label:"play",icons:{primary:"ui-icon-play"}})});e.md.addListener("play",function(){e.Qb.play()});e.md.addListener("pause",function(){e.Qb.pause()});e.md.addListener("stop",function(){e.Qb.stop()});e.md.addListener("update",function(f){Vh(e.Qb,f)});e.Yh.addListener("commandParsed",function(f){var g=e.Qb;
f=f.data;g.ca=0;g.ka=f.slice(0);Wh(g);f=g.ka.length;for(var h=0;h<f;h++){var k=g.ka[h];k instanceof Uh&&(g.ca+=k.duration)}})}function Xf(e){e?$("#scriptPlayerDiv").css({top:"-50px"}):$("#scriptPlayerDiv").css({top:"50px"})}
var sj=P.kc.name,tj=P.Jf.name,uj={NONE:P.NONE.name,SPHERES:P.hf.name,BALLS:P.pi.name,LINES:P.LINES.name,BALL_AND_STICKS:P.gf.name,STICKS:sj,ATOMS:P.re.name,MOLECULAR_SURFACE_WIREFRAME:P.yi.name,MOLECULAR_SURFACE:P.Og.name,ACCESSIBLE_SURFACE_WIREFRAME:P.ni.name,ACCESSIBLE_SURFACE:P.Jg.name,CARTOON:tj,CYLINDER:P.ti.name,ALPHA_SHAPE:P.Kg.name,ALPHA_SHAPE_WIREFRAME:P.oi.name,MOLECULAR_INTERACTIONS:P.Ng.name},vj={Structure:M.u.Qg,Molecule:M.u.sc,Residue:M.u.jc,Atom:M.u.ob,Vdw:M.u.Xc},wj=V.ob.name,xj={Molecule:V.sc.name,
Residue:V.jc.name,Atom:wj,CarbonAtom:V.vi.name,HeteroAtom:V.wi.name,SST:V.Ai.name,Rainbow:V.zi.name,Hydrophobicity:V.xi.name},yj={PROTEIN:"Protein",PEPTIDE:"Peptide",SMALL_PEPTIDE:"Small Peptide",RNA:"RNA",DNA:"DNA",LIGAND:"Ligand",ION:"Ion",SOLVENT:"Solvent",UNKNOWN:"Unknown"};function X(){}z=X.prototype;z.pk=function(){this.u=new qj};z.cl=function(){this.v=this.u.$d();this.aa=this.u.aa};z.gl=function(){return this.v};z.Ql=function(e){this.u.contextMenu.moveTo(e);this.u.Zf=e;this.u.gj=e.find("#biovizFrame")};
z.cg=function(){return this.u.cg()};z.Vj=function(e){this.ca=e};z.jb=function(e){this.u.jb(e)};z.ad=function(e){a:{for(var f=this.aa.scene3D,g=0;g<f.na.length;g++)if(f.na[g].fd().toUpperCase()===e.toUpperCase()){e=f.na[g];break a}e=void 0}return e};z.jf=function(e,f){var g=this.ad(e);if(void 0!==g)if(f.includes("Proteinic"))for(var h=["Protein","Peptide","Small Peptide"],k=0,m=h.length;k<m;k++){var l=Hh(g,f.replace("Proteinic",h[k]));if(null!=l)return l}else return Hh(g,f)};
z.kf=function(e,f,g){e=this.jf(e,f);if(void 0!==e)return e.gc(g,!0)};z.Ji=function(e,f,g,h){e=this.kf(e,f,g);if(void 0!==e)return e.Id(h,!0)};z.$c=function(e){var f,g;for(g in P){var h=P[g];if(h.name===e){f=h;break}}if(!f)throw"Can't find RepresentationType corresponding to representationTypeID : "+e;return f};z.Di=function(e){if(1<e.length)throw Error("Selection must contain a single object");e=e[0];if(e instanceof ag)return e;throw Error("Selection must contain a only a molecule");};
z.Ei=function(e){if(1<e.length)throw Error("Selection must contain a single object");e=e[0];if(e instanceof vh)return e;throw Error("Selection must contain a only a molecule");};z.Rg=function(e,f){var g=this,h=rf(this.aa,e);qf(g.u,"Creating scene");Eh(this.aa.scene3D,h);this.aa.scene3D.aa.Sa=h;return new Promise(function(e){vf(g.aa);Ae(g.aa,h,!0);qf(g.u);g.ca?sf(g.aa,h).then(function(){Ae(g.aa,h,!0);g.u.jb({type:"structureReady",data:f});e()}):(g.u.jb({type:"structureReady",data:f}),e())})};
z.gc=function(e,f,g){return this.kf(e,f,g)};z.Hl=function(e){e=e[0];for(var f=e.Ud.values(),g=0,h=f.length;g<h;g++)e.remove(f[g]);e.Ud.clear()};z.Kk=function(e){if(e instanceof M)return yj.u;if(e instanceof ag)return e.ra.type;if(e instanceof bg)return e.Ab.xa.type;if(e instanceof eg)return e.be.Aa().xa.type};
z.Nc=function(e,f){var g=null,h=e.split(":"),k,m,l;5<h.length&&(l=h[5]+":"+h[6],null==f&&(f=4));3<h.length&&(isNaN(h[3])?(m=h[3]+":"+h[4],null==f&&(f=3)):(m=h[3],null!=h[4]?(l=h[4],null==f&&(f=4)):null==f&&(f=3)));1<h.length&&(k=h[1]+":"+h[2],null==f&&(f=2));h=h[0];null==f&&(f=1);switch(f){case 1:g=this.ad(h);break;case 2:g=this.jf(h,k);break;case 3:g=this.kf(h,k,m);break;case 4:g=this.Ji(h,k,m,l)}return null!=g?[g]:[]};z.bg=function(e){return void 0==e?xh("molecule"):e[0].bg()};z.Sj=function(e,f){this.Di(e).ra.Uj(f)};
z.Ze=function(){this.aa.scene3D.Ze()};z.Il=function(){this.aa.scene3D.vg()};z.Vh=function(){this.aa.scene3D.Vh()};z.Jl=function(){this.aa.scene3D.reset()};z.yb=function(e,f,g,h,k){var m=this.Ei(e);null!=g?(g=this.$c(g),g=[Sg(m,g)]):g=m.Zb();e=null;if(null!=h){e=[];for(var m=m.ra,l=m.ga,q=null,q=null,r=h[0]-1;r<h[1];r++)if(k?(q=Md(m.zk,r),q=l[q]):(q=r,q=m.Aa(q)),null!=q)for(var q=q.Ea(),t=0;t<=q.length;t++)e.push(q[t])}for(t=0;t<g.length;t++)g[t].yb(f,e)};z.yk=function(e){He(this.u,e)};z.im=function(){this.u.Qb.play()};
z.jm=function(){this.u.Qb.stop()};z.Bl=function(){this.u.Qb.pause()};z.Zk=function(){this.u.md.kd.css("visibility","hidden")};z.al=function(){this.u.If.hide()};z.addListener=function(e,f){this.u.addListener(e,f)};z.vj=function(){return this.u.vj()};z.di=function(e,f){this.u.di(e,f)};z.yf=function(e,f){if(1===e.length&&e[0]instanceof vh)var g=e[0],h=this.$c(f);else throw Error("Selection must contain a single object");return g.mg(h)};
z.ek=function(e,f,g){null==g&&(g=0);if(1===e.length)0<g?De(this.aa.scene3D,e[0],g,f):Ae(this.aa,e[0],f);else throw Error("Selection must contain a single object");};z.Yj=function(e){if(1===e.length)this.aa.scene3D.aa.Sa=e[0];else throw Error("Selection must contain a single object");};
z.Sk=function(e){var f;if(1!==e.length)throw Error("Selection must contain a single object");if(e[0]instanceof ag){f=e[0].ra;e=e[0].gb();f=f.ga;for(var g=0;g<f.length;g++)if(void 0==e.Wc.get(f[g]))return!1;return!0}return e[0]instanceof bg?(f=e[0].Ab,e=e[0].qb().gb(),void 0!=e.Wc.get(f)):!1};z.Tk=function(){return 0!==this.aa.scene3D.na.length};z.ig=function(){for(var e=[],f=this.aa,g=f.scene3D.na.length,h=0;h<g;h++){var k=f.scene3D.na[h];k instanceof M&&e.push(k.fd())}return e};
z.Lk=function(e){var f=[];e=this.ad(e).Da.keys();for(var g=0,h=e.length;g<h;g++){var k=e[g];f.push(k.type+":"+k.id)}return f};z.Wg=function(e){var f=[];e=this.ad(e).Da.keys();for(var g=0,h=e.length;g<h;g++)f.push(e[g]);return f};z.Nk=function(e){var f=[];e=this.ad(e).Da.keys();for(var g=0,h=e.length;g<h;g++){var k=e[g];"Protein"!==k.type&&"Peptide"!==k.type&&"Small Peptide"!==k.type||f.push(k.type+":"+k.id)}return f};
z.Ok=function(e,f){for(var g=this.jf(e,f).ra.ga,h=[],k=0;k<g.length;k++)h.push(g[k].toString());return h};z.hd=function(e,f){var g=this;return this.aa.hd(e,f).then(function(e){return new Promise(function(k,m){e instanceof Error?m(e):g.Rg(e,f).then(function(e){k(e)})})})};z.ng=function(e,f){var g=this;return this.aa.ng(e,f).then(function(e){return new Promise(function(k,m){e instanceof Error?m(e):g.Rg(e,f).then(function(e){k(e)})})})};
z.fj=function(e){var f=this.ad(e);if(null==f)throw Error("Structure with id: "+e+" not found");Ee(this.aa,f)};z.rk=function(){for(var e=this.ig(),f=0,g=e.length;f<g;f++)this.fj(e[f])};z.xg=function(e,f,g,h,k){this.aa.scene3D.xg(e,f,g,h,k)};z.Bg=function(e,f){for(var g=this.$c(f),h=0,k=e.length;h<k;h++)e[h].show(g)};z.qj=function(e,f){for(var g=this.$c(f),h=0,k=e.length;h<k;h++)e[h].hide(g)};
z.show=function(e,f){for(var g=[],h=0,k=e.length;h<k;h++){var m=e[h];m.visible=!0;f&&m.traverseAncestors(function(e){(e instanceof M||e instanceof ag||e instanceof bg)&&g.push(e)})}0!=g.length&&this.show(g)};z.hide=function(e,f){for(var g=[],h=0,k=e.length;h<k;h++){var m=e[h];m.visible=!1;f&&m.traverse(function(e){(e instanceof ag||e instanceof bg||e instanceof eg)&&g.push(e)})}0!=g.length&&this.hide(g)};
z.jl=function(e){if(1===e.length)return e[0].visible;throw Error("Selection must contain a single object");};z.cc=function(e,f){var g,h;if(1!==e.length)throw Error("Selection must contain a single object");if(e[0]instanceof ag)g=e[0].ra,h=e[0].gb();else if(e[0]instanceof bg)g=e[0].Ab,h=e[0].qb().gb();else throw Error("Selection item is not a Molecule or a Residue");h.cc(g,f)};
z.Yk=function(e){var f;if(1!==e.length)throw Error("Selection must contain a single object");if(e[0]instanceof ag)f=e[0].ra.ga,e=e[0].gb();else if(e[0]instanceof bg)f=e[0].Ab,e=e[0].qb().gb();else throw Error("Selection item is not a Molecule or a Residue");Ge(e,f)};z.Vf=function(e,f,g){f[0]instanceof M&&(f=tf(f[0]));var h=V.eg(e);null==h&&(h=e);e=0;for(var k=f.length;e<k;e++)if(null!=f[e])for(var m=f[e].Zb(),l=0,q=m.length;l<q;l++){var r=m[l].ld;null!=g&&r!==g||m[l].color(h)}};
z.yg=function(e,f,g){if(1!==f.length)throw Error("Selection must contain a single object");f[0]instanceof M&&(f=tf(f[0]));for(var h=0,k=f.length;h<k;h++)if(null!=f[h])for(var m=f[h].Zb(),l=0,q=m.length;l<q;l++){var r=m[l].ld;null!=g&&r!==g||m[l].yg(e)}};z.fk=function(e,f){if(1!=e.length||!(e[0]instanceof ag))throw Error("Selection must contain a single object");var g=e[0];g.ra.Sl(f);var h=this.$c(tj);Sg(g,h).update({gm:!0})};
z.dk=function(e){var f=this.aa;e=this.ad(e);f.u=new THREE.Matrix4;f.u.copy(e.matrix);var g;g="["+f.u.elements[0];for(var h=f.u.elements.length,k=1;k<h;k++)g+=","+f.u.elements[k];console.log(e+" : "+(g+"]"))};z.Ol=function(e){var f=this.aa;e=new THREE.Color(e);f.fa.Dd(e)};z.Dg=function(e){this.aa.Dg(e)};z.Ef=function(){this.aa.Ef()};z.ji=function(){this.aa.scene3D.ji()};
z.Ff=function(){var e=Dh(this.aa.scene3D),f=window.open("","","height="+window.innerHeight+",width="+window.innerWidth);e.then(function(e){e=(window.URL||window.webkitURL).createObjectURL(e);f.location=e})};window.BiovizAPI=X.prototype.constructor;X.prototype.RepresentationTypeID=uj;X.prototype.LabelTypeID=vj;X.prototype.ColorMappingID=xj;X.prototype.ObjectTypeID=yj;z=X.prototype;
z.sl=function(e,f,g,h){var k=this,m=new zj(e);new zj(f);for(var l=new Aj(g,0,this.aa.scene3D),q=m.la.keys().length,r=[],t=0;t<q;t++){var w=jd(m.la)[t],w=this.aa.hd(w);r.push(w);w.then(function(m){m=rf(k.aa,m,g);l.dh(m);m=new Bj(l,h,g);for(var q=k.gg(g,e),r=0,t=q.length;r<t;r++)uf(q[r]);r=V.eg(wj);q=k.gg(g,f);1===q.length&&q[0].show(P.kc).color(r);Ae(k.aa,m,!0);k.aa.scene3D.aa.Sa=m;vf(k.aa)})["catch"](function(e){console.warn("Error on loadStructure : ",e)})}return Promise.all(r).then(function(){return"Query loaded"})};
z.tk=function(){this.we()["delete"]();vf(this.aa)};
z.rl=function(e,f,g,h,k){var m=this,l=new zj(e),q=this.we();if(null==Cj(q,f)){var r=new Dj(f,q),q=new THREE.Vector3(h[4],h[5],h[6]);h=new THREE.Quaternion(h[1],h[2],h[3],h[0]);h=(new THREE.Matrix4).compose(q,h,new THREE.Vector3(1,1,1));r.applyMatrix(h);r.updateMatrixWorld(!0);h=l.la.keys().length;for(var q=[],t=0;t<h;t++){var w=jd(l.la)[t],w=this.aa.hd(w);q.push(w);w.then(function(h){var q=rf(m.aa,h,f);r.dh(q);null!=g&&new Bj(r,g,f);for(var q=0,t=jd(l.la),w=t.length,I=0;I<w;I++)if(t[I].toUpperCase()===
h.Xg.toUpperCase()){q=h.Xg;break}if(null!=k)for(h=0,t=k.length;h<t;h++)w=k[h],I=new Ej(r.vb,r,w.qTips),r.Vc[w.type]=I,r.add(I);h=m.gg(f,e);t=0;for(w=h.length;t<w;t++)uf(h[t]);h=V.eg(wj);q=l.la.get(q).la.keys();t=0;for(w=q.length;t<w;t++)I=m.Nc(f+":Ligand:"+q[t],2),m.Bg(I,sj),m.Vf(h,I,sj);vf(m.aa)})["catch"](function(e){console.warn("Error on loadStructure : ",e)})}return Promise.all(q).then(function(){return"Hit loaded"})}};z.sk=function(e){e=this.td(e);null!=e&&(e["delete"](),vf(this.aa))};
z.gg=function(e,f){for(var g=new Set,h=new zj(f),k=jd(h.la),m=k.length,l=0;l<m;l++)for(var q=h.la.get(k[l]),r=q.la.keys(),t=r.length,w=0;w<t;w++)for(var x=r[w],B=q.la.get(x),C=B.length,G=0;G<C;G++){var I=B[G],D;a:{switch(I.type){case Fj:D=["Protein","Small Peptide","Peptide","DNA","RNA"];break a;case Gj:D=["Solvent"];break a;case Hj:D=["Ligand"];break a}D=void 0}for(var J=null,F=0,K=D.length;F<K;F++)J=D[F],J=I.type==Hj?this.kf(e,J+":"+x,I.$h+":"+I.Zh):this.jf(e,J+":"+x),null!=J&&g.add(J)}return Array.from(g)};
z.ll=function(e,f){var g=this.xe(e),h=this.$c(f);return g.mg(h)};z.am=function(e,f){var g=this.xe(e),h=this.$c(f);g.show(h)};z.$k=function(e,f){var g=this.xe(e),h=this.$c(f);g.hide(h)};z.Yl=function(e){e=Cj(this.we(),e);null!=e&&e.show()};z.Xk=function(e){e=Cj(this.we(),e);null!=e&&e.hide()};z.Zl=function(e){e=tf(e[0]);for(var f in e){var g=e[f];g.visible="Ligand"!==g.qa.type?!1:!0}};
z.$l=function(e){if(1!==e.length)throw Error("Selection must contain a single Structure3D");e[0].visible=!0;e=tf(e[0]);for(var f in e)e[f].visible=!0};z.jk=function(e,f,g,h){e=tf(this.ad(e));for(var k in e){var m=e[k],l=m.qa.type;if("Protein"===l||"Peptide"===l||"Small Peptide"===l){var m=m.Zb(),q;for(q in m)m[q].color([f,g,h])}}};z.lk=function(e,f,g){var h=this.xe(f);f=V.eg(e);null==f&&(f=e);e=h.Zb();for(var k in e)h=e[k].ld,null!=g&&h!==g||e[k].color(f)};
z.kk=function(e,f,g,h,k){h=this.xe(h).Zb();for(var m in h){var l=h[m].ld;null!=k&&l!==k||h[m].color([e,f,g])}};z.Vl=function(e,f){var g=this.td(e).Vc[f];g&&g.show()};z.Uk=function(e,f){var g=this.td(e).Vc[f];g&&g.hide()};z.Xl=function(e,f){var g=this.td(e).Vc[f];g&&(g.Me.visible=!1,g.$e.visible=!0)};z.Wk=function(e,f){var g=this.td(e).Vc[f];g&&(g.$e.visible=!1)};z.Wl=function(e,f){var g=this.td(e).Vc[f];g&&(g.$e.visible=!1,g.Me.visible=!0)};
z.Vk=function(e,f){var g=this.td(e).Vc[f];g&&(g.Me.visible=!1)};z.xe=function(e){var f=this.aa.scene3D,g;for(g in f.na){var h=f.na[g];if(h instanceof Bj&&h.name===e)return f.na[g]}return null};z.we=function(){return this.aa.scene3D.vb};z.td=function(e){return Cj(this.we(),e)};function Ij(e){this.ia=e;this.la=new Fa}Ij.prototype.Fb=function(){return structure+"@"+chain};function Jj(e,f,g){this.type=e;this.$h=f;this.Zh=g}
Jj.prototype.toString=function(){var e="";switch(this.type){case Fj:e+="T";break;case Gj:e+="S";break;case Hj:e+="L"}null!=this.$h&&null!=this.Zh&&(e+="."+this.$h+"."+this.Zh);return e};var Fj="TARGET",Gj="SOLVENT",Hj="LIGAND";function Kj(e){switch(e){case "Protein":case "Small Peptide":case "Peptide":case "DNA":case "RNA":return Fj;case "Solvent":return Gj;case "Ligand":return Hj;default:return null}}
function Lj(e){switch(e.toUpperCase()){case "T":case "TAR":case "TARGET":return Fj;case "L":case "LIG":case "LIGAND":return Hj;case "S":case "SOL":case "SOLVENT":return Gj;default:return Fj}}
function zj(e){this.la=new Fa;if(null!=e){e=e.split("+");for(var f=0;f<e.length;f++){var g=e[f].split("/"),h=g[0].toUpperCase(),k=new Ij(h);this.la.set(h,k);for(var h=g.slice(1),m=0;m<h.length;m++){var g=h[m].split(":"),l=g[0].toUpperCase();k.la.set(l,[]);for(var g=g[1].split(","),q=0;q<g.length;q++){var r="",t=null,w=null,x=g[q].split("."),r=x[0].toUpperCase();3===x.length&&(t=x[1].toUpperCase(),w=parseFloat(x[2]));r=new Jj(Lj(r),t,w);k.la.get(l).push(r)}}}}}
zj.prototype.toString=function(){for(var e="",f=jd(this.la),g=0,h=f.length;g<h;g++){0<g&&(e+="+");for(var k=f[g],e=e+(k+"/"),k=this.la.get(k),m=k.la.keys(),l=0,q=m.length;l<q;l++){0<l&&(e+="/");for(var r=m[l],t=k.la.get(r),e=e+(r+":"),r=0,w=t.length;r<w;r++)e+=t[r].toString()}}return e};function Mj(e){R.call(this,e);this.vb=e.vb;this.nm=e.vh}Mj.prototype=Object.create(R.prototype);Mj.prototype.constructor=Mj;P.ri=new fg("BVS Matching","BVSMatching",Mj);
Mj.prototype.Ka=function(){var e=new THREE.CylinderGeometry(.1,.1,1),f=(new THREE.BufferGeometry).fromGeometry(e),g=this.ja.length/2,h=f.attributes.position.array.length/f.attributes.position.itemSize,k=g*h,e=new THREE.BufferGeometry,m=new Float32Array(3*k),l=new Float32Array(3*k),q=new Float32Array(3*k),r=new Float32Array(2*k),k=new Float32Array(k),t=new THREE.Matrix4;t.makeRotationX(.5*Math.PI);for(var w=0;w<g;w++){var x=this.ja[2*w+1],B=this.wa.Kj[w],C=this.ja[2*w].pos.clone(),G=x.pos.clone(),
x=(new THREE.Matrix4).getInverse(this.nm.matrix);C.applyMatrix4(x);var I=(new THREE.Vector3).addVectors(C,G).multiplyScalar(.5),x=(new THREE.Vector3).subVectors(C,G),D=new THREE.Vector3(1,x.length(),1),J=new THREE.Matrix4;J.lookAt(G,C,new THREE.Vector3(0,1,0));J.multiply(t);J.setPosition(I);J.scale(D);I=f.clone();I.applyMatrix(J);C=I.attributes.position.array;G=I.attributes.normal.array;J=I.attributes.color.array;I=I.attributes.uv.array;B=Mj.xl(x.length(),B);x=C.length/3;for(D=0;D<x;D++){for(var F=
0;3>F;F++)m[w*C.length+3*D+F]=C[3*D+F],l[w*G.length+3*D+F]=G[3*D+F],q[w*J.length+3*D+F]=B[F];for(F=0;2>F;F++)r[w*I.length+2*D+F]=I[2*D+F];k[w*h+D]=w}}e.addAttribute("position",new THREE.BufferAttribute(m,3));e.addAttribute("normal",new THREE.BufferAttribute(l,3));J=new THREE.BufferAttribute(q,3);J.dynamic=!0;e.addAttribute("color",J);e.addAttribute("uv",new THREE.BufferAttribute(r,2));e.addAttribute("atomIndex",new THREE.BufferAttribute(k,1));e.gd();f=ff(this.fa);e=new THREE.Mesh(e,f);e.Ja=this;this.parent.add(e);
this.da=e};Mj.prototype.update=function(){};Mj.pg=[new THREE.Color(.7,.7,.7),new THREE.Color(0,1,0)];Mj.Ye=[new THREE.Color(1,0,0),new THREE.Color(.9,.5,.1)];Mj.og=[.5,1];Mj.Qd=[.25,.75];Mj.xl=function(e,f){var g=null,g=5<e||.5>f||.7>f&&4<e?Mj.Rc(Mj.Ye,Mj.Qd,f):Mj.Rc(Mj.pg,Mj.og,f);return g.toArray()};
Mj.Rc=function(e,f,g){var h=f[0],k=f[1];f=null;if(g>=h&&g<=k){var m=e.length-1;f=(k-h)/m;k=Math.ceil((g-h)/(k-h)*m)-1;m=h+k*f;g=(g-m)/(h+(k+1)*f-m);h=e[k].clone();e=e[k+1].clone();h.lerp(e,g);f=h}else f=g<h?e[0]:e[e.length-1];return f};function Nj(e){$g.call(this,e);this.fe=e.fe;e=this.ja.length;for(var f=[],g=[],h=0;h<e;h++){var k=this.ja[h].Aa();if(!(0<=f.indexOf(k))){var m=k.Ea(),g=g.concat(m);f.push(k)}}this.ja=g}Nj.prototype=Object.create($g.prototype);Nj.prototype.constructor=Nj;
P.Rj=new fg("BVS Residues","BVSResidues",Nj);function Oj(e){R.call(this,e);this.fe=e.fe}Oj.prototype=Object.create(R.prototype);Oj.prototype.constructor=Oj;P.si=new fg("BVS Surface","BVSSurface",Oj);
Oj.prototype.Ka=function(){for(var e=new ce(!0),f=[],g=this.fe.Ae.values(),h=g.length,k=0;k<h;k++)f.push(g[k]);for(g=0;g<f.length;g++)h=f[g].rd,de(e,h.pos.x,h.pos.y,h.pos.z,new THREE.Color("#AAAA00")),e.Zc.push(this.wa.ja.indexOf(h));for(g=0;g<f.length;g++)if(h=f[g],k=h.ed())for(var m=0;m<k.length;m++)for(var l=Hd(k[m],h),q=l.ed(),r=0;r<q.length;r++){var t=Hd(q[r],l);t!==h&&t.pj(h)&&ee(e,h._id,l._id,t._id)}e=fe(e);f=ff(this.fa);f.shading=THREE.FlatShading;f.vertexColors=THREE.FaceColors;f.side=THREE.DoubleSide;
e=new THREE.Mesh(e,f);e.qa=this.Ia;e.Ja=this;this.parent.add(e);this.da=e};Oj.prototype.update=function(){};function Pj(e){$g.call(this,e);this.Vb=e.fe}Pj.prototype=Object.create($g.prototype);Pj.prototype.constructor=Pj;P.Qj=new fg("BVS Mesh","BVSMesh",Pj);Pj.prototype.Ka=function(){$g.prototype.Ka.call(this);this.color(V.uh("residue"))};function Dj(e,f){vh.call(this);this.bc=Je();this._id=e;this.rc=[];this.Vd=null;var g=this.vb=f;g.Ld.push(this);g.add(this);this.Vc={}}Dj.prototype=Object.create(vh.prototype);
z=Dj.prototype;z.constructor=Dj;
z["delete"]=function(){vh.prototype["delete"].call(this);var e=this;this.traverse(function(f){f===e.vb.scene3D.aa.Sa&&(e.vb.scene3D.aa.Sa=null);f===e.vb.scene3D.aa.eb&&(e.vb.scene3D.aa.eb=e.vb.scene3D)});for(var f=this.vb.parent.na,g=0,h=this.rc.length;g<h;g++)f.splice(f.indexOf(this.rc[g]),1),this.rc[g]["delete"]();for(var k in this.Vc)this.remove(this.Vc[k]),this.Vc[k]["delete"]();null!=this.Vd&&(f.splice(f.indexOf(this.Vd),1),this.Vd["delete"]());this.vb.Ld.splice(this.vb.Ld.indexOf(this),1);this.parent.remove(this)};
z.dh=function(e){this.rc.push(e);this.vb.scene3D.na.push(e);this.add(e);var f=this;e.wb=function(){var e=null,h;for(h in this.Da.keys()){var k=this.Da.get(this.Da.keys()[h]),m=k.wb().clone();m.applyMatrix4(k.matrix);e=null===e?m:e.merge(m)}e.applyMatrix4(f.matrix);return e};e.updateMatrixWorld(!0)};z.Qi=function(e){this.Vd=e;this.vb.scene3D.na.push(e);this.add(e)};z.show=function(){this.visible=!0};z.hide=function(){this.visible=!1};
function Ej(e,f,g){vh.call(this);this.vb=e;this.vh=f;this.sg=g;this.bc=Je();this.$e=new THREE.Object3D;this.add(this.$e);this.$e.visible=!1;this.Me=new THREE.Object3D;this.add(this.Me);this.Me.visible=!1;this.ja=Array(2*this.sg.length);this.Kj=Array(this.sg.length);e=this.vb.rc[0].ia.fg().Ea();f=this.vh.rc[0].ia.fg().Ea();g=0;for(var h=this.sg.length;g<h;g++){var k=this.sg[g],m=Qj(e,k.queryAtom),l=Qj(f,k.targetAtom),k=parseFloat(k.value);this.ja[2*g]=m;this.ja[2*g+1]=l;this.Kj[g]=k;var m=m.pos.clone(),
l=l.pos.clone(),q=(new THREE.Matrix4).getInverse(this.vh.matrix);m.applyMatrix4(q);q=(new THREE.Vector3).addVectors(m,l).multiplyScalar(.5);m=(new THREE.Vector3).subVectors(m,l).length();this.$e.add(Rj(k.toFixed(2),q));this.Me.add(Rj(m.toFixed(2),q))}e=Sg(this,P.ri);null!==e&&void 0!==e&&e.show();this.visible=!1}Ej.prototype=Object.create(vh.prototype);Ej.prototype.constructor=Ej;yh.add(Ej,[P.ri]);Ej.prototype["delete"]=function(){vh.prototype["delete"].call(this)};
Ej.prototype.show=function(){this.visible=!0};Ej.prototype.hide=function(){this.visible=!1};function Qj(e,f){for(var g=null,h=0,k=e.length;h<k;h++){var m=e[h];m.name+"."+m.id===f.split(".",2).join(".")&&(g=m)}return g}function Rj(e,f){var g=cf(e,15);return be(g,f)}function Aj(e,f,g){vh.call(this);this.bc=Je();this._id=e;this.rc=[];this.Vd=null;this.Ld=[];this.scene3D=g;this.scene3D.vb=this;this.scene3D.add(this)}Aj.prototype=Object.create(vh.prototype);Aj.prototype.constructor=Aj;
Aj.prototype["delete"]=function(){vh.prototype["delete"].call(this);var e=this;this.traverse(function(f){f===e.scene3D.aa.Sa&&(console.log("hasAnchor"),e.scene3D.aa.Sa=null);f===e.scene3D.aa.eb&&(console.log("hasTarget"),e.scene3D.aa.eb=e.scene3D)});for(var f=this.parent.na,g=0,h=this.rc.length;g<h;g++)f.splice(f.indexOf(this.rc[g]),1),this.rc[g]["delete"]();this.Vd["delete"]();f.splice(f.indexOf(this.Vd),1);g=0;for(h=this.Ld.length;g<h;g++)this.Ld[0]["delete"]();this.Ld=null;this.scene3D.vb=null;
this.parent.remove(this)};Aj.prototype.dh=function(e){this.rc.push(e);this.scene3D.na.push(e);e.scene3D=this.scene3D;this.add(e);var f=this;e.wb=function(){var e=null,h;for(h in this.Da.keys()){var k=this.Da.get(this.Da.keys()[h]),m=k.wb().clone();m.applyMatrix4(k.matrix);e=null===e?m:e.merge(m)}e.applyMatrix4(f.matrix);return e}};Aj.prototype.Qi=function(e){this.Vd=e;this.scene3D.na.push(e);this.add(e)};
function Cj(e,f){for(var g=0,h=e.Ld.length;g<h;g++){var k=e.Ld[g];if(k._id===f)return k}return null}
function Bj(e,f,g){vh.call(this);this.bc=Je();this.Ij=e;this.Ij.Qi(this);this.name=g;this.oe=this.Ij.rc[0];this.qa=this.oe.ia.fg();e=new yb;g=this.qa.Ea();for(var h=f.isolated,k=0;k<h.length;k++){for(var m=h[k].value,l=null,q=0;q<g.length&&(null==w||null==x);q++){var r=g[q],t=r.name+"."+r.id;t===m.split(".",2).join(".")&&(l=r)}null==e.findNode(l)&&e.Sf(l)}f=f.edges;for(k=0;k<f.length;k++){for(var h=f[k].v1,m=f[k].v2,w=null,x=null,q=0;q<g.length&&(null==w||null==x);q++)r=g[q],t=r.name+"."+r.id,t===
h.split(".",2).join(".")&&(w=r),t===m.split(".",2).join(".")&&(x=r);q=e.findNode(w);null==q&&(q=e.Sf(w));w=e.findNode(x);null==w&&(w=e.Sf(x));x=!1;if(r=e.sd.get(q))for(t=0,h=r.length;t<h;t++)if(Hd(r[t],q)===w){x=!0;break}x||e.$g(q,w)}this.fe=e;this.ja=this.fe.values();this.updateMatrixWorld(!0);Sg(this,P.si).show()}Bj.prototype=Object.create(vh.prototype);Bj.prototype.constructor=Bj;yh.add(Bj,[P.si,P.Qj,P.Rj,P.pi]);z=Bj.prototype;z["delete"]=function(){vh.prototype["delete"].call(this)};z.fd=function(){return this.name};
z.reset=function(){};z.le=function(){};z.dd=function(){return Id(this.wb())};z.wb=function(){for(var e=new THREE.Vector3(Infinity,Infinity,Infinity),f=new THREE.Vector3(-Infinity,-Infinity,-Infinity),g=0,h=this.ja.length;g<h;g++){var k=this.ja[g].pos;e.x=Math.min(e.x,k.x);e.y=Math.min(e.y,k.y);e.z=Math.min(e.z,k.z);f.x=Math.max(f.x,k.x);f.y=Math.max(f.y,k.y);f.z=Math.max(f.z,k.z)}e=new ob(e,f);e.applyMatrix4(this.parent.matrix);return e};z=X.prototype;
z.uk=function(e,f,g){var h=new Fa,k=this.Nc(e)[0],m=[];e=0;for(var l=f.length;e<l;e++)m.push(this.Nc(f[e])[0]);var q=[],r=new THREE.Vector3(Infinity,Infinity,Infinity),t=new THREE.Vector3(-Infinity,-Infinity,-Infinity);e=0;for(l=m.length;e<l;e++)if(f=m[e],f!==k){var w=f.ja;f=0;for(var x=w.length;f<x;f++){var B=w[f];r.min(B.pos);t.max(B.pos);q.push(new gc(B))}}m=new Tb(r,t);m.add(q);m.optimize();k=k.ja;e=0;for(l=k.length;e<l;e++)for(B=k[e],q=B.radius(),r=m.$f(B.pos,2*g),f=0,t=r.length;f<t;f++){var w=
r[f].getPoint(),C=w.Aa(),G=C.xa,x=G.Bc().toString()+":"+G.toString();G.yj()&&(x+=":"+C.vc+":"+C._id);C=w.distanceTo(B);G=w.radius();C/(q+G)<=g&&(C=h.get(x),null==C&&(C=[],h.set(x,C)),C.push([B,w]))}return h};z.Hk=function(e){var f=new zj,g=e.split(":"),h=g[0],k=g[1];e=g[2];var m=null,l=null;3<g.length&&(m=g[3],l=g[4]);g=new Ij(h);g.la.set(e,[]);f.la.set(h,g);h=new Jj(Kj(k),m,l);g.la.get(e).push(h);return f.toString()};
z.Gk=function(){for(var e=[],f=this.ig(),g=f.length,h=0;h<g;h++)for(var k=f[h],m=this.Wg(k),l=0,q=m.length;l<q;l++){var r=m[l];r.zj()&&e.push(k+":"+r.toString())}return e};z.Fk=function(){for(var e=[],f=this.ig(),g=f.length,h=0;h<g;h++)for(var k=f[h],m=this.Wg(k),l=0,q=m.length;l<q;l++){var r=m[l];if(r.zj())e.push(k+":"+r.toString());else if(r.yj())for(var t=r.ga,w=0,x=t.length;w<x;w++)e.push(k+":"+r.toString()+":"+t[w].toString())}return e};
z.Pk=function(e,f){for(var g=[],h=0,k=e.length;h<k;h++){var m=e[h][f].Aa(),m=m.xa.Bc().toString()+":"+m.xa.toString()+":"+m.toString();0>g.indexOf(m)&&g.push(m)}return g};z.Jk=function(e){return e.ia.blob};
(function(e){e.widget("bionext.bvsjobswidget",{options:{ba:null},Oh:[],lg:null,rg:null,_create:function(){this.element.addClass("bionext.bvsjobswidget");this.ba=this.options.ba;if(null==this.ba)throw new Exception("You must set bioviz option when using this widget");this.$d()},_destroy:function(){this.element.removeClass("bionext.bvsjobswidget")},$d:function(){var f=this,g;g='<label for="target">Select a target : </label><select name="target" id="target"><option disabled>No target available</option></select><br><label for="dist">Interaction distance : </label>';
g+='<input type="text" id="dist" readonly>';g+='<div id="distSlider"></div>';g+="<br>";g+='<button id="detect">Detect</button>';g+="<br>";g+='<label for="detected">Detected Ligand : </label>';g+='<select name="detected" id="detected"><option disabled>No compound available</option></select>';g+='<input type="checkbox" id ="focus">autoFocus</input>';g+="<br>";g+='<input id="title" placeholder="Title">';g+='<select name="db" id="db"><option>crystal</option><option>small-mq</option></select>';g+="<br>";
g+='<input id="compoundStr" placeholder="Compound selection">';g+='<input id="siteStr" placeholder="Site selection">';g+='<button id="submit">Submit</button>';g=e('<div id="bvsjobswidget" class="ui-widget-header ui-corner-all">'+g+"</div>");this.element.empty();g.appendTo(this.element);e("#target").selectmenu().addClass("disabled");e("#detected").selectmenu().addClass("disabled");e("#db").selectmenu();e("#distSlider").slider({value:20,min:1,max:80,step:1,slide:function(f,g){e("#dist").val(g.value/
10+"A")}}).each(function(){for(var f=e(this).data()["ui-slider"].options,g=f.max-f.min,m=0;m<=g;m++)if(0===(m+f.min)%20){var l=e("<label>"+(m+f.min)/10+"</label>").css("left",m/g*100+"%");e("#distSlider").append(l)}});e("#dist").val(e("#distSlider").slider("value")/10+"A");e("#detect").button().attr("disabled",!0);e("#submit").button().attr("disabled",!0);e("#target").css("color","black").css("font-weight","normal");e("#detected").css("color","black").css("font-weight","normal");e("#db").css("color",
"black").css("font-weight","normal");e("#title").css("color","black").css("font-weight","normal");e("#compoundStr").css("color","black").css("font-weight","normal");e("#siteStr").css("color","black").css("font-weight","normal");e("#dist").css("color","black").css("font-weight","normal");e("#distSlider label").css("position","absolute").css("width","20px").css("margin-top","10px").css("margin-left","-10px").css("text-align","center");e("#detect").click(function(){e("#detected").empty();f.lg=f.ba.ba("detectLigands",
e("#target").val(),f.Oh,e("#distSlider").slider("value")/10);var g=f.lg.keys();if(0<g.length){for(var k=0,m=g.length;k<m;k++)e("#detected").append(e("<option></option>").attr("value",g[k]).text(g[k]));e("#detected").selectmenu().removeClass("disabled");e("#submit").button().removeAttr("disabled")}else e("#detected").append(e("<option disabled></option>").attr("value","No compound available").text("No compound available")),e("#detected").selectmenu().addClass("disabled");e("#detected").selectmenu("refresh",
!0);f.Ui();e("#focus").is(":checked")&&setTimeout(function(){var g=f.ba.ba("getObjects3DFromSelection",e("#detected").val());f.ba.ba("centerOnSelection",g,!1);f.ba.ba("anchorOnSelection",g)},200)});e("#target").on("selectmenuselect",function(){var g=f.ba.ba("getObjects3DFromSelection",e("#target").val(),1);f.ba.ba("centerOnSelection",g)});e("#detected").on("selectmenuchange",function(){null!=f.lg&&(f.Ui(),e("#focus").is(":checked")&&setTimeout(function(){var g=f.ba.ba("getObjects3DFromSelection",
e("#detected").val());f.ba.ba("centerOnSelection",g,!1);f.ba.ba("anchorOnSelection",g)},200))});e("#focus").change(function(){if(!e("#submit").button().attr("disabled"))if(e(this).is(":checked"))g=f.ba.ba("getObjects3DFromSelection",e("#detected").val()),f.ba.ba("centerOnSelection",g,!1);else{var g=f.ba.ba("getObjects3DFromSelection",e("#target").val(),1);f.ba.ba("centerOnSelection",g)}});e("#submit").click(function(){f.Nl()});this.ba.ba("addListener","requestWidgetUpdate",function(){f.rm()})},rm:function(){var f=
e("#target").val();e("#target").empty();this.Oh=[];if(this.ba.ba("hasObject3D")){e("#target").selectmenu().removeClass("disabled");e("#detect").button().removeAttr("disabled");for(var g=this.ba.ba("getAvailableTargets"),h=0,k=g.length;h<k;h++){var m=g[h];e("#target").append(e("<option></option>").attr("value",m).text(m))}this.Oh=this.ba.ba("getAvailableCompounds")}else e("#target").append(e("<option disabled></option>").attr("value","No target available").text("No target available")),e("#target").selectmenu().addClass("disabled"),
e("#detect").button().attr("disabled",!0);e("#target").selectmenu("refresh",!0);g=e("#selectBox option");0>e.map(g,function(e){return e.value===f}).indexOf(!0)&&this.pm()},pm:function(){e("#detected").empty();e("#detected").append(e("<option></option>").attr("value","No compound available").text("No compound available"));e("#detected").selectmenu("refresh",!0);e("#submit").button().attr("disabled",!0);e("#compoundStr").val("");e("#siteStr").val("")},Ui:function(){this.qm();this.Kl();this.rg=e("#detected").val();
for(var f=this.lg.get(e("#detected").val()),g=this.ba.ba("getSelectionFromInteraction",f,0),f=this.ba.ba("getSelectionFromInteraction",f,1),h=0,k=g.length;h<k;h++){var m=this.ba.ba("getObjects3DFromSelection",g[h]);this.ba.ba("showRepresentation",m,e.u.Pg.kc);this.ba.ba("colorBy",[255,0,0],m,e.u.Pg.kc);this.ba.ba("showLabel",m,e.u.Tj.jc)}h=0;for(k=f.length;h<k;h++)m=this.ba.ba("getObjects3DFromSelection",f[h]),this.ba.ba("showRepresentation",m,e.u.Pg.kc),this.ba.ba("colorBy",[0,255,0],m,e.u.Pg.kc),
this.ba.ba("showLabel",m,e.u.Tj.jc)},Kl:function(){var f=this.ba.ba("getObjects3DFromSelection",e("#target").val());this.ba.ba("removeResidues3D",f);this.ba.ba("hideLabel",f);null!=this.rg&&(f=this.ba.ba("getObjects3DFromSelection",this.rg,2),0===f.length?this.rg=null:(this.ba.ba("removeResidues3D",f),this.ba.ba("hideLabel",f)))},qm:function(){var f=this.ba.ba("getBVSSelectionFromBiovizSelection",e("#target").val()),g=this.ba.ba("getBVSSelectionFromBiovizSelection",e("#detected").val());e("#compoundStr").val(g);
e("#siteStr").val(f)},Nl:function(){var f={title:e("#title").val(),Xf:e("#db").val(),Gm:e("#compoundStr").val(),Im:e("#siteStr").val()},g=this.ba.ba("getObjects3DFromSelection",e("#target").val(),1),g=this.ba.ba("getFileFromStructureSelection",g[0]);console.log(g);console.log(JSON.stringify(f))}})})(jQuery);X.prototype.createBioviz=X.prototype.pk;X.prototype.initBioviz=X.prototype.cl;X.prototype.isAvailable=X.prototype.gl;X.prototype.setExternalContextMenuDiv=X.prototype.Ql;
X.prototype.getCanvas=X.prototype.cg;X.prototype._setDefaultRepresentations=X.prototype.Vj;X.prototype._notify=X.prototype.jb;X.prototype._getStructure=X.prototype.ad;X.prototype._getMolecule=X.prototype.jf;X.prototype._getResidue=X.prototype.kf;X.prototype._getAtom=X.prototype.Ji;X.prototype._getRepresentationType=X.prototype.$c;X.prototype._checkSingleMolecule3DFromSelection=X.prototype.Di;X.prototype._checkSingleObject3DFromSelection=X.prototype.Ei;X.prototype._afterLoaded=X.prototype.Rg;
X.prototype.getResidue3D=X.prototype.gc;X.prototype.removeResidues3D=X.prototype.Hl;X.prototype.getMoleculeType=X.prototype.Kk;X.prototype.getObjects3DFromSelection=X.prototype.Nc;X.prototype.getAvailableRepresentations=X.prototype.bg;X.prototype.linkWithExternalSequence=X.prototype.Sj;X.prototype.resetRepresentations=X.prototype.Ze;X.prototype.resetHighlights=X.prototype.Il;X.prototype.resetPositions=X.prototype.Vh;X.prototype.resetScene=X.prototype.Jl;X.prototype.highlight=X.prototype.yb;
X.prototype.executeScript=X.prototype.yk;X.prototype.startScript=X.prototype.im;X.prototype.stopScript=X.prototype.jm;X.prototype.pauseScript=X.prototype.Bl;X.prototype.hideScriptPlayer=X.prototype.Zk;X.prototype.hideWidgetManager=X.prototype.al;X.prototype.addListener=X.prototype.addListener;X.prototype.isDebug=X.prototype.vj;X.prototype.setOption=X.prototype.di;X.prototype.isRepresentationActive=X.prototype.yf;X.prototype.centerOnSelection=X.prototype.ek;X.prototype.anchorOnSelection=X.prototype.Yj;
X.prototype.hasLabels=X.prototype.Sk;X.prototype.hasObject3D=X.prototype.Tk;X.prototype.getStructuresByPDBID=X.prototype.ig;X.prototype.getMoleculesFromStructure=X.prototype.Lk;X.prototype._getMoleculesFromStructure=X.prototype.Wg;X.prototype.getProteinicMoleculesFromStructure=X.prototype.Nk;X.prototype.getResiduesFromMolecule=X.prototype.Ok;X.prototype.loadStructure=X.prototype.hd;X.prototype.loadLocalStructure=X.prototype.ng;X.prototype.deleteStructure=X.prototype.fj;
X.prototype.deleteAllStructures=X.prototype.rk;X.prototype.say=X.prototype.xg;X.prototype.showRepresentation=X.prototype.Bg;X.prototype.hideRepresentation=X.prototype.qj;X.prototype.show=X.prototype.show;X.prototype.hide=X.prototype.hide;X.prototype.isShowed=X.prototype.jl;X.prototype.showLabel=X.prototype.cc;X.prototype.hideLabel=X.prototype.Yk;X.prototype.colorBy=X.prototype.Vf;X.prototype.setAlpha=X.prototype.yg;X.prototype.changeSSE=X.prototype.fk;X.prototype.capturePosition=X.prototype.dk;
X.prototype.setBackground=X.prototype.Ol;X.prototype.startSpin=X.prototype.Dg;X.prototype.stopSpin=X.prototype.Ef;X.prototype.toggleFullscreen=X.prototype.ji;X.prototype.takeScreenshot=X.prototype.Ff;X.prototype.loadBvsQuery=X.prototype.sl;X.prototype.deleteBvsQuery=X.prototype.tk;X.prototype.loadBvsHit=X.prototype.rl;X.prototype.deleteBvsHit=X.prototype.sk;X.prototype.getObjects3DFromBVSSelection=X.prototype.gg;X.prototype.isSiteRepresentationActive=X.prototype.ll;
X.prototype.showSiteRepresentation=X.prototype.am;X.prototype.hideSiteRepresentation=X.prototype.$k;X.prototype.showHit=X.prototype.Yl;X.prototype.hideHit=X.prototype.Xk;X.prototype.showLigandOnly=X.prototype.Zl;X.prototype.showMolecules=X.prototype.$l;X.prototype.colorMolecules=X.prototype.jk;X.prototype.colorSiteBy=X.prototype.lk;X.prototype.colorSite=X.prototype.kk;X.prototype.showBvsHitMatching=X.prototype.Vl;X.prototype.hideBvsHitMatching=X.prototype.Uk;X.prototype.showBvsHitMatchingLabels=X.prototype.Xl;
X.prototype.hideBvsHitMatchingLabels=X.prototype.Wk;X.prototype.showBvsHitMatchingDistanceLabels=X.prototype.Wl;X.prototype.hideBvsHitMatchingDistanceLabels=X.prototype.Vk;X.prototype._getSite=X.prototype.xe;X.prototype._getQuery=X.prototype.we;X.prototype._getHit=X.prototype.td;X.prototype.detectLigands=X.prototype.uk;X.prototype.getBVSSelectionFromBiovizSelection=X.prototype.Hk;X.prototype.getAvailableTargets=X.prototype.Gk;X.prototype.getAvailableCompounds=X.prototype.Fk;
X.prototype.getSelectionFromInteraction=X.prototype.Pk;X.prototype.getFileFromStructureSelection=X.prototype.Jk;
}(biovizNamespace));