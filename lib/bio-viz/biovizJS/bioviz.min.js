var biovizNamespace = {};
(function(ns) {
var z,ea=[];function ga(e){return function(){return ea[e].apply(this,arguments)}}function ha(){if(this.constructor===ha)throw Error("Can't instanciate abstract class BiovizMap");}z=ha.prototype;z.set=function(){throw Error("Trying to call an abstract method");};z.get=function(){throw Error("Trying to call an abstract method");};z.remove=function(){throw Error("Trying to call an abstract method");};z.Gc=function(){throw Error("Trying to call an abstract method");};
z.keys=function(){throw Error("Trying to call an abstract method");};z.values=function(){throw Error("Trying to call an abstract method");};z.clear=function(){throw Error("Trying to call an abstract method");};z.rd=ga(2);function ja(){ha.call(this);this.ia=Object.create(null);this.Ff=Object.create(null);this.Ze={}.hasOwnProperty}ja.prototype=Object.create(ha.prototype);z=ja.prototype;z.constructor=ja;z.set=function(e,f){var g=Da(e);this.Gc(g);this.ia[g]=f;this.Ff[g]=e};
z.get=function(e){e=Da(e);return this.Gc(e)?this.ia[e]:null};z.remove=function(e){e=Da(e);if(this.Gc(e)){var f=this.ia[e];delete this.ia[e];delete this.Ff[e];return f}return null};z.Gc=function(e){e=Da(e);return this.Ze.call(this.ia,e)};z.keys=function(){var e=[],f;for(f in this.ia)e.push(f);return e};z.values=function(){var e=[],f;for(f in this.ia)e.push(this.ia[f]);return e};z.clear=function(){this.ia=Object.create(null);this.Ff=Object.create(null)};z.rd=ga(1);
function Da(e){if(e instanceof Array){e=[];for(var f=e.length,g=0;g<f;g++)e.push(e[g].wb());return e.join("")}return e instanceof Object?e.wb():e}function La(){ha.call(this);this.ia=[]}function Ta(e,f){this.key=e;this.value=f}La.prototype=Object.create(ha.prototype);z=La.prototype;z.constructor=La;
z.set=function(e,f){if(void 0===e)throw"ERROR: key cannot be undefined";var g;a:if(void 0!==e.nf)g=this.ia[e.nf];else{for(g in this.ia)if(this.ia[g].key===e){g=this.ia[g];break a}g=void 0}void 0===g?"object"===typeof e&&(e.nf=this.ia.push(new Ta(e,f))-1):g.value=f};z.get=function(e){if(void 0!==e.nf)return this.ia[e.nf].value;for(var f in this.ia)if(this.ia[f].key===e)return this.ia[f].value};z.keys=function(){var e=[],f;for(f in this.ia)e.push(this.ia[f].key);return e};
z.Gc=function(e){return-1!==this.keys().indexOf(e)};z.values=function(){var e=[],f;for(f in this.ia)e.push(this.ia[f].value);return e};z.remove=function(e){var f=-1,g;for(g in this.ia)if(this.ia[g].key===e){f=g;break}return 0<=f?this.ia.splice(f,1)[0].value:null};z.clear=function(){this.ia=[]};z.rd=ga(0);

function Ua(){this.pos=new THREE.Vector3;this.aa=this.Fa=this.Xb=this.v=this.u=this.kc=this.da=this.symbol=this.sa=this.fa=this.md=this.name=this.id=this.type=null}z=Ua.prototype;z.qa=function(){return this.id};z.pb=function(){return this.Fa};function Za(e,f){e.v!==f&&(e.v=f,null!==e.Fa&&e.Fa.Oc(f))}z.Ma=function(){return this.pos};z.nc=function(){if(null===this.aa){var e=parseFloat($a.Jc(this.symbol)[7]),f=new THREE.Vector3(-e,-e,-e),e=new THREE.Vector3(e,e,e);this.aa=new ab(f,e)}return this.aa};
z.radius=function(){return parseFloat($a.Jc(this.symbol)[7])};z.ob=function(){return this.Xb};function ib(e,f){if(e.Xb!==f&&(e.Xb=f,null!=e.Fa)){var g=e.Fa,h=e.Xb;if(g.Xb!=h){g.Xb=h;for(var k=g.u.length,n=0;n<k;n++)ib(g.u[n],h)}}}z.Wc=function(){return this.kc};z.Le=function(e){this.kc!=e&&(this.kc=e,null!==this.Fa&&this.Fa.Le(e))};z.we=function(){return this.u};z.ae=function(e){this.u!==e&&(this.u=e,null!==this.Fa&&this.Fa.ae(e))};z.toString=function(){return this.symbol+":"+this.id};
z.Ic=function(){return this.Fa.Ic()+":"+this.toString()};z.wb=function(){return this.symbol+":"+this.id+":"+this.u};z.distanceTo=function(e){return e instanceof Ua?Math.sqrt((this.pos.x-e.pos.x)*(this.pos.x-e.pos.x)+(this.pos.y-e.pos.y)*(this.pos.y-e.pos.y)+(this.pos.z-e.pos.z)*(this.pos.z-e.pos.z)):Math.sqrt((this.pos.x-e.x)*(this.pos.x-e.x)+(this.pos.y-e.y)*(this.pos.y-e.y)+(this.pos.z-e.z)*(this.pos.z-e.z))};
z.sub=function(e){return e instanceof Ua?new THREE.Vector3(this.pos.x-e.pos.x,this.pos.y-e.pos.y,this.pos.z-e.pos.z):new THREE.Vector3(this.pos.x-e.x,this.pos.y-e.y,this.pos.z-e.z)};z.add=function(e){return e instanceof Ua?new THREE.Vector3(this.pos.x+e.pos.x,this.pos.y+e.pos.y,this.pos.z+e.pos.z):new THREE.Vector3(this.pos.x+e.x,this.pos.y+e.y,this.pos.z+e.z)};z.clone=function(){return new THREE.Vector3(this.pos.x,this.pos.y,this.pos.z)};
function nb(){this.fa=null;this.u=new vb;this.aa=[];this.sa=this.v=this.da=null}z=nb.prototype;z.qc=function(){return this.fa};z.Me=function(e){this.fa=e;e=this.aa.length;for(var f=0;f<e;f++)f.Me(this.fa)};z.add=function(e){if(e instanceof Ua)return e=this.u.Gf(e),wb(this),e;e instanceof Fb?((null!==e.Zb&&e.Zb!==this||e.Zb===this)&&console.warn("ERROR: ",e,"already belongs to",e.Zb),null===e.Zb&&(this.aa.push(e),e.Me(this.fa),e.Zb=this,wb(this))):console.warn("ERROR : a is not an atom or a molecule")};
z.remove=function(e){e instanceof Ua?(e=this.u.findNode(atom),-1<e&&(delete this.u[e],wb(this))):e instanceof Fb&&(null===molecule&&console.warn("molecule null in function remove in model"),molecule.Zb===this&&(this.aa.splice(this.aa.Da(molecule),1),molecule.Me(null),molecule.Zb=null,wb(this)))};z.xa=function(){return this.u.values()};
z.dc=function(){if(!this.sa){this.u.Kj();this.v=this.nc();for(var e=new Mb(this.v.ye(),this.v.xe(),32),f=this.xa(),g=f.length,h=0;h<g;h++)e.add(new Nb(f[h]));e.optimize();g=f.length;for(h=0;h<g;h++)for(var k=f[h],n=k.symbol,n=n.charAt(0).toUpperCase()+n.slice(1).toLowerCase(),m=parseFloat($a.Jc(n)[6]),q=e.fh(k.pos,5),r=q.length,t=0;t<r;t++){var x=q[t].getPoint();if(x!==k){var n=x.symbol,n=n.charAt(0).toUpperCase()+n.slice(1).toLowerCase(),n=parseFloat($a.Jc(n)[6]),w=k.distanceTo(x);if(w>=m+n-.4&&
w<=m+n+.4){var n=k,w=this.u.findNode(n),E=this.u.findNode(x);void 0!==w&&void 0!==E||console.warn("Couldn't find atoms ",n," and/or ",x," in model ",this);w.Oi(E)||this.u.Lg(w,E).setAttribute("BondType","SIMPLE")}}}this.sa=!0}return this.u};function wb(e){e.da=null;e.v=null;e.sa=!1}z.Ma=function(){if(null===this.da){this.da=new THREE.Vector3;for(var e=this.xa(),f=0,g=0,h=0,k=e.length,n=0;n<k;n++)var m=e[n].pos,f=f+parseInt(m.x),g=g+parseInt(m.y),h=h+parseInt(m.z);this.da.set(f/k,g/k,h/k)}return this.da};
z.nc=function(){if(null===this.v){for(var e=new THREE.Vector3(Infinity,Infinity,Infinity),f=new THREE.Vector3(-Infinity,-Infinity,-Infinity),g=this.xa(),h=g.length,k=0;k<h;k++){var n=g[k].pos;e.x=Math.min(e.x,n.x);e.y=Math.min(e.y,n.y);e.z=Math.min(e.z,n.z);f.x=Math.max(f.x,n.x);f.y=Math.max(f.y,n.y);f.z=Math.max(f.z,n.z)}this.v=new ab(e,f)}return this.v};function Fb(e){this.id=e;this.Zb=this.da=this.type=null;this.ga=[];this.v=this.aa=this.u=null;this.Jg=!1}z=Fb.prototype;z.qa=function(){return this.id};
z.dc=function(){return this.Zb.dc()};z.Oc=function(e){if(this.id!==e){this.id=e;for(var f=0;f<this.ga.length;f++)this.ga[f].ae(e)}};z.qc=function(){return this.da};z.Me=function(e){this.da=e};z.add=function(e){null==e&&console.warn("residue is null in Molecule");null!==e.Ea&&e.Ea!==this&&console.warn(e," already belongs to ",e.Ea);null===e.Ea&&(this.ga.push(e),ec(e,this),fc(this))};
z.remove=function(e){null===e&&console.warn("residue is null in Molecule");e.Ea===this&&(this.ga.remove(e),ec(e,null),fc(this))};z.pb=function(e){for(var f=0;f<this.ga.length;f++){var g=this.ga[f];if(g.qa()==e)return g}return null};z.xa=function(){for(var e=[],f=this.ga.length,g=0;g<f;g++)e=e.concat(this.ga[g].xa());return e};z.size=function(){return this.ga.length};z.isEmpty=function(){return 0===this.size};function fc(e){e.u=null;e.aa=null;null!==e.Zb&&wb(e.Zb)}
z.Ma=function(){if(null===this.u){this.u=new THREE.Vector3;for(var e=this.xa(),f=e.length,g=0;g<f;g++){var h=e[g].pos;this.u.x+=h.x;this.u.y+=h.y;this.u.z+=h.z}this.u.x/=f;this.u.y/=f;this.u.z/=f}return this.u};
z.nc=function(){if(null===this.aa){for(var e=new THREE.Vector3(Infinity,Infinity,Infinity),f=new THREE.Vector3(-Infinity,-Infinity,-Infinity),g=this.xa(),h=g.length,k=0;k<h;k++){var n=g[k].pos;e.x=Math.min(e.x,n.x);e.y=Math.min(e.y,n.y);e.z=Math.min(e.z,n.z);f.x=Math.max(f.x,n.x);f.y=Math.max(f.y,n.y);f.z=Math.max(f.z,n.z)}this.aa=new ab(e,f)}return this.aa};z.toString=function(){return this.type+":"+this.id};z.wb=function(){return this.toString()};z.Ic=function(){return this.da.Ic()+":"+this.toString()};
z.ri=function(){if(null!==this.type&&"Protein"===this.type&&!this.Jg){if(null===this.v){var e=this.ga,f=e.length;this.v=new vb;for(var g=1;g<f;g++){var h=e[g-1],k=e[g],n=this.v.findNode(k);null==n&&(n=this.v.Ng(k.toString(),k));var m=k.gc("CA"),q=k.gc("N"),r=k.gc("H");if(h.qa()+h.ob().charCodeAt(0)===k.qa()+k.ob().charCodeAt(0)-1&&"PRO"!==h.aa){r=h.gc("C");h=h.gc("O");if(null==r||null==h)continue;r=r.sub(h);r=r.normalize();h=q.add(r);r=new Ua;r.name="H";r.symbol="H";r.pos.x=h.x;r.pos.y=h.y;r.pos.z=
h.z}if(null!=r)for(h=0;h<f;h++)if(h!=g&&h!=g-1){var t=e[h],k=this.v.findNode(t);null==k&&(k=this.v.Ng(t.toString(),t));var x=t.gc("CA"),w=t.gc("C"),E=t.gc("O");if(null!=x&&null!=w&&null!=E&&!(9<x.distanceTo(m))){var x=r.distanceTo(E),t=r.distanceTo(w),E=q.distanceTo(E),F=q.distanceTo(w),w=-9.9;.5>x||.5>t||.5>E||.5>F||(w=27.888/E,w+=27.888/t,w-=27.888/x,w-=27.888/F,-9.9>w&&(w=-9.9));if(-.5>w){var x=n.gk(k),G;null!=x?G=x.getAttribute("eH"):G=0;w<G&&(this.v.Lg(n,k,!0).setAttribute("eH",w),null!=x&&this.v.al(x))}}}}}e=
this.ga.length;for(f=0;f<e;f++)this.ga[f].rb=null;f=1;for(m=4;f+m<e;f++)if(gc(this,this.ga[f-1],this.ga[f-1+m])&&gc(this,this.ga[f],this.ga[f+m]))for(g=f;g<f+m;g++)this.ga[g].rb=D.u;for(f=1;f+1<e;f++)for(g=f+3;g+1<e;g++)if(n=this.ga[f],m=this.ga[g],null===n.rb&&null===m.rb)if(gc(this,this.ga[f-1],m)&&gc(this,m,this.ga[f+1])||gc(this,this.ga[g-1],n)&&gc(this,n,this.ga[g+1]))n.rb=D.aa,m.rb=D.aa;else if(gc(this,n,m)&&gc(this,m,n)||gc(this,this.ga[f-1],this.ga[g+1])&&gc(this,this.ga[g-1],this.ga[f+1]))n.rb=
D.v,m.rb=D.v;f=1;for(m=3;f+m<e;f++)if(gc(this,this.ga[f-1],this.ga[f-1+m])&&gc(this,this.ga[f],this.ga[f+m])){n=!0;for(g=f;g<f+m;g++)if(null!=this.ga[g]){n=!1;break}for(g=f;g<f+m;g++)this.ga[g].rb=n?D.u:D.da}f=1;for(m=5;f+m<e;f++)if(gc(this,this.ga[f-1],this.ga[f-1+m])&&gc(this,this.ga[f],this.ga[f+m])){n=!0;for(g=f;g<f+m;g++)if(null!=this.ga[g]){n=!1;break}for(g=f;g<f+m;g++)this.ga[g].rb=n?D.u:D.da}for(m=3;5>=m;m++)for(f=0;f+m<e;f++)if(gc(this,this.ga[f],this.ga[f+m]))for(g=f+1;g<f+m;g++)n=this.ga[g].rb,
null==n&&(this.ga[g].rb=D.da);for(f=0;f<e;f++)n=this.ga[f].rb,null==n&&(this.ga[f].rb=D.fa);this.Jg=!0}};function gc(e,f,g){f=e.v.findNode(f);return null==f?!1:f.nk(e.v.findNode(g))}z.Sd=function(e){void 0===e&&(e=!0);for(var f="",g=this.ga,h=0,k="\x00",n=this.vd()?"X":this.Ae()?"N":"-",m=g.length,q=0;q<m;q++){var r=g[q];if(e&&0!=q)for(h=r.qa()-h+r.ob().charCodeAt(0)-k.charCodeAt(0);1<h--;)f+=n;f+=r.Mi();h=r.qa();k=r.ob()}return f};z.Ae=function(){return"DNA"==this.type||"RNA"==this.type};
z.vd=function(){return"Protein"==this.type||"Peptide"==this.type||"Small Peptide"==this.type};z.$i=function(){return this.Ae()||this.vd()};z.Zi=function(){return"Ligand"===this.type};z.yj=function(e){var f=new qc,g=[];g.push(new rc(this.toString(),this.Sd(!1)));g.push(new rc("ExternalSequence",e));f=f.da(g);e=f.Sd("ExternalSequence");f=f.Sd(this.toString());console.log(e,f);this.fa=f;console.log(f.fa())};
function sc(e){for(var f=[],g=0,h=e.ga,k=0,n=0;n<h.length;n++){var m=h[n];if(null===m.type)k++;else{var q=f[m.type];void 0===q&&(q=0,f[m.type]=q,g++);f[m.type]++}}if(0!==g){var g=Infinity,r;for(q in f)h=f[q],0!==h&&h<g?(g=h,r=q):h===g&&q<r&&(r=q);g>=k&&("Protein"==r?(f=e.size(),e.type=20>f?"Small Peptide":60>f?"Peptide":"Protein"):e.type=r)}}function tc(){this._id=this.da=this.kc=this.Ea=this.rb=this.type=this.aa=null;this.Xb="\x00";this.u=[];this.sa=new ja;this.ya=this.fa=this.v=null}
function yc(e,f){e.da=f.Jb;e._id=f.tb;e.Xb=f.Lb}z=tc.prototype;z.dc=function(){return this.Ea.dc()};function ec(e,f){e.Ea=f;null!==f&&void 0!==f&&e.ae(f.qa())}z.qa=function(){return this._id};z.Oc=function(e){if(this._id!=e){this._id=e;for(var f=0;f<this.u.length;f++)Za(this.u[f],e)}};z.ob=function(){return this.Xb};z.Wc=function(){return this.kc};z.Le=function(e){if(this.kc!=e){this.kc=e;for(var f=this.u.length,g=0;g<f;g++)g.Le(e)}};z.we=function(){return this.da};
z.ae=function(e){if(this.da!=e){this.da=e;null!==this.Ea&&this.Ea.Oc(e);for(var f=this.u.length,g=0;g<f;g++)g.ae(e)}};z.add=function(e){null===e&&console.warn("atom = null in Residue");null!==e.pb()&&e.pb()!==this&&console.warn(e," already belongs to ",e.pb());if(null===e.pb()){this.u.push(e);var f=new Fc(e.name,e.md);this.sa.Gc(f)||this.sa.set(f,e);e.Fa=this;null!==this&&(Za(e,e.Fa.qa()),ib(e,e.Fa.ob()),e.Le(e.Fa.Wc()),e.ae(e.Fa.we()))}};
z.remove=function(e){null===e&&console.warn("atom = null in Residue");if(e.pb()===this){this.u.remove(e);var f=new this.yb(e.name,e.md);this.sa.remove(f,e)}};z.xa=function(){return this.u};z.ck=function(e){for(var f=0;f<this.u.length;f++){var g=this.u[f];if(g.qa()==e)return g}return null};z.gc=function(e){var f=void 0;void 0===f&&(f="\x00");e=this.sa.get(new Fc(e,f));if(null!==e)return e};
z.Ma=function(){if(null==this.v){this.v=new THREE.Vector3;for(var e=this.u.length,f=0;f<e;f++){var g=this.u[f].pos;this.v.x+=g.x;this.v.y+=g.y;this.v.z+=g.z}this.v.x/=e;this.v.y/=e;this.v.z/=e}return this.v};
z.hh=function(){if(null==this.fa)for(var e=this.u.length,f=0;f<e;f++){var g=this.u[f];if("CA"===g.name){this.fa=g.pos.clone();break}}if(null==this.fa){for(var h=this.Ma(),k=this.u[0],n=h.distanceTo(k.pos),e=this.u.length,f=0;f<e;f++){var g=this.u[f],m=h.distanceTo(g.pos);m<n&&(k=g,n=m)}this.fa=k.clone()}return this.fa};
z.nc=function(){if(null===this.ya){for(var e=new THREE.Vector3(Infinity,Infinity,Infinity),f=new THREE.Vector3(-Infinity,-Infinity,-Infinity),g=this.u.length,h=0;h<g;h++){var k=this.u[h];e.x=Math.min(e.x,k.pos.x);e.y=Math.min(e.y,k.pos.y);e.z=Math.min(e.z,k.pos.z);f.x=Math.max(f.x,k.pos.x);f.y=Math.max(f.y,k.pos.y);f.z=Math.max(f.z,k.pos.z)}this.ya=new ab(e,f)}return this.ya};z.Ae=function(){return"DNA"==this.type||"RNA"==this.type};
z.vd=function(){return"Protein"==this.type||"Peptide"==this.type||"Small Peptide"==this.type};
z.Mi=function(){switch(null!==this.aa?this.aa:this.kc){case "GLY":return"G";case "ALA":return"A";case "VAL":return"V";case "LEU":return"L";case "ILE":return"I";case "PRO":return"P";case "PHE":return"F";case "MET":return"M";case "TRP":return"W";case "SER":return"S";case "THR":return"T";case "ASN":return"N";case "GLN":return"Q";case "ASP":return"D";case "GLU":return"E";case "CYS":return"C";case "TYR":return"Y";case "HIS":return"H";case "LYS":return"K";case "ARG":return"R";case "ASX":return"B";case "GLX":return"Z";
case "A":case "DA":case "+A":return"A";case "C":case "DC":case "+C":return"C";case "G":case "DG":case "+G":return"G";case "T":case "DT":case "+T":return"T";case "U":case "DU":case "+U":return"U";case "I":case "DI":case "+I":return"I"}return null!=this.Ea.type&&"Protein"===this.Ea.type?"X":null==this.Ea.type||"RNA"!==this.Ea.type&&"DNA"!==this.Ea.type?"?":"N"};z.toString=function(){return this.kc+":"+this._id};z.wb=function(){return this.kc+":"+this._id+":"+this.da};
z.Ic=function(){return this.Ea.Ic()+":"+this.toString()};function Fc(e,f){this.name=e;this.md=f}Fc.prototype.toString=function(){return this.name+":"+this.md};Fc.prototype.wb=function(){return this.name+":"+this.md};
function Gc(e,f){null===e.aa&&console.warn("Error : stdResName must be set before guessing residue type");if(-1!==Hc.indexOf(e.aa))e.type="DNA";else if(-1!==Ic.indexOf(e.aa))e.type="RNA";else if(-1!==Oc.indexOf(e.aa))e.type="Protein";else if(-1!==Pc.indexOf(e.Wc()))e.type="Solvent";else if(-1!==Tc.indexOf(e.Wc()))e.type=null;else{var g=f.get(e.qa());null!=g&&g.name.endsWith(" ION")&&(e.type="Ion");e.type="Ligand"}}
var Oc="GLY ALA VAL LEU ILE PRO PHE MET TRP SER THR ASN GLN ASP GLU CYS TYR HIS LYS ARG".split(" "),Ic=["A","C","G","U","I"],Hc="DA DC DG DT DI DU +A +C +G +T +I +U T".split(" "),Tc="UNK ASX GLX N DN UNL UNX".split(" "),Pc=["HOH","DOD","GOL","EDO"];
function Uc(e,f,g){null===e&&console.warn("chainId null in Residue.Id");this.Jb=e;this.tb=f;this.Lb=g;this.toString=function(){return"\x00"!==this.Lb.charCodeAt(0)?this.Jb+":"+this.tb+":"+this.Lb:this.Jb+":"+this.tb};this.wb=function(){return"\x00"!==this.Lb.charCodeAt(0)?this.Jb+":"+this.tb+":"+this.Lb:this.Jb+":"+this.tb}}function D(e,f){this.name=e;this.code=f}D.fa=new D("Coil"," ");D.da=new D("Turn","T");D.u=new D("Helix","H");D.aa=new D("Strand","x");D.v=new D("Strand","X");
D.prototype.toString=function(){return name};function Vc(){this.Lk=!0;this.ii=this._id=this.Ig=null;this.aa=[];this.ci=[];this.cf=new ja;this.$e=new ja;this.Jd=new ja;this.zj=[];this.v=[];this.da=new ja;this.u=null}z=Vc.prototype;z.Ma=function(){if(null===this.u){this.u=new THREE.Vector3;for(var e=this.v[0].aa,f=0;f<e.length;f++){var g=e[f].Ma();this.u.x+=g.x;this.u.y+=g.y;this.u.z+=g.z}this.u.x/=e.length;this.u.y/=e.length;this.u.z/=e.length}return this.u};z.dc=function(){return this.v[0].dc()};
z.qa=function(){return this._id};z.Oc=function(e){null==this._id&&(this.Ig=e);this._id=e};z.Ph=function(){};z.setDate=function(){};z.lj=function(e){this.ii=e};z.ll=function(){};z.li=function(e,f){null==(null==e?this.aa:this.aa[e])&&(this.aa[e]=f)};z.il=function(e){this.ci=e};z.add=function(e){null===e&&console.warn("Error on adding model to structure : model = NULL");null!=e.qc()&&e.qc()!=this&&console.warn(e," already belongs to ",e.qc());null==e.qc()&&(this.v.push(e),e.Me(this))};
z.remove=function(e){null===e&&console.warn("Error on removing structure");e.qc()==this&&(this.v.remove(e),e.Me(null))};z.Qf=function(){return this.v[0]};z.toString=function(){return this._id};z.wb=function(){return this.toString()};z.Ic=function(){return this.toString()};
z.Sj=function(e){this.cf.__proto__=ja.prototype;this.cf.Ze={}.hasOwnProperty;this.Jd.__proto__=ja.prototype;this.Jd.Ze={}.hasOwnProperty;this.$e.__proto__=ja.prototype;this.$e.Ze={}.hasOwnProperty;this.da.__proto__=ja.prototype;this.da.Ze={}.hasOwnProperty;for(var f=e.length,g=0;g<f;g++){var h=new nb;this.add(h);for(var k=e[g],n=k.length,m=0;m<n;m++){var q=new Ua;q.type=k[m][0];q.id=k[m][1];q.name=k[m][2];q.md=k[m][3];q.Le(k[m][4]);q.ae(k[m][5]);Za(q,k[m][6]);ib(q,k[m][7]);q.pos.x=k[m][8];q.pos.y=
k[m][9];q.pos.z=k[m][10];q.fa=k[m][11];q.sa=k[m][12];q.symbol=k[m][13];q.da=k[m][14];h.add(q)}}Wc(this)};
function Wc(e){var f=e.cf,g=e.$e,h=e.Jd,k=e.v,n=!1,m,q=k.length;for(m=0;m<q;m++){for(var r=k[m],t=[],x=r.xa(),w=x.length,E=0;E<w;E++){for(var F=x[E],G=void 0,I=void 0,I=0;I<t.length;I++){var C=t[I][0];if(C.qa()===F.v&&C.we()===F.we()&&C.ob().charCodeAt(0)===F.ob().charCodeAt(0)){G=C;break}}void 0===G&&(I=new Uc(F.we(),F.v,F.ob()),G=new tc,yc(G,I),G.Le(F.Wc()),C=f.get(I),G.aa=C?C.Wh:G.Wc(),Gc(G,g),C=h.get(I),null!=C?(n||(n=!0),G.rb=C):G.rb=D.fa,t.push([G,I]));G.add(F)}C=void 0;for(G=0;G<t.length;G++){x=
t[G][0];w=t[G][1];G=x;for(E=[];void 0!==G&&null!==G&&-1===E.indexOf(w)&&!G.vd()&&!G.Ae();)if(E.push(w),I=e.da.get(w),null!=I){for(var C=I.Da.Jb===w.Jb&&I.Da.tb===w.tb&&I.Da.Lb===w.Lb?I.rc:I.Da,K,I=0;I<t.length;I++)G=t[I],C.Jb===G.Jb&&C.tb===G.tb&&C.Lb===G.Lb&&(K=I);G=t[K][0]}void 0!==G&&G.type!==x.type&&(x.type=G.type)}G=[];for(I=0;I<t.length;I++){var C=t[I][0],x=C.we(),w=C.type+" "+x,H=G[w];void 0===H&&(H=new Fb(x),r.add(H),G[w]=H);H.add(C);H.Jg=n}for(H in G)r=G[H],r.ga.sort(function(e,f){return e.Eg<
f.Eg?-1:e.Eg>f.Eg?1:e._id<f._id?-1:e._id>f._id?1:e.Xb<f.Xb?-1:e.Xb>f.Xb?1:0}),sc(r)}};

function cd(e,f){return ea[e]=f}ha.prototype.rd=cd(2,function(){throw Error("Trying to call an abstract method");});ja.prototype.rd=cd(1,function(e){for(var f in this.ia)if(this.ia[f]===e)return f});La.prototype.rd=cd(0,function(e){for(var f in this.ia)if(this.ia[f].value===e)return this.ia[f].key});function dd(e){var f=[],g;for(g in e.Ff)f.push(g);return f}var ed=ed||{};ed.Vb=ed.Vb||{};ed.Vb.Ej=function(){return this.Ef||this.Df};
ed.Vb.Bj=function(){if(this.Ef)return document.webkitIsFullScreen;if(this.Df)return document.mozFullScreen;console.assert(!1)};ed.Vb.request=function(e){e=e||document.body;this.Ef?e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):this.Df?e.mozRequestFullScreen():console.assert(!1)};ed.Vb.cancel=function(){this.Ef?document.webkitCancelFullScreen():this.Df?document.mozCancelFullScreen():console.assert(!1)};ed.Vb.Ef="webkitCancelFullScreen"in document?!0:!1;
ed.Vb.Df="mozCancelFullScreen"in document?!0:!1;
ed.Vb.Fj=function(e){function f(){ed.Vb.Bj()?(fd(n),null!=n.Mf?n.contextMenu.moveTo(n.Mf):n.contextMenu.moveTo(n.Yg),ed.Vb.cancel()):(fd(n),null!=n.Mf&&n.contextMenu.moveTo(n.Yg),ed.Vb.request(k))}e=e||{};var g=e.charCode||102,h=void 0!==e.dblclick?e.dblclick:!1,k=e.element,n=e.ba;document.addEventListener("keypress",function(e,f){return function(){return e.apply(f,arguments)}}(function(e){e.which===g&&f()},this),!1);h&&document.addEventListener("dblclick",f,!1)};ed=ed||{};
ed.ge=function(e,f,g,h){function k(){var k=null,r=null;null==f?(k=window.v,r=window.u):(k=f.width(),r=f.height());if(n!==k||m!==r)n=k,m=r,e.setSize(n,m),null!=g&&(g instanceof THREE.PerspectiveCamera?(g.aspect=n/m,g.fov=id(h,g),g.updateProjectionMatrix()):g instanceof THREE.OrthographicCamera?(g.left=-n/2,g.right=n/2,g.top=m/2,g.bottom=-m/2,g.updateProjectionMatrix()):console.warn("Unknown camera type"))}var n,m;window.addEventListener("resize",k,!1);return{stop:function(){window.removeEventListener("resize",
k)}}};ed.ge.bind=function(e,f,g,h){return ed.ge(e,f,g,h)};ed=ed||{};
ed.Nl=function(){var e=document.createElement("div");e.style.cssText="width:80px;opacity:0.9;cursor:pointer";var f=document.createElement("div");f.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#200;";e.appendChild(f);var g=document.createElement("div");g.style.cssText="color:#f00;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px";g.innerHTML="WebGLRenderer";f.appendChild(g);for(var h=[],g=0;9>g;g++)h[g]=document.createElement("div"),h[g].style.cssText=
"color:#f00;background-color:#311;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",f.appendChild(h[g]),h[g].innerHTML="-";var k=Date.now();return{domElement:e,update:function(e){console.assert(e instanceof THREE.WebGLRenderer);if(!(Date.now()-k<1E3/30)){k=Date.now();var f=0;h[f++].textContent="== Memory =====";h[f++].textContent="Programs: "+e.info.memory.programs;h[f++].textContent="Geometries: "+e.info.memory.geometries;h[f++].textContent="Textures: "+e.info.memory.textures;
h[f++].textContent="== Render =====";h[f++].textContent="Calls: "+e.info.render.calls;h[f++].textContent="Vertices: "+e.info.render.vertices;h[f++].textContent="Faces: "+e.info.render.faces;h[f++].textContent="Points: "+e.info.render.points}}}};function jd(){Element.call(this);this.Xi=!0;this.lc=this.Bc=null;this.Af=!1}jd.prototype=Object.create(Element.prototype);jd.prototype.constructor=jd;jd.prototype.sd=function(){return this.lc};
function kd(e,f){if(e.Bc===f)return e.lc;if(e.lc===f)return e.Bc;console.warn(e.Bc,NaN+e.lc+":"+f);console.warn("Node "+f+" is not part of edge "+e.qa())}jd.prototype.toString=function(){var e;e=""+this.Bc;e=this.Af?e+"->":e+"--";return e+=this.lc};function Element(){this.Hd=this._id=null;this.Cg=[]}Element.prototype.qa=function(){return this._id};Element.prototype.getAttributes=function(){return this.Cg};Element.prototype.getAttribute=function(e){return this.Cg[e]};
Element.prototype.setAttribute=function(e,f){this.Cg[e]=f};function vb(){this.aa=this.da=0;this.ne=new ja;this.u=new ja;this.v=new ja;this.fd=new ja}z=vb.prototype;z.clear=function(){this.ne.clear();this.u.clear();this.v.clear();this.fd.clear()};z.Kj=function(){this.u.clear();this.fd.clear()};
z.Ng=function(e,f){void 0===f&&(f=null);var g=new Node,h=f;void 0!==e&&(g._id=e);void 0!==this&&(g.Hd=this);void 0!==h&&null!==h&&(g.Fd=h);null==g&&console.warn("Error : node undefined or null in Graph");g.Hd!==this&&console.warn("Error : node with id ",g," must belong to this in graph");h=this.ne.get(g.qa());null!=h&&h!==g?console.warn("Error : node with id ",g.qa()," already exists in graph"):(this.ne.set(g.qa(),g),this.v.Gc(g.Fd)||this.v.set(g.Fd,g));return g};
z.Gf=function(e){var f;do f=this.da++;while(null!=this.ne.get(f));return this.Ng(f,e)};z.values=function(){for(var e=[],f=this.ne.values(),g=f.length,h=0;h<g;h++)e.push(f[h].Fd);return e};z.findNode=function(e){return this.v.get(e)};
z.Lg=function(e,f,g){!0!==g&&(g=!1);var h;do h=this.aa++;while(null!=this.u.get(h));var k=g;!0!==k&&(k=!1);g=new jd;void 0!==h&&(g._id=h);void 0!==this&&(g.Hd=this);this===e.Hd&&this===f.Hd||console.warn("Error : nodes ",g.Bc,", ",g.lc," and edge ",h," must all be part of same graph ",this);g.Bc=e;g.lc=f;!0!==k&&(k=!1);g.Af=k;null===g&&console.warn("Error : edge is null in GRAPH");g.Hd!==this&&console.warn("Error : edge with id ",g," must belong to this in graph");e=this.u.get(g.qa());if(null!=e&&
e!==g)console.warn("Error : edge with id ",g.qa()," already exists in graph");else{this.u.set(g.qa(),g);e=[];e=e.concat(g.Bc);e=e.concat(g.lc);for(var n in e)f=this.fd.get(e[n]),null===f&&(f=[],this.fd.set(e[n],f)),f.push(g)}return g};z.al=function(e){!0!==e.Xi&&(e=this.u.get(e));var f=e;if(f.Xi?null!==f&&this.u.get(f.qa())===f:null==this.u.get(f))this.u.remove(e.qa()),f=this.fd.get(e.Bc),null!==f&&delete f[e],f=this.fd.get(e.lc),null!==f&&delete f[e]};
z.qd=function(){for(var e=[],f=this.u.values(),g=f.length,h=0;h<g;h++)e.push(f[h]);return e};function Node(){Element.call(this);this.Fd=null}Node.prototype=Object.create(Element.prototype);z=Node.prototype;z.constructor=Node;z.qd=function(){return this.Hd.fd.get(this)};z.Oi=function(e){a:{var f=this.qd();if(f)for(var g=f.length,h=0;h<g;h++)if(kd(f[h],this)===e){e=h;break a}e=void 0}return void 0!==e};
z.nk=function(e){a:{var f=this.qd();if(f)for(var g=f.length,h=0;h<g;h++){var k=f[h];if(k.Af&&k.Bc===e&&k.sd()===this){e=k;break a}}e=void 0}return void 0!==e};z.toString=function(){return this.qa()};z.wb=function(){return this.qa()};z.gk=function(e){var f=this.qd();if(f)for(var g=f.length,h=0;h<g;h++){var k=f[h];if(k.Af&&k.Bc==this&&k.sd()==e)return k}};
function ab(e,f){this.u=Array(8);this.u[0]=new THREE.Vector3(e.x,e.y,e.z);this.u[1]=new THREE.Vector3(f.x,e.y,e.z);this.u[2]=new THREE.Vector3(e.x,f.y,e.z);this.u[3]=new THREE.Vector3(e.x,e.y,f.z);this.u[4]=new THREE.Vector3(f.x,f.y,e.z);this.u[5]=new THREE.Vector3(f.x,e.y,f.z);this.u[6]=new THREE.Vector3(e.x,f.y,f.z);this.u[7]=new THREE.Vector3(f.x,f.y,f.z)}z=ab.prototype;z.applyMatrix4=function(e){for(var f=this.u.length,g=0;g<f;g++)this.u[g].applyMatrix4(e);return this};
z.ye=function(){for(var e=this.u[0].clone(),f=this.u.length,g=1;g<f;g++)e.min(this.u[g].clone());return e};z.xe=function(){for(var e=this.u[0].clone(),f=this.u.length,g=1;g<f;g++)e.max(this.u[g].clone());return e};function ld(e){var f=e.ye();e=e.xe();return f.add(e).multiplyScalar(.5)}z.length=function(){return md(this).length()};function md(e){var f=e.ye();return e.xe().sub(f)}z.merge=function(e){var f=this.ye(),g=this.xe();f.min(e.ye());g.max(e.xe());return new ab(f,g)};
z.clone=function(){return new ab(this.ye(),this.xe())};function nd(e){this.u=new ja;for(var f=e.length,g=0;g<f;g++){var h=e[g];this.u.set(h.getName(),h)}}nd.prototype.Sd=function(e){return this.u.get(e)};function rc(e,f){this.da=e;this.u=f;this.v=this.aa=null}function od(e,f){e.u=f;e.aa=null;e.v=null}rc.prototype.getName=function(){return this.da};function pd(e,f){if(null!==e.u&&(null===e.v&&qd(e),null!==e.v))return e.v[f];throw Error("Can't find index ",f," in sequence");}
rc.prototype.fa=function(){if(null!==this.u&&(null===this.aa&&qd(this),null!==this.aa))return this.aa[0];throw Error("Can't find index ",0," in sequence");};function qd(e){if(null!==e.u){var f=e.u.length;e.aa=Array(f);var g=0;e.v=Array(f);for(var h=0;h<f;h++){var k=e.u.charAt(h);"A"<=k&&"Z">=k||"a"<=k&&"z">=k?(e.aa[g]=h,e.v[h]=g,g++):e.v[h]=-1}e.aa=e.aa.slice(0,g)}else e.v=null}function qc(e){e?this.v=e:this.v=rd;this.u=null;this.fa=this.sa=NaN}
var Ad=new sd("ABCDEFGHIKLMNPQRSTVWXYZ",[[24,0,5,-3,0,-23,5,-8,-8,-4,-12,-7,-3,3,-2,-6,11,6,1,-36,0,-22,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[5,0,115,-32,-30,-8,-20,-13,-11,-28,-15,-9,-18,-31,-24,-22,1,-5,0,-10,0,-5,0],[-3,0,-32,47,27,-45,1,4,-38,5,-40,-30,22,-7,9,-3,5,0,-29,-52,0,-28,0],[0,0,-30,27,36,-39,-8,4,-27,12,-28,-20,9,-5,17,4,2,-1,-19,-43,0,-27,0],[-23,0,-8,-45,-39,70,-52,-1,10,-33,20,16,-31,-38,-26,-32,-28,-22,1,36,0,51,0],[5,0,-20,1,-8,-52,66,-14,-45,-11,-44,-35,4,-16,-10,
-10,4,-11,-33,-40,0,-40,0],[-8,0,-13,4,4,-1,-14,60,-22,6,-19,-13,12,-11,12,6,-2,-3,-20,-8,0,22,0],[-8,0,-11,-38,-27,10,-45,-22,40,-21,28,25,-28,-26,-19,-24,-18,-6,31,-18,0,-7,0],[-4,0,-28,5,12,-33,-11,6,-21,32,-21,-14,8,-6,15,27,1,1,-17,-35,0,-21,0],[-12,0,-15,-40,-28,20,-44,-19,28,-21,40,28,-30,-23,-16,-22,-21,-13,18,-7,0,0,0],[-7,0,-9,-30,-20,16,-35,-13,25,-14,28,43,-22,-24,-10,-17,-14,-6,16,-10,0,-2,0],[-3,0,-18,22,9,-31,4,12,-28,8,-30,-22,38,-9,7,3,9,5,-22,-36,0,-14,0],[3,0,-31,-7,-5,-38,-16,
-11,-26,-6,-23,-24,-9,76,-2,-9,4,1,-18,-50,0,-31,0],[-2,0,-24,9,17,-26,-10,12,-19,15,-16,-10,7,-2,27,15,2,0,-15,-27,0,-17,0],[-6,0,-22,-3,4,-32,-10,6,-24,27,-22,-17,3,-9,15,47,-2,-2,-20,-16,0,-18,0],[11,0,1,5,2,-28,4,-2,-18,1,-21,-14,9,4,2,-2,22,15,-10,-33,0,-19,0],[6,0,-5,0,-1,-22,-11,-3,-6,1,-13,-6,5,1,0,-2,15,25,0,-35,0,-19,0],[1,0,0,-29,-19,1,-33,-20,31,-17,18,16,-22,-18,-15,-20,-10,0,34,-26,0,-11,0],[-36,0,-10,-52,-43,36,-40,-8,-18,-35,-7,-10,-36,-50,-27,-16,-33,-35,-26,142,0,41,0],[0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-22,0,-5,-28,-27,51,-40,22,-7,-21,0,-2,-14,-31,-17,-18,-19,-19,-11,41,0,78,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]),Bd=new sd("ARNBDCQZEGHILKMFPSTWYVX*",[[1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,
-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,
-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,
-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,
-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,
-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,0,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,
-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,0]]),rd=Ad;
qc.prototype.da=function(e){if(0===e.length)return new nd;for(var f=e.length,g=0;g<f;g++){var h=e[g];od(h,h.u.toUpperCase())}if(2===e.length){var f=e[0].u,g=e[1].u,k=this.v.clone(),h=0;this.v===rd?h=10:this.v===Bd&&(h=100);for(var n=h,m=k.jb.length,q=0;q<m;q++)for(var r=k.jb[q].length,t=0;t<r;t++)k.jb[q][t]*=n;k=this.u=k;n=k.jb.length-1;m=0;q=k.jb.length;for(r=0;r<q;r++)for(t=0;t<=r;t++)r!==t&&(m+=k.jb[r][t]);this.sa=0>=-(m/((n*n-n)/2))?2*(10+Math.log(Math.min(f.length,g.length)))*h:2*(10+Math.log(Math.min(f.length,
g.length)));this.fa=.1*h;var h=f.length,k=g.length,x=this.aa(2,k),n=this.aa(h,k),w=[k];w.fill(0);for(var E=Number.MIN_VALUE,q=m=-1,r=0;r<h;r++){for(t=0;t<k;t++)if(0===r||0===t)x[1][t]=this.u.getValue(f.charAt(r),g.charAt(t)),0===r&&0!==t&&(x[1][t]-=Cd(this,r,h,2===w[t-1]),w[t]=2),0===t&&0!==r&&(x[1][t]-=Cd(this,t,k,1===w[t]),w[t]=1),n[r][t]=0;else{var F=x[0][t-1]+this.u.getValue(f.charAt(r),g.charAt(t)),G=x[1][t-1]-Cd(this,r,h,2===w[t-1]),I=x[0][t]-Cd(this,t,k,1===w[t]);x[1][t]=Math.max(Math.max(F,
G),I);if(x[1][t]===F)n[r][t]=1,w[t]=0;else if(x[1][t]===G)n[r][t]=3,w[t]=2;else if(x[1][t]===I)n[r][t]=2,w[t]=1;else throw"Error when filling traceback matrix";(r===h-1||t===k-1)&&x[1][t]>E&&(E=x[1][t],m=r,q=t)}t=x[0];x[0]=x[1];x[1]=t}w=x="";r=h-1;for(t=k-1;r>m&&0<=r;)x+=f.charAt(r),w+="-",r--;for(;t>q&&0<=t;)x+="-",w+=g.charAt(t),t--;for(;0<=r&&0<=t;)0<r&&3===n[r][t]?(x+="-",w+=g.charAt(t),t--):0<t&&2===n[r][t]?(x+=f.charAt(r),w+="-",r--):(x+=f.charAt(r),w+=g.charAt(t),r--,t--);for(;0<=r;)x+=f.charAt(r),
w+="-",r--;for(;0<=t;)x+="-",w+=g.charAt(t),t--;f=[x.split("").reverse().join(""),w.split("").reverse().join("")];od(e[0],f[0]);od(e[1],f[1]);e=new nd(e)}else throw"Alignment must be computed with only 2 sequences, for advanced alignement, use Bioviz Java";return e};qc.prototype.aa=function(e){var f=Array(e||0),g=e;if(1<arguments.length)for(var h=Array.prototype.slice.call(arguments,1);g--;)f[e-1-g]=this.aa.apply(this,h);return f};function Cd(e,f,g,h){return 0===f||f===g-1?0:h?e.fa:e.sa}
function sd(e,f){this.v=e;this.u=new ja;this.jb=f}sd.prototype.setValue=function(e){this.jb=e.slice(0)};sd.prototype.getValue=function(e,f){return this.u.Gc(e)&&this.u.Gc(f)?this.jb[this.u.get(e)][this.u.get(f)]:0};sd.prototype.clone=function(){var e=new sd;e.setValue(this.jb);var f=this.v;e.v=f;for(var g=f.length,h=0;h<g;h++)e.u.set(f[h],h);return e};function Dd(){this.aa=this.v=null;this.u=NaN}
function Ed(e,f){for(var g=[],h=e.ga.slice(0),k=f.u,n=e.Ma(),m=e.vd()?"CA":"C4'",q=k.length,r=0;r<q;r++)if("-"!=k.charAt(r)){var t=h[pd(f,r)].gc(m);if(null!==t){var x=new THREE.Vector3;x.subVectors(t.pos,n);g.push(x)}else g.push(null)}else g.push(null);return g}function Fd(e,f){return new rc((null!==e?e:"")+f.toString(),f.Sd(!1))}function Mb(e,f,g){this.ib=e;this.hb=f;this.Oa=new THREE.Vector3((e.x+f.x)/2,(e.y+f.y)/2,(e.z+f.z)/2);this.wa=[];this.zc=g;void 0===g&&(this.zc=32);this.jb=[]}z=Mb.prototype;
z.add=function(e){if(e.Ik){var f=e.getPoint().pos;Gd(this,f)||console.warn("Error : "+f+" can't fit into [ "+this.ib+" , "+this.hb+" ]");if(0===this.wa.length){if(this.jb.push(e),this.jb.length>this.zc){0!==this.wa.length&&console.warn("Error : This octant was already split ");this.wa.push(new Mb(new THREE.Vector3(this.ib.x,this.ib.y,this.ib.z),new THREE.Vector3(this.Oa.x,this.Oa.y,this.Oa.z),this.zc));this.wa.push(new Mb(new THREE.Vector3(this.Oa.x,this.ib.y,this.ib.z),new THREE.Vector3(this.hb.x,
this.Oa.y,this.Oa.z),this.zc));this.wa.push(new Mb(new THREE.Vector3(this.ib.x,this.Oa.y,this.ib.z),new THREE.Vector3(this.Oa.x,this.hb.y,this.Oa.z),this.zc));this.wa.push(new Mb(new THREE.Vector3(this.Oa.x,this.Oa.y,this.ib.z),new THREE.Vector3(this.hb.x,this.hb.y,this.Oa.z),this.zc));this.wa.push(new Mb(new THREE.Vector3(this.ib.x,this.ib.y,this.Oa.z),new THREE.Vector3(this.Oa.x,this.Oa.y,this.hb.z),this.zc));this.wa.push(new Mb(new THREE.Vector3(this.Oa.x,this.ib.y,this.Oa.z),new THREE.Vector3(this.hb.x,
this.Oa.y,this.hb.z),this.zc));this.wa.push(new Mb(new THREE.Vector3(this.ib.x,this.Oa.y,this.Oa.z),new THREE.Vector3(this.Oa.x,this.hb.y,this.hb.z),this.zc));this.wa.push(new Mb(new THREE.Vector3(this.Oa.x,this.Oa.y,this.Oa.z),new THREE.Vector3(this.hb.x,this.hb.y,this.hb.z),this.zc));for(var g in this.jb){e=this.jb[g];var h=e.getPoint().pos,k;for(k in this.wa)Gd(this.wa[k],h)&&this.wa[k].add(e)}}}else for(h in this.wa)if(Gd(this.wa[h],f)){this.wa[h].add(e);break}}else if(0<e.length)for(f in e)this.add(e[f])};
z.optimize=function(){if(0<this.wa.length){var e=0,f;for(f in this.wa){var g=this.wa[f];g.optimize();g.isEmpty()&&g.wa===[]&&(this.wa[f]=null,e++)}if(0!==e)if(e===this.wa.length)this.wa=[];else for(f in e=$.extend(!0,{},this.wa),this.wa=[],e)g=e[f],null!==g&&void 0!==g&&this.wa.push(g)}};z.isEmpty=function(){return 0===this.jb.length};function Gd(e,f){return f.x>=e.ib.x&&f.y>=e.ib.y&&f.z>=e.ib.z&&f.x<=e.hb.x&&f.y<=e.hb.y&&f.z<=e.hb.z}
z.fh=function(e,f){var g;if(g=!Gd(this,e)){g=this.ib;var h=this.hb,k=f*f;e.x<g.x?k-=(e.x-g.x)*(e.x-g.x):e.x>h.x&&(k-=(e.x-h.x)*(e.x-h.x));e.y<g.y?k-=(e.y-g.y)*(e.y-g.y):e.y>h.y&&(k-=(e.y-h.y)*(e.y-h.y));e.z<g.z?k-=(e.z-g.z)*(e.z-g.z):e.z>h.z&&(k-=(e.z-h.z)*(e.z-h.z));g=!(0<k)}if(g)return[];g=[];if(0!==this.wa.length)for(var n in this.wa)g=g.concat(this.wa[n].fh(e,f));else for(var m in this.jb)this.jb[m].getPoint().distanceTo(e)<=f&&g.push(this.jb[m]);return g};
z.trace=function(){var e=0;void 0===e&&(e=0);for(var f=0;f<e;f++)console.log(f==e-1?"\u2514-":"  ");console.log(this.toString()+": "+this.jb.length);if(null!==this.wa){e++;for(var g in this.wa)this.wa[g].trace(e)}};z.toString=function(){return"[("+this.ib.x+","+this.ib.y+","+this.ib.z+"),("+this.hb.x+","+this.hb.y+","+this.hb.z+")]"};function Nb(e){this.Ik=!0;this.hi=e}Nb.prototype.getPoint=function(){return this.hi};Nb.prototype.toString=function(){return this.hi.toString()};
function Hd(e,f,g,h){this.la=null;this.Wd=f;this.El=e;this.Dl=g;this.Hk=null!=h?h:!1;this.pg=new Worker("webworker.js");this.blob=null}
Hd.prototype.load=function(){var e=this;console.time("time for loading parsing on the webworker");return new Promise(function(f,g){e.pg.onmessage=function(h){h.ni=e.Dl;h.data instanceof Blob?e.blob=h.data:(h=JSON.parse(h.data),h.Lk?(h.__proto__=Vc.prototype,e.la=h,e.la.blob=e.blob):"error"===h.type?g(Error(h.msg)):(e.la.Sj(h),e.pg.terminate(),f(e.la)))};e.pg.postMessage([e.El,e.Wd,e.Hk])})};
var Id={atom:"#F5A99580",residue:"#CCFF00",molecule:"#FF66CC"},Jd={A:"#2424DC",B:"#AABDC0",C:"#00C500",D:"#5A00C1",E:"#96640A",F:"#F5A995",G:"#2EF7F0",H:"#C1C1BC",I:"#E8A432",J:"#0AFA0A",K:"#49C8C8",L:"#C8C80A",M:"#64C864",N:"#CB70BB",O:"#960096",P:"#531966",Q:"#173232",R:"#AA4664",S:"#7B7B7B",T:"#189A8F",U:"#F57B15",V:"#EA22EA",W:"#82B4BE",X:"#828282",Y:"#505050",Z:"#323232",0:"#7B7B7B",1:"#189A8F",2:"#F57B15",3:"#EA22EA",4:"#82B4BE",5:"#828282",6:"#505050",7:"#323232",8:"#A050FA",9:"#1EEA20"},Kd=
{A:"#FF3232",T:"#0A32FF",C:"#FFFF32",G:"#0AFF0A",U:"#FF32FF",DA:"#FF3232",DT:"#0A32FF",DC:"#FFFF32",DG:"#0AFF0A",DU:"#FF32FF"},Ld={SER:"#DAD0CC",LEU:"#008CB1",GLY:"#D6E9E5",ALA:"#69A0AC",LYS:"#DD524A",VAL:"#799CB4",THR:"#D0C2B0",ASP:"#82C56B",GLU:"#4EC4A4",PRO:"#315E87",ASN:"#E5E3DA",ARG:"#A73638",PHE:"#315E87",ILE:"#61818A",GLN:"#CFD0CD",TYR:"#72896E",CYS:"#72896E",HIS:"#6C6C67",MET:"#C8DBE8",TRP:"#356B84"},Md={H:"#FFFFFF",He:"#FADEC5",Li:"#7F3C3D",Be:"#000000",B:"#229262",C:"#AFAFAF",N:"#385E96",
O:"#B83839",F:"#FB9B27",Ne:"#000000",Na:"#38608E",Mg:"#72896E",Al:"#82C56B",Si:"#000000",P:"#FB9B27",S:"#F7B848",Cl:"#28FE28",Ar:"#000000",K:"#FADEC5",Ca:"#6C6C67",Sc:"#6C6C67",Ti:"#72896E",V:"#000000",Cr:"#6C6C67",Mn:"#6C6C67",Fe:"#FB9B27",Co:"#AAB844",Ni:"#6B5248",Cu:"#6B5248",Zn:"#6B5248"},Nd={Hydrophobic:"#FF0000",Hydrophilic:"#0000FF"},Od={"First residue":"#00FF00","Last residue":"#0000FF"},Pd={Coil:"#B4B4B4",Turn:"#FFB419",Helix:"#FF1919",Strand:"#1919FF"},Qd={AA_AROMATIC:"#CDCD4B",AA_CHARGED_NEG:"#FF1919",
AA_CHARGED_PLUS:"#1919FF",AA_CYSTEINE:"#FF7D0F",AA_GLYCINE:"#9696FF",AA_HYDROPHOB:"#AFAFAF",AA_POLAR_NEG:"#9B3737",AA_POLAR_PLUS:"#37379B",AA_PROLINE:"#FF9B9B",AccessibleSurface:"#C8641E",ALL_ATOMS:"#000000",ALL_RESIDUES:"#000000",ALL_SSE:"#000000",AlphaShapeSurface:"#C8641E",Antiparallel_Strand:"#1919FF",APOLAIRE:"#CFD0CD",ATOM_CARBON_CHAIN:"#AFAFAF",ATOM_CARBON_CYCLE:"#AFAF4B",ATOM_CHARGED_NEG:"#1919FF",ATOM_CHARGED_PLUS:"#1919FF",ATOM_POLAR_NEG:"#9B1919",ATOM_POLAR_PLUS:"#19199B",ATOM_S:"#FFFFFF",
AXIS:"#FFFFFF",BACKBONE:"#A0B4FA",Background:"#000000",BOND:"#1EEA2066",CHARGE_NEG:"#0000FF99",CHARGE_NEUTRAL:"#FFFFFF99",CHARGE_POS:"#FF000099",Coil:"#B4B4B4",CORE:"#FF6464",C_TERM:"#A73638",DELTA_NEG:"#0000B499",DELTA_POS:"#B4000099",FIX:"#315E87",FLEXIBLE:"#C8DBE8",HELIX_2:"#32B432",Helix:"#FF1919",HYDROGEN_BOND:"#FFFFFF33",INTERFACE:"#FFFFFF",MolecularSurface:"#C8641E",N_TERM:"#315E87",Parallel_Strand:"#1919FF",PCORE:"#3C321E",PE:"#F7B848B3",PLANE:"#FFFFFF1A",POLAIRE_F_AB_ANIONIQUE:"#38608E",
POLAIRE_F_AB_CATIONIQUE:"#A73638",POLAIRE_F_AB_NEUTRE:"#F6F7F0",POLAIRE_SANS_F_AB:"#F9B58F",PSURFACE:"#141496",RIM:"#1428FF",SELECTION:"#FDB45D",SSE_B:"#6A68E6",SSE:"#FB9B27",SSE_HA:"#DC5456",SSE_T:"#FAFAFA",STABLE:"#385E96",SURFACE:"#FF0000",Turn:"#FFB419",UNSTABLE:"#BA3938",VDW:"#008CB1E1",Void_mo:"#9BFAB4",Void_pi:"#BEFF64",Void_po:"#C8C8C8",Void_pp:"#787878",Void_pr:"#6464FF"},Rd={white:{r:1,g:1,b:1},black:{r:0,g:0,b:0},grey:{r:.5,g:.5,b:.5},lightgrey:{r:.7,g:.7,b:.7},darkgrey:{r:.3,g:.3,b:.3},
red:{r:1,g:0,b:0},darkred:{r:.5,g:0,b:0},lightred:{r:1,g:.5,b:.5},green:{r:0,g:1,b:0},darkgreen:{r:0,g:.5,b:0},lightgreen:{r:.5,g:1,b:.5},blue:{r:0,g:0,b:1},darkblue:{r:0,g:0,b:.5},lightblue:{r:.5,g:.5,b:1},yellow:{r:1,g:1,b:0},darkyellow:{r:.5,g:.5,b:0},lightyellow:{r:1,g:1,b:.5},cyan:{r:0,g:1,b:1},darkcyan:{r:0,g:.5,b:.5},lightcyan:{r:.5,g:1,b:1},magenta:{r:1,g:0,b:1},darkmagenta:{r:.5,g:0,b:.5},lightmagenta:{r:1,g:.5,b:1},orange:{r:1,g:.5,b:0},darkorange:{r:.5,g:.25,b:0},lightorange:{r:1,g:.75,
b:.5}},$a={Ac:"Actinium 7Act 20 f 89 [227] 2.15 2".split(" "),Al:"Aluminium 3 13 p 13 26.982 1.21 2".split(" "),Am:"Americium 7Act 20 f 95 [243] 1.8 2".split(" "),Sb:"Antimony 5 15 p 51 121.76 1.39 2".split(" "),Ar:"Argon 3 18 p 18 39.948 1.51 1.88".split(" "),As:"Arsenic 4 15 p 33 74.922 1.21 1.85".split(" "),At:"Astatine 6 17 p 85 [210] 1.21 2".split(" "),Ba:"Barium 6 2 s 56 137.327 2.15 2".split(" "),Bk:"Berkelium 7Act 20 f 97 [247] 1.54 2".split(" "),Be:"Beryllium 2 2 s 4 9.012 0.96 2".split(" "),
Bi:"Bismuth 6 15 p 83 208.98 1.48 2".split(" "),Bh:"Bohrium 7 7 d 107 [264] 1.5 2".split(" "),B:"Boron 2 13 p 5 10.811 0.83 2".split(" "),Br:"Bromine 4 17 p 35 79.904 1.21 1.85".split(" "),Cd:"Cadmium 5 12 d 48 112.411 1.54 1.58".split(" "),Cs:"Caesium 6 1 s 55 132.905 2.44 2".split(" "),Ca:"Calcium 4 2 s 20 40.078 1.76 2".split(" "),Cf:"Californium 7Act 20 f 98 [251] 1.83 2".split(" "),C:"Carbon 2 14 p 6 12.011 0.68 1.7".split(" "),Ce:"Cerium 6Lan 19 f 58 140.116 2.04 2".split(" "),Cl:"Chlorine 3 17 p 17 35.453 0.99 1.75".split(" "),
Cr:"Chromium 4 6 d 24 51.996 1.39 2".split(" "),Co:"Cobalt 4 9 d 27 58.933 1.26 2".split(" "),Cu:"Copper 4 11 d 29 63.546 1.32 1.4".split(" "),Cm:"Curium 7Act 20 f 96 [247] 1.69 2".split(" "),Ds:"Darmstadtium 7 10 d 110 [271] 1.5 2".split(" "),Db:"Dubnium 7 5 d 105 [262] 1.5 2".split(" "),Dy:"Dysprosium 6Lan 19 f 66 162.5 1.92 2".split(" "),Es:"Einsteinium 7Act 20 f 99 [252] 1.5 2".split(" "),Er:"Erbium 6Lan 19 f 68 167.26 1.89 2".split(" "),Eu:"Europium 6Lan 19 f 63 151.964 1.98 2".split(" "),Fm:"Fermium 7Act 20 f 100 [257] 1.5 2".split(" "),
F:"Fluorine 2 17 p 9 18.998 0.64 1.47".split(" "),Fr:"Francium 7 1 s 87 [223] 2.6 2".split(" "),Gd:"Gadolinium 6Lan 19 f 64 157.25 1.96 2".split(" "),Ga:"Gallium 4 13 p 31 69.723 1.22 1.87".split(" "),Ge:"Germanium 4 14 p 32 72.61 1.17 2".split(" "),Au:"Gold 6 11 d 79 196.967 1.36 1.66".split(" "),Hf:"Hafnium 6 4 d 72 178.49 1.75 2".split(" "),Hs:"Hassium 7 8 d 108 [269] 1.5 2".split(" "),He:"Helium 1 18 p 2 4.003 1.5 1.4".split(" "),Ho:"Holmium 6Lan 19 f 67 164.93 1.92 2".split(" "),H:"Hydrogen 1 1 s 1 1.008 0.23 1.09".split(" "),
In:"Indium 5 13 p 49 114.818 1.42 1.93".split(" "),I:"Iodine 5 17 p 53 126.904 1.4 1.98".split(" "),Ir:"Iridium 6 9 d 77 192.217 1.41 2".split(" "),Fe:"Iron 4 8 d 26 55.845 1.52 2".split(" "),Kr:"Krypton 4 18 p 36 83.8 1.5 2.02".split(" "),La:"Lanthanum 6Lan 19 f 57 138.906 2.07 2".split(" "),"Lr (Lw)":"Lawrencium 7 3 d 103 [262] 1.5 2".split(" "),Pb:"Lead 6 14 p 82 207.2 1.46 2.02".split(" "),Li:"Lithium 2 1 s 3 6.941 1.28 1.82".split(" "),Lu:"Lutetium 6 3 d 71 174.967 1.87 2".split(" "),Mg:"Magnesium 3 2 s 12 24.305 1.41 1.73".split(" "),
Mn:"Manganese 4 7 d 25 54.938 1.61 2".split(" "),Mt:"Meitnerium 7 9 d 109 [268] 1.5 2".split(" "),Md:"Mendelevium 7Act 20 f 101 [258] 1.5 2".split(" "),Hg:"Mercury 6 12 d 80 200.59 1.32 1.55".split(" "),Mo:"Molybdenum 5 6 d 42 95.94 1.54 2".split(" "),Nd:"Neodymium 6Lan 19 f 60 144.24 2.01 2".split(" "),Ne:"Neon 2 18 p 10 20.18 1.5 1.54".split(" "),Np:"Neptunium 7Act 20 f 93 [237] 1.9 2".split(" "),Ni:"Nickel 4 10 d 28 58.693 1.24 1.63".split(" "),Nb:"Niobium 5 5 d 41 92.906 1.64 2".split(" "),N:"Nitrogen 2 15 p 7 14.007 0.68 1.55".split(" "),
No:"Nobelium 7Act 20 f 102 [259] 1.5 2".split(" "),Os:"Osmium 6 8 d 76 190.23 1.44 2".split(" "),O:"Oxygen 2 16 p 8 15.999 0.68 1.52".split(" "),Pd:"Palladium 5 10 d 46 106.42 1.39 1.63".split(" "),P:"Phosphorus 3 15 p 15 30.974 1.05 1.8".split(" "),Pt:"Platinum 6 10 d 78 195.078 1.36 1.72".split(" "),Pu:"Plutonium 7Act 20 f 94 [244] 1.87 2".split(" "),Po:"Polonium 6 16 p 84 [210] 1.4 2".split(" "),K:"Potassium 4 1 s 19 39.098 2.03 2.75".split(" "),Pr:"Praseodymium 6Lan 19 f 59 140.908 2.03 2".split(" "),
Pm:"Promethium 6Lan 19 f 61 [145] 1.99 2".split(" "),Pa:"Protactinium 7Act 20 f 91 231.036 2 2".split(" "),Ra:"Radium 7 2 s 88 [226] 2.21 2".split(" "),Rn:"Radon 6 18 p 86 [222] 1.5 2".split(" "),Re:"Rhenium 6 7 d 75 186.207 1.51 2".split(" "),Rh:"Rhodium 5 9 d 45 102.906 1.42 2".split(" "),Rb:"Rubidium 5 1 s 37 85.468 2.2 2".split(" "),Ru:"Ruthenium 5 8 d 44 101.07 1.46 2".split(" "),Rf:"Rutherfordium 7 4 d 104 [261] 1.5 2".split(" "),Sm:"Samarium 6Lan 19 f 62 150.36 1.98 2".split(" "),Sc:"Scandium 4 3 d 21 44.956 1.7 2".split(" "),
Sg:"Seaborgium 7 6 d 106 [266] 1.5 2".split(" "),Se:"Selenium 4 16 p 34 78.96 1.22 1.9".split(" "),Si:"Silicon 3 14 p 14 28.086 1.2 2.1".split(" "),Ag:"Silver 5 11 d 47 107.868 1.45 1.72".split(" "),Na:"Sodium 3 1 s 11 22.991 1.66 2.27".split(" "),Sr:"Strontium 5 2 s 38 87.62 1.95 2".split(" "),S:"Sulphur 3 16 p 16 32.066 1.02 1.8".split(" "),Ta:"Tantalum 6 5 d 73 180.948 1.7 2".split(" "),Tc:"Technetium 5 7 d 43 [98] 1.47 2".split(" "),Te:"Tellurium 5 16 p 52 127.6 1.47 2.06".split(" "),Tb:"Terbium 6Lan 19 f 65 158.925 1.94 2".split(" "),
Tl:"Thallium 6 13 p 81 204.383 1.45 1.96".split(" "),Th:"Thorium 7Act 20 f 90 232.038 2.06 2".split(" "),Tm:"Thulium 6Lan 19 f 69 168.934 1.9 2".split(" "),Sn:"Tin 5 14 p 50 118.71 1.39 2.17".split(" "),Ti:"Titanium 4 4 d 22 47.867 1.6 2".split(" "),W:"Tungsten 6 6 d 74 183.84 1.62 2".split(" "),U:"Uranium 7Act 20 f 92 238.029 1.96 1.86".split(" "),V:"Vanadium 4 5 d 23 50.942 1.53 2".split(" "),Xe:"Xenon 5 18 p 54 131.29 1.5 2.16".split(" "),Yb:"Ytterbium 6Lan 19 f 70 173.04 1.87 2".split(" "),Y:"Yttrium 5 3 d 39 88.906 1.9 2".split(" "),
Zn:"Zinc 4 12 d 30 65.39 1.22 1.39".split(" "),Zr:"Zirconium 5 4 d 40 91.224 1.75 2".split(" "),Jc:function(e){return this[e[0].toUpperCase()+e.substr(1).toLowerCase()]}};
function Sd(e,f,g,h){var k=1;void 0!==h&&(k=h);var n=e.Uc();h=e.sb().length()/2;var m=new THREE.Matrix4;m.copy(e.matrixWorld);e=new THREE.Matrix4;e.makeTranslation(n.x,n.y,n.z);m.multiply(e);e=new THREE.Matrix4;e.makeTranslation(-m.elements[12],-m.elements[13],-m.elements[14]);e.multiply(f.scene.matrix);e.elements[14]=g?e.elements[14]-(1/k*h*2-f.camera.position.z):f.scene.matrix.elements[14];return e}
function Td(e,f,g,h){if(0===f.length)return null;var k=new THREE.Raycaster;k.linePrecision=.2;g=new THREE.Vector3(g,h,e.camera.near);k.setFromCamera(g,e.camera);e=k.intersectObjects(f);if(k=e.length){for(f=0;f<k;){g=e[f].object;for(h=!0;null!=g&&h;)h=g.visible,g=g.parent;if(h)break;f++}if(f<k){k=e[f].object;g=k.geometry;if(g instanceof THREE.Geometry)return g.vertices[e[f].face.a].pa;if(g instanceof THREE.BufferGeometry)return k.Ja.oa[g.attributes.atomIndex.array[null!=e[f].index?e[f].index:e[f].face.a]];
console.warn("Unknown type of geometry for raycasting real object")}}return null}function id(e,f){var g=NaN,h=Sd(e,e,!0),k=e.sb().clone(),g=md(k).length(),h=ld(k.applyMatrix4(h)),h=Math.abs(f.position.z-h.z)+.5*g,g=Math.max(Math.dh(2*Math.atan(g/(2*h))),Math.dh(2*Math.atan(Math.tan(2*Math.atan(g/(2*h))/2)/f.aspect)));isNaN(g)&&(g=Math.dh(2*Math.atan(Math.tan(Math.$k()/2)*f.aspect)));return g}
function Ud(e,f){var g=new THREE.SpriteMaterial({map:e});g.depthTest=!1;g.depthWrite=!1;var h=g.map.image.width,k=g.map.image.height,g=new THREE.Sprite(g);g.position.set(f.x,f.y,f.z);g.scale.set(h/40,k/40,1);return g}function Vd(e){this.geometry=new THREE.BufferGeometry;this.jc=[];this.af=e?[]:null;this.Gg=[];this.Kg=[];this.Qc=[];this.le=null}function Wd(e,f,g,h,k){e.jc.push(f,g,h);f=null!=k?k:new THREE.Color(1,1,1);e.Gg.push(f.r,f.g,f.b);f=new THREE.Vector2(0,1);e.Kg.push(f.x,f.y)}
function Xd(e,f,g,h){null!=e.af?e.af.push(f,g,h):console.warn("This BufferGeometry is not indexed")}Vd.prototype.ud=function(){this.le=Array(this.jc.length/3);this.le.fill(0);return this.le};THREE.BufferGeometry.prototype.ud=function(){var e=Array(this.attributes.position.count);e.fill(0);e=new Float32Array(e);this.addAttribute("highlight",new THREE.BufferAttribute(e,1))};
function Yd(e){null==e.le&&e.ud();var f=new Float32Array(e.jc);e.jc=void 0;e.geometry.addAttribute("position",new THREE.BufferAttribute(f,3));null!=e.af&&(f=new Uint32Array(e.af),e.geometry.setIndex(new THREE.BufferAttribute(f,1)),e.af=void 0);f=new Float32Array(e.Gg);e.Gg=void 0;f=new THREE.BufferAttribute(f,3);f.dynamic=!0;e.geometry.addAttribute("color",f);f=new Float32Array(e.le);e.le=void 0;e.geometry.addAttribute("highlight",new THREE.BufferAttribute(f,1));f=new Float32Array(e.Kg);e.Kg=void 0;
e.geometry.addAttribute("uv",new THREE.BufferAttribute(f,2));f=new Float32Array(e.Qc);e.Qc=void 0;e.geometry.addAttribute("atomIndex",new THREE.BufferAttribute(f,1));e.geometry.computeVertexNormals();e.geometry.normalizeNormals();return e.geometry}Math.$k=function(){return 22.5*Math.PI/180};Math.dh=function(e){return 180*e/Math.PI};THREE.Vector3.prototype.wb=function(){return this.x+":"+this.y+":"+this.z};
function Zd(e,f){var g=new THREE.Vector3;g.x=f.x*e.elements[0];g.y=f.x*e.elements[1];g.z=f.x*e.elements[2];g.x+=f.y*e.elements[4];g.y+=f.y*e.elements[5];g.z+=f.y*e.elements[6];g.x+=f.z*e.elements[8];g.y+=f.z*e.elements[9];g.z+=f.z*e.elements[10];return g}
function $d(e,f,g,h,k){var n=Math.sqrt(g*g+h*h+k*k);0==n&&(n=.01);g/=n;h/=n;k/=n;n=Math.sin(f);f=Math.cos(f);var m=1-f;e.elements[0]=m*g*g+f;e.elements[4]=m*g*h-n*k;e.elements[8]=m*g*k+n*h;e.elements[1]=m*h*g+n*k;e.elements[5]=m*h*h+f;e.elements[9]=m*h*k-n*g;e.elements[2]=m*k*g-n*h;e.elements[6]=m*k*h+n*g;e.elements[10]=m*k*k+f;e.elements[3]=0;e.elements[7]=0;e.elements[11]=0;e.elements[12]=0;e.elements[13]=0;e.elements[14]=0;e.elements[15]=1}
THREE.Matrix4.prototype.lerp=function(e,f,g){var h=new THREE.Matrix4;h.copy(e);h.elements[12]=e.elements[12]+g*(f.elements[12]-e.elements[12]);h.elements[13]=e.elements[13]+g*(f.elements[13]-e.elements[13]);h.elements[14]=e.elements[14]+g*(f.elements[14]-e.elements[14]);this.copy(h)};
THREE.Matrix4.prototype.slerp=function(e,f,g){var h=ae(e),h=e.normalize(h);e=ae(f);e=f.normalize(e);var k=h[0]*e[0]+h[1]*e[1]+h[2]*e[2]+h[3]*e[3];0>k&&(e[0]=-e[0],e[1]=-e[1],e[2]=-e[2],e[3]=-e[3],k=-k);f=1-g;var n=g;.1<1-k&&(n=Math.acos(k),k=1/Math.sin(n),f=Math.sin((1-g)*n)*k,n=Math.sin(g*n)*k);g=[];g.push(f*h[0]+n*e[0]);g.push(f*h[1]+n*e[1]);g.push(f*h[2]+n*e[2]);g.push(f*h[3]+n*e[3]);this.setFromQuaternion(g)};
function ae(e){var f=e.elements[0]+e.elements[5]+e.elements[10],g,h,k;if(0<=f){var n=Math.sqrt(f+1);k=.5*n;n=.5/n;f=(e.elements[9]-e.elements[6])*n;g=(e.elements[2]-e.elements[8])*n;h=(e.elements[4]-e.elements[1])*n}else e.elements[0]>e.elements[5]&&e.elements[0]>e.elements[10]?(n=Math.sqrt(1+e.elements[0]-e.elements[5]-e.elements[10]),f=.5*n,n=.5/n,g=(e.elements[4]+e.elements[1])*n,h=(e.elements[2]+e.elements[8])*n,k=(e.elements[9]-e.elements[6])*n):e.elements[5]>e.elements[10]?(n=Math.sqrt(1+e.elements[5]-
e.elements[0]-e.elements[10]),g=.5*n,n=.5/n,f=(e.elements[4]+e.elements[1])*n,h=(e.elements[9]+e.elements[6])*n,k=(e.elements[2]-e.elements[8])*n):(n=Math.sqrt(1+e.elements[10]-e.elements[0]-e.elements[5]),h=.5*n,n=.5/n,f=(e.elements[2]+e.elements[8])*n,g=(e.elements[9]+e.elements[6])*n,k=(e.elements[4]-e.elements[1])*n);return[f,g,h,k]}
THREE.Matrix4.prototype.setFromQuaternion=function(e){this.setPosition(new THREE.Vector3(0,0,0));var f=be(e),f=1==f?2:0<f?2/f:0,g=e[0]*f,h=e[1]*f,k=e[2]*f,f=e[0]*g,n=e[0]*h,m=e[0]*k,g=e[3]*g,q=e[1]*h,r=e[1]*k,h=e[3]*h,t=e[2]*k;e=e[3]*k;this.elements[0]=1-(q+t);this.elements[1]=n-e;this.elements[2]=m+h;this.elements[4]=n+e;this.elements[5]=1-(f+t);this.elements[6]=r-g;this.elements[8]=m-h;this.elements[9]=r+g;this.elements[10]=1-(f+q)};
function be(e){return e[3]*e[3]+e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}THREE.Matrix4.prototype.normalize=function(e){var f=1/Math.sqrt(be(e));e[0]*=f;e[1]*=f;e[2]*=f;e[3]*=f;return e};THREE.Vector3.prototype.lb=function(e,f){return new THREE.Vector3(this.x+e.x*f,this.y+e.y*f,this.z+e.z*f)};
THREE.Vector3.u=function(e,f,g){if(e.th&&f.th&&g.th){var h=new THREE.Vector3(f.x,f.y,f.z);h.sub(new THREE.Vector3(e.x,e.y,e.z));h.cross((new THREE.Vector3(g.x,g.y,g.z)).sub(new THREE.Vector3(f.x,f.y,f.z)))}else h=new THREE.Vector3,h.copy(f),h.sub(e),h.cross(g.clone().sub(f));return h};
THREE.Vector3.aa=function(e,f,g,h,k){var n=k*k,m=n*k;if(null===e||null===f||null===g||null===h)return null;var q=null,r=null,q=f.clone().sub(e).add(g.clone().sub(f)).multiplyScalar(.5),r=g.clone().sub(f).add(h.clone().sub(g)).multiplyScalar(.5);e=2*m-3*n+1;k=m-2*n+k;h=m-n;n=-2*m+3*n;return f.clone().multiplyScalar(e).lb(q,k).lb(r,h).lb(g,n)};THREE.Vector3.sc=function(e,f,g){return null===e|null===f?new THREE.Vector3:e.clone().multiplyScalar(1-g).lb(f,g)};
function ce(e,f,g){return Math.atan2(e.clone().dot(g),e.clone().dot(f))}THREE.Vector3.v=function(e,f,g){return e.clone().multiplyScalar(Math.cos(g)).lb(f,Math.sin(g))};function de(e){var f=Math.abs(e.x),g=Math.abs(e.y),h=Math.abs(e.z);return f<=g&&f<=h?e.clone().cross(new THREE.Vector3(1,0,0)).normalize():g<=f&&g<=h?e.clone().cross(new THREE.Vector3(0,1,0)).normalize():e.clone().cross(new THREE.Vector3(0,0,1)).normalize()}
function ee(e,f,g,h){var k=de(e);e=e.clone().cross(k).normalize();var n=f.length(),m=g.length();f=ce(f,k,e);g=ce(g,k,e);Math.abs(f-g)>Math.PI&&(g<f?g+=2*Math.PI:f+=2*Math.PI);g=THREE.Math.sc(f,g,h);h=THREE.Math.sc(n,m,h);return THREE.Vector3.v(k,e,g).multiplyScalar(h)}THREE.Color.sc=function(e,f,g){return null===e|null===f?null:e.clone().multiplyScalar(1-g).lb(f,g)};THREE.Color.prototype.lb=function(e,f){return new THREE.Color(this.r+e.r*f,this.g+e.g*f,this.b+e.b*f)};
THREE.Math.sc=function(e,f,g){return e*(1-g)+f*g};THREE.GeometryUtils.Xj=function(e,f,g,h,k,n,m,q,r,t,x,w,E,F,G,I){var C=k*f-e*n,K=r*f-e*t;e=E*f-e*F;f=r*n-k*t;k=E*n-k*F;r=E*t-r*F;return(r*m-k*x+f*G)*h-(r*g-e*x+K*G)*q+(k*g-e*m+C*G)*w-(f*g-K*m+C*x)*I};THREE.GeometryUtils.tl=function(e,f,g,h){return THREE.GeometryUtils.ul(e.x,e.y,e.z,e.weight,f.x,f.y,f.z,f.weight,g.x,g.y,g.z,g.weight,h.x,h.y,h.z,h.weight)};THREE.GeometryUtils.jf=function(e,f,g,h,k,n,m,q,r){return(e*k-h*f)*r-(e*q-m*f)*n+(h*q-m*k)*g};
THREE.GeometryUtils.Rc=function(e,f,g,h){return e*h-g*f};
THREE.GeometryUtils.ul=function(e,f,g,h,k,n,m,q,r,t,x,w,E,F,G,I){k=k-e;n=n-f;m=m-g;q=THREE.GeometryUtils.square(k)+THREE.GeometryUtils.square(n)+THREE.GeometryUtils.square(m)-q+h;r=r-e;t=t-f;x=x-g;w=THREE.GeometryUtils.square(r)+THREE.GeometryUtils.square(t)+THREE.GeometryUtils.square(x)-w+h;e=E-e;f=F-f;g=G-g;F=THREE.GeometryUtils.square(e)+THREE.GeometryUtils.square(f)+THREE.GeometryUtils.square(g)-I+h;I=THREE.GeometryUtils.jf(n,m,q,t,x,w,f,g,F);G=THREE.GeometryUtils.jf(k,m,q,r,x,w,e,g,F);q=THREE.GeometryUtils.jf(k,
n,q,r,t,w,e,f,F);k=THREE.GeometryUtils.jf(k,n,m,r,t,x,e,f,g);if(0===k)throw"den==0 in squared_radius_orthogonal_sphereC3_detailedParams";return(THREE.GeometryUtils.square(I)+THREE.GeometryUtils.square(G)+THREE.GeometryUtils.square(q))*THREE.GeometryUtils.square(.5/k)-h};THREE.GeometryUtils.square=function(e){return e*e};THREE.GeometryUtils.Qi=function(e,f,g,h){return THREE.GeometryUtils.Ak(e.x,e.y,e.z,e.weight,f.x,f.y,f.z,f.weight,g.x,g.y,g.z,g.weight,h.x,h.y,h.z,h.weight)};
THREE.GeometryUtils.Ak=function(e,f,g,h,k,n,m,q,r,t,x,w,E,F,G,I){k=k-e;n=n-f;m=m-g;r=r-e;t=t-f;x=x-g;var C=THREE.GeometryUtils.square(k)+THREE.GeometryUtils.square(n)+THREE.GeometryUtils.square(m),K=THREE.GeometryUtils.square(r)+THREE.GeometryUtils.square(t)+THREE.GeometryUtils.square(x),H=k*r+n*t+m*x,L=C-q+h,P=K-w+h;w=THREE.GeometryUtils.Rc(C,H,H,K);q=THREE.GeometryUtils.Rc(L,H,P,K);C=THREE.GeometryUtils.Rc(C,L,H,P);e=E-e;f=F-f;g=G-g;G=THREE.GeometryUtils.square(e)+THREE.GeometryUtils.square(f)+
THREE.GeometryUtils.square(g);if(0==w)throw"den==0 in in_sphere_detailedParams";return THREE.GeometryUtils.sign(w*(G-I+h)-q*(e*k+f*n+g*m)-C*(e*r+f*t+g*x))};THREE.GeometryUtils.sign=function(e){return 0<e?1:0>e?-1:0};
THREE.GeometryUtils.wl=function(e,f,g,h,k,n,m,q,r,t,x,w){k=k-e;n=n-f;m=m-g;q=THREE.GeometryUtils.square(k)+THREE.GeometryUtils.square(n)+THREE.GeometryUtils.square(m)-q+h;e=r-e;f=t-f;g=x-g;var E=THREE.GeometryUtils.square(e)+THREE.GeometryUtils.square(f)+THREE.GeometryUtils.square(g)-w+h;t=n*g-m*f;r=m*e-k*g;var F=k*f-n*e;w=q*THREE.GeometryUtils.Rc(f,g,r,F)-E*THREE.GeometryUtils.Rc(n,m,r,F);x=q*THREE.GeometryUtils.Rc(e,g,t,F)-E*THREE.GeometryUtils.Rc(k,m,t,F);q=q*THREE.GeometryUtils.Rc(e,f,t,r)-E*
THREE.GeometryUtils.Rc(k,n,t,r);k=THREE.GeometryUtils.jf(k,n,m,e,f,g,t,r,F);if(0==k)throw"den==0";return(THREE.GeometryUtils.square(w)+THREE.GeometryUtils.square(x)+THREE.GeometryUtils.square(q))*THREE.GeometryUtils.square(.5/k)-h};THREE.GeometryUtils.vl=function(e,f,g){return THREE.GeometryUtils.wl(e.x,e.y,e.z,e.weight,f.x,f.y,f.z,f.weight,g.x,g.y,g.z,g.weight)};
function fe(e,f){this.ba=e;this.div=f;this.menu=null;this.sa=!1;this.Id();this.ya=this.Da=this.da=this.u=this.aa=this.Fa=this.v=this.fa=null;this.pe=this.qe=!1;this.ca=this.ba.ca;this.scene3D=this.ca.scene3D}fe.prototype.moveTo=function(e){this.menu.getMenu().detach().appendTo(e)};
fe.prototype.Id=function(){var e=this,f=ge(this),g=he(this),h=ie(this),k=je(this),n=ke(),m=le(this),q={title:"Move",cmd:"move"},r={title:"Reset&nbspposition",cmd:"resetPos"},t={title:"Center",cmd:"center"},x={title:"Zoom",cmd:"zoom"},w={title:"As&nbsprotation&nbspanchor",cmd:"anchor"},E={title:"Structure&nbspname",cmd:"labelStr"},F={title:"Molecule&nbspname",cmd:"labelMol"},G={title:"Residue&nbspname",cmd:"labelRes"},I={title:"Atom&nbspname",cmd:"labelAtom"},C={title:"vdW",cmd:"labelVdw"},K={title:"Clear",
cmd:"labelClear"},H={title:"Remove",cmd:"remove"},L=this.ba.Zh,L=L.split("${id}")[0];this.menu=this.div.contextmenu({delegate:".hasContextMenu",autoTrigger:!1,preventContextMenuForPopup:!0,menu:[{title:"File",children:[{title:"Load",cmd:"load",children:[{title:"Load&nbspURL",cmd:"loadUrl"},{title:"Load&nbspFrom&nbsp"+L,cmd:"loadPDB"},{title:"Load&nbspFrom&nbspLocal&nbspFile",cmd:"loadFile"},{title:"Load&nbspScript",cmd:"loadScript"},{title:"Load&nbspScript&nbspFile",cmd:"loadScriptFile"}]},{title:"Save",
cmd:"save"},{title:"Export&nbspFile",cmd:"export"},{title:"Options",cmd:"options"},{title:"Reset",cmd:"reset"}]},{title:"Model",cmd:"model",children:[{title:"Clear&nbsprotation&nbspanchor",cmd:"clearAnchor"},{title:"Manage&nbsprepresentations",cmd:"manageRep"}]},{title:"Tools",children:[{title:"Legend",cmd:"legend"},{title:"Stereoscopy",cmd:"stereo"},{title:"Anaglyph",cmd:"anaglyph"},{title:"Zoom",children:[{title:"25%",cmd:"zoom25"},{title:"50%",cmd:"zoom50"},{title:"100%",cmd:"zoom100"},{title:"200%",
cmd:"zoom200"},{title:"400%",cmd:"zoom400"}]},{title:"Spin",cmd:"spin"},{title:"Measurements",cmd:"measurements"}]},{title:"About",children:[{title:"BiovizJS",cmd:"biovizJS"},{title:"System",cmd:"System"}]}],position:function(e){return{my:"left top",at:"left+"+e.extraData.pageX+" top+"+e.extraData.pageY,of:parent.$(document),collision:e.extraData.Yi?"none":"fit"}},beforeOpen:function(f){e.aa=f.extraData.target;null!==e.aa?(f=e.ba.ca,e.Fa=e.aa.pb(),e.v=e.Fa.Ea,e.fa=e.v.qc(),e.u=f.cb(e.fa.qa())[0],
e.da=me(f,e.fa.qa(),e.v.type,e.v.id)[0],e.div.contextmenu("setEntry","model",{title:"Model",cmd:"model",children:[{title:"Clear&nbsprotation&nbspanchor",cmd:"clearAnchor"},{title:"----"},{title:e.fa.toString(),cmd:"structure",children:[q,r,w,{title:"----"},t,x,{title:"----"},{title:"Labels",children:[E,F,G,I,C,{title:"----"},K]},{title:"----"},H]},{title:e.v.toString(),cmd:"molecule",children:[q,r,w,{title:"----"},t,x,{title:"----"},{title:"Labels",children:[F,G,I,C,{title:"----"},K]}]},{title:e.Fa.toString(),
cmd:"residue",children:[w,{title:"----"},t,x,{title:"----"},{title:"Labels",children:[G,I,C,{title:"----"},K]}]},{title:e.aa.toString(),cmd:"atom",children:[w,{title:"----"},t,x,{title:"----"},{title:"Labels",children:[I,C,{title:"----"},K]}]},{title:"----"},{title:"Manage&nbsprepresentations",cmd:"manageRep"}]})):e.div.contextmenu("setEntry","model",{title:"Model",cmd:"model",children:[{title:"Clear&nbsprotation&nbspanchor",cmd:"clearAnchor"},{title:"Manage&nbsprepresentations",cmd:"manageRep"}]})},
select:function(q,r){q.stopPropagation();switch(r.cmd){case "loadUrl":e.sa=!0;f.dialog("open");break;case "loadPDB":e.sa=!1;f.dialog("open");break;case "loadFile":g.dialog("open");break;case "loadScript":h.dialog("open");break;case "loadScriptFile":k.dialog("open");break;case "reset":e.scene3D.reset();break;case "save":n.dialog("open");break;case "options":m.dialog("open");break;case "export":n.dialog("open");break;case "legend":ne(e.ba.uf,"Legend");break;case "stereo":e.qe=!e.qe;e.pe=e.ca.qe(e.qe);
break;case "anaglyph":e.pe=!e.pe;e.qe=e.ca.pe(e.pe);break;case "zoom25":case "zoom50":case "zoom100":case "zoom200":case "zoom400":var t=r.cmd.split("zoom").pop()/100,w=e.ca;w.v=t;oe(w,null!=w.Ia?w.Ia:w.scene3D,!0);break;case "spin":null===e.ca.ce?e.ca.kg():e.ca.rf();break;case "measurements":ne(e.ba.uf,"MeasureWidget");break;case "biovizJS":n.dialog("open");break;case "System":n.dialog("open");break;case "move":w=r.item.context.parentElement.parentElement.dataset.command;switch(w){case "structure":e.ca.Ya=
e.u;e.scene3D.ca.Ia=e.u;break;case "molecule":e.ca.Ya=e.da;e.scene3D.ca.Ia=e.da;break;default:throw Error("Parent command type "+w+" is not handled");}break;case "resetPos":w=r.item.context.parentElement.parentElement.dataset.command;switch(w){case "structure":e.u.$d();break;case "molecule":e.da.$d();break;default:throw Error("Parent command type "+w+" is not handled");}break;case "clearAnchor":e.scene3D.ca.Ia=null;break;case "anchor":w=r.item.context.parentElement.parentElement.dataset.command;switch(w){case "structure":e.scene3D.ca.Ia=
e.u;break;case "molecule":e.scene3D.ca.Ia=e.da;break;case "residue":pe(e);e.scene3D.ca.Ia=e.Da;break;case "atom":qe(e);e.scene3D.ca.Ia=e.ya;break;default:throw Error("Parent command type "+w+" is not handled");}break;case "center":w=r.item.context.parentElement.parentElement.dataset.command;switch(w){case "structure":oe(e.ca,e.u);break;case "molecule":oe(e.ca,e.da);break;case "residue":pe(e);oe(e.ca,e.Da);break;case "atom":qe(e);oe(e.ca,e.ya);break;default:throw Error("Parent command type "+w+" is not handled");
}break;case "zoom":w=r.item.context.parentElement.parentElement.dataset.command;switch(w){case "structure":re(e.ca.scene3D,e.u);break;case "molecule":re(e.ca.scene3D,e.da);break;case "residue":pe(e);re(e.ca.scene3D,e.Da);break;case "atom":qe(e);re(e.ca.scene3D,e.ya);break;default:throw Error("Parent command type "+w+" is not handled");}break;case "remove":se(e.ca,e.u);break;case "labelStr":w=r.item.context.parentElement.parentElement.parentElement.parentElement.dataset.command;te(e,w);var x;"structure"===
w&&(x=e.fa);e.u.Ob(x,M.u.zf);break;case "labelMol":w=r.item.context.parentElement.parentElement.parentElement.parentElement.dataset.command;te(e,w);"molecule"===w&&(x=e.v);e.u.Ob(x,M.u.Wb);break;case "labelRes":w=r.item.context.parentElement.parentElement.parentElement.parentElement.dataset.command;te(e,w);switch(w){case "structure":break;case "molecule":x=e.v;break;case "residue":x=e.Fa;break;default:throw Error("Parent command type "+w+" is not handled");}e.u.Ob(x,M.u.Hb);break;case "labelAtom":w=
r.item.context.parentElement.parentElement.parentElement.parentElement.dataset.command;te(e,w);switch(w){case "structure":e.u.Ob(void 0,M.u.Wa);break;case "molecule":e.u.Ob(e.v,M.u.Wa);break;case "residue":e.u.Ob(e.Fa,M.u.Wa);break;case "atom":e.u.Ob(e.aa,M.u.Wa);break;default:throw Error("Parent command type "+w+" is not handled");}break;case "labelVdw":w=r.item.context.parentElement.parentElement.parentElement.parentElement.dataset.command;te(e,w);switch(w){case "structure":e.u.Ob(void 0,M.u.yc);
break;case "molecule":e.u.Ob(e.v,M.u.yc);break;case "residue":w=e.Fa.xa();for(t in w)e.u.Ob(w[t],M.u.yc);break;case "atom":e.u.Ob(e.aa,M.u.yc);break;default:throw Error("Parent command type "+w+" is not handled");}break;case "labelClear":w=r.item.context.parentElement.parentElement.parentElement.parentElement.dataset.command;te(e,w);break;case "manageRep":ne(e.ba.uf,"RepresentationManager");e.ba.uf.Ue.RepresentationManager.Ug(e.aa);break;default:throw Error("Command "+r.cmd+" not handled by ContextMenu");
}}}).contextmenu("instance")};function te(e,f){switch(f){case "structure":ue(e.u);break;case "molecule":ue(e.u,e.da);ue(e.u,e.da.ta.ga);ue(e.u,e.da.ta.xa());break;case "residue":ue(e.u,e.Fa);ue(e.u,e.Fa.xa());break;case "atom":ue(e.u,e.aa);break;default:throw Error("Parent command type "+f+" is not handled");}}
function ge(e){var f,g,h;h='<div id="load-structure-dialog-form" title="Load New Structure"><p class="validateTips">All form fields are required.</p><form><fieldset>';h+='<label id ="structIDLabel" for="structID">Structure ID : </label>';h+='<input type="text" name="structID" id="structID" class="text ui-widget-content ui-corner-all">';h+="<br>";h+='<label for="isPDBX">Load PDBX : </label>';h+='<input type="checkbox" name="isPDBX" id="isPDBX" class="button ui-widget-content ui-corner-all" checked>';
h+='<input type="submit" tabindex="-1" style="position:absolute; top:-1000px">';h+="</fieldset>";h+="</form>";h+="</div>";$(h).appendTo(document.body);var k=$("#structID"),n=$("#isPDBX"),m=$([]).add(k).add(n);f=$("#load-structure-dialog-form").dialog({autoOpen:!1,height:250,width:300,modal:!0,position:{my:"center",at:"center",of:$("#content")},buttons:{"Load Structure":function(){m.removeClass("ui-state-error");if(!e.sa){var g=/^[a-z0-9]+$/i;if(4!=k.val().length||!g.test(k.val())){k.addClass("ui-state-error");
return}}e.ba.Wd=n.is(":checked");biovizAPI.Xc(k.val());f.dialog("close")},Cancel:function(){f.dialog("close")}},open:function(){e.sa?$("#structIDLabel").html("Structure URL : "):$("#structIDLabel").html("Structure ID : ")},close:function(){g[0].reset();m.removeClass("ui-state-error")}});g=f.find("form").on("submit",function(f){f.preventDefault();e.Xc()});return $("#load-structure-dialog-form")}
function he(e){var f,g,h;h='<div id="load-structure-file-dialog-form" title="Load New Structure"><p class="validateTips">All form fields are required.</p><form><fieldset>';h+='<label id ="structIDLabel" for="file">Structure file : </label>';h+='<input type="file" name="file" id="file">';h+="<br>";h+='<label for="isPDBX2">Load PDBX : </label>';h+='<input type="checkbox" name="isPDBX2" id="isPDBX2" class="button ui-widget-content ui-corner-all" checked>';h+='<input type="submit" tabindex="-1" style="position:absolute; top:-1000px">';
h+="</fieldset>";h+="</form>";h+="</div>";$(h).appendTo(document.body);var k=$("#isPDBX2");f=$("#load-structure-file-dialog-form").dialog({autoOpen:!1,height:250,width:300,modal:!0,position:{my:"center",at:"center",of:$("#content")},buttons:{"Load Structure":function(){var g=$("#file")[0].files,h=new FileReader;h.onload=function(){return function(g){e.ba.Wd=k.is(":checked");biovizAPI.Yf(g.target.result);f.dialog("close")}}(g);h.readAsText(g[0])},Cancel:function(){f.dialog("close")}},open:function(){e.sa?
$("#structIDLabel").html("Structure URL : "):$("#structIDLabel").html("Structure ID : ")},close:function(){g[0].reset()}});g=f.find("form").on("submit",function(f){f.preventDefault();e.Xc()});return $("#load-structure-file-dialog-form")}
function ie(e){var f,g,h;h='<div id="load-script-dialog-form" title="Load New Script"><form><fieldset><label id ="scriptLabel" for="script">Script (string or url) : </label>';h+='<input type="text" name="script" id="script" class="text ui-widget-content ui-corner-all">';h+="<br>";h+='<input type="submit" tabindex="-1" style="position:absolute; top:-1000px">';h+="</fieldset>";h+="</form>";h+="</div>";$(h).appendTo(document.body);var k=$("#script"),n=$([]).add(k);f=$("#load-script-dialog-form").dialog({autoOpen:!1,
height:250,width:300,modal:!0,position:{my:"center",at:"center",of:$("#content")},buttons:{"Load Script":function(){function g(h){try{ve(e.ba,h),f.dialog("close")}catch(m){k.addClass("ui-state-error"),console.warn("Didn't succeed to get script")}}n.removeClass("ui-state-error");var h=k.val();$.ajax({async:!0,crossDomain:!0,url:h,success:function(e){g(e)},error:function(){g(h)}})},Cancel:function(){f.dialog("close")}},close:function(){g[0].reset();n.removeClass("ui-state-error")}});g=f.find("form").on("submit",
function(f){f.preventDefault();e.yb()});return $("#load-script-dialog-form")}
function je(e){var f,g,h;h='<div id="load-local-script-dialog-form" title="Load New Script"><form><fieldset><label id ="scriptLabel" for="scriptFile">Script (string or url) : </label>';h+='<input type="file" name="scriptFile" id="scriptFile">';h+="<br>";h+='<input type="submit" tabindex="-1" style="position:absolute; top:-1000px">';h+="</fieldset>";h+="</form>";h+="</div>";$(h).appendTo(document.body);f=$("#load-local-script-dialog-form").dialog({autoOpen:!1,height:250,width:300,modal:!0,position:{my:"center",
at:"center",of:$("#content")},buttons:{"Load Script":function(){var g=$("#scriptFile")[0].files,h=new FileReader;h.onload=function(){return function(g){console.log(g.target.result);ve(e.ba,g.target.result);f.dialog("close");f.dialog("close")}}(g);h.readAsText(g[0])},Cancel:function(){f.dialog("close")}},close:function(){g[0].reset()}});g=f.find("form").on("submit",function(f){f.preventDefault();e.yb()});return $("#load-local-script-dialog-form")}
function ke(){var e;$('<div id="not-implemented-dialog-form" title="Feature not available"><p class="info">This feature will be added soon</p></div>').appendTo(document.body);e=$("#not-implemented-dialog-form").dialog({autoOpen:!1,height:250,width:300,modal:!0,position:{my:"center",at:"center",of:$("#content")},buttons:{Cancel:function(){e.dialog("close")}}});return $("#not-implemented-dialog-form")}
function le(e){function f(){q=n.Ua;r=n.dg.antialias;t=n.oe;x="#"+n.bgColor.getHexString();w=n.df;E=q;F=t;G=w;I="";$("#quality").find('option[value="'+q+'"]').attr("selected",!0);$("#quality").selectmenu("refresh");$("#antialias").prop("checked",r);$("#textSize").slider("value",t);$("#textSizeInfo").html(t+"%");$("#mouse3D").val("");var e=[],f=m.ve.values(),g;for(g in f){var k=f[g];e.push('<option value="'+k.index+'">'+k.id+"</option>")}$("#mouse3D").append(e.join(""));null!=m.nb&&(I=m.nb.id,G=m.nb.index,
$("#mouse3D").find('option[value="'+G+'"]').attr("selected",!0),$("#mouse3D").selectmenu("refresh"));$.farbtastic("#colorpicker").setColor(x)}function g(){we(n,E);q=E;var e=$("#antialias").prop("checked");window.localStorage.setItem("antialias",e);r=antialias;n.oe=F;window.localStorage.setItem("textRatio",n.oe);t=F;e=$.farbtastic("#colorpicker").color;$("#saveBg").prop("checked")&&window.localStorage.setItem("background",e);n.Od(new THREE.Color(e));x=e;m.nb=m.ve.get(G);e=I;n.df=e;window.localStorage.setItem("3DController",
e);w=G}var h,k;k='<div id="config-dialog-form" title="BiovizJS Configuration"><label for="quality">Select a quality : </label><select name="quality" id="quality"><option value="LOW">Low</option>';k+='<option value="MEDIUM">Medium</option>';k+='<option value="HIGH">High</option>';k+="</select>";k+="<br/>";k+='<label for="antialias">Antialiasing (needs page refresh) : </label>';k+='<input type="checkbox" name="Antialiasing" id="antialias" class="button ui-widget-content ui-corner-all">';k+="<br/>";
k+='<label for="mouse3D">Select a 3D Mouse : </label>';k+='<select name="mouse3D" id="mouse3D">';k+="</select>";k+="<br/>";k+='<label for="textSize">Text Size : </label>';k+='<span id="textSizeInfo"></span>';k+='<div id="textSize"></div>';k+="<br/>";k+='<label id ="bgLabel" for="background">Background Color : </label>';k+='<label for="saveBg">Save background configuration : </label>';k+='<input type="checkbox" name="saveBg" id="saveBg" class="button ui-widget-content ui-corner-all">';k+='<div id="colorpicker"></div>';
k+="<br/>";k+='<label for="advance">Enable advanced features : </label>';k+='<input type="checkbox" name="Advanced Features" id="advance" class="button ui-widget-content ui-corner-all">';k=$(k);k.appendTo(document.body);var n=xe(),m=e.ba.ca.scene3D.bj,q=n.Ua,r=n.dg.antialias,t=n.oe,x="#"+n.bgColor.getHexString(),w=n.df,E=q,F=t,G=w,I="";h=$("#config-dialog-form").dialog({autoOpen:!1,height:250,width:300,modal:!0,position:{my:"center",at:"center",of:$("#content")},buttons:{Reset:function(){n.dg.antialias=
!0;n.Ua="MEDIUM";n.oe=20;n.bgColor=new THREE.Color(0,0,0);n.df="";$("#saveBg").prop("checked",!0);f();g()},Apply:function(){g();h.dialog("close")},Cancel:function(){h.dialog("close")}},open:function(){f()}});$("#quality").selectmenu({width:"200px",select:function(e,f){E=f.item.value}});$("#mouse3D").selectmenu({width:"200px",select:function(e,f){G=f.item.value;I=f.item.label}});$("#textSize").slider({slide:function(e,f){F=f.value;$("#textSizeInfo").html(F+"%")}});$("#colorpicker").farbtastic();$("#advance").attr("disabled",
!0);k.find("select").css({width:"150%"});k.find("select").find(".options-small").css({"font-size":"0.8em"});k.find("label").css({display:"block"});return $("#config-dialog-form")}function pe(e){e.Da=e.ba.ca.pc(e.fa.qa(),e.v.type,e.v.id,e.Fa._id,!0)[0]}function qe(e){e.ya=e.ba.ca.pd(e.fa.qa(),e.v.type,e.v.id,e.aa.id,e.aa.md,!0)[0]}
function EventTarget(e){this._listeners={};var f=this;e&&!e.addListener&&(e.addListener=function(e,h){f.addListener(e,h)},e.removeListener=function(e,h){f.removeListener(e,h)},e.ab=function(e){f.fire(e)})}EventTarget.prototype.addListener=function(e,f){void 0===this._listeners[e]&&(this._listeners[e]=[]);this._listeners[e].push(f)};EventTarget.prototype.removeListener=function(e,f){var g=this._listeners[e];if(void 0!==g)for(var h=g.length,k=0;k<h;k++)if(g[k]===f){g.splice(k,1);break}};
EventTarget.prototype.fire=function(e){"string"===typeof e&&(e={type:e});e.target||(e.target=this);if(!e.type)throw Error("Event object type must be defined");var f=this._listeners[e.type];if(void 0!==f)for(var g=f.length,h=0;h<g;h++)f[h].call(this,e)};
function ye(){if("object"===typeof ze)return ze;ze=this;this.bgColor=new THREE.Color(0,0,0);var e=window.localStorage.getItem("quality"),f=window.localStorage.getItem("antialias"),g=window.localStorage.getItem("textRatio"),h=window.localStorage.getItem("background"),k=window.localStorage.getItem("3DController");this.ej=this.Vd=this.Ee=this.De=this.yb=this.xd=this.wd=this.yd=this.Zf=null;Ae(this);this.Mc={Atoms:this.yb,"Amino Acids":this.xd,"Nucleic Acids":this.wd,Molecules:this.yd,"Secondary Structure Type":this.Vd,
Rainbow:this.Ee,Hydrophobicity:this.De};this.fa={Atoms:[],Residues:[],Molecules:[],SST:[]};f="string"==typeof f?JSON.parse(f):f;this.dg={antialias:null!=f?f:!0,Pl:"0c0c0c"};this.Ua=null!=e?e:"MEDIUM";this.oe=null!=g?g:7;null!=h&&(this.bgColor=new THREE.Color(h));this.df=k;this.ak=30;this.fps=60;this.ya=this.sa=this.Da=this.rc=null;this.v={ka:{radius:1,widthSegments:16,heightSegments:8,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI},na:{radius:1,widthSegments:10,heightSegments:6,phiStart:0,
phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI},ma:{radius:1,widthSegments:6,heightSegments:3,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI}};this.u={ka:{radius:.3,widthSegments:12,heightSegments:8,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI},na:{radius:.3,widthSegments:8,heightSegments:5,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI},ma:{radius:.3,widthSegments:5,heightSegments:3,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI}};
this.aa={ka:{radiusTop:.2,radiusBottom:.2,height:1,zd:12,heightSegments:1,openEnded:!1},na:{radiusTop:.2,radiusBottom:.2,height:1,zd:5,heightSegments:1,openEnded:!1},ma:{radiusTop:.2,radiusBottom:.2,height:1,zd:3,heightSegments:1,openEnded:!1}};this.da={ka:{radius:this.aa.ka.radiusTop,widthSegments:12,heightSegments:8,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI},na:{radius:this.aa.ka.radiusTop,widthSegments:6,heightSegments:4,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI},
ma:{radius:this.aa.ka.radiusTop,widthSegments:5,heightSegments:3,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI}};this.lineWidth=1.5;this.Uh=1;this.Xd=[]}var ze;function xe(){return new ye}ye.prototype.subscribe=function(e){if(void 0!==e.update)this.Xd.push(e);else throw Error("Class must have a update function to subscribe to modellingProperties");};function Be(e,f){for(var g=e.Xd.length,h=0;h<g;h++)e.Xd[h].update(f)}
ye.prototype.setLineWidth=function(e){this.lineWidth=e;e=new Ce;e.lineWidth=!0;Be(this,e)};ye.prototype.Od=function(e){this.bgColor=e;e=new Ce;e.bgColor=!0;Be(this,e)};
function De(e,f,g){if("A"===g)return void 0===e.fa.Atoms[f]?(g=new THREE.Color(e.yb[f]),e.fa.Atoms[f]=g):e.fa.Atoms[f];if("M"===g)return void 0===e.fa.Molecules[f]?(g=new THREE.Color(e.yd[f]),e.fa.Molecules[f]=g):e.fa.Molecules[f];if("R"===g)return void 0===e.fa.Residues[f]?(g=e.xd[f],void 0===g&&(g=e.wd[f]),g=new THREE.Color(g),e.fa.Residues[f]=g):e.fa.Residues[f];if("SST"===g)return void 0===e.fa.SST[f]?(g=e.Vd[f],g=new THREE.Color(g),e.fa.SST[f]=g):e.fa.SST[f]}
function we(e,f){if("LOW"===f||"MEDIUM"===f||"HIGH"===f){e.Ua=f;var g=new Ce;g.pf=!0;"HIGH"===e.Ua?(e.Da=new THREE.SphereGeometry(e.v.ka.radius,e.v.ka.widthSegments,e.v.ka.heightSegments,e.v.ka.phiStart,e.v.ka.phiLength,e.v.ka.thetaStart,e.v.ka.thetaLength),e.sa=new THREE.SphereGeometry(e.u.ka.radius,e.u.ka.widthSegments,e.u.ka.heightSegments,e.u.ka.phiStart,e.u.ka.phiLength,e.u.ka.thetaStart,e.u.ka.thetaLength),e.ya=new THREE.CylinderGeometry(e.aa.ka.radiusTop,e.aa.ka.radiusBottom,e.aa.ka.height,
e.aa.ka.zd,e.aa.ka.kf,e.aa.ka.openEnded)):"MEDIUM"===e.Ua?(e.Da=new THREE.SphereGeometry(e.v.na.radius,e.v.na.widthSegments,e.v.na.heightSegments,e.v.na.phiStart,e.v.na.phiLength,e.v.na.thetaStart,e.v.na.thetaLength),e.sa=new THREE.SphereGeometry(e.u.na.radius,e.u.na.widthSegments,e.u.na.heightSegments,e.u.na.phiStart,e.u.na.phiLength,e.u.na.thetaStart,e.u.na.thetaLength),e.ya=new THREE.CylinderGeometry(e.aa.na.radiusTop,e.aa.na.radiusBottom,e.aa.na.height,e.aa.na.zd,e.aa.na.kf,e.aa.na.openEnded)):
"LOW"===e.Ua&&(e.Da=new THREE.SphereGeometry(e.v.ma.radius,e.v.ma.widthSegments,e.v.ma.heightSegments,e.v.ma.phiStart,e.v.ma.phiLength,e.v.ma.thetaStart,e.v.ma.thetaLength),e.sa=new THREE.SphereGeometry(e.u.ma.radius,e.u.ma.widthSegments,e.u.ma.heightSegments,e.u.ma.phiStart,e.u.ma.phiLength,e.u.ma.thetaStart,e.u.ma.thetaLength),e.ya=new THREE.CylinderGeometry(e.aa.ma.radiusTop,e.aa.ma.radiusBottom,e.aa.ma.height,e.aa.ma.zd,e.aa.ma.kf,e.aa.ma.openEnded));Be(e,g);window.localStorage.setItem("quality",
e.Ua)}}
function Ee(e){null===e.sa&&("HIGH"===e.Ua?e.sa=new THREE.SphereGeometry(e.u.ka.radius,e.u.ka.widthSegments,e.u.ka.heightSegments,e.u.ka.phiStart,e.u.ka.phiLength,e.u.ka.thetaStart,e.u.ka.thetaLength):"MEDIUM"===e.Ua?e.sa=new THREE.SphereGeometry(e.u.na.radius,e.u.na.widthSegments,e.u.na.heightSegments,e.u.na.phiStart,e.u.na.phiLength,e.u.na.thetaStart,e.u.na.thetaLength):"LOW"===e.Ua&&(e.sa=new THREE.SphereGeometry(e.u.ma.radius,e.u.ma.widthSegments,e.u.ma.heightSegments,e.u.ma.phiStart,e.u.ma.phiLength,e.u.ma.thetaStart,
e.u.ma.thetaLength)));return e.sa}function Fe(e,f){if(null===f||void 0===f)f=30;return Ge(e,{fontsize:f,gh:{r:255,g:255,b:255,a:1},strokeStyle:!0})}
function Ge(e,f){void 0===f&&(f={});var g=void 0!==f.bk?f.bk:"Arial",h=void 0!==f.fontsize?f.fontsize:20,k=void 0!==f.gh?f.gh:{r:1,g:0,b:0,a:1},n=f.maxWidth,m=f.maxHeight,q=document.createElement("canvas"),r=q.getContext("2d");r.font=h+"px "+g;var t=r.measureText(e).width,h=Math.ceil(h);null!=n&&t>n&&(h=Math.ceil(h*n/t),r.font=h+"px "+g,t=n);null!=m&&h>m&&(t*=m/h,h=m,r.font=h+"px "+g);q.width=t;q.height=h;r.fillStyle="rgba("+k.r+","+k.g+","+k.b+","+k.a+")";r.font=h+"px "+g;r.textAlign="center";r.textBaseline=
"middle";f.strokeStyle&&(r.strokeStyle="rgba(0,0,0,1.0)",r.lineWidth=2,r.strokeText(e,t/2,h/2));r.fillText(e,t/2,h/2);g=new THREE.Texture(q);g.minFilter=THREE.LinearFilter;g.needsUpdate=!0;return g}function He(e,f){return parseFloat($a.Jc(f.symbol.charAt(0).toUpperCase()+f.symbol.slice(1).toLowerCase())[7])}function Ie(){return new THREE.MeshPhongMaterial({vertexColors:THREE.VertexColors})}
function Ae(e){e.Zf=JSON.parse(window.localStorage.getItem("def"))||Id;e.yd=JSON.parse(window.localStorage.getItem("moleculeColor"))||Jd;e.wd=JSON.parse(window.localStorage.getItem("nucleicAcidColor"))||Kd;e.xd=JSON.parse(window.localStorage.getItem("residueColor"))||Ld;e.yb=JSON.parse(window.localStorage.getItem("atomColor"))||Md;e.De=JSON.parse(window.localStorage.getItem("hydroColor"))||Nd;e.Ee=JSON.parse(window.localStorage.getItem("rainbowColor"))||Od;e.Vd=JSON.parse(window.localStorage.getItem("sstColor"))||
Pd;e.ej=JSON.parse(window.localStorage.getItem("unsortedProperties"))||Qd;e.Mc={Atoms:e.yb,"Amino Acids":e.xd,"Nucleic Acids":e.wd,Molecules:e.yd,"Secondary Structure Type":e.Vd,Rainbow:e.Ee,Hydrophobicity:e.De}}function Ce(){this.Yh=this.lineWidth=this.Uh=this.pf=!1;this.Wg=this.Wg=null;this.bgColor=!1}
function Ve(e){this.pg=new Worker("webworker.js");this.ba=e;this.ra=new ye;e=$("#content").width()/$("#content").height();this.camera=new THREE.PerspectiveCamera(45,e,1,1E3);this.Ya=this.scene3D=new We(this);this.Ia=null;this.domElement=this.scene3D.renderer.domElement;this.effect=null;this.Cc=this.Pe=!1;this.u=null;this.v=1;this.ce=null}function Xe(e){e.ba.ab({type:"requestWidgetUpdate",data:null!=e.Ia?e.Ia.la._id:null})}z=Ve.prototype;z.Qg=function(e){this.ba.Qg(e)};
z.Xc=function(e,f){var g=this;if(void 0===e)throw Error("Structure's identifier to load is undefined");var h;-1!=e.indexOf("/")?h=e:(h=this.ba.Zh.slice().replace("${id}",e),h=h.replace("${divided}",e.substring(1,2)));Ye(this.ba,"Downloading "+e,!0);return(new Hd(h,this.ba.Wd,f)).load().then(function(e){Ye(g.ba);return e})["catch"](function(e){Ye(g.ba,e.message);return e})};
z.Yf=function(e,f){var g=this;Ye(this.ba,"Parsing...",!0);return(new Hd(e,this.ba.Wd,f,!0)).load().then(function(e){Ye(g.ba);return e})["catch"](function(e){console.warn("Error : ",e)})};function Ze(e,f,g){Ye(e.ba,"Loading 3D Objects...",!0);if(null!==f&&void 0!==f){var h=new M(f);null!=g&&h.la.Oc(g);f=f.v[0].aa;g=f.length;for(var k=0;k<g;k++)h.kb(f[k]);Ye(e.ba);return h}return null}
function $e(e,f){Ye(e.ba,"Loading 3D Representations...",!0);for(var g=af(f),h=g.length,k=[],n=0;n<h;n++)k.push(new Promise(function(e){var f=g[n];setTimeout(function(){bf(f);e()},100)}));return Promise.all(k).then(function(){return new Promise(function(f){Ye(e.ba);f()})})}
function cf(e){var f=1.5*e.scene3D.sb().length();e.camera.far=f;df=f/5E3;ef(e.scene3D,0,100);f=e.scene3D;f.Ub.fog.near=f.camera.far-(f.camera.far-f.camera.near)*f.ra.ak/100;f.Ub.fog.far=f.camera.far;e.camera.updateProjectionMatrix();e.camera.fov=id(e.scene3D,e.camera)}function se(e,f){f.traverse(function(f){f===e.Ia&&(e.Ia=null);f===e.Ya&&(e.Ya=e.scene3D)});var g=e.scene3D.ja.indexOf(f);0<=g&&e.scene3D.ja.splice(g,1);f["delete"]();cf(e);Xe(e)}
z.translate=function(e,f,g){e=new THREE.Vector3(e,f,g);this.Ya===this.scene3D?(e=(new THREE.Matrix4).setPosition(e),e=e.multiply(this.Ya.matrixWorld),this.Ya.matrix.copy(e)):(f=new THREE.Matrix4,f.copy(this.Ya.matrixWorld),g=new THREE.Matrix4,g.getInverse(f),f=Zd(g,e),e=new THREE.Matrix4,e.makeTranslation(f.x,f.y,f.z),f=new THREE.Matrix4,f.copy(this.Ya.matrix),f.multiply(e),this.Ya.matrix.copy(f));this.Ya.updateMatrixWorld(!0)};
z.rotate=function(e,f,g){var h=null!==this.Ya?this.Ya:this.scene3D.scene,k=null!==this.Ia?this.Ia:h,n=new THREE.Matrix4;n.copy(h.matrixWorld);var m=new THREE.Matrix4;m.getInverse(n);var q=new THREE.Matrix4;q.copy(h.matrixWorld);n=new THREE.Matrix4;n.getInverse(q);var q=new THREE.Vector3(n.elements[0],n.elements[1],n.elements[2]),r=new THREE.Vector3(n.elements[4],n.elements[5],n.elements[6]),t=(new THREE.Vector3).crossVectors(q,r),n=new THREE.Matrix4;$d(n,e,r.x,r.y,r.z);e=new THREE.Matrix4;$d(e,f,
q.x,q.y,q.z);f=new THREE.Matrix4;$d(f,g,t.x,t.y,t.z);g=new THREE.Matrix4;g=f.multiply(e).multiply(n);f=new THREE.Vector3;f.copy(k.Uc());f=(new THREE.Matrix4).makeTranslation(f.x,f.y,f.z);m=(new THREE.Matrix4).copy(m);m.multiply(k.matrixWorld).multiply(f);k=(new THREE.Matrix4).getInverse(m);m=[m,k];k=new THREE.Matrix4;k=k.multiply(m[0]).multiply(g).multiply(m[1]);m=new THREE.Matrix4;h.matrix.copy((null!==h.matrix?h.matrix:m).multiply(k));h.updateMatrixWorld(!0)};
function oe(e,f,g){var h=Sd(f,e.scene3D,g,e.v);e.scene3D.scene.matrix.copy(h);e.scene3D.scene.matrixWorldNeedsUpdate=!0;g&&(e.scene3D.ca.Ia=f)}z.kg=function(e){null!==this.ce&&this.rf();void 0==e&&(e=.25);this.ce=new ff(this.scene3D,e);this.scene3D.tf.mc(this.ce)};z.rf=function(){this.ce&&(this.ce.stop(),this.ce=null)};z.qe=function(e){(this.Pe=e)&&this.Cc&&(this.Cc=!1);return this.Cc};z.pe=function(e){(this.Cc=e)&&this.Pe&&(this.Pe=!1);return this.Pe};
z.cb=function(e){for(var f in this.scene3D.ja)if(this.scene3D.ja[f].Vc()===e)return[this.scene3D.ja[f]]};
function me(e,f,g,h){var k=[];if(void 0===g)for(var n in e.scene3D.ja)e.scene3D.ja[n].Vc().toUpperCase()===f.toUpperCase()&&(k=k.concat(af(e.scene3D.ja[n])));else if(void 0===h)for(n in e.scene3D.ja){if(e.scene3D.ja[n].Vc().toUpperCase()===f.toUpperCase()){var m=af(e.scene3D.ja[n]),q;for(q in m)g.toUpperCase()===m[q].ta.type.toUpperCase()&&k.push(m[q])}}else for(n in e.scene3D.ja)if(e.scene3D.ja[n].Vc().toUpperCase()===f.toUpperCase())for(q in m=af(e.scene3D.ja[n]),m)if(g.toUpperCase()===m[q].ta.type.toUpperCase()&&
h.toUpperCase()===m[q].ta.id.toUpperCase())return[m[q]];return k}z.pc=function(e,f,g,h,k){e=me(this,e,f,g)[0];if(null!==e){f=e.ta.ga;for(var n in f)if(g=f[n],g.qa()==h)return[e.pc(g,k)]}return null};z.pd=function(e,f,g,h,k,n){e=me(this,e,f,g)[0];if(null!==e){f=e.ta.xa();for(var m in f)if(f[m].id===h&&(null==k||f[m].md===k)&&(g=e.pc(f[m].pb(),n),null!==g&&void 0!==g))return[g.pd(f[m],n)]}return null};
function gf(e){this.u=null;this.scene3D=e;this.u=new THREE.DirectionalLight(16777215,1);this.u.position.set(this.scene3D.camera.position.x,this.scene3D.camera.position.y,this.scene3D.camera.position.z);this.u.matrixAutoUpdate=!0;this.scene3D.Ub.add(this.u)}function hf(e){this.ra=xe();this.duration=e;this.Sa=0}hf.prototype.moveTo=function(e){if(1<e||0>e||isNaN(e))return 0;this.Sa=this.duration*e};function jf(e){new THREE.Clock;this.ra=xe();this.Dc=[];this.pause=!1;this.scene3D=e}jf.prototype.mc=function(e){this.Dc.push(e)};
function kf(e,f,g){if(!e.pause||g){g=e.Dc.length;for(var h=0;h<g;h++){var k=e.Dc[h];k.ld(f);-1!=k.duration&&k.Sa>=k.duration&&(e.Dc.splice(h,1),g--)}}}function lf(e,f,g,h){hf.call(this);this.duration=g;this.scene3D=f;this.ue=new THREE.Matrix4;this.Ri=new THREE.Matrix4;this.Ri.copy(this.scene3D.scene.matrix);e=Sd(e,this.scene3D,h);this.ue.copy(e)}lf.prototype=Object.create(hf.prototype);lf.prototype.constructor=lf;
lf.prototype.ld=function(e){this.Sa+=e;e=this.Sa/this.duration;1<e&&(e=1);var f=new THREE.Matrix4;f.lerp(this.Ri,this.ue,e);this.scene3D.scene.matrix.copy(f);this.scene3D.scene.matrixWorldNeedsUpdate=!0};function mf(e,f,g,h){hf.call(this);this.r=e;this.g=f;this.b=g;this.duration=h;this.fj=this.ra.bgColor.r;this.Ii=this.ra.bgColor.g;this.vi=this.ra.bgColor.b}mf.prototype=Object.create(hf.prototype);mf.prototype.constructor=mf;
mf.prototype.ld=function(e){this.Sa+=e;e=this.Sa/this.duration;1<e?this.ra.Od(new THREE.Color(this.r,this.g,this.b)):this.ra.Od(new THREE.Color(this.fj+(this.r-this.fj)*e,this.Ii+(this.g-this.Ii)*e,this.vi+(this.b-this.vi)*e))};function nf(e){hf.call(this);this.Sa=0;this.duration=e}nf.prototype=Object.create(hf.prototype);nf.prototype.constructor=nf;nf.prototype.ld=function(e){this.Sa+=e};
function of(e,f){hf.call(this);this.duration=e;this.Ja=f;this.Vf=[];this.b=this.g=this.r=null;this.Ah=!1;this.map=null}of.prototype=Object.create(hf.prototype);of.prototype.constructor=of;of.prototype.init=function(){var e=this.Ja.ea.geometry,f=e.attributes.color,e=e.attributes.color.array;if(0===f.count)this.Ja.ea.material.color=this.Ja.ea.material.color.clone(),this.Vf.push(this.Ja.ea.material.color);else for(var f=f.count,g=0;g<f;g++){var h=(new THREE.Color(e[3*g],e[3*g+1],e[3*g+2])).clone();this.Vf.push(h)}};
function pf(e,f,g,h){1<f?e.r=f/255:e.r=f;1<g?e.g=g/255:e.g=g;1<h?e.b=h/255:e.b=h;e.init()}
of.prototype.ld=function(e){this.Sa+=e;e=this.Sa/this.duration;1<e&&(e=1);for(var f=this.Ja.ea.geometry.attributes.color,g=new Float32Array(f.array.length),h=this.Vf.length,k=0;k<h;k++){var n=this.Vf[k];if(1===e)if(this.Ah){var m=this.map[k];null!=m?(g[3*k]=m.r,g[3*k+1]=m.g,g[3*k+2]=m.b):(g[3*k]=n.r,g[3*k+1]=n.g,g[3*k+2]=n.b)}else g[3*k]=this.r,g[3*k+1]=this.g,g[3*k+2]=this.b;else this.Ah?(m=this.map[k],null!=m?(g[3*k]=n.r+(m.r-n.r)*e,g[3*k+1]=n.g+(m.g-n.g)*e,g[3*k+2]=n.b+(m.b-n.b)*e):(g[3*k]=n.r,
g[3*k+1]=n.g,g[3*k+2]=n.b)):(g[3*k]=n.r+(this.r-n.r)*e,g[3*k+1]=n.g+(this.g-n.g)*e,g[3*k+2]=n.b+(this.b-n.b)*e)}f.set(g);f.needsUpdate=!0};
function qf(e,f,g,h){hf.call(this);this.duration=e;this.target=f;this.scene3D=g;this.oh=new THREE.Matrix4;this.oh.copy(this.target.matrix);this.Dk=new THREE.Vector3;this.Ui=new THREE.Quaternion;this.Vi=new THREE.Vector3;this.oh.decompose(this.Dk,this.Ui,this.Vi);this.ue=h;this.Zj=new THREE.Vector3;this.Fi=new THREE.Quaternion;this.Gi=new THREE.Vector3;this.ue.decompose(this.Zj,this.Fi,this.Gi);e=this.target.Uc();this.Jh=new THREE.Vector3(-e.x,-e.y,-e.z);this.Ih=(new THREE.Matrix4).setPosition(this.Jh);
this.fg=e.clone();this.jj=(new THREE.Matrix4).setPosition(this.fg);this.Vh=new THREE.Vector3;f=new THREE.Matrix4;f.multiply(this.oh).multiply((new THREE.Matrix4).setPosition(e));this.Vh.setFromMatrixPosition(f);f=new THREE.Vector3;g=new THREE.Matrix4;g.multiply(this.ue).multiply((new THREE.Matrix4).setPosition(e));f.setFromMatrixPosition(g);this.sj=new THREE.Vector3;this.sj.subVectors(this.Vh,e);this.xi=new THREE.Vector3;this.xi.subVectors(f,this.Vh)}qf.prototype=Object.create(hf.prototype);
qf.prototype.constructor=qf;
qf.prototype.ld=function(e){this.Sa+=e;e=this.Sa/this.duration;if(1<e||isNaN(e))this.target.matrix.copy(this.ue);else{var f=new THREE.Quaternion;THREE.Quaternion.slerp(this.Ui,this.Fi,f,e);var f=(new THREE.Matrix4).makeRotationFromQuaternion(f),g=new THREE.Vector3;g.lerp(this.xi,e);(new THREE.Matrix4).setPosition(g);var h=new THREE.Vector3;h.lerpVectors(this.Vi,this.Gi,e);(new THREE.Matrix4).scale(h);e=(new THREE.Matrix4).setPosition(g.add(this.fg).add(this.sj));e.multiply(f);e.multiply(this.Ih);
this.target.matrix.copy(e)}this.target.matrixWorldNeedsUpdate=!0};nf=function(e,f,g){hf.call(this);this.nh=null;this.opacity=e;this.Ja=g;this.Sa=0;this.duration=f;this.Ja.ea.material.transparent=!0;this.nh=this.Ja.ea.material.opacity};nf.prototype=Object.create(hf.prototype);nf.prototype.constructor=nf;nf.prototype.ld=function(e){this.Sa+=e;e=this.Sa/this.duration;1<e&&(e=1);this.Ja.ea.material.opacity=1===e?this.opacity:this.nh+(this.opacity-this.nh)*e};
function ff(e,f){hf.call(this);this.duration=-1;this.speed=f;this.target=e;var g=this.target.Uc();this.Jh=new THREE.Vector3(-g.x,-g.y,-g.z);this.Ih=(new THREE.Matrix4).setPosition(this.Jh);this.fg=g.clone();this.jj=(new THREE.Matrix4).setPosition(this.fg)}ff.prototype=Object.create(hf.prototype);ff.prototype.constructor=ff;
ff.prototype.ld=function(e){var f=new THREE.Matrix4;f.copy(this.target.matrixWorld);var g=new THREE.Matrix4;g.getInverse(f);var f=new THREE.Vector3(g.elements[0],g.elements[1],g.elements[2]),h=new THREE.Vector3(g.elements[4],g.elements[5],g.elements[6]),k=(new THREE.Vector3).crossVectors(f,h),g=new THREE.Matrix4;$d(g,e/1E3*this.speed*2*Math.PI,h.x,h.y,h.z);e=new THREE.Matrix4;$d(e,0,f.x,f.y,f.z);f=new THREE.Matrix4;$d(f,0,k.x,k.y,k.z);k=new THREE.Matrix4;k=f.multiply(e).multiply(g);g=(new THREE.Matrix4).multiply(this.jj).multiply(k).multiply(this.Ih);
this.target.matrix.copy(this.target.matrix.multiply(g))};ff.prototype.stop=function(){this.duration=0};function rf(e,f,g,h){hf.call(this);this.duration=g;this.scene3D=f;this.text=e;this.position=h}rf.prototype=Object.create(hf.prototype);rf.prototype.constructor=rf;rf.prototype.ld=function(e){this.Sa+=e;this.Sa>=this.duration&&(this.scene3D.Bd[this.position]=void 0,this.scene3D.xc.remove(this.text),this.scene3D.renderer.render(this.scene3D.xc,this.scene3D.Ld))};
function sf(e,f){Af.call(this,e,f);(this.Ji="getGamepads"in navigator)||console.warn("Gamepad API not supported, you can't use any 3D device to control BiovizJS");var g=this;this.ve=new ja;this.nb=null;this.sh=this.rh=this.wh=this.xh=!1;window.addEventListener("gamepadconnected",function(e){Bf(g,e.nb)});window.addEventListener("gamepaddisconnected",function(e){e=e.nb;g.nb.index==e.index&&(g.nb=null);g.ve.remove(e.index)});this.pk="GamepadEvent"in window;var h=window.chrome,k=window.navigator.vendor,
n=-1<window.navigator.userAgent.indexOf("OPR"),m=-1<window.navigator.userAgent.indexOf("Edge");this.Gk=null!==h&&void 0!==h&&"Google Inc."===k&&0==n&&0==m}sf.prototype=Object.create(Af.prototype);sf.prototype.constructor=sf;
sf.prototype.update=function(){if(this.Ji){if(!this.pk||this.Gk)for(var e=navigator.getGamepads(),f=0;f<e.length;f++){var g=e[f];g&&(this.ve.Gc(g.index)?this.ve.set(g.index,g):Bf(this,g))}if(null!=this.nb){(e=this.nb.buttons[0])&&e.pressed?this.rh||(this.xh=!this.xh,this.rh=!0):this.rh=!1;(e=this.nb.buttons[1])&&e.pressed?this.sh||(this.wh=!this.wh,this.sh=!0):this.sh=!1;var e=this.nb.axes[0]*Cf,f=this.nb.axes[1]*Cf,g=this.nb.axes[2]*Cf,h=this.nb.axes[3]*Df,k=this.nb.axes[4]*Df,n=this.nb.axes[5]*
Df;if(0!==e||0!==f||0!==g||0!==h||0!==k||0!==n)this.wh||this.scene3D.ca.rotate(-n,h,k),this.xh||this.scene3D.ca.translate(e,-g,f)}}};function Bf(e,f){f.wb=function(){return this.index+":"+this.id};e.ve.set(f.index,f);if(null==e.nb||f.id===xe().df)e.nb=f}function Af(e,f){this.scene3D=e;this.domElement=f;this.Da=new THREE.Vector3;this.sa=new THREE.Vector3;this.da=new THREE.Vector3;this.ya=new THREE.Vector3;this.fa=new THREE.Vector3;this.aa=new THREE.Vector3;this.maxDistance=Infinity}
var df=.4,Df=.1,Cf=1.5;
function Ef(e,f){Af.call(this,e,f);this.u={NONE:-1,dd:0,he:1,ee:2,ie:3};this.v=this.u.NONE;var g=this,h;this.vh=!1;this.mousedown=function(e){fd(g.scene3D.ca.ba);h=e.timeStamp;Ff(!1);if(g.v===g.u.NONE)g.v=e.button;else if(g.v===g.u.dd||g.v===g.u.ee)g.v=g.u.ie;g.v===g.u.dd?g.Da=g.ya=Gf(g,e.clientX,e.clientY):g.v===g.u.he||g.v===g.u.ie?g.sa=g.fa=Gf(g,e.clientX,e.clientY):g.da=g.aa=Gf(g,e.clientX,e.clientY)};this.mouseup=function(e){Ff(!0);g.v=g.u.NONE;h=e.timeStamp-h;if(300>h&&5>Math.abs(g.aa.x-g.da.x)&&
5>Math.abs(g.aa.y-g.da.y)){var f=[],m;for(m in g.scene3D.ja)f=f.concat(Hf(g.scene3D.ja[m]));var q=e.offsetX/$("#content").width()*2-1,r=2*-(e.offsetY/$("#content").height())+1,f=Td(g.scene3D,f,q,r);if(2==e.button)m=g.scene3D.ca.ba,e={target:null!=f?f:null,pageX:e.pageX,pageY:e.pageY},m.contextMenu.menu.getMenu()[0].parentElement!==m.Yg[0]?(e.Yi=!0,f=m.Di.offset(),e.pageX+=f.left,e.pageY+=f.top):e.Yi=!1,m.contextMenu.div.contextmenu("open",m.Pj,e);else if(0==e.button){for(m in g.callback)if("function"===
typeof g.callback[m])g.callback[m](f);if(null!=f&&g.vh&&(e=g.scene3D,f!=e.me)){if(e.ca.Ya!==e)throw"In order to measure, you must have the scene as camera target";m=f.pb().Ea;q=m.qc();r=me(e.ca,q.qa(),m.type,m.id)[0];void 0!=e.me&&(me(e.ca,q.qa(),m.type,m.id),e.ic=e.me.pos.clone(),e.ic.applyMatrix4(r.matrixWorld),e.ic.applyMatrix4((new THREE.Matrix4).getInverse(e.scene.matrixWorld)));e.ic?e.kd||(e.kd=f.pos.clone(),e.kd.applyMatrix4(r.matrixWorld),e.kd.applyMatrix4((new THREE.Matrix4).getInverse(e.scene.matrixWorld)),
f=new THREE.Geometry,f.vertices.push(e.ic),f.vertices.push(e.kd),f.computeLineDistances(),m=new THREE.LineDashedMaterial({color:16760576,dashSize:.7,gapSize:.3,linewidth:1.5}),f=new THREE.Line(f,m),e.scene.add(f),m=e.ic.distanceTo(e.kd).toFixed(2),m=Fe(m),m=new THREE.SpriteMaterial({map:m}),m.depthTest=!1,m.depthWrite=!1,q=new THREE.Sprite(m),r=(new THREE.Vector3).addVectors(e.ic,e.kd).multiplyScalar(.5),q.position.set(r.x,r.y,r.z),q.scale.set(m.map.image.width/40,m.map.image.height/40,1),e.scene.add(q),
e.bf.push(f),e.bf.push(q),e.ic=null,e.kd=null):(e.ic=f.pos.clone(),e.ic.applyMatrix4(r.matrixWorld),e.ic.applyMatrix4((new THREE.Matrix4).getInverse(e.scene.matrixWorld)))}}}};this.rc=function(e){e.preventDefault()};this.mousemove=function(e){if(g.v===g.u.NONE){var f=[],h;for(h in g.scene3D.ja)f=f.concat(Hf(g.scene3D.ja[h]));h=e.offsetX/$("#content").width()*2-1;e=2*-(e.offsetY/$("#content").height())+1;f=Td(g.scene3D,f,h,e);e=null;null!=f&&(e=f.Ic());g.scene3D.ca.Qg(e)}else g.v===g.u.dd?g.ya=Gf(g,
e.clientX,e.clientY):g.v===g.u.he||g.v===g.u.ie?g.fa=Gf(g,e.clientX,e.clientY):g.v===g.u.ee&&(g.aa=Gf(g,e.clientX,e.clientY))};this.yb=function(e){e.preventDefault();e.stopPropagation();!0===e.ctrlKey?If(g.scene3D,g.scene3D.eh+.05*e.deltaY):g.scene3D.ca.translate(0,0,-e.deltaY*e.deltaFactor*df)};this.update=function(){if(g.v!==g.u.NONE)if(g.v===g.u.dd){var e=.025*(this.ya.x-this.Da.x),f=.025*(this.ya.y-this.Da.y);g.scene3D.ca.rotate(e,f,0);this.Da=this.ya}else g.v===g.u.he||g.v===g.u.ie?(e=this.fa.y-
this.sa.y,e=this.v===this.u.ie?2*e:e*df,g.scene3D.ca.translate(0,0,1*e),this.sa=this.fa):g.v===g.u.ee&&(e=.2*(this.aa.x-this.da.x),f=.2*(this.aa.y-this.da.y),g.scene3D.ca.translate(e,-f,0),this.da=this.aa)};this.callback=[];this.Ki=function(e){this.callback.push(e)};this.gj=function(){this.callback=[]};this.Ug=function(e){var f=[],h;for(h in g.scene3D.ja)f=f.concat(Hf(g.scene3D.ja[h]));h=e.offsetX/$("#content").width()*2-1;var q=2*-(e.offsetY/$("#content").height())+1,f=Td(g.scene3D,f,h,q);null!==
f?(f=g.scene3D.ca.cb(f.pb().Ea.qc().qa())[0],!0===e.ctrlKey&&(g.scene3D.ca.Ya=f),g.scene3D.ca.Ia=f,Xe(g.scene3D.ca)):(g.scene3D.ca.Ya=g.scene3D,g.scene3D.ca.Ia=null)};$(this.domElement).on("mousemove",this.mousemove);$(this.domElement).on("mousedown",this.mousedown);$(this.domElement).on("mouseup",this.mouseup);$(document.body).on("dragstart ondrop",function(){return!1});$(this.domElement).on("click",function(){clearTimeout(void 0)});$(this.domElement).on("dblclick",function(e){e.preventDefault();
e.stopPropagation();clearTimeout(void 0);g.Ug(e);return!1});$(this.domElement).on("contextmenu",this.rc);$(this.domElement).on("mousewheel",this.yb)}Ef.prototype=Object.create(Af.prototype);Ef.prototype.constructor=Ef;function Gf(e,f,g){e=e.domElement.getBoundingClientRect();return{x:f-e.left,y:g-e.top}}
function Jf(e,f){Af.call(this,e,f);this.u={NONE:-1,dd:0,he:1,ee:2,ie:3};this.v=this.u.NONE;var g=this,h=new Hammer.Manager(this.domElement),k=new Hammer.Swipe({direction:Hammer.DIRECTION_ALL}),n=new Hammer.Pan({direction:Hammer.DIRECTION_ALL,pointers:0,threshold:50}),m=new Hammer.Pinch({enable:!0,threshold:.3}),q=new Hammer.Tap({enable:!0});h.add(k);h.add(n);h.add(m);h.add(q);n.recognizeWith(k);this.yb=function(e){if(g.v===g.u.NONE&&"mouse"!==e.pointerType)switch(e.type){case "panstart":if(.5<Math.abs(e.velocity)||
0===e.velocity)break;var f=e.center;g.da={x:f.x,y:f.y};g.aa={x:f.x,y:f.y};g.v=1===e.pointers.length?g.u.dd:g.u.ee;break;case "pinchstart":g.sa=e.scale;g.fa=e.scale;g.v=g.u.he;break;case "swipeup":g.scene3D.ca.ba.bd.show();break;case "swipeleft":g.scene3D.ca.ba.Pk.show(!0);break;case "swiperight":g.scene3D.ca.ba.yi.show();break;case "swipedown":g.scene3D.ca.ba.bd.hide(),g.scene3D.ca.ba.Pk.show(!1),g.scene3D.ca.ba.yi.hide()}};this.ya=function(){g.v=g.u.NONE};this.Da=function(e){if("mouse"!==e.pointerType)switch(e.type){case "panmove":e=
g.v===g.u.dd?{x:e.pointers[0].clientX,y:e.pointers[0].clientY}:e.center;g.aa={x:e.x,y:e.y};break;case "pinchmove":g.fa=e.scale}};this.update=function(){if(this.v!==this.u.NONE)if(this.v===this.u.dd){var e=.0125*(this.aa.x-this.da.x),f=.0125*(this.aa.y-this.da.y);this.scene3D.ca.rotate(e,f,0);this.da=this.aa}else this.v===this.u.he?(this.scene3D.ca.translate(0,0,30*(this.fa-this.sa)),this.sa=this.fa):this.v===this.u.ee&&(e=.1*(this.aa.x-this.da.x),f=.1*(this.aa.y-this.da.y),this.scene3D.ca.translate(e,
-f,0),this.da=this.aa)};h.on("panstart pinchstart swipeleft swiperight swipeup swipedown press tap",this.yb);h.on("panend pinchend",this.ya);h.on("panmove pinchmove",this.Da)}Jf.prototype=Object.create(Af.prototype);Jf.prototype.constructor=Jf;function O(e){this.Aa=e;this.oa=this.Aa.oa;this.za=this.Aa.pa;this.parent=this.Aa;this.ra=xe();this.ra.subscribe(this);this.visible=!0;this.ea=null;this.wc=[];this.u=null}z=O.prototype;
z.Qa=function(){throw"This method must be defined by childrens of Representation";};z["delete"]=function(){var e=this.ra;void 0!==this.update&&e.Xd.splice(e.Xd.indexOf(this));null!=this.ea&&(this.parent.remove(this.ea),this.ea.geometry.dispose(),this.ea.material.dispose())};z.Ad=function(){this.Aa instanceof Kf?this.color(Q.Wa):this.Aa instanceof Lf?this.color(Q.Hb):this.color(Q.Wa)};
z.ub=function(e,f){null==this.ea&&this.Qa();var g=this.ea.geometry.attributes.highlight;if(null!=g){var h=e?1:0,k=g.array.slice();if(null!=f){for(var n=[],m=this.ea.geometry.attributes.atomIndex.array,q=0;q<f.length;q++)n.push(this.oa.indexOf(f[q]));for(var q=g.count,r=0;r<q;r++)-1!==n.indexOf(m[r])&&(k[r]=h)}else k.fill(h);g.set(k);g.needsUpdate=!0}};z.show=function(){null===this.ea&&this.Qa();null!==this.ea&&(this.visible=this.ea.visible=!0)};
z.hide=function(){null!==this.ea&&(this.visible=this.ea.visible=!1)};
z.color=function(e,f){this.u=e;var g,h,k,n;if("string"===typeof e){if(void 0!=Rd[e])h=Rd[e].r,k=Rd[e].g,n=Rd[e].b;else if("#"==e.substring(0,1))g=e.replace("#",""),e=[parseInt(g.substring(0,2),16),parseInt(g.substring(2,4),16),parseInt(g.substring(4,6),16)],h=e[0],k=e[1],n=e[2];else if("rgb("==e.substring(0,4))e=e.replace("rgb(",""),e=e.replace(")",""),e=e.split(","),h=e[0],k=e[1],n=e[2];else throw Error("unrecognized color");if(void 0!=f)return g=new of(f,this),pf(g,h,k,n),g;Mf(this,h,k,n)}else{a:{for(g in Q)if(Q[g]===
e){g=!0;break a}g=!1}if(g){if(void 0!=f)return h=Nf(this,e),k=g=new of(f,this),k.Ah=!0,k.map=h,k.init(),g;g=e;if(null!==this.ea)if(h=this.ea.geometry,h instanceof THREE.BufferGeometry){k=h.attributes.color.array;n=h.attributes.atomIndex.array.length;for(var m=0;m<n;m++){var q;q=g;var r=m;null==this.wc[q.id]&&(this.wc[q.id]=Nf(this,q));q=this.wc[q.id][r];void 0!=q&&(k[3*m]=q.r,k[3*m+1]=q.g,k[3*m+2]=q.b);h.attributes.color.needsUpdate=!0}}else console.warn("Unknown type of geometry for coloring by atom ",
h)}else if(3===e.length){h=e[0];k=e[1];n=e[2];if(0<f)return g=new of(f,this),pf(g,h,k,n),g;Mf(this,h,k,n)}else throw Error("unrecognized color");}};
function Nf(e,f){var g=e.wc,h=f.id,k;if(f===Q.xg){var n=[];e.Aa instanceof Kf?n=e.Aa.ta.xa():e.Aa instanceof Lf?n=e.Aa.Eb.xa():e.Aa instanceof Of&&(n=[e.Aa.Ql]);k=new ja;for(var m=n.length,q=0;q<m;q++)k.set(n[q],(new THREE.Color).setHSL(q/m*.8,1,.42));if(null!==e.ea){q=e.ea.geometry;n=[];if(q instanceof THREE.BufferGeometry)for(m=q.attributes.atomIndex.array,q=0;q<m.length;q++){var r=k.get(e.oa[m[q]]);n.push(r)}else console.warn("Unknown type of geometry for mapping by rainbow ",q);k=n}else k=void 0}else if(f===
Q.vg)if(e.Aa instanceof Kf?e.Aa.ta.xa():e.Aa instanceof Lf&&e.Aa.Eb.xa(),m=e.ea.geometry,k=[],q="IVLFCMAGTWSYPHEZQDBNKR".split(""),n=[45,42,38,28,25,19,18,-4,-7,-9,-8,-13,-16,-32,-35,-35,-35,-35,-35,-35,-39,-45],null!=e.ea)for(m=m.attributes.atomIndex.array,r=0;r<m.length;r++){var t=null,t=e.oa[m[r]].pb();if("Peptide"==t.type||"Protein"==t.type||"Small Peptide"==t.type){var x;for(x=0;x<q.length&&q[x]!=t.Mi().toUpperCase();x++);x==q.length?t=new THREE.Color(1,1,1):(t=n[x],t=0<t?new THREE.Color(1,1-
t/45,1-t/45):new THREE.Color(1-t/-45,1-t/-45,1))}else t=new THREE.Color(1,1,1);k.push(t)}else k=void 0;else if(null!==e.ea){k=e.ea.geometry.attributes.atomIndex.array;q=k.length;n=[];for(m=0;m<q;m++){var r=e,t=k[m],w=x=x=x=void 0,w=void 0;switch(f){case Q.Wb:x=r.oa[t].pb().Ea.id.toUpperCase();x=De(r.ra,x,"M");break;case Q.Hb:x=r.oa[t].pb().Wc().toUpperCase();x=De(r.ra,x,"R");break;case Q.Wa:w=r.oa[t];w=w.symbol.charAt(0).toUpperCase()+w.symbol.slice(1).toLowerCase();x=De(r.ra,w,"A");break;case Q.tg:w=
r.oa[t];"C"===w.symbol&&(w=w.symbol.charAt(0).toUpperCase()+w.symbol.slice(1).toLowerCase(),x=De(r.ra,w,"A"));break;case Q.ug:w=r.oa[t];"C"!==w.symbol&&(w=w.symbol.charAt(0).toUpperCase()+w.symbol.slice(1).toLowerCase(),x=De(r.ra,w,"A"));break;case Q.zg:w=r.oa[t],x=De(r.ra,w.pb().rb.name,"SST")}n.push(x)}k=n}else k=void 0;g[h]=k;return e.wc[f.id]}
function Mf(e,f,g,h){1<f&&(f=f/255);1<g&&(g=g/255);1<h&&(h=h/255);if(null!==e.ea)if(e=e.ea.geometry,e instanceof THREE.BufferGeometry){for(var k=e.attributes.color.array,n=k.length/3,m=0;m<n;m++)k[3*m]=f,k[3*m+1]=g,k[3*m+2]=h;e.attributes.color.needsUpdate=!0}else console.warn("Unknown type of geometry for coloring by atom ",e)}z.hg=function(e,f){if(null!==this.ea)if(void 0===f||0===f)this.ea.material.transparent=!0,this.ea.material.opacity=e;else return new nf(e,f,this);return null};
z.update=function(e){if(e.Yh){e=e.Wg;if(void 0!=e){if("Amino Acids"===e||"Nucleic Acids"===e)e=Q.Hb;this.wc[e]=null}else this.wc=[];this.color(this.u)}};
var Q={Wb:{name:"Molecules",id:"molecule"},Hb:{name:"Residues",id:"residue"},Wa:{name:"Atoms",id:"atom"},tg:{name:"Carbon atom",id:"carbon"},ug:{name:"Heteroatom",id:"heteroatom"},zg:{name:"Secondary Structure Type",id:"sse"},xg:{name:"Rainbow",id:"rainbow"},vg:{name:"Hydrophobicity",id:"hydrophobicity"},jk:function(){var e=[],f;for(f in this){var g=this[f];this.hasOwnProperty(f)&&"object"===typeof g&&e.push(g.name)}return e},ih:function(e){for(var f in this)if(this[f].id===e)return this[f];return null},
ik:function(e){for(var f in this)if(this[f].name===e)return this[f];return null}};function Pf(e,f,g){this.name=e;this.Oj=f;this.Ja=g;var h=arguments.length-3;1<=h&&(this.Nk=arguments[3]);2<=h&&(this.Fl=arguments[4])}var V={};V.NONE=new Pf("","NONE",null);V.Tf=function(e){for(var f in V)if(V[f].Oj===e)return V[f]};var Qf=Object;
Qf.$j=function(e,f){for(var g=null,h=Rf(e),k=h.length,n=0;n<k;n++)g=h[n],g.eb=!1,g.alpha=THREE.GeometryUtils.tl(g.a,g.b,g.c,g.d),g.Kc=g.alpha>f;for(var m=new ja,h=Rf(e),k=h.length,n=0;n<k;n++){for(var g=h[n],q=[],r=Sf(g),t=0;4>t;t++){var x=Tf(g,t);q.push(Qf.Ek(g,x[3],r[t],x[0],x[1],x[2],f))}m.set(g,q)}x=[];h=Rf(e);k=h.length;for(n=0;n<k;n++)if(g=h[n],g.eb=!1,g.Kc=!1,null==g.xb||null==g.Ab||null==g.Bb||null==g.Cb){r=Sf(g);q=m.get(g);for(t=0;4>t;t++)null!=r[t]||q[t]||(g.Kc=!0);g.Kc&&x.push(g)}for(;0!==
x.length;)for(n=x[x.length-1],x.splice(x.length-1),n.eb=!0,n.Kc=!0,r=Sf(n),q=m.get(n),t=0;4>t;t++)null==r[t]||r[t].eb||q[t]||x.push(r[t]);h=Rf(e);k=h.length;for(n=0;n<k;n++)if(g=h[n],g.eb=!1,!g.Kc)for(r=Sf(g),q=m.get(g),t=0;4>t;t++)null==r[t]||r[t].Kc||(q[t]=!1);return m};
Qf.Qj=function(e,f,g){g=Qf.$j(f,g);f=Rf(f);for(var h=[],k=Array(3),n=f.length,m=0;m<n;m++){for(var q=f[m],r=Sf(q),t=g.get(q),r=r.length,x=0;x<r;x++)if(t[x]){for(var w=Tf(q,x),E=0;3>E;E++){var F=w[E],G=h.indexOf(F);-1===G&&(G=h.push(F)-1,Wd(e,F.x,F.y,F.z));k[E]=G}q.Kc?Xd(e,k[2],k[1],k[0]):Xd(e,k[0],k[1],k[2])}q.eb=!0}return h};
Qf.Ek=function(e,f,g,h,k,n,m){if(null==e)throw"!!";var q=e.Kc,r=null==g||g.Kc;return q!=r||q&&r&&(null==g||0<THREE.GeometryUtils.Qi(h,k,n,Uf(e,g)))&&0<THREE.GeometryUtils.Qi(h,k,n,f)&&m>=THREE.GeometryUtils.vl(h,k,n)?!0:!1};function Vf(){this.dj=1.4;this.alpha=0;this.ti=new ja}function Wf(){this.za=[];this.Hi=[];this.Of=0}function Xf(e){return e.za.length-e.Of}function Yf(e,f,g){THREE.Vector3.call(this);this.th=!0;this.x=e;this.y=f;this.z=g;this.radius=this.weight=1;this.zb=[]}
Yf.prototype.set=function(e,f){this.weight=e;this.radius=f};Yf.prototype.toString=function(){return this.x+":"+this.y+":"+this.z};Yf.prototype.wb=function(){return this.x+":"+this.y+":"+this.z};function Zf(e,f,g,h){for(var k=e.zb.length,n=0;n<k;n++){var m=e.zb[n];if($f(m,g)&&$f(m,h)&&m!=f)return m}return null}Yf.prototype.remove=function(){for(var e=[],f=this.zb.length,g=0;g<f;g++)e.push(this.zb[g]);f=e.length;for(g=0;g<f;g++)e[g].disconnect()};
function ag(){this.wi=this.Fc=this.nd=this.ec=this.max=this.min=null;this.ef=0;this.Ec=[];this.Kd=[];this.Xa=[];this.iterator=null;this.Ok=0}ag.prototype.toString=function(){return"Tesselation"};function bg(e,f){var g=Math.trunc((f.x-e.min.x)*e.ec/(e.max.x-e.min.x)),h=Math.trunc((f.y-e.min.y)*e.nd/(e.max.y-e.min.y)),k=Math.trunc((f.z-e.min.z)*e.Fc/(e.max.z-e.min.z));0>g&&(g=0);g>=e.ec&&(g=e.ec-1);0>h&&(h=0);h>=e.nd&&(h=e.nd-1);0>k&&(k=0);k>=e.Fc&&(k=e.Fc-1);return g+h*e.ec+k*e.ec*e.Fc}
function cg(e,f,g){f.Oe=!0;e.Kd.push(f);var h=f.xb;null==h||void 0===h||h.eb||(h.eb=!0,0<dg(h,g)&&cg(e,h,g));h=f.Ab;null==h||void 0===h||h.eb||(h.eb=!0,0<dg(h,g)&&cg(e,h,g));h=f.Bb;null==h||void 0===h||h.eb||(h.eb=!0,0<dg(h,g)&&cg(e,h,g));h=f.Cb;null==h||void 0===h||h.eb||(h.eb=!0,0<dg(h,g)&&cg(e,h,g))}
function eg(e,f){f.eb=!1;var g;g=f.xb;null!=g&&void 0!==g&&g.eb&&eg(e,g);g=f.Ab;null!=g&&void 0!==g&&g.eb&&eg(e,g);g=f.Bb;null!=g&&void 0!==g&&g.eb&&eg(e,g);g=f.Cb;null!=g&&void 0!==g&&g.eb&&eg(e,g)}function Rf(e){var f=0;e.iterator=new fg(e);for(var g=[];null!=e.iterator.Va;){var h=e.iterator.next();void 0!==h&&g.push(h);f++}return g}
function fg(e){this.Dd=e;this.Gb=this.Ib=0;for(this.Va=this.Dd.Ec[this.Ib];this.Ib<this.Dd.ef&&(null==this.Va||void 0==this.Va||0==Xf(this.Va));)this.Ib++,this.Va=this.Ib<this.Dd.ef?this.Dd.Ec[this.Ib]:null;if(null!=this.Va&&void 0!=this.Va)for(;this.Gb<this.Va.za.length&&(null==this.Va.za[this.Gb]||void 0==this.Va.za[this.Gb]);)this.Gb++}
fg.prototype.next=function(){var e=this.Dd.Ec[this.Ib].za[this.Gb];for(this.Gb++;this.Gb<this.Va.za.length&&(null==this.Va.za[this.Gb]||void 0===this.Va.za[this.Gb]);)this.Gb++;if(this.Gb>=this.Va.za.length){this.Gb=0;for(this.Ib++;this.Ib<this.Dd.ef;){this.Va=this.Dd.Ec[this.Ib];if(null!==this.Va&&void 0!==this.Va&&0<Xf(this.Va))break;this.Ib++}this.Ib>=this.Dd.ef&&(this.Va=null)}if(null!=this.Va&&void 0!=this.Va)for(;this.Gb<this.Va.za.length&&null==this.Va.za[this.Gb];)this.Gb++;return e};
function gg(){this.eb=!1;this.Kc=null;this.alpha=-1;this.Oe=!1;this.box=this.d=this.c=this.b=this.a=this.Fh=null;this.Ib=-1;this.id=this.Cb=this.Bb=this.Ab=this.xb=null}gg.prototype.toString=function(){return this.Fh+":"+this.id};gg.prototype.wb=function(){return this.Fh+":"+this.id};
gg.prototype.set=function(e,f,g,h,k,n){this.Fh=e;this.a=f;this.b=g;this.c=h;this.d=k;this.Oe=!1;this.id=e.Ok++;var m=new THREE.Vector3((this.a.x+this.b.x+this.c.x+this.d.x)/4,(this.a.y+this.b.y+this.c.y+this.d.y)/4,(this.a.z+this.b.z+this.c.z+this.d.z)/4),m=bg(e,m);if(void 0===e.Ec[m]||null===e.Ec[m])e.Ec[m]=new Wf;e=e.Ec[m];this.box=e;e=this.box;m=0<e.Of?e.Hi[--e.Of]:e.za.length;e.za[m]=this;this.Ib=m;f.zb.push(this);g.zb.push(this);h.zb.push(this);k.zb.push(this);null!=n?this.xb=n:this.xb=Zf(this.a,
this,this.b,this.c);null!=this.xb&&hg(this.xb,this.a,this.b,this.c,this);this.Ab=Zf(this.a,this,this.c,this.d);null!=this.Ab&&hg(this.Ab,this.a,this.c,this.d,this);this.Bb=Zf(this.a,this,this.d,this.b);null!=this.Bb&&hg(this.Bb,this.a,this.d,this.b,this);this.Cb=Zf(this.b,this,this.d,this.c);null!=this.Cb&&hg(this.Cb,this.b,this.d,this.c,this)};
function dg(e,f){var g=e.a.x-f.x,h=e.a.y-f.y,k=e.a.z-f.z,n=e.b.x-f.x,m=e.b.y-f.y,q=e.b.z-f.z,r=e.c.x-f.x,t=e.c.y-f.y,x=e.c.z-f.z,w=e.d.x-f.x,E=e.d.y-f.y,F=e.d.z-f.z;return-THREE.GeometryUtils.sign(THREE.GeometryUtils.Xj(g,h,k,g*g+h*h+k*k+(f.weight-e.a.weight),n,m,q,n*n+m*m+q*q+(f.weight-e.b.weight),r,t,x,r*r+t*t+x*x+(f.weight-e.c.weight),w,E,F,w*w+E*E+F*F+(f.weight-e.d.weight)))}
function hg(e,f,g,h,k){if(f===e.a||g===e.a||h===e.a)if(f===e.c||g===e.c||h===e.c)f===e.b||g===e.b||h===e.b?e.xb=k:e.Ab=k;else{if(f!==e.d&&g!==e.d&&h!==e.d)throw"This tetrahedron doesn't have the right vertices";e.Bb=k}else if(f===e.b||g===e.b||h===e.b)e.Cb=k;else throw"This tetrahedron doesn't have the right vertices - ("+f+"),("+g+"),("+h+") - ("+a+"),("+b+"),("+c+"),("+d+")";}function Sf(e){var f=[];f.push(e.xb);f.push(e.Ab);f.push(e.Bb);f.push(e.Cb);return f}
function Tf(e,f){if(0==f)return[e.c,e.b,e.a,e.d];if(1==f)return[e.d,e.c,e.a,e.b];if(2==f)return[e.b,e.d,e.a,e.c];if(3==f)return[e.c,e.d,e.b,e.a];throw"i :"+f+" not between 0 and 3";}function $f(e,f){return e.a.x===f.x&&e.a.y===f.y&&e.a.z===f.z||e.b.x===f.x&&e.b.y===f.y&&e.b.z===f.z||e.c.x===f.x&&e.c.y===f.y&&e.c.z===f.z||e.d.x===f.x&&e.d.y===f.y&&e.d.z===f.z}
gg.prototype.disconnect=function(){var e=this.box,f=this.Ib;e.za[f]=null;e.Hi[e.Of++]=f;null!=this.xb&&hg(this.xb,this.a,this.b,this.c,null);null!=this.Ab&&hg(this.Ab,this.a,this.c,this.d,null);null!=this.Bb&&hg(this.Bb,this.a,this.d,this.b,null);null!=this.Cb&&hg(this.Cb,this.b,this.d,this.c,null);this.a.zb.splice(this.a.zb.indexOf(this),1);this.b.zb.splice(this.b.zb.indexOf(this),1);this.c.zb.splice(this.c.zb.indexOf(this),1);this.d.zb.splice(this.d.zb.indexOf(this),1);this.Cb=this.Bb=this.Ab=this.xb=
this.d=this.c=this.b=this.a=null};function Uf(e,f){if(f.xb==e)return f.d;if(f.Ab==e)return f.b;if(f.Bb==e)return f.c;if(f.Cb==e)return f.a;throw"getOtherVertex: Tetrahedra "+e+" and "+f+" not touching";}function ig(e,f){O.call(this,e);this.wireframe=f}ig.prototype=Object.create(O.prototype);ig.prototype.constructor=ig;V.wf=new Pf("Alpha Shape","ASHAPE",ig,!1);V.rg=new Pf("Alpha Shape Wireframe","ASHAPEM",ig,!0);
ig.prototype.Qa=function(){var e=Ie(),f=null;if(this.wireframe)e.wireframe=!0,e.wireframeLinewidth=2,f=jg(this.Aa,V.wf),null===f.ea&&(f.Qa(),f.hide()),f=f.ea.geometry.clone();else{e.side=THREE.DoubleSide;e.shading=THREE.FlatShading;for(var f=new Vf,g=this.oa,h=[],k=g.length,n=0;n<k;n++){var m=g[n];f.ti.set(m.pos,m);var q=He(xe(),m),r=(q+f.dj)*(q+f.dj),m=new Yf(m.pos.x,m.pos.y,m.pos.z);m.set(r,q);h.push(m)}m=new ag;if(4>h.length)throw"Too few points to tesselate";m.min=new THREE.Vector3(Infinity,Infinity,
Infinity);m.max=new THREE.Vector3(-Infinity,-Infinity,-Infinity);k=h.length;for(n=0;n<k;n++)q=h[n],m.min.x=Math.min(m.min.x,q.x),m.min.y=Math.min(m.min.y,q.y),m.min.z=Math.min(m.min.z,q.z),m.max.x=Math.max(m.max.x,q.x),m.max.y=Math.max(m.max.y,q.y),m.max.z=Math.max(m.max.z,q.z);var r=(m.min.x+m.max.x)/2,t=(m.min.y+m.max.y)/2,x=(m.min.z+m.max.z)/2,w=m.min.distanceTo(m.max);m.ec=8;m.nd=8;m.Fc=8;m.wi=Math.max(m.ec,Math.max(m.nd,m.Fc));m.ef=m.ec*m.nd*m.Fc;k=new Yf(r-w,t-w,x-w);n=new Yf(r+w,t+w,x-w);q=
new Yf(r-w,t+w,x+w);r=new Yf(r+w,t-w,x+w);(new gg).set(m,k,n,q,r,null);t=h.length;for(x=0;x<t;x++){var w=m,E=h[x];w.Kd=[];var F=!1,G=w.Ec[bg(w,E)];if(void 0!==G&&null!==G){var I=void 0;for(I in G.za){var C=G.za[I];if(null!=C){var K=dg(C,E);0===K&&console.warn(">1 point on the same power sphere");if(null!==C&&void 0!==C&&0<K){C.eb=!0;cg(w,C,E);eg(w,C);F=!0;break}}}}if(!F)for(var G=!1,K=Math.trunc((E.x-w.min.x)*w.ec/(w.max.x-w.min.x)),H=Math.trunc((E.y-w.min.y)*w.nd/(w.max.y-w.min.y)),L=Math.trunc((E.z-
w.min.z)*w.Fc/(w.max.z-w.min.z)),F=1;F<w.wi&&!G;F++)for(var P=-F;P<=F&&!G;P++)for(var U=-F;U<=F&&!G;U++)for(var X=-F;X<=F&&!G;X++)if(Math.abs(X)==F||Math.abs(U)==F||Math.abs(P)==F){var C=K+X,oa=H+U,ma=L+P;if(!(0>C||C>=w.ec||0>oa||oa>=w.nd||0>ma||ma>=w.Fc)&&(C=w.Ec[Math.trunc(C+oa*w.ec+ma*w.ec*w.Fc)],null!=C))for(I in oa=C.za,oa)if(C=oa[I],null!=C&&void 0!=C&&0<dg(C,E)){C.eb=!0;cg(w,C,E);eg(w,C);G=!0;break}}w.Xa=[];G=w.Kd.length;for(F=0;F<G;F++)C=w.Kd[F],null!=C.xb&&C.xb.Oe||(w.Xa.push(C.xb),w.Xa.push(C.a),
w.Xa.push(C.b),w.Xa.push(C.c)),null!=C.Ab&&C.Ab.Oe||(w.Xa.push(C.Ab),w.Xa.push(C.a),w.Xa.push(C.c),w.Xa.push(C.d)),null!=C.Bb&&C.Bb.Oe||(w.Xa.push(C.Bb),w.Xa.push(C.a),w.Xa.push(C.d),w.Xa.push(C.b)),null!=C.Cb&&C.Cb.Oe||(w.Xa.push(C.Cb),w.Xa.push(C.b),w.Xa.push(C.d),w.Xa.push(C.c));for(F=0;F<G;F++)C=w.Kd[F],C.disconnect();C=0;G=w.Xa.length;for(F=0;F<G;F+=4)K=w.Xa[F],H=w.Xa[F+1],L=w.Xa[F+2],P=w.Xa[F+3],U=(new THREE.Vector3((H.x+L.x+P.x)/3,(H.y+L.y+P.y)/3,(H.z+L.z+P.z)/3)).sub(E),U=0>THREE.Vector3.u(H,
L,P).dot(U),X=C<w.Kd.length?w.Kd[C++]:new gg,U?X.set(w,H,L,P,E,K):X.set(w,P,L,H,E,K)}k.remove();n.remove();q.remove();r.remove();I=new Vd(!0);h=Qf.Qj(I,m,f.alpha);k=h.length;for(m=0;m<k;m++){n=h[m];q=f.ti.get(n);r=g.indexOf(q);if(void 0===q)throw"Couldn't get atom for position :"+n.x+", "+n.y+", "+n.z;I.Qc.push(r)}f=Yd(I);f.computeVertexNormals()}e=new THREE.Mesh(f,e);e.Ja=this;this.parent.add(e);this.ea=e;this.color(Q.Wa)};ig.prototype.update=function(e){O.prototype.update.call(this,e)};
function kg(e){O.call(this,e)}kg.prototype=Object.create(O.prototype);kg.prototype.constructor=kg;V.Ed=new Pf("Atoms","ATOMS",kg);
kg.prototype.Qa=function(){for(var e=new THREE.BufferGeometry,f=[],g=[],h=[],k=this.oa.length,n=0;n<k;n++){var m=this.oa[n],q=m.pos.clone();q.pa=m;q.x-=.5;var r=m.pos.clone();r.pa=m;r.x+=.5;var t=m.pos.clone();t.pa=m;t.y-=.5;var x=m.pos.clone();x.pa=m;x.y+=.5;var w=m.pos.clone();w.pa=m;w.z-=.5;var E=m.pos.clone();E.pa=m;E.z+=.5;f.push(q.x,q.y,q.z,r.x,r.y,r.z,t.x,t.y,t.z,x.x,x.y,x.z,w.x,w.y,w.z,E.x,E.y,E.z);for(m=0;18>m;m++)g.push(1);for(m=0;6>m;m++)h.push(n)}f=new Float32Array(f);g=new Float32Array(g);
h=new Float32Array(h);e.addAttribute("position",new THREE.BufferAttribute(f,3));g=new THREE.BufferAttribute(g,3);g.dynamic=!0;e.addAttribute("color",g);e.addAttribute("atomIndex",new THREE.BufferAttribute(h,1));e.ud();h=new THREE.LineBasicMaterial({linewidth:this.ra.Uh,vertexColors:THREE.VertexColors});e=new THREE.LineSegments(e,h);e.Ja=this;this.parent.add(e);this.ea=e;this.Ad()};kg.prototype.update=function(e){O.prototype.update.call(this,e);e.Uh&&(this.parent.remove(this.ea),this.ea=null,this.Qa())};
function lg(e){O.call(this,e)}lg.prototype=Object.create(O.prototype);lg.prototype.constructor=lg;V.de=new Pf("Balls & sticks","BSTICKS",lg);
lg.prototype.Qa=function(){var e=Ee(this.ra),f=Ie(),g=(new THREE.BufferGeometry).fromGeometry(e),h=this.oa.length,k=g.attributes.position.array.length/g.attributes.position.itemSize,n=h*k,m=jg(this.Aa,V.cc);null===m.ea&&(m.Qa(),m.hide());for(var e=new THREE.BufferGeometry,m=m.ea.geometry,q=Array(3*n),r=Array(3*n),t=Array(3*n),x=Array(2*n),n=Array(n),w=0;w<h;w++){var E=this.oa[w],F=new THREE.Matrix4;F.setPosition(E.pos);E=g.clone();E.applyMatrix(F);for(var G=E.attributes.position.array,F=0;F<G.length;F++)q[w*
G.length+F]=G[F];G=E.attributes.normal.array;for(F=0;F<G.length;F++)r[w*G.length+F]=G[F];G=E.attributes.color.array;for(F=0;F<G.length;F++)t[w*G.length+F]=G[F];E=E.attributes.uv.array;for(F=0;F<E.length;F++)x[w*E.length+F]=E[F];for(F=0;F<k;F++)n[w*k+F]=w}g=new Float32Array(q);h=new Float32Array(r);t=new Float32Array(t);x=new Float32Array(x);n=new Float32Array(n);k=new Float32Array(g.length+m.attributes.position.array.length);k.set(m.attributes.position.array);k.set(g,m.attributes.position.array.length);
g=new Float32Array(h.length+m.attributes.normal.array.length);g.set(m.attributes.normal.array);g.set(h,m.attributes.normal.array.length);h=new Float32Array(t.length+m.attributes.color.array.length);h.set(m.attributes.color.array);h.set(t,m.attributes.color.array.length);t=new Float32Array(x.length+m.attributes.uv.array.length);t.set(m.attributes.uv.array);t.set(x,m.attributes.uv.array.length);x=new Float32Array(n.length+m.attributes.atomIndex.array.length);x.set(m.attributes.atomIndex.array);x.set(n,
m.attributes.atomIndex.array.length);e.addAttribute("position",new THREE.BufferAttribute(k,3));e.addAttribute("normal",new THREE.BufferAttribute(g,3));G=new THREE.BufferAttribute(h,3);G.dynamic=!0;e.addAttribute("color",G);e.addAttribute("uv",new THREE.BufferAttribute(t,2));e.addAttribute("atomIndex",new THREE.BufferAttribute(x,1));e.ud();f=new THREE.Mesh(e,f);f.Ja=this;this.parent.add(f);this.ea=f;this.Ad()};
lg.prototype.update=function(e){O.prototype.update.call(this,e);e.pf&&(this.wc=[],e=jg(this.Aa,V.cc),e.parent.remove(e.ea),e.ea=null,e=this.ea.visible,this.parent.remove(this.ea),this.ea=null,this.Qa(),this.ea.visible=e)};function mg(e){O.call(this,e)}mg.prototype=Object.create(O.prototype);mg.prototype.constructor=mg;V.Ve=new Pf("Cartoon","CARTOON",mg);mg.sa=.075;mg.fa=1.2;mg.da=.25;mg.yb=1.3;mg.Da=.5;mg.aa=.175;mg.v=.175;mg.ya=34;mg.rc=12;
mg.prototype.Qa=function(){var e=De(this.ra,this.Aa.ta.id,"M"),f=null;if(this.za.vd()){var g=this.za;g.ri();var h=[],f=[];h.push(f);for(var k=g.ga,g=g.xa(),n=["N","CA","C"],m=null,q=k.length,r=0;r<q;r++){var t=k[r];if(null!==m){var x=0;isNaN(parseFloat(t.qa()))||(x+=parseFloat(t.qa()));isNaN(parseFloat(m.qa()))||(x-=parseFloat(m.qa()));isNaN(t.ob().charCodeAt(0))||(x+=t.ob().charCodeAt(0));isNaN(m.ob().charCodeAt(0))||(x-=m.ob().charCodeAt(0));1<x&&(f=[],h.push(f))}for(var w in n)if(m=t.gc(n[w]),
void 0!==m&&null!==m){var x=new ng(m),E=g.indexOf(m);x.$b=e;x.pa=m;x.Ka=E;x.cd="CA"!==m.name;switch(t.rb.name){case D.u.name:x.width=mg.sa;x.height=mg.fa;x.fc=mg.da;break;case D.aa.name:case D.v.name:x.width=mg.yb;x.height=mg.Da;x.vb=!0;x.Rd=mg.ya;break;default:x.width=mg.aa,x.height=mg.v}f.push(x)}m=t}f=h}else if(this.za.Ae()){g=this.za;w=[];f=[];w.push(f);k=g.ga;g=g.xa();n=["P","O5'","O3'"];m=null;q=k.length;for(r=0;r<q;r++){t=k[r];null!==m&&1<t.qa()-m.qa()+t.ob().charCodeAt(0)-m.ob().charCodeAt(0)&&
(f=[],w.push(f));for(h in n)m=t.gc(n[h]),null!==m&&void 0!==m&&(x=new ng(m),E=g.indexOf(m),x.$b=e,x.pa=m,x.Ka=E,x.cd=!0,x.width=mg.sa,x.height=mg.fa,x.fc=mg.da,x.Rd=mg.rc,f.push(x));m=t}f=w}w=new Vd(!0);if(null!==f){var h=new og,F;for(F in f)2<f[F].length&&Hg(h,w,f[F],e);e=Yd(w);F=Ie();e=new THREE.Mesh(e,F);e.pa=this.za;e.Ja=this;this.parent.add(e);this.ea=e;this.color(Q.Wb)}};mg.prototype.Ad=function(){this.color(Q.Wb)};mg.prototype.update=function(e){O.prototype.update.call(this,e)};
function Y(e){O.call(this,e)}Y.prototype=Object.create(O.prototype);Y.prototype.constructor=Y;V.sg=new Pf("Cylinder","CYLINDER",Y);Y.sa=.075;Y.fa=1.2;Y.da=.25;Y.yb=1.3;Y.Da=.5;Y.aa=.175;Y.v=.175;Y.ya=34;Y.rc=12;Y.u=20;Y.wd=2.5;
Y.prototype.Qa=function(){var e=De(this.ra,this.Aa.ta.id,"M"),f=null,g=[],h=[],k=[],n=[],m=[],q=[],r=[],t=[];if(this.za.vd()){var x=this.za;x.ri();for(var w=x.ga,E=x.xa(),F=[],G=[],I=[],C=[],K=[],H=[],L=[],P=[],U=!1,X=!1,oa=["N","CA","C"],ma=null,Gb=w.length,Sb=0;Sb<Gb;Sb++){var ca=w[Sb];if(null!==ma){var aa=0;isNaN(parseFloat(ca.qa()))||(aa+=parseFloat(ca.qa()));isNaN(parseFloat(ma.qa()))||(aa-=parseFloat(ma.qa()));isNaN(ca.ob().charCodeAt(0))||(aa+=ca.ob().charCodeAt(0));isNaN(ma.ob().charCodeAt(0))||
(aa-=ma.ob().charCodeAt(0));1<aa&&(U?(I.push(C),U=!1):X&&(F.push(G),X=!1))}for(var va in oa){var Hb=ca.gc(oa[va]);if(void 0!==Hb&&null!==Hb){var W=new ng(Hb),l=E.indexOf(Hb);W.$b=e;W.pa=Hb;W.Ka=l;W.cd="CA"!==Hb.name;switch(ca.rb.name){case D.u.name:U||(X&&(K.push(F.length),H.push(I.length),F.push(G),X=!1),C=[],U=!0);C.push(Hb);break;case D.aa.name:case D.v.name:W.width=Y.yb;W.height=Y.Da;W.vb=!0;W.Rd=Y.ya;U?(P.push(I.length),L.push(F.length),I.push(C),U=!1,G=[],X=!0):X||(G=[],X=!0);G.push(W);break;
default:W.width=Y.aa,W.height=Y.v,U?(P.push(I.length),L.push(F.length),I.push(C),U=!1,G=[],X=!0):X||(G=[],X=!0),G.push(W)}}}ma=ca}U?I.push(C):X&&F.push(G);f=[F,I,K,H,L,P];g=f[0];h=f[1];k=f[2];n=f[3];m=f[4];q=f[5]}else this.za.Ae()&&console.warn("Cylinder representation not available for nucleic molecules");var y=new Vd(!0);if(null!==g){var Ib=new og,na;for(na in h){var xb=null,uc=null;if(2<h[na].length){var bb,sa=y,yb=h[na],gd=e;console.assert(2<yb.length,"Helix number must be > 2");for(var Tb,cb=
yb,ob=0,db=0,pb=0,qa=0,eb=0,Ma=0,qb=0,zb=0,Na=0,pa=cb.length,N=null,R=0;R<pa;R++)N=cb[R],ob+=N.pos.x,db+=N.pos.y,pb+=N.pos.z,qa+=N.pos.x*N.pos.x,eb+=N.pos.y*N.pos.y,Ma+=N.pos.z*N.pos.z,qb+=N.pos.x*N.pos.y,zb+=N.pos.y*N.pos.z,Na+=N.pos.z*N.pos.x;for(var rb=pa*qa-ob*ob,Ha=(pa*qb-ob*db)/rb,Ub=(-ob*qb+qa*db)/rb,Jc=pa*eb-db*db,hc=(pa*zb-db*pb)/Jc,Vb=(-db*zb+eb*pb)/Jc,Kc=pa*Ma-pb*pb,ic=(pa*Na-pb*ob)/Kc,Ab=(-pb*Na+Ma*ob)/Kc,jc=1-Ha*hc*ic,Ia=(hc*ic*Ub+ic*Vb+Ab)/jc,Va=(Ub+Ha*ic*Vb+Ha*Ab)/jc,fb=(hc*Ub+Vb+Ha*
hc*Ab)/jc,ia=void 0,ba=void 0,da=void 0,Ba=0,Bb=0,sb=Number.POSITIVE_INFINITY,tb=0;180>=tb;tb+=10)for(var Ja=Math.PI*tb/180,Cb=0;360>Cb;Cb+=10){for(var ra=Math.PI*Cb/180,ia=Math.cos(ra)*Math.sin(Ja),ba=Math.sin(ra)*Math.sin(Ja),da=Math.cos(Ja),Oa=0,R=0;R<pa;R++)var N=cb[R],ka=(ia*(N.pos.x-Ia)+ba*(N.pos.y-Va)+da*(N.pos.z-fb))/(ia*ia+ba*ba+da*da),Wa=ia*ka+Ia,ta=ba*ka+Va,gb=da*ka+fb,Oa=Oa+((N.pos.x-Wa)*(N.pos.x-Wa)+(N.pos.y-ta)*(N.pos.y-ta)+(N.pos.z-gb)*(N.pos.z-gb));Oa<sb&&(sb=Oa,Ba=Ja,Bb=ra)}for(var vc=
Ba,wc=Bb,Wb=-10;10>=Wb;Wb++)for(var Ja=vc+Math.PI*Wb/180,wa=-10;10>=wa;wa++){ra=wc+Math.PI*wa/180;ia=Math.cos(ra)*Math.sin(Ja);ba=Math.sin(ra)*Math.sin(Ja);da=Math.cos(Ja);for(R=Oa=0;R<pa;R++)N=cb[R],ka=(ia*(N.pos.x-Ia)+ba*(N.pos.y-Va)+da*(N.pos.z-fb))/(ia*ia+ba*ba+da*da),Wa=ia*ka+Ia,ta=ba*ka+Va,gb=da*ka+fb,Oa+=(N.pos.x-Wa)*(N.pos.x-Wa)+(N.pos.y-ta)*(N.pos.y-ta)+(N.pos.z-gb)*(N.pos.z-gb);Oa<sb&&(sb=Oa,Ba=Ja,Bb=ra)}for(var ia=Math.cos(Bb)*Math.sin(Ba),ba=Math.sin(Bb)*Math.sin(Ba),da=Math.cos(Ba),la=
[],xa=[],Lc=!1;!Lc;){for(R=0;R<cb.length;R++)N=cb[R],ka=(ia*(N.pos.x-Ia)+ba*(N.pos.y-Va)+da*(N.pos.z-fb))/(ia*ia+ba*ba+da*da),xa[R]=ka,Wa=ia*ka+Ia,ta=ba*ka+Va,gb=da*ka+fb,la[R]=new THREE.Vector3(Wa,ta,gb);xa[0]>xa[xa.length-1]?(ia=-ia,ba=-ba,da=-da):Lc=!0}for(R=0;R<cb.length;R++)for(var Ca=R+1;Ca<cb.length;Ca++)xa[R]>xa[Ca]&&(Ja=xa[R],xa[R]=xa[Ca],xa[Ca]=Ja,ra=la[R],la[R]=la[Ca],la[Ca]=ra);Tb=[la,ia,ba,da];var Jb=Tb[0],Mc=Tb[1],Nc=Tb[2],Xb=Tb[3],Pa=Jb[0],Ka=Jb[Jb.length-1],kc=Ka.clone().sub(Pa).normalize(),
xc=de(kc.clone()),lc=kc.clone().cross(xc).normalize(),hb=sa.jc.length/3,Kb=NaN,Xa=0,Lb=Pa.clone();Lb.pa=yb[0];var mc=this.oa.indexOf(yb[0]);Lb.Ka=mc;Wd(sa,Lb.x,Lb.y,Lb.z,gd);sa.Qc.push(Lb.Ka);var hb=sa.jc.length/3,Db=hb-1;Ig(this,sa,xc,lc,Pa,yb[0],gd);for(var Xa=hb,hb=sa.jc.length/3,ua=0;ua<Y.u;ua++){var Qa=(ua+1)%Y.u;Xd(sa,Db,Xa+ua,Xa+Qa)}for(var A=1;A<yb.length;A++){var ub=yb[A],Ka=Jb[A];Ig(this,sa,xc,lc,Ka,ub,gd);Kb=Xa;Xa=hb;hb=sa.jc.length/3;for(ua=0;ua<Y.u;ua++)Qa=(ua+1)%Y.u,Xd(sa,Kb+ua,Xa+ua,
Xa+Qa),Xd(sa,Kb+ua,Xa+Qa,Kb+Qa)}var fa=Ka.clone();fa.pa=yb[yb.length-1];mc=this.oa.indexOf(yb[yb.length-1]);fa.Ka=mc;Wd(sa,fa.x,fa.y,fa.z,gd);sa.Qc.push(fa.Ka);hb=sa.jc.length/3;for(ua=0;ua<Y.u;ua++)Qa=(ua+1)%Y.u,Xd(sa,hb-1,Xa+Qa,Xa+ua);Pa.add((new THREE.Vector3(Mc,Nc,Xb)).multiplyScalar(.3));Ka.add((new THREE.Vector3(-Mc,-Nc,-Xb)).multiplyScalar(.3));bb=[Pa,Ka];xb=bb[0];uc=bb[1]}r.push(xb);t.push(uc)}for(na=0;na<k.length;na++){var Yb=k[na],J=n[na];if(null!=r[J]){var ya=g[Yb],za=h[J],Ra=za[0],S=new ng(Ra),
Sa=this.oa.indexOf(Ra);S.$b=e;S.pa=Ra;S.Ka=Sa;S.width=Y.aa;S.height=Y.v;S.pos=r[J];ya.push(S.clone());ya.push(S.clone());ya.push(S.clone())}}for(na=0;na<m.length;na++)J=q[na],Yb=m[na],null!=r[J]&&(ya=g[Yb],za=h[J],Ra=za[za.length-1],S=new ng(Ra),Sa=this.oa.indexOf(Ra),S.$b=e,S.pa=Ra,S.Ka=Sa,S.width=Y.aa,S.height=Y.v,S.pos=t[J],ya.splice(0,0,S.clone()),ya.splice(0,0,S.clone()),ya.splice(0,0,S.clone()));for(na in g)2<g[na].length&&Hg(Ib,y,g[na],e);var Eb=Yd(y),hd=Ie();hd.vertexColors=THREE.FaceColors;
var Zb=new THREE.Mesh(Eb,hd);Zb.pa=this.za;Zb.Ja=this;this.parent.add(Zb);this.ea=Zb;this.color(Q.Wb)}};function Ig(e,f,g,h,k,n,m){for(var q=0;q<Y.u;q++){var r=q*Math.PI*2/Y.u,t=Y.wd*Math.sin(r),r=Y.wd*Math.cos(r),t=g.clone().multiplyScalar(t).add(h.clone().multiplyScalar(r)),t=k.clone().add(t);t.pa=n;t.Ka=e.oa.indexOf(n);Wd(f,t.x,t.y,t.z,m);f.Qc.push(t.Ka)}}Y.prototype.Ad=function(){this.color(Q.Wb)};Y.prototype.update=function(e){O.prototype.update.call(this,e)};
function Jg(e){O.call(this,e);this.dc=this.Aa.pa.dc()}Jg.prototype=Object.create(O.prototype);Jg.prototype.constructor=Jg;V.LINES=new Pf("Lines","LINES",Jg);
Jg.prototype.Qa=function(){for(var e=new THREE.BufferGeometry,f=[],g=[],h=[],k=this.oa.length,n=0;n<k;n++){var m=this.oa[n],q=this.dc.findNode(m);if(q){var r=q.qd();if(r)for(var t=r.length,x=0;x<t;x++){var w=kd(r[x],q).Fd;if(this.oa.includes(w)){var E=m.pos,w=w.pos,w=new THREE.Vector3((E.x+w.x)/2,(E.y+w.y)/2,(E.z+w.z)/2);f.push(E.x);f.push(E.y);f.push(E.z);f.push(w.x);f.push(w.y);f.push(w.z);for(E=0;6>E;E++)g.push(1);h.push(n);h.push(n)}}}}f=new Float32Array(f);g=new Float32Array(g);h=new Float32Array(h);
e.addAttribute("position",new THREE.BufferAttribute(f,3));g=new THREE.BufferAttribute(g,3);g.dynamic=!0;e.addAttribute("color",g);e.addAttribute("atomIndex",new THREE.BufferAttribute(h,1));e.ud();h=new THREE.LineBasicMaterial({linewidth:this.ra.lineWidth,vertexColors:THREE.VertexColors});e=new THREE.LineSegments(e,h);e.Ja=this;this.ea=e;this.parent.add(e);this.Ad()};Jg.prototype.update=function(e){O.prototype.update.call(this,e);e.lineWidth&&(this.parent.remove(this.ea),this.ea=null,this.Qa())};
var Kg=[[],[0,8,3],[0,1,9],[1,8,3,9,8,1],[1,2,10],[0,8,3,1,2,10],[9,2,10,0,2,9],[2,8,3,2,10,8,10,9,8],[3,11,2],[0,11,2,8,11,0],[1,9,0,2,3,11],[1,11,2,1,9,11,9,8,11],[3,10,1,11,10,3],[0,10,1,0,8,10,8,11,10],[3,9,0,3,11,9,11,10,9],[9,8,10,10,8,11],[4,7,8],[4,3,0,7,3,4],[0,1,9,8,4,7],[4,1,9,4,7,1,7,3,1],[1,2,10,8,4,7],[3,4,7,3,0,4,1,2,10],[9,2,10,9,0,2,8,4,7],[2,10,9,2,9,7,2,7,3,7,9,4],[8,4,7,3,11,2],[11,4,7,11,2,4,2,0,4],[9,0,1,8,4,7,2,3,11],[4,7,11,9,4,11,9,11,2,9,2,1],[3,10,1,3,11,10,7,8,4],[1,11,
10,1,4,11,1,0,4,7,11,4],[4,7,8,9,0,11,9,11,10,11,0,3],[4,7,11,4,11,9,9,11,10],[9,5,4],[9,5,4,0,8,3],[0,5,4,1,5,0],[8,5,4,8,3,5,3,1,5],[1,2,10,9,5,4],[3,0,8,1,2,10,4,9,5],[5,2,10,5,4,2,4,0,2],[2,10,5,3,2,5,3,5,4,3,4,8],[9,5,4,2,3,11],[0,11,2,0,8,11,4,9,5],[0,5,4,0,1,5,2,3,11],[2,1,5,2,5,8,2,8,11,4,8,5],[10,3,11,10,1,3,9,5,4],[4,9,5,0,8,1,8,10,1,8,11,10],[5,4,0,5,0,11,5,11,10,11,0,3],[5,4,8,5,8,10,10,8,11],[9,7,8,5,7,9],[9,3,0,9,5,3,5,7,3],[0,7,8,0,1,7,1,5,7],[1,5,3,3,5,7],[9,7,8,9,5,7,10,1,2],[10,
1,2,9,5,0,5,3,0,5,7,3],[8,0,2,8,2,5,8,5,7,10,5,2],[2,10,5,2,5,3,3,5,7],[7,9,5,7,8,9,3,11,2],[9,5,7,9,7,2,9,2,0,2,7,11],[2,3,11,0,1,8,1,7,8,1,5,7],[11,2,1,11,1,7,7,1,5],[9,5,8,8,5,7,10,1,3,10,3,11],[5,7,0,5,0,9,7,11,0,1,0,10,11,10,0],[11,10,0,11,0,3,10,5,0,8,0,7,5,7,0],[11,10,5,7,11,5],[10,6,5],[0,8,3,5,10,6],[9,0,1,5,10,6],[1,8,3,1,9,8,5,10,6],[1,6,5,2,6,1],[1,6,5,1,2,6,3,0,8],[9,6,5,9,0,6,0,2,6],[5,9,8,5,8,2,5,2,6,3,2,8],[2,3,11,10,6,5],[11,0,8,11,2,0,10,6,5],[0,1,9,2,3,11,5,10,6],[5,10,6,1,9,2,
9,11,2,9,8,11],[6,3,11,6,5,3,5,1,3],[0,8,11,0,11,5,0,5,1,5,11,6],[3,11,6,0,3,6,0,6,5,0,5,9],[6,5,9,6,9,11,11,9,8],[5,10,6,4,7,8],[4,3,0,4,7,3,6,5,10],[1,9,0,5,10,6,8,4,7],[10,6,5,1,9,7,1,7,3,7,9,4],[6,1,2,6,5,1,4,7,8],[1,2,5,5,2,6,3,0,4,3,4,7],[8,4,7,9,0,5,0,6,5,0,2,6],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9],[3,11,2,7,8,4,10,6,5],[5,10,6,4,7,2,4,2,0,2,7,11],[0,1,9,4,7,8,2,3,11,5,10,6],[9,2,1,9,11,2,9,4,11,7,11,4,5,10,6],[8,4,7,3,11,5,3,5,1,5,11,6],[5,1,11,5,11,6,1,0,11,7,11,4,0,4,11],[0,5,9,0,6,5,0,3,6,11,
6,3,8,4,7],[6,5,9,6,9,11,4,7,9,7,11,9],[10,4,9,6,4,10],[4,10,6,4,9,10,0,8,3],[10,0,1,10,6,0,6,4,0],[8,3,1,8,1,6,8,6,4,6,1,10],[1,4,9,1,2,4,2,6,4],[3,0,8,1,2,9,2,4,9,2,6,4],[0,2,4,4,2,6],[8,3,2,8,2,4,4,2,6],[10,4,9,10,6,4,11,2,3],[0,8,2,2,8,11,4,9,10,4,10,6],[3,11,2,0,1,6,0,6,4,6,1,10],[6,4,1,6,1,10,4,8,1,2,1,11,8,11,1],[9,6,4,9,3,6,9,1,3,11,6,3],[8,11,1,8,1,0,11,6,1,9,1,4,6,4,1],[3,11,6,3,6,0,0,6,4],[6,4,8,11,6,8],[7,10,6,7,8,10,8,9,10],[0,7,3,0,10,7,0,9,10,6,7,10],[10,6,7,1,10,7,1,7,8,1,8,0],[10,
6,7,10,7,1,1,7,3],[1,2,6,1,6,8,1,8,9,8,6,7],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9],[7,8,0,7,0,6,6,0,2],[7,3,2,6,7,2],[2,3,11,10,6,8,10,8,9,8,6,7],[2,0,7,2,7,11,0,9,7,6,7,10,9,10,7],[1,8,0,1,7,8,1,10,7,6,7,10,2,3,11],[11,2,1,11,1,7,10,6,1,6,7,1],[8,9,6,8,6,7,9,1,6,11,6,3,1,3,6],[0,9,1,11,6,7],[7,8,0,7,0,6,3,11,0,11,6,0],[7,11,6],[7,6,11],[3,0,8,11,7,6],[0,1,9,11,7,6],[8,1,9,8,3,1,11,7,6],[10,1,2,6,11,7],[1,2,10,3,0,8,6,11,7],[2,9,0,2,10,9,6,11,7],[6,11,7,2,10,3,10,8,3,10,9,8],[7,2,3,6,2,7],[7,0,8,7,6,0,6,
2,0],[2,7,6,2,3,7,0,1,9],[1,6,2,1,8,6,1,9,8,8,7,6],[10,7,6,10,1,7,1,3,7],[10,7,6,1,7,10,1,8,7,1,0,8],[0,3,7,0,7,10,0,10,9,6,10,7],[7,6,10,7,10,8,8,10,9],[6,8,4,11,8,6],[3,6,11,3,0,6,0,4,6],[8,6,11,8,4,6,9,0,1],[9,4,6,9,6,3,9,3,1,11,3,6],[6,8,4,6,11,8,2,10,1],[1,2,10,3,0,11,0,6,11,0,4,6],[4,11,8,4,6,11,0,2,9,2,10,9],[10,9,3,10,3,2,9,4,3,11,3,6,4,6,3],[8,2,3,8,4,2,4,6,2],[0,4,2,4,6,2],[1,9,0,2,3,4,2,4,6,4,3,8],[1,9,4,1,4,2,2,4,6],[8,1,3,8,6,1,8,4,6,6,10,1],[10,1,0,10,0,6,6,0,4],[4,6,3,4,3,8,6,10,3,
0,3,9,10,9,3],[10,9,4,6,10,4],[4,9,5,7,6,11],[0,8,3,4,9,5,11,7,6],[5,0,1,5,4,0,7,6,11],[11,7,6,8,3,4,3,5,4,3,1,5],[9,5,4,10,1,2,7,6,11],[6,11,7,1,2,10,0,8,3,4,9,5],[7,6,11,5,4,10,4,2,10,4,0,2],[3,4,8,3,5,4,3,2,5,10,5,2,11,7,6],[7,2,3,7,6,2,5,4,9],[9,5,4,0,8,6,0,6,2,6,8,7],[3,6,2,3,7,6,1,5,0,5,4,0],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8],[9,5,4,10,1,6,1,7,6,1,3,7],[1,6,10,1,7,6,1,0,7,8,7,0,9,5,4],[4,0,10,4,10,5,0,3,10,6,10,7,3,7,10],[7,6,10,7,10,8,5,4,10,4,8,10],[6,9,5,6,11,9,11,8,9],[3,6,11,0,6,3,0,5,6,0,
9,5],[0,11,8,0,5,11,0,1,5,5,6,11],[6,11,3,6,3,5,5,3,1],[1,2,10,9,5,11,9,11,8,11,5,6],[0,11,3,0,6,11,0,9,6,5,6,9,1,2,10],[11,8,5,11,5,6,8,0,5,10,5,2,0,2,5],[6,11,3,6,3,5,2,10,3,10,5,3],[5,8,9,5,2,8,5,6,2,3,8,2],[9,5,6,9,6,0,0,6,2],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8],[1,5,6,2,1,6],[1,3,6,1,6,10,3,8,6,5,6,9,8,9,6],[10,1,0,10,0,6,9,5,0,5,6,0],[0,3,8,5,6,10],[10,5,6],[11,5,10,7,5,11],[11,5,10,11,7,5,8,3,0],[5,11,7,5,10,11,1,9,0],[10,7,5,10,11,7,9,8,1,8,3,1],[11,1,2,11,7,1,7,5,1],[0,8,3,1,2,7,1,7,5,7,2,11],
[9,7,5,9,2,7,9,0,2,2,11,7],[7,5,2,7,2,11,5,9,2,3,2,8,9,8,2],[2,5,10,2,3,5,3,7,5],[8,2,0,8,5,2,8,7,5,10,2,5],[9,0,1,5,10,3,5,3,7,3,10,2],[9,8,2,9,2,1,8,7,2,10,2,5,7,5,2],[1,3,5,3,7,5],[0,8,7,0,7,1,1,7,5],[9,0,3,9,3,5,5,3,7],[9,8,7,5,9,7],[5,8,4,5,10,8,10,11,8],[5,0,4,5,11,0,5,10,11,11,3,0],[0,1,9,8,4,10,8,10,11,10,4,5],[10,11,4,10,4,5,11,3,4,9,4,1,3,1,4],[2,5,1,2,8,5,2,11,8,4,5,8],[0,4,11,0,11,3,4,5,11,2,11,1,5,1,11],[0,2,5,0,5,9,2,11,5,4,5,8,11,8,5],[9,4,5,2,11,3],[2,5,10,3,5,2,3,4,5,3,8,4],[5,10,
2,5,2,4,4,2,0],[3,10,2,3,5,10,3,8,5,4,5,8,0,1,9],[5,10,2,5,2,4,1,9,2,9,4,2],[8,4,5,8,5,3,3,5,1],[0,4,5,1,0,5],[8,4,5,8,5,3,9,0,5,0,3,5],[9,4,5],[4,11,7,4,9,11,9,10,11],[0,8,3,4,9,7,9,11,7,9,10,11],[1,10,11,1,11,4,1,4,0,7,4,11],[3,1,4,3,4,8,1,10,4,7,4,11,10,11,4],[4,11,7,9,11,4,9,2,11,9,1,2],[9,7,4,9,11,7,9,1,11,2,11,1,0,8,3],[11,7,4,11,4,2,2,4,0],[11,7,4,11,4,2,8,3,4,3,2,4],[2,9,10,2,7,9,2,3,7,7,4,9],[9,10,7,9,7,4,10,2,7,8,7,0,2,0,7],[3,7,10,3,10,2,7,4,10,1,10,0,4,0,10],[1,10,2,8,7,4],[4,9,1,4,1,
7,7,1,3],[4,9,1,4,1,7,0,8,1,8,7,1],[4,0,3,7,4,3],[4,8,7],[9,10,8,10,11,8],[3,0,9,3,9,11,11,9,10],[0,1,10,0,10,8,8,10,11],[3,1,10,11,3,10],[1,2,11,1,11,9,9,11,8],[3,0,9,3,9,11,1,2,9,2,11,9],[0,2,11,8,0,11],[3,2,11],[2,3,8,2,8,10,10,8,9],[9,10,2,0,9,2],[2,3,8,2,8,10,0,1,8,1,10,8],[1,10,2],[1,3,8,9,1,8],[0,9,1],[0,3,8],[]];function og(){this.mg=24;this.Xh=2;this.sl=3;this.Zk=!1;this.Dj=3;this.Eh=20;this.yd=new THREE.Color(16777215)}
function ng(e){e instanceof Ua?this.pos=e.pos.clone():this.pos=e;this.$b=null;this.pa=e;this.height=this.width=1;this.fc=0;this.vb=this.lf=!1;this.cd=!0;this.Rd=0;this.Za=this.od=this.ua=null;this.re=0}ng.prototype.clone=function(){var e=new ng;e.pos=this.pos.clone();e.$b=this.$b;e.pa=this.pa;e.Ka=this.Ka;e.width=this.width;e.height=this.height;e.fc=this.fc;e.lf=this.lf;e.vb=this.vb;e.cd=this.cd;e.Rd=this.Rd;e.ua=this.ua;e.od=this.od;e.Za=this.Za;e.re=this.re;return e};
function Hg(e,f,g,h){if(!(2>g.length)){e.yd=h;Lg(e,g);Mg(g);Ng(e,g);Og(g);Pg(e,g);g=Qg(e,g);g.forEach(function(e){var f=e.Za.clone().cross(e.ua).normalize();e.od=f});h=0;for(var k=g.length-1;0<=k;k--){var n=g[k];n.vb?(1<k&&(h+=n.pos.distanceTo(g[k-1].pos)),n.re=h):h=0}Rg(e,f,g)}}
function Lg(e,f){for(var g=f.length,h=0;h<e.sl;h++){var k=[];if(e.Zk)for(var n=0;n<g;n++)f[n].cd&&(k[n]=f[n-1].pos.clone().add(f[n+1].pos.clone()).multiplyScalar(.5));else for(f[1].cd&&(k[1]=f[0].pos.clone().add(f[1].pos.clone()).multiplyScalar(.5)),f[g-1].cd&&(k[g-1]=f[g-2].pos.add(f[g-1].pos.clone()).multiplyScalar(.5)),n=2;n<g-2;n++)f[n].cd&&(k[n]=(new THREE.Vector3).lb(f[n-2].pos.clone(),-.25).lb(f[n-1].pos.clone(),.5).lb(f[n].pos.clone(),.5).lb(f[n+1].pos.clone(),.5).lb(f[n+2].pos.clone(),-.25));
for(n=1;n<g-1;n++){var m=k[n];void 0!==m&&null!==m&&(f[n].pos=m.clone())}}for(var q=0,h=0;h<g;h++)k=f[h].Rd,k>q&&(q=k);for(h=0;h<q;h++){k=[];for(n=1;n<g-1;n++)f[n].Rd>h&&(k[n]=f[n].pos.clone().add(f[n-1].pos.clone().add(f[n+1].pos.clone()).multiplyScalar(.5)).multiplyScalar(.5));for(n=1;n<g-1;n++)m=k[n],null!==m&&void 0!==m&&(f[n].pos=m.clone())}}
function Pg(e,f){for(var g=f.length,h=0;h<e.Dj;h++)for(var k=[],n=1;n<g-1;n++)k[n]=f[n-1].Za.clone().add(f[n+1].Za.clone()).lb(f[n].Za.clone(),2).normalize(),ee(k[n],f[n-1].ua.clone(),f[n+1].ua.clone(),.5).normalize()}
function Qg(e,f){var g=f.length;if(1<e.Xh){var h=[],k=0;h[k++]=f[0];for(var n=0;n<g-3;n++)for(var m=0;m<e.Xh;m++){var q=h,r=k++,t=f[n+1],x=f[n+2],w=f[n+3],E=m/e.Xh,w=THREE.Vector3.aa(f[n].pos.clone(),t.pos.clone(),x.pos.clone(),w.pos.clone(),E),w=new ng(w);w.pa=.5>E?t.pa:x.pa;w.Ka=.5>E?t.Ka:x.Ka;t.vb==x.vb?(w.width=THREE.Math.sc(t.width,x.width,E),w.height=THREE.Math.sc(t.height,x.height,E),w.fc=THREE.Math.sc(t.fc,x.fc,E),w.$b=THREE.Color.sc(t.$b,x.$b,E),w.vb=t.vb):(w.width=t.vb?x.width:t.width,w.height=
t.vb?x.height:t.height,w.fc=t.vb?x.fc:t.fc,w.$b=t.vb?x.$b:t.$b,w.vb=!1);w.lf=t.lf;w.od=THREE.Vector3.sc(t.od,x.od,E).normalize();w.Za=THREE.Vector3.sc(t.Za,x.Za,E).normalize();null!==t.ua&&null!==x.ua&&null!==w.Za&&void 0!==t.ua&&void 0!==x.ua&&void 0!==w.Za?w.ua=ee(w.Za.clone(),t.ua,x.ua,E):w.ua=THREE.Vector3.sc(t.ua,x.ua,E).normalize();q[r]=w}h[k++]=f[g-1];return h}return f}
function Mg(e){e[0].Za=e[1].pos.clone().sub(e[0].pos).normalize();for(var f=e.length,g=1;g<f-1;g++)e[g].Za=e[g+1].pos.clone().sub(e[g-1].pos).normalize();e[f-1].Za=e[f-1].pos.clone().sub(e[f-2].pos).normalize()}
function Ng(e,f){for(var g=f.length,h=0;h<g;h++){var k=f[h];if(k.width!==k.height){for(var n=new THREE.Vector3,m=0,q=new THREE.Vector3,r=0,t=0,x=h-1;0<=x;x--){var t=t+f[x].pos.distanceTo(f[x+1].pos),w=(e.Eh-t)/t*t;if(0>=w)break;n=n.lb(f[x].pos,w);m+=w}t=0;for(x=h+1;x<g;x++){t+=f[x].pos.distanceTo(f[x-1].pos);w=(e.Eh-t)/t*t;if(0>=w)break;q=q.lb(f[x].pos,w);r+=w}q=q.multiplyScalar(1/r);n=n.multiplyScalar(1/m);0===m&&(q=n);0===r&&(n=q);k.ua=k.pos.clone().sub(q).add(k.pos.clone().sub(n)).multiplyScalar(1/
e.Eh);m=k.ua.clone().cross(k.Za.clone());if(.1>Math.sqrt(m.x*m.x+m.y*m.y+m.z*m.z))k.ua=null;else if(k.ua=k.Za.clone().cross(k.ua.clone()).cross(k.Za.clone()).normalize(),0===k.fc)for(m=h-1;0<=m;m--)if(r=f[m].ua,n=k.ua,null!==r&&void 0!==r){0>n.x*r.x+n.y*r.y+n.z*r.z&&(f[h].ua=n.multiplyScalar(-1));break}}}}
function Og(e){for(var f=[],g=e.length,h=0;h<g;h++){var k=e[h];if(null===k.ua||void 0===k.ua){for(var n=h;0<=n&&(null===e[n].ua||void 0===e[n].ua);)n--;for(var m=h;m<g&&(null===e[m].ua||void 0===e[m].ua);)m++;m===g&&(m=-1);if(0>n&&0>m)f[h]=de(k.Za);else if(0<=n&&0<=m){var q=(h-n)/(m-n),k=k.Za.clone();f[h]=ee(k,e[n].ua,e[m].ua,q)}else f[h]=0<=n?e[n].ua.clone():e[m].ua.clone()}}g=f.length;for(h=0;h<g;h++)n=f[h],null!==n&&void 0!==n&&(m=n.clone(),m.pa=n.pa,m.Ka=n.Ka,e[h].ua=m)}
function Rg(e,f,g){var h=Sg(g[0],e.mg,!0),k=!1;Tg(e,f,h,!1);for(var n=g.length,m=1;m<n;m++){var q=g[m],r=Sg(q,e.mg,!0),t=q.vb&&q.re<2*q.width;if(t&&!k)k=Sg(q,e.mg,!1),q=Sg(q,e.mg,!0),Ug(e,f,h,k),Ug(e,f,k,q);else{for(var k=r.length,x=0;x<k;x++).01>=r[x].clone().sub(h[x].clone()).dot(q.Za.clone())&&(r[x]=h[x].clone(),r[x].normal=h[x].normal,r[x].pa=h[x].pa,r[x].Ka=h[x].Ka);Ug(e,f,h,r)}h=r;k=t}Tg(e,f,h,!0)}
function Vg(e,f,g){for(var h=g.length,k=f.jc.length/3,n=0;n<h;n++){var m=g[n];Wd(f,m.x,m.y,m.z,e.yd);f.Qc.push(m.Ka)}return k}function Ug(e,f,g,h){if(g.length!==h.length)throw"meshFill impossible, a.length !== b.length";g=g.length;e=Vg(e,f,h);for(h=0;h<g;h++){var k=(h+1)%g,n=e-g+h,m=e-g+k,k=e+k;Xd(f,n,e+h,k);Xd(f,n,k,m)}}function Tg(e,f,g,h){var k=g.length;e=Vg(e,f,g);for(g=0;g<k-1;g++){var n=e+g,m=e+g+1,q=e+k-g-1;h?Xd(f,n,q,m):Xd(f,n,m,q)}}
function Sg(e,f,g){for(var h=[],k=0;k<f;k++){var n=2*(k+.5)*Math.PI/f,m;if(e.lf){m=f/4;var q=m+2,r=3*f/4,t=r+2,x=.1*e.width;k==m||k==m+1||k==t||k==t+1?(m=k==m||k==m+1?x:-x,n=e.height-2*e.width):k==q||k==q+1||k==r||k==r+1?(m=k==q||k==q+1?x:-x,n=2*e.width-e.height):k<m||k>t?(m=Math.sin(2*n)*e.width,n=e.height-e.width+Math.cos(2*n)*e.width):(m=Math.sin(Math.PI+2*n)*e.width,n=e.width-e.height+Math.cos(Math.PI+2*n)*e.width)}else m=Math.sin(n)*e.width,n=Math.cos(n)*e.height,e.vb?(q=e.width,e.vb&&e.re<2*
e.width&&g&&(q=e.re),m=q*(0<=m?1:-1),n=e.height*(0<=n?1:-1)):m+=e.fc*Math.cos(Math.PI*n/e.height);q=null;e.pos instanceof Ua?q=e.pos.pos.clone().lb(e.ua,m).lb(e.od,n):q=e.pos.clone().lb(e.ua,m).lb(e.od,n);q.pa=e.pa;q.Ka=e.Ka;h.push(q)}for(k=0;k<f;k++)g=(k+f-1)%f,n=(k+1)%f,m=new THREE.Vector3,m=h[n].clone().sub(h[g].clone()),h[k].normal=m.cross(e.Za).normalize();return h}function Wg(e,f){O.call(this,e);this.rj=null==f?!0:f}Wg.prototype=Object.create(O.prototype);Wg.prototype.constructor=Wg;
V.We=new Pf("Spheres","SPHERES",Wg);V.tj=new Pf("Balls","BALLS",Wg,!1);
Wg.prototype.Qa=function(){var e;this.rj?(e=this.ra,null===e.Da&&("HIGH"===e.Ua?e.Da=new THREE.SphereGeometry(e.v.ka.radius,e.v.ka.widthSegments,e.v.ka.heightSegments,e.v.ka.phiStart,e.v.ka.phiLength,e.v.ka.thetaStart,e.v.ka.thetaLength):"MEDIUM"===e.Ua?e.Da=new THREE.SphereGeometry(e.v.na.radius,e.v.na.widthSegments,e.v.na.heightSegments,e.v.na.phiStart,e.v.na.phiLength,e.v.na.thetaStart,e.v.na.thetaLength):"LOW"===e.Ua&&(e.Da=new THREE.SphereGeometry(e.v.ma.radius,e.v.ma.widthSegments,e.v.ma.heightSegments,
e.v.ma.phiStart,e.v.ma.phiLength,e.v.ma.thetaStart,e.v.ma.thetaLength))),e=e.Da):e=Ee(this.ra);var f=(new THREE.BufferGeometry).fromGeometry(e),g=this.oa.length,h=f.attributes.position.array.length/f.attributes.position.itemSize,k=g*h;e=new THREE.BufferGeometry;for(var n=new Float32Array(3*k),m=new Float32Array(3*k),q=new Float32Array(3*k),r=new Float32Array(2*k),k=new Float32Array(k),t=0;t<g;t++){var x=this.oa[t],w=new THREE.Matrix4;w.setPosition(x.pos);x=He(0,x);if(this.rj){var E=new THREE.Matrix4;
E.makeScale(x,x,x);w.multiply(E)}var F=f.clone();F.applyMatrix(w);for(var w=F.attributes.position.array,x=F.attributes.normal.array,E=F.attributes.color.array,F=F.attributes.uv.array,G=w.length/3,I=0;I<G;I++){for(var C=0;3>C;C++)n[t*w.length+3*I+C]=w[3*I+C],m[t*x.length+3*I+C]=x[3*I+C],q[t*E.length+3*I+C]=E[3*I+C];for(C=0;2>C;C++)r[t*F.length+2*I+C]=F[2*I+C];k[t*h+I]=t}}e.addAttribute("position",new THREE.BufferAttribute(n,3));e.addAttribute("normal",new THREE.BufferAttribute(m,3));E=new THREE.BufferAttribute(q,
3);E.dynamic=!0;e.addAttribute("color",E);e.addAttribute("uv",new THREE.BufferAttribute(r,2));e.addAttribute("atomIndex",new THREE.BufferAttribute(k,1));e.ud();f=Ie();e=new THREE.Mesh(e,f);e.Ja=this;this.parent.add(e);this.ea=e;this.Ad()};Wg.prototype.update=function(e){O.prototype.update.call(this,e);e.pf&&(this.wc=[],this.parent.remove(this.ea),e=this.ea.visible,this.ea=null,this.Qa(),this.ea.visible=e)};function Xg(e){O.call(this,e)}Xg.prototype=Object.create(O.prototype);
Xg.prototype.constructor=Xg;V.cc=new Pf("Sticks","STICKS",Xg);
Xg.prototype.Qa=function(){var e=null;this.Aa instanceof Kf?e=this.Aa.ta.Zb.dc():this.Aa instanceof Lf?e=this.Aa.Eb.Ea.Zb.dc():console.warn("Sticks representation unavailable for this data type");var f;f=this.ra;null===f.ya&&("HIGH"===f.Ua?f.ya=new THREE.CylinderGeometry(f.aa.ka.radiusTop,f.aa.ka.radiusBottom,f.aa.ka.height,f.aa.ka.zd,f.aa.ka.kf,f.aa.ka.openEnded):"MEDIUM"===f.Ua?f.ya=new THREE.CylinderGeometry(f.aa.na.radiusTop,f.aa.na.radiusBottom,f.aa.na.height,f.aa.na.zd,f.aa.na.kf,f.aa.na.openEnded):
"LOW"===f.Ua&&(f.ya=new THREE.CylinderGeometry(f.aa.ma.radiusTop,f.aa.ma.radiusBottom,f.aa.ma.height,f.aa.ma.zd,f.aa.ma.kf,f.aa.ma.openEnded)));f=f.ya;var g=(new THREE.BufferGeometry).fromGeometry(f);f=this.ra;null===f.rc&&("HIGH"===f.Ua?f.rc=new THREE.SphereGeometry(f.da.ka.radius,f.da.ka.widthSegments,f.da.ka.heightSegments,f.da.ka.phiStart,f.da.ka.phiLength,f.da.ka.thetaStart,f.da.ka.thetaLength):"MEDIUM"===f.Ua?f.rc=new THREE.SphereGeometry(f.da.na.radius,f.da.na.widthSegments,f.da.na.heightSegments,
f.da.na.phiStart,f.da.na.phiLength,f.da.na.thetaStart,f.da.na.thetaLength):"LOW"===f.Ua&&(f.rc=new THREE.SphereGeometry(f.da.ma.radius,f.da.ma.widthSegments,f.da.ma.heightSegments,f.da.ma.phiStart,f.da.ma.phiLength,f.da.ma.thetaStart,f.da.ma.thetaLength)));f=f.rc;var h=(new THREE.BufferGeometry).fromGeometry(f),k=h.attributes.position.array.length/h.attributes.position.itemSize,n=g.attributes.position.array.length/g.attributes.position.itemSize;f=new THREE.BufferGeometry;var m=[],q=[],r=[],t=[],x=
[],w=new THREE.Matrix4;w.makeRotationX(.5*Math.PI);for(var E=this.oa.length,F=0;F<E;F++){var G=this.oa[F],I=e.findNode(G);if("HOH"!==this.oa[F].Wc()){var C=new THREE.Matrix4;C.setPosition(G.pos);var K=h.clone();K.applyMatrix(C);for(var H=K.attributes.position.array,L=0;L<H.length;L++)m.push(H[L]);H=K.attributes.normal.array;for(L=0;L<H.length;L++)q.push(H[L]);H=K.attributes.color.array;for(L=0;L<H.length;L++)r.push(H[L]);H=K.attributes.uv.array;for(L=0;L<H.length;L++)t.push(H[L]);for(L=0;L<k;L++)x.push(F)}if(K=
I.qd())for(var C=K.length,P=0;P<C;P++)if(L=kd(K[P],I).Fd,this.oa.includes(L)){var H=G.pos,U=L.pos,L=H.clone(),X=new THREE.Vector3((H.x+U.x)/2,(H.y+U.y)/2,(H.z+U.z)/2),U=L.distanceTo(X),oa=X.clone().add(L).divideScalar(2),H=new THREE.Matrix4;H.lookAt(L,X,new THREE.Vector3(0,1,0));H.multiply(w);H.setPosition(oa);L=new THREE.Matrix4;L.makeScale(1,U,1);H.multiply(L);U=g.clone();U.applyMatrix(H);H=U.attributes.position.array;for(L=0;L<H.length;L++)m.push(H[L]);H=U.attributes.normal.array;for(L=0;L<H.length;L++)q.push(H[L]);
H=U.attributes.color.array;for(L=0;L<H.length;L++)r.push(H[L]);H=U.attributes.uv.array;for(L=0;L<H.length;L++)t.push(H[L]);for(L=0;L<n;L++)x.push(F)}}e=new Float32Array(m);g=new Float32Array(q);r=new Float32Array(r);t=new Float32Array(t);x=new Float32Array(x);f.addAttribute("position",new THREE.BufferAttribute(e,3));f.addAttribute("normal",new THREE.BufferAttribute(g,3));H=new THREE.BufferAttribute(r,3);H.dynamic=!0;f.addAttribute("color",H);f.addAttribute("uv",new THREE.BufferAttribute(t,2));f.addAttribute("atomIndex",
new THREE.BufferAttribute(x,1));f.ud();e=Ie();f=new THREE.Mesh(f,e);f.Ja=this;this.parent.add(f);this.ea=f;this.Ad()};Xg.prototype.update=function(e){O.prototype.update.call(this,e);if(e=e.pf)e=void 0===this.Aa.Zd.rd(V.de);e&&(e=this.ea.visible,this.wc=[],this.parent.remove(this.ea),this.ea=null,this.Qa(),this.ea.visible=e)};function Yg(e,f,g){O.call(this,e);this.ji=g;this.wireframe=f;this.If=Yg.v;this.startTime=null}Yg.v=0;Yg.u=1.4;Yg.prototype=Object.create(O.prototype);
Yg.prototype.constructor=Yg;V.qg=new Pf("Accessible Surface Wireframe","ASM",Yg,!0,!0);V.vf=new Pf("Accessible Surface","AS",Yg,!1,!0);V.wg=new Pf("Molecular Surface Wireframe","MSM",Yg,!0,!1);V.xf=new Pf("Molecular Surface","MS",Yg,!1,!1);
Yg.prototype.Qa=function(){if("Solvent"!==this.za.type){if(this.wireframe){var e=Ie();e.wireframe=!0;var f=this.ji?jg(this.Aa,V.vf):jg(this.Aa,V.xf);null===f.ea&&(f.Qa(),f.hide());f=f.ea.geometry.clone()}else{e=Ie();this.startTime=(new Date).getTime();this.ji&&(this.If=Yg.u);var g;f=this.ra;g="LOW"===f.Ua?.5:"MEDIUM"===f.Ua?1:"HIGH"===f.Ua?1.5:void 0;var h=this.za.xa(),f=this.nc(h),k=f[0],f=f[1],n=6*Math.ceil(g)+1;k.x-=n;f.x+=n;k.y-=n;f.y+=n;k.z-=n;f.z+=n;for(var m=Math.round((f.x-k.x)*g),q=Math.round((f.y-
k.y)*g),r=Math.round((f.z-k.z)*g),f=Array(m),n=0;n<m;n++)for(var t=0;t<q;t++)for(var x=0;x<r;x++)void 0===f[n]&&(f[n]=Array(q)),void 0===f[n][t]&&(f[n][t]=Array(r)),f[n][t][x]=new THREE.Vector3(n/g+k.x,t/g+k.y,x/g+k.z),f[n][t][x].fb=[],f[n][t][x].state=0;m=h.length;n=null;for(q=0;q<m;q++)for(var r=h[q],w=He(0,r),E=Math.round((w+this.If)*g+1),F=Math.round((r.pos.x-k.x)*g),G=Math.round((r.pos.y-k.y)*g),I=Math.round((r.pos.z-k.z)*g),C=F-E;C<=F+E;C++)for(var K=G-E;K<=G+E;K++)for(var H=I-E;H<=I+E;H++)n=
C/g+k.x,t=K/g+k.y,x=H/g+k.z,r.Ma().distanceTo(new THREE.Vector3(n,t,x))<w+this.If&&(n=f[C][K][H],n.fb.push(r),n.pa=r,n.Ka=q,n.state=1);g=new Vd(!0);h=f.length;for(k=1;k<h;k++)for(n=f[k].length,t=1;t<n;t++)for(x=f[k][t].length,m=1;m<x;m++){w=0;1===f[k-1][t][m].state&&(w|=128);1===f[k][t][m].state&&(w|=64);1===f[k][t-1][m].state&&(w|=32);1===f[k-1][t-1][m].state&&(w|=16);1===f[k-1][t][m-1].state&&(w|=8);1===f[k][t][m-1].state&&(w|=4);1===f[k][t-1][m-1].state&&(w|=2);1===f[k-1][t-1][m-1].state&&(w|=
1);for(var q=g,E=f[k-1][t-1][m-1],F=f[k][t-1][m-1],G=f[k][t][m-1],I=f[k-1][t][m-1],C=f[k-1][t-1][m],K=f[k][t-1][m],H=f[k][t][m],L=f[k-1][t][m],r=[E,F,G,I,C,K,H,L,E,F,G,I],E=[F,G,I,E,K,H,L,C,C,K,H,L],F=Kg[w],G=0,I=F.length,w=0;w<I;w++){C=F[w];K=r[C];H=E[C];C=void 0;for(L=0;8>L;L++)if(C=new THREE.Vector3((K.x+H.x)/2,(K.y+H.y)/2,(K.z+H.z)/2),C.fb=[],0<K.fb.length)Zg(this,C,K.fb)?(C.fb=C.fb.concat(K.fb),K=C):Zg(this,C,H.fb)||(H=C);else if(0<H.fb.length)Zg(this,C,H.fb)?(C.fb=C.fb.concat(H.fb),H=C):Zg(this,
C,K.fb)||(K=C);else break;C.fb=C.fb.concat(K.fb);C.fb=C.fb.concat(H.fb);for(var H=K=C,L=C.fb,P=Infinity,U=null,X=L.length,oa=0;oa<X;oa++){var ma=L[oa],Gb=H.distanceTo(ma.Ma());Gb<P&&(P=Gb,U=ma)}K.pa=U;C.Ka=this.oa.indexOf(C.pa);Wd(q,C.x,C.y,C.z);q.Qc.push(C.Ka);G++}r=G/3;E=q.jc.length/3;for(w=0;w<r;w++)Xd(q,E-3*w-3,E-3*w-1,E-3*w-2)}f=Yd(g)}e=new THREE.Mesh(f,e);e.pa=this.za;e.Ja=this;this.parent.add(e);this.ea=e;this.color(Q.Wa)}};
Yg.prototype.nc=function(e){for(var f=new THREE.Vector3(Infinity,Infinity,Infinity),g=new THREE.Vector3(-Infinity,-Infinity,-Infinity),h=e.length,k=0;k<h;k++){var n=e[k].pos;f.x=Math.min(f.x,n.x);f.y=Math.min(f.y,n.y);f.z=Math.min(f.z,n.z);g.x=Math.max(g.x,n.x);g.y=Math.max(g.y,n.y);g.z=Math.max(g.z,n.z)}return[f,g]};function Zg(e,f,g){for(var h=g.length,k=!1,n=0;n<h;n++){var m=g[n];if(m.Ma().distanceTo(f)<parseFloat($a.Jc(m.symbol)[7]+e.If)){k=!0;break}}return k}
Yg.prototype.update=function(e){O.prototype.update.call(this,e);e.pf&&(e=this.ea.visible,this.wc=[],this.parent.remove(this.ea),this.ea=null,this.Qa(),this.ea.visible=e)};
self.onmessage=function(e){var f=e.data[0];e=e.data[1];console.log(f,e);importScripts("/BioVizJS-ng/3DLibrary/three.min.js");importScripts("/BioVizJS-ng/data/elemental_radii.js");var g=new THREE.Geometry;new THREE.MeshLambertMaterial({vertexColors:THREE.VertexColors});for(var h=0,k=f.length,n=0;n<k;n++){var m=new THREE.Matrix4;m.setPosition(new THREE.Vector3(f[n][0],f[n][1],f[n][2]));var q=$a[f[n][3]][7],r=new THREE.Matrix4;r.makeScale(q,q,q);m.multiply(r);g.merge(e,m);for(m=g.vertices.length;h<m;h++)g.vertices[h].pa=
f[n];h=g.vertices.length}console.log(g)};function $g(){THREE.Object3D.call(this);this.matrixAutoUpdate=!1;this.matrixWorldNeedsUpdate=!0;this.Aa=this;this.Zd=new La;this.labels=new THREE.Object3D;this.add(this.labels)}$g.prototype=Object.create(THREE.Object3D.prototype);$g.prototype.constructor=$g;function ah(){this.map=[]}ah.prototype.get=function(e){return this.map[e.constructor]};ah.prototype.add=function(e,f){this.map[e]=f};var bh=new ah;z=$g.prototype;
z["delete"]=function(){for(var e=this.Zd.keys(),f=0,g=e.length;f<g;f++)e[f]["delete"]()};z.show=function(e){if(void 0!==e){if(e=jg(this,e),null!=e)return e.show(),e}else this.visible=!0};z.hide=function(e){void 0!==e?(e=jg(this,e),null!=e&&e.hide()):this.visible=!1};z.ub=function(e,f,g){if(void 0!==f)f=jg(this,f),null!=f&&f.ub(e,g);else{f=this.Kb();for(var h=0;h<f.length;h++)f[h].ub(e,g)}};
function jg(e,f){if(null!==f){var g=e.Zd.rd(f);void 0===g&&-1!==bh.get(e).indexOf(f)&&(void 0!==f&&null!==f?(g=new f.Ja(e,f.Nk,f.Fl),g.ad=f.name):g=void 0,void 0!==g&&(g.nf=void 0),e.Zd.set(g,f));return g}}z.Xf=function(e){var f=this.Zd.rd(e);return void 0===f||-1===bh.get(this).indexOf(e)?!1:f.visible};z.Kb=function(){var e=[],f=this.Zd.keys(),g;for(g in f){var h=f[g];h.visible&&e.push(h)}return e};
function Hf(e,f){var g=[];if(void 0===f||null===f)f=e;var h=f.children.length;if(0!==h)for(var k=0;k<h;k++)!(f.children[k]instanceof THREE.Mesh||f.children[k]instanceof THREE.Line)||void 0===f.children[k].pa&&0===f.children[k].material.vertexColors?g=g.concat(Hf(e,f.children[k])):g.push(f.children[k]);else if((f.children[k]instanceof THREE.Mesh||f.children[k]instanceof THREE.Line)&&void 0!==f.children[k].pa)return[f.children[k]];return g}
function Of(e,f){$g.call(this);this.ra=xe();this.se=f;this.cg=e;this.cg.add(this);this.oa=[f];this.pa=this.se;this.updateMatrixWorld()}Of.prototype=Object.create($g.prototype);Of.prototype.constructor=Of;bh.add(Of,[V.We,V.Ed]);z=Of.prototype;z["delete"]=function(){$g.prototype["delete"].call(this);this.parent.remove(this)};z.cb=function(){return this.cg.cb()};z.kb=function(){return this.cg.kb()};z.pc=function(){return this.cg};z.Uc=function(){return this.se.Ma()};z.sb=function(){return this.se.nc()};
function Kf(e,f){$g.call(this);this.sf=e;this.sf.add(this);this.ta=f;this.ra=xe();this.Je=new ja;this.oa=this.ta.xa();this.pa=this.ta;this.updateMatrixWorld()}Kf.prototype=Object.create($g.prototype);Kf.prototype.constructor=Kf;bh.add(Kf,[V.We,V.de,V.LINES,V.cc,V.Ed,V.Ve,V.sg,V.xf,V.wg,V.vf,V.qg,V.wf,V.rg]);z=Kf.prototype;z["delete"]=function(){$g.prototype["delete"].call(this);for(var e=this.Je.values(),f=0,g=e.length;f<g;f++)e[f]["delete"]();this.parent.remove(this)};z.cb=function(){return this.sf};
z.clear=function(e){e=jg(this,e);null!==e&&void 0!==e&&e.clear()};function ch(e){if(null!==e.ta.type)switch(e.ta.type){case "Protein":case "Peptide":return V.Ve;case "Small Peptide":return V.de;case "RNA":case "DNA":return V.Ve;case "Ligand":return V.cc;case "Ion":return V.Ed;case "Solvent":return V.NONE}console.warn("Error, cannot draw : ",e.ta.type);return null}function bf(e){e=jg(e,ch(e));null!==e&&void 0!==e&&e.show()}
z.pc=function(e,f){"string"===typeof e&&(e=this.ta.pb(e.split(":")[1]));if(e.Ea!==this.ta)throw e.toString()+" don't belongs to "+this.ta.toString();var g=this.Je.get(e);null==g&&f&&(g=new Lf(this,e),this.Je.set(e,g));return g};z.reset=function(){for(var e=this.Kb(),f=0;f<e.length;f++){var g=e[f];g.Ad();g.ub(!1);g.hide();if(g=e[f].ea)g.material.opacity=1,g.material.transparent=!1}bf(this);e=this.Je.values();g=e.length;for(f=0;f<g;f++)this.remove(e[f]);this.Je.clear()};
z.$d=function(){this.matrix.identity();this.matrixWorldNeedsUpdate=!0};z.Uc=function(){return ld(this.ta.nc())};z.sb=function(){return this.ta.nc()};z.wb=function(){return this.ta.wb()};function Lf(e,f){$g.call(this);this.ra=xe();this.Eb=f;this.zh=e;this.Jf=new ja;this.zh.add(this);this.oa=this.Eb.xa();this.pa=this.Eb;this.updateMatrixWorld()}Lf.prototype=Object.create($g.prototype);Lf.prototype.constructor=Lf;bh.add(Lf,[V.We,V.de,V.LINES,V.cc,V.Ed]);z=Lf.prototype;
z["delete"]=function(){$g.prototype["delete"].call(this);for(var e=this.Jf.values(),f=0,g=e.length;f<g;f++)e[f]["delete"]();this.parent.remove(this)};z.cb=function(){return this.zh.sf};z.kb=function(){return this.zh};z.pd=function(e,f){"string"===typeof e&&(e=this.Eb.ck(e.split(":")[1]));if(e.Fa!==this.Eb)throw e.toString()+" don't belongs to "+this.Eb.toString();var g=this.Jf.get(e);null==g&&f&&(g=new Of(this,e),this.Jf.set(e,g));return g};z.Uc=function(){return ld(this.Eb.nc())};z.sb=function(){return this.Eb.nc()};
function We(e){function f(){requestAnimationFrame(f);var e=k.getDelta();h.Fb.Lc?0!==h.tf.Dc.length&&kf(h.tf,1E3*e):h.Fb.update(1E3*e);h.Yd.update();h.bj.update();h.Tk.update();h.ca.Pe?(h.renderer.clear(),h.Gh.render(h.Ub,h.camera)):h.ca.Cc?(h.renderer.clear(),h.Cc.render(h.Ub,h.camera)):(h.renderer.clear(),h.renderer.render(h.Ub,h.camera),h.Ub.overrideMaterial=h.Vk,h.renderer.render(h.Ub,h.camera),h.Ub.overrideMaterial=null);null!=h.xc&&(h.renderer.clearDepth(),h.renderer.render(h.xc,h.Ld))}THREE.Group.call(this);
this.Ub=new THREE.Scene;this.scene=this;this.scene.pa=this;this.Ub.add(this);this.ac=e.ba.canvas;this.ja=[];this.light=this.camera=this.renderer=null;this.eh=.5;this.ra=xe();this.animations=new jf(this);this.tf=new jf(this);this.Fb=new ScriptEngine(this);this.ca=e;this.xc=this.Ld=null;this.Bd=[];this.kd=this.ic=this.me=null;this.bf=[];if(this.ca.ba.nj){this.$a={enabled:!0};this.Lf=1;e=THREE.ShaderLib.depthRGBA;var g=THREE.UniformsUtils.clone(e.uniforms);new THREE.ShaderMaterial({fragmentShader:e.fragmentShader,
vertexShader:e.vertexShader,uniforms:g,blending:THREE.NoBlending})}this.cj=new THREE.Plane(new THREE.Vector3(0,0,-1),0);this.Ei=new THREE.Plane(new THREE.Vector3(0,0,1),0);this.init();ed.Vb.Ej()&&ed.Vb.Fj({element:$(this.renderer.domElement.parent).get(0),ba:this.ca.ba});this.Xg=new THREE.EffectComposer(this.renderer);e=new THREE.RenderPass(this.Ub,this.camera);g=new THREE.ShaderPass(THREE.CopyShader);g.renderToScreen=!0;this.Xg.addPass(e);this.Xg.addPass(g);e=this.ac.width()||2;g=this.ac.height()||
2;this.Gh=new THREE.StereoEffect(THREE.StereoEffect.Types.PARALLAX_BARRIER,this.renderer,e,g);this.Cc=new THREE.StereoEffect(THREE.StereoEffect.Types.ANAGLYPH,this.renderer,e,g);ed.ge.bind(this.Gh,this.ac);ed.ge.bind(this.Cc,this.ac);If(this,this.eh);this.Vk=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone({scale:{type:"f",value:.2}}),vertexShader:"uniform float scale;\nattribute float highlight;\nvarying float doHighlight;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec4 pNormal = projectionMatrix * vec4( normalize( normalMatrix * normal ), 0.0 );\nvec2 xyNormal = pNormal.xy * scale;\ndoHighlight = highlight;\ngl_Position = projectionMatrix * mvPosition + vec4( xyNormal, 0.15 , 0.0 );\n}",
fragmentShader:"varying float doHighlight;\nvoid main() {\nif (doHighlight > 0.99) {\ngl_FragColor = vec4( 0.9, 0.8, 0.2, 1.0 );\n} else {\ndiscard;\n}\n}"});this.bj=new sf(this,this.renderer.domElement);this.Yd=new Ef(this,this.renderer.domElement);this.Tk=new Jf(this,this.renderer.domElement);var h=this,k=new THREE.Clock;requestAnimationFrame(f);this.ra.subscribe(this)}We.prototype=Object.create(THREE.Group.prototype);We.prototype.constructor=We;var dh=Object;dh.location=[];dh.location.da="CENTER";
dh.location.fa="TOP";dh.location.u="BOTTOM";dh.location.LEFT="LEFT";dh.location.RIGHT="RIGHT";dh.location.sa="TOP_LEFT";dh.location.v="BOTTOM_LEFT";dh.location.aa="BOTTOM_RIGHT";dh.location.ya="TOP_RIGHT";function If(e,f){e.eh=f;e.Gh.setSeparation(f);e.Cc.setSeparation(f)}function ef(e,f,g){var h=1.5*e.sb().length();null!=f&&(e.cj.constant=-(e.camera.near-e.camera.position.z+f/100*(h-e.camera.near)));null!=g&&(e.Ei.constant=e.camera.near-e.camera.position.z+g/100*(h-e.camera.near))}
function eh(e,f){for(var g=e.ja.length,h=f.Vc(),k=0,n=0;n<g;n++)e.ja[n].Vc().substring(0,4)===h&&k++;0<k&&f.la.Oc(h+"_"+k);e.add(f);e.ja.push(f)}z=We.prototype;
z.init=function(){this.camera=this.ca.camera;this.camera.position.set(0,0,30);this.light=new gf(this);this.scene.matrixAutoUpdate=!1;var e=new THREE.AmbientLight(6710886);this.Ub.add(e);this.Ub.fog=new THREE.Fog(this.ra.bgColor,0,0);this.renderer=new THREE.WebGLRenderer({antialias:this.ra.dg.antialias,preserveDrawingBuffer:!0});this.renderer.autoClear=!1;this.renderer.setSize(this.ac.width(),this.ac.height());this.renderer.setPixelRatio(window.devicePixelRatio);this.renderer.setClearColor(this.ra.bgColor,
1);this.renderer.domElement.className+=" hasContextMenu";this.ac.prepend(this.renderer.domElement);this.renderer.getContext();this.renderer.clippingPlanes=[this.cj,this.Ei];ed.ge.bind(this.renderer,this.ac,this.camera,this);this.ca.ba.nj&&(this.$a.scene=new THREE.Scene,this.$a.camera=new THREE.OrthographicCamera(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,-1E4,1E4),this.$a.camera.position.z=1,e={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter},this.$a.fl=
new THREE.WebGLRenderTarget(window.innerWidth*this.Lf,window.innerHeight*this.Lf,e),this.$a.el=new THREE.WebGLRenderTarget(window.innerWidth,window.innerHeight,e),e=THREE.SSAOShader,this.$a.ssao_uniforms=THREE.UniformsUtils.clone(e.uniforms),this.$a.ssao_uniforms.tDiffuse.value=this.$a.el,this.$a.ssao_uniforms.tDepth.value=this.$a.fl,this.$a.ssao_uniforms.size.value.set(window.innerWidth*this.Lf,window.innerHeight*this.Lf),this.$a.ssao_uniforms.cameraNear.value=this.camera.near,this.$a.ssao_uniforms.cameraFar.value=
this.camera.far,this.$a.ssao_uniforms.onlyAO.value=!1,this.$a.Sk=new THREE.ShaderMaterial({uniforms:this.$a.ssao_uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.$a.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(window.innerWidth,window.innerHeight),this.$a.Sk),this.$a.quad.position.z=-500,this.$a.scene.add(this.$a.quad),new SSAOConfig(this.renderer,this.$a))};z.clear=function(){for(var e=0;e<this.ja.length;e++)this.scene.remove(this.ja);this.ja=[]};
z.Od=function(e,f){null==f&&(f=.1);var g=new mf(e.r,e.g,e.b,f);this.animations.mc(g)};function re(e,f,g,h){void 0===f&&(f=e.ja[0]);void 0===g&&(g=1E3);void 0===h&&(h=!0);g=new lf(f,e,g,h);e.tf.mc(g);h&&(e.ca.Ia=f)}function fh(e,f,g,h){void 0===f&&(f=e.ja[0]);void 0===h&&(h=1E3);f=new qf(h,f,e,g);e.animations.mc(f)}z.toString=function(){return"scene"};z.update=function(e){e.bgColor&&(this.renderer.setClearColor(this.ra.bgColor,1),this.Ub.fog.color=this.ra.bgColor)};
z.gg=function(e,f,g,h,k){function n(e){return"#"===e.charAt(0)?e.substring(1,7):"x"===e.charAt(1)?e.substring(2,8):e}var m=this.ac.height(),q=this.ac.width();null==f&&(f=dh.location.ya);null!=g?"string"===typeof g&&g.endsWith("%")&&(g=m*g.substr(0,g.length-1)/100):g=m*this.ra.oe/100;null==h&&(h="#00ff00");null==k&&(k=2E3);if(null===this.xc){this.Ld=new THREE.OrthographicCamera(-q/2,q/2,m/2,-m/2,1,10);this.Ld.position.z=10;this.xc=new THREE.Scene;ed.ge.bind(this.renderer,this.ac,this.Ld,this);var r=
new THREE.RenderPass(this.xc,this.Ld);this.Xg.addPass(r,1)}""===e?void 0!==this.Bd[f]&&(this.xc.remove(this.Bd[f]),this.Bd[f]=void 0,this.renderer.render(this.xc,this.Ld)):void 0!==e&&(e=Ge(e,{fontsize:g,gh:{r:parseInt(n(h).substring(0,2),16),g:parseInt(n(h).substring(2,4),16),b:parseInt(n(h).substring(4,6),16),a:1},maxWidth:q,maxHeight:m}),h=new THREE.SpriteMaterial({map:e}),e=h.map.image.width,g=h.map.image.height,h=new THREE.Sprite(h),h.scale.set(e,g,1),void 0!==this.Bd[f]&&this.xc.remove(this.Bd[f]),
this.Bd[f]=h,gh(this),this.xc.add(h),void 0!==k&&(f=new rf(h,this,k,f),this.Fb.Lc?this.tf.mc(f):this.animations.mc(f)))};
function gh(e){var f=e.ac.width()/2,g=e.ac.height()/2,h;for(h in dh.location){var k=dh.location[h],n=e.Bd[k];if(void 0!==n){var m=n.material.map.image.width/2,q=n.material.map.image.height/2;switch(k){case dh.location.da:n.position.set(0,0,1);break;case dh.location.fa:n.position.set(0,g-q,1);break;case dh.location.u:n.position.set(0,-g+q,1);break;case dh.location.LEFT:n.position.set(-f+m,0,1);break;case dh.location.RIGHT:n.position.set(f-m,0,1);break;case dh.location.sa:n.position.set(-f+m,g-q,1);
break;case dh.location.v:n.position.set(-f+m,-g+q,1);break;case dh.location.aa:n.position.set(f-m,-g+q,1);break;default:n.position.set(f-m,g-q,1)}}}}z.eg=function(){for(var e=0;e<this.ja.length;e++)this.ja[e].eg()};z.Ie=function(){for(var e=0;e<this.ja.length;e++)this.ja[e].Ie();this.ca.ba.ab({type:"requestWidgetUpdate"})};z.Hh=function(){this.scene.matrix.identity();for(var e=0;e<this.ja.length;e++)this.ja[e].$d();this.scene.updateMatrixWorld(!0);oe(this.ca,this.ca.Ya,!0)};
z.reset=function(){this.scene.matrix.identity();for(var e=0;e<this.ja.length;e++)this.ja[e].reset();this.scene.updateMatrixWorld(!0);oe(this.ca,this.ca.Ya,!0);this.ca.ba.ab({type:"requestWidgetUpdate"})};z.Ma=function(){return new THREE.Vector3};z.Uc=function(){return ld(this.sb())};z.sb=function(){for(var e=null,f=this.ja.length,g=0;g<f;g++){var h=this.ja[g],k=h.sb().clone();k.applyMatrix4(h.matrix);e=null===e?k:e.merge(k)}f=new THREE.Vector3;return null!==e?e:new ab(f,f)};
z.jg=function(e){this.Yd.vh=!0;void 0!=e?this.me=e:this.me=null};z.lg=function(){this.me=null;this.Yd.vh=!1};z.Vg=function(){for(var e=this.bf.length,f=0;f<e;f++)this.scene.remove(this.bf[f]);this.bf.splice()};function M(e){$g.call(this);this.Mk=!0;this.la=e;this.pa=this.la.Qf();this.ra=xe();this.va=new La;this.updateMatrixWorld();this.Pc=new ja}M.prototype=Object.create($g.prototype);z=M.prototype;z.constructor=M;z.cb=function(){return this};
z["delete"]=function(){$g.prototype["delete"].call(this);for(var e=this.va.values(),f=0,g=e.length;f<g;f++)e[f]["delete"]();this.parent.remove(this)};z.show=function(e){for(var f=0;f<this.va.keys().length;f++)this.va.get(this.va.keys()[f]).show(e)};z.hide=function(e){for(var f=0;f<this.va.keys().length;f++)this.va.get(this.va.keys()[f]).hide(e)};z.Xf=function(e){for(var f=!0,g=this.va.keys(),h=0;h<g.length&&(f=this.va.get(g[h]).Xf(e),f);h++);return f};
z.Kb=function(){for(var e=[],f=this.va.values(),g=0,h=f.length;g<h;g++)for(var k=f[g].Zd.keys(),n=0;n<k.length;n++){var m=k[n];m.visible&&e.push(m)}return e};z.Uc=function(){return ld(this.sb())};z.sb=function(){var e=null,f;for(f in this.va.keys()){var g=this.va.get(this.va.keys()[f]),h=g.sb().clone();h.applyMatrix4(g.matrix);e=null===e?h:e.merge(h)}return e};z.toString=function(){return this.la.ii};z.wb=function(){return this.toString()};z.Vc=function(){return this.la._id};
function hh(e,f){for(var g=e.va.keys(),h=0;h<g.length;h++){var k=g[h];if(k.toString()===f)return e.va.get(k)}}function af(e){for(var f=[],g=e.va.keys(),h=0;h<g.length;h++)f.push(e.va.get(g[h]));return f}z.kb=function(e){var f=this.va.get(e);void 0===f&&(f=new Kf(this,e),this.va.set(e,f));return f};z.reset=function(){ue(this);this.$d();this.Ie();this.eg()};
z.eg=function(){for(var e=af(this),f=0;f<e.length;f++){e[f].ub(!1);for(var g=e[f].Je.values();f<g.length;f++){g[0].ub(!1);for(var h=g[0].Jf.values();f<h.length;f++)h[0].ub(!1)}}};z.$d=function(){this.matrix.identity();this.matrixWorldNeedsUpdate=!0;for(var e=af(this),f=0;f<e.length;f++)e[f].$d()};z.Ie=function(){ue(this);var e=af(this);this.show();for(var f=0;f<e.length;f++)e[f].reset()};
z.Ob=function(e,f,g){var h,k;if(e instanceof Vc||void 0==e)switch(f){case void 0:case M.u.zf:ih(this,this.la,this.la.toString(),this.la.Ma(),this,g);break;case M.u.Wb:e=this.va.keys();for(var n in e)k=this.va.get(e[n]),ih(this,k.ta,k.ta.toString(),k.ta.Ma(),k,g);break;case M.u.Hb:e=this.va.keys();for(n in e){k=this.va.get(e[n]);f=k.ta.ga;for(var m=0;m<f.length;m++)h=f[m],ih(this,h,h.toString(),h.hh(),k,g)}break;case M.u.Wa:case M.u.yc:for(n in e=this.va.keys(),e)for(k=this.va.get(e[n]),h=k.ta.xa(),
m=0;m<h.length;m++){var q=h[m];f===M.u.Wa?ih(this,q,q.toString(),q.Ma(),k,g):ih(this,q,$a.Jc(q.symbol)[7],q.Ma(),k,g)}}else if(e instanceof Fb)switch(f){case M.u.Wa:case M.u.yc:h=e.xa();k=this.kb(e);for(n=0;n<h.length;n++)q=h[n],f===M.u.Wa?ih(this,q,q.toString(),q.Ma(),k,g):ih(this,q,$a.Jc(q.symbol)[7],q.Ma(),k,g);break;case M.u.Hb:f=e.ga;k=this.kb(e);for(n=0;n<f.length;n++)h=f[n],ih(this,h,h.toString(),h.hh(),k,g);break;case M.u.Wb:case void 0:k=this.kb(e),ih(this,e,e.toString(),e.Ma(),k,g)}else if(e instanceof
tc)switch(f){case void 0:case M.u.Hb:k=this.kb(e.Ea);ih(this,e,e.toString(),e.hh(),k,g);break;case M.u.Wa:case M.u.yc:for(m3D=this.kb(e.Ea),h=e.xa(),n=0;n<h.length;n++)q=h[n],f===M.u.Wa?ih(this,q,q.toString(),q.Ma(),k,g):ih(this,q,$a.Jc(q.symbol)[7],q.Ma(),k,g)}else if(e instanceof Ua)switch(f){case void 0:case M.u.Wa:case M.u.yc:k=this.kb(e.Fa.Ea),f===M.u.Wa||void 0===f?ih(this,e,e.toString(),e.Ma(),k,g):ih(this,e,$a.Jc(e.symbol)[7],e.Ma(),k,g)}};
function ih(e,f,g,h,k,n){void 0==e.Pc.get(f)&&(g=Fe(g,n),h=Ud(g,h),k.labels.add(h),e.Pc.set(f,h))}function ue(e,f){var g,h;if(void 0===f){var k=e.Pc.keys();for(h=0;h<k.length;h++)g=e.Pc.get(k[h]),g.parent.remove(g);e.Pc.clear()}else if(Array.isArray(f))for(h=0;h<f.length;h++)g=e.Pc.get(f[h]),null!=g&&(e.Pc.remove(f[h]),g.parent.remove(g));else g=e.Pc.remove(f),null!=g&&g.parent.remove(g)}M.u={zf:"structure",Wb:"molecule",Hb:"residue",Wa:"atom",yc:"vdw"};function jh(){}jh.prototype.bb=function(){};
function kh(e,f,g){var h=[],k,n=V.Ed;switch(f.type){case lh:e=af(f.cb(e)[0]);for(var m in e)if(f=e[m],k=f.Kb(),void 0===g)0===k.length&&(k=jg(f,n)),h=h.concat(k);else for(var q in k)k[q].ad===g.name&&h.push(k[q]);break;case mh:e=f.sd(e);for(m in e)if(f=e[m],k=f.Kb(),void 0===g)0===k.length&&(k=jg(f,n)),h=h.concat(k);else for(q in k)k[q].ad===g.name&&h.push(k[q]);break;case nh:f=f.kb(e)[0];k=f.Kb();if(void 0===g)0===k.length&&(k=jg(f,n)),h=h.concat(k);else for(q in k)k[q].ad===g.name&&h.push(k[q]);
break;case oh:m=f.pc(e)[0];if(null!==m&&void 0!==m)if(k=m.Kb(),void 0===g)0===k.length&&(k=jg(m,n)),h=h.concat(k);else for(q in k)k[q].ad===g.name&&h.push(k[q]);break;case ph:if(m=f.pd(e)[0],null!==m&&void 0!==m&&(k=m.Kb()),void 0===g)0===k.length&&(k=jg(m,n)),h=h.concat(k);else for(q in k)k[q].ad===g.name&&h.push(k[q])}return h}function qh(){this.si=this.Pg=this.tb=this.Zc=this.Qb=this.tc=this.type=null;this.hj="\x00"}qh.prototype=Object.create(jh.prototype);qh.prototype.constructor=qh;
var lh="STRUCTURE",mh="MOL_TYPE",nh="MOLECULE",oh="RESIDUE",ph="ATOM";z=qh.prototype;z.bb=function(){};z.sd=function(e){switch(this.type){case "SCENE":return e;case lh:return e.cb(this.Qb);case mh:return me(e,this.Qb,this.tc);case nh:return me(e,this.Qb,this.tc,this.Zc);case oh:return e.pc(this.Qb,this.tc,this.Zc,this.tb,this.hj,!0);case ph:return e.pd(this.Qb,this.tc,this.Zc,this.Pg,this.si,!0);default:return null}};z.cb=function(e){return e.cb(this.Qb)};
z.kb=function(e){return me(e,this.Qb,this.tc,this.Zc)};z.pc=function(e){return e.pc(this.Qb,this.tc,this.Zc,this.tb,this.hj,!0)};z.pd=function(e){return e.pd(this.Qb,this.tc,this.Zc,this.Pg,this.si,!0)};function rh(e){this.v=sh;this.ca=e;this.u=[];new EventTarget(rh.prototype)}function ScriptEngine(e){this.scene3D=e;this.u=this.scene3D.animations;this.Lc=!0;this.u.pause=this.Lc;this.v=this.fa=this.aa=this.currentTime=this.da=null;new EventTarget(ScriptEngine.prototype)}z=ScriptEngine.prototype;
z.update=function(e){if(!this.Lc){this.currentTime+=e;if(0<this.da)this.da-=e;else for(var f=0;this.v.length;f++){var g=this.v.remove();if(!1===g)break;else void 0!==g&&void 0!==g.bb||console.warn("WARNING : the command didn't return a class with execute function");if(g instanceof th){this.da=g.duration;break}else try{g.bb(this.scene3D.ca)}catch(h){console.warn("Error on parsing script : "+h+"\nOn stack : "+(h.stack?h.stack:"Unknown")+"\nComing from command "+g.constructor.name);break}}0!==this.u.Dc.length&&
kf(this.u,e);this.currentTime>this.aa&&this.ab("endScript");this.ab({type:"timeChanged",data:{currentTime:this.currentTime,progress:this.currentTime/this.aa}})}};
function uh(e,f){vh(e);var g=e.u;g.Dc.splice(0,g.Dc.length);e.currentTime=f.value*e.aa;for(var h=0,g=[],k=0;e.v.length;k++){var n=e.v.remove();if(!1===n)break;else void 0!==n&&void 0!==n.bb||console.warn("The command didn't return a class with execute function");if(n instanceof th){for(var n=n.duration,m=g.length,k=0;k<m;k++)try{g[k].bb(e.scene3D.ca)}catch(q){console.warn("Error on parsing script : "+q+"\nOn stack : "+(q.stack?q.stack:"Unknown")+"\nComing from command "+g[k].constructor.name);break}g.splice(0,
g.length);if(h+n>e.currentTime){h=e.currentTime-h;kf(e.u,h,!0);e.da=n-h;break}else kf(e.u,n,!0),h+=n}else g.push(n)}m=g.length;if(0<m){for(k=0;k<m;k++)try{g[k].bb(e.scene3D.ca)}catch(q){console.warn("Error on parsing script : "+q+"\nOn stack : "+(q.stack?q.stack:"Unknown")+"\nComing from command "+g[k].constructor.name);break}e.ab("endScript")}}z.mc=function(e){this.u.mc(e)};z.play=function(){this.Lc=!1;this.u.pause=this.Lc;uh(this,{type:"update",value:this.currentTime/this.aa})};
z.stop=function(){this.Lc=!0;this.u.pause=this.Lc;vh(this);var e=this.u;e.Dc.splice(0,e.Dc.length);this.scene3D.reset();this.ab({type:"timeChanged",data:{currentTime:this.currentTime,progress:this.currentTime/this.aa}})};z.pause=function(){this.Lc=!0;this.u.pause=this.Lc};function vh(e){e.currentTime=0;e.da=0;e.v=e.fa.slice(0);e.v.add=e.v.push;e.v.remove=e.v.shift}function wh(e,f,g){this.gi=e;this.lc=f;this.ei=g?g.get("full"):!1;this.di=g?g.get("duration"):0}wh.prototype=Object.create(jh.prototype);
wh.prototype.constructor=wh;
wh.prototype.bb=function(e){var f;f=this.gi.kb(e)[0];var g=this.lc.kb(e)[0],h=new Dd,k=f.ta,n=g.ta;h.v=null;h.aa=null;h.u=NaN;if(k&&n)if(k!==n){var m;m=k.vd()?new qc:new qc(Bd);var q=[];q.push(Fd("SRC:",k));q.push(Fd("DST:",n));m=m.da(q);h.v=m;k=Ed(k,h.v.Sd("SRC:"+k.toString()));n=Ed(n,h.v.Sd("DST:"+n.toString()));if(null===k||null===n||k.length!==n.length)throw"Illegal argument exception";m=[];for(var q=[],r=k.length,t=0;t<r;t++){var x=k[t],w=n[t];null!==x&&null!==w&&(m.push([x.x,x.y,x.z]),q.push([w.x,
w.y,w.z]))}q=[m,q];m=q[0];q=q[1];if(3>k.length)console.error("Need at least 3 paired coordinates. Found only "+k.length);else{q=numeric.transpose(q);q=numeric.dot(q,m);m=numeric.svd(q);q=[[1,0,0],[0,1,0],[0,0,Math.sign(numeric.det(q))]];q=numeric.dot(numeric.dot(m.V,q),numeric.transpose(m.U));m=new THREE.Matrix4;m.set(q[0][0],q[1][0],q[2][0],0,q[0][1],q[1][1],q[2][1],0,q[0][2],q[1][2],q[2][2],0,0,0,0,1);h.u=0;q=k.length;for(r=0;r<q;r++)x=k[r],t=n[r],null!==x&&null!==t&&(x=x.clone().applyMatrix4(m),
t=t.clone(),h.u+=x.distanceToSquared(t));h.aa=m;h.u=Math.sqrt(h.u/k.length)}}else console.warn("Same src and dst molecule, resolving alignement"),m=[],m.push(Fd("SRC:",k)),m.push(Fd("DST:",n)),h.v=new nd(m),h.aa=new THREE.Matrix4,h.u=0;else console.error("Source ("+k+") or dest ("+n+") is not a polymer");h=h.aa;null!==h?(n=xh(this,e).matrixWorld,k=(new THREE.Matrix4).getInverse(n),t=f.matrixWorld,r=g.matrixWorld,n=(new THREE.Matrix4).extractRotation(n),m=(new THREE.Matrix4).extractRotation(r),q=this.ei?
(new THREE.Matrix4).extractRotation((new THREE.Matrix4).getInverse(f.matrix)):new THREE.Matrix4,f=f.ta.Ma().clone().applyMatrix4(t),r=g.ta.Ma().clone().applyMatrix4(r),g=new THREE.Vector3,g.setFromMatrixPosition((new THREE.Matrix4).multiply(k).multiply((new THREE.Matrix4).setPosition(f))),f=(new THREE.Vector3).subVectors(r,f),f=(new THREE.Matrix4).multiply((new THREE.Matrix4).setPosition(Zd(k,f))).multiply((new THREE.Matrix4).setPosition(g)).multiply((new THREE.Matrix4).getInverse(n)).multiply(m).multiply(h).multiply(q).multiply((new THREE.Matrix4).setPosition(g.clone().negate()))):
f=null;g=xh(this,e);0<=this.di?(f=g.matrix.clone().multiply(f),fh(e.scene3D,g,f,this.di)):(g.matrix.multiply(f),g.matrixWorldNeedsUpdate=!0)};function xh(e,f){var g=e.gi.kb(f)[0];return e.ei?g.cb():g}function yh(e,f,g,h){this.alpha=f;this.target=e;this.uc=h;this.duration=g?g.get("duration"):void 0}yh.prototype=Object.create(jh.prototype);yh.prototype.constructor=yh;
yh.prototype.bb=function(e){for(var f=kh(e,this.target,this.uc),g=0;g<f.length;g++){var h=f[g].hg(this.alpha,this.duration);null!=h&&e.scene3D.animations.mc(h)}};function zh(e,f,g){this.target=e;this.zoom=g;this.duration=f?f.get("duration"):0}zh.prototype=Object.create(jh.prototype);zh.prototype.constructor=zh;
zh.prototype.bb=function(e){var f=this.target.cb(e)[0];if(void 0!==f)if(0>=this.duration)oe(e,f,this.zoom);else{e=e.scene3D;var g=this.duration,h=this.zoom;void 0===f&&(f=e.ja[0]);void 0===g&&(g=1E3);void 0===h&&(h=!0);f=new lf(f,e,g,h);e.animations.mc(f)}};function Ah(e,f,g,h){this.target=e;this.duration=h?h.get("duration"):void 0}Ah.prototype=Object.create(jh.prototype);Ah.prototype.constructor=Ah;Ah.prototype.bb=function(){console.log("Clip Command not supported yet")};
function Bh(e,f,g,h){this.target=e;this.color=f;this.uc=g;this.duration=h?h.get("duration"):void 0}Bh.prototype=Object.create(jh.prototype);Bh.prototype.constructor=Bh;Bh.prototype.bb=function(e){var f=kh(e,this.target,this.uc),g,h=this.color;void 0!=Q.ih(this.color)&&(h=Q.ih(this.color));for(var k=0;k<f.length;k++)g=f[k].color(h,this.duration),null!=g&&e.scene3D.animations.mc(g)};
function Ch(e,f){this.name="display";this.text=e;this.position=null==f?void 0:f.get("location");this.size=null==f?void 0:f.get("size");this.color=null==f?void 0:f.get("color");this.duration=null==f?void 0:f.get("duration")}Ch.prototype=Object.create(jh.prototype);Ch.prototype.constructor=Ch;Ch.prototype.bb=function(e){e.scene3D.gg(this.text,this.position,this.size,this.color,this.duration)};function Dh(e,f,g){this.target=e;this.uc=f;this.enable=g}Dh.prototype=Object.create(jh.prototype);
Dh.prototype.constructor=Dh;Dh.prototype.bb=function(e){var f=this.target.sd(e);switch(this.target.type){case lh:f=af(f);for(e=0;e<f.length;e++)f[e].ub(this.enable,this.uc);break;case mh:case nh:for(e=0;e<f.length;e++)f[e].ub(this.enable,this.uc);break;case oh:e=f[0];e.ub(this.enable,this.uc);f=e.kb();f.ub(this.enable,this.uc,e.Eb.xa());break;case ph:var g=f[0];g.ub(this.enable,this.uc);e=g.pc();e.ub(this.enable,this.uc,[g.se]);f=g.kb();f.ub(this.enable,this.uc,[g.se])}};
function Eh(e,f){this.name="load";this.lh=e;this.ni=f}Eh.prototype=Object.create(jh.prototype);Eh.prototype.constructor=Eh;Eh.prototype.bb=function(e){e.Xc(this.lh,this.ni)};function Fh(e,f,g){this.target=e;this.matrix=f;this.duration=g?g.get("duration"):0}Fh.prototype=Object.create(jh.prototype);Fh.prototype.constructor=Fh;
Fh.prototype.bb=function(e){var f;if("SCENE"==this.target.type)f=e.scene3D;else if(this.target.type==lh)f=this.target.cb(e)[0];else if(this.target.type==nh)f=this.target.sd(e)[0];else throw"MoveCommand only applies to Scene, Structure and Molecule targets";var g=new THREE.Matrix4;g.set(this.matrix[0],this.matrix[4],this.matrix[8],this.matrix[12],this.matrix[1],this.matrix[5],this.matrix[9],this.matrix[13],this.matrix[2],this.matrix[6],this.matrix[10],this.matrix[14],this.matrix[3],this.matrix[7],
this.matrix[11],this.matrix[15]);void 0!==f&&fh(e.scene3D,f,g,this.duration)};function Gh(e){this.lh=e}Gh.prototype=Object.create(jh.prototype);Gh.prototype.constructor=Gh;Gh.prototype.bb=function(e){var f=e.cb(this.lh);void 0!==f&&void 0!==f[0].remove&&se(e,f[0])};function Hh(e,f,g){this.target=e;this.Ja=f;this.enable=g}Hh.prototype=Object.create(jh.prototype);Hh.prototype.constructor=Hh;
Hh.prototype.bb=function(e){e=this.target.sd(e);for(var f in e){var g;e[f].Mk?g=af(e[f]):g=[e[f]];for(var h in g)this.enable?g[h].show(this.Ja):g[h].hide(this.Ja)}};function Ih(){}Ih.prototype=Object.create(jh.prototype);Ih.prototype.constructor=Ih;Ih.prototype.bb=function(e){e.scene3D.reset()};function Jh(e,f,g){this.Kl=e;this.value=f;this.duration=null==g?void 0:g.get("duration")}Jh.prototype=Object.create(jh.prototype);Jh.prototype.constructor=Jh;
Jh.prototype.bb=function(e){switch(this.Kl){case "background":var f=new THREE.Color(this.value),g=this.duration;g&&0<g?e.scene3D.Od(f,g):e.ra.Od(f);break;case "quality":we(e.Mb,this.value)}};function Kh(e,f){this.target=e;this.show=f}Kh.prototype=Object.create(jh.prototype);Kh.prototype.constructor=Kh;Kh.prototype.bb=function(e){var f="SCENE"==this.target.type?e.scene3D.ja:this.target.sd(e);for(e=0;e<f.length;e++)this.show?f[e].show():f[e].hide()};function th(e){this.duration=e}th.prototype=Object.create(jh.prototype);
th.prototype.constructor=th;th.prototype.bb=function(){};
var sh=function(){function e(f,g,h,k){this.message=f;this.location=k;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}(function(e,g){function h(){this.constructor=e}h.prototype=g.prototype;e.prototype=new h})(e,Error);return{SyntaxError:e,parse:function(f){function g(e){var g=tf[e],h,k;if(g)return g;for(h=e-1;!tf[h];)h--;g=tf[h];for(g={line:g.line,mb:g.mb,bc:g.bc};h<e;)k=f.charAt(h),"\n"===k?(g.bc||g.line++,g.mb=1,g.bc=!1):"\r"===k||"\u2028"===k||
"\u2029"===k?(g.line++,g.mb=1,g.bc=!0):(g.mb++,g.bc=!1),h++;return tf[e]=g}function h(e,f){var h=g(e),k=g(f);return{start:{offset:e,line:h.line,mb:h.mb},end:{offset:f,line:k.line,mb:k.mb}}}function k(e){p<Ya||(p>Ya&&(Ya=p,pg=[]),pg.push(e))}function n(){var e,f,g,h;e=p;f=[];for(g=m();g!==l;)f.push(g),g=m();if(f!==l){g=[];for(f=va();f!==l;)g.push(f),f=va();if(g!==l){f=[];for(h=m();h!==l;)f.push(h),h=m();if(f!==l){e=g;g=[];for(var k in e)g.push(e[k]);e=g}else p=e,e=l}else p=e,e=l}else p=e,e=l;if(e===
l)for(e=[],f=m();f!==l;)e.push(f),f=m();return e}function m(){var e;32===f.charCodeAt(p)?(e=na,p++):(e=l,0===B&&k(xb));e===l&&(9===f.charCodeAt(p)?(e=uc,p++):(e=l,0===B&&k(bb)));return e}function q(){var e;Ha.test(f.charAt(p))?(e=f.charAt(p),p++):(e=l,0===B&&k(Ub));return e}function r(){var e;Jc.test(f.charAt(p))?(e=f.charAt(p),p++):(e=l,0===B&&k(hc));return e}function t(){var e,g,h;e=p;Vb.test(f.charAt(p))?(g=f.charAt(p),p++):(g=l,0===B&&k(Kc));g!==l?(h=G(),h!==l?e=g=[g,h]:(p=e,e=l)):(p=e,e=l);return e}
function x(){var e;32===f.charCodeAt(p)?(e=na,p++):(e=l,0===B&&k(xb));e===l&&(33===f.charCodeAt(p)?(e=ic,p++):(e=l,0===B&&k(Ab)),e===l&&(35===f.charCodeAt(p)?(e=qa,p++):(e=l,0===B&&k(eb)),e===l&&(36===f.charCodeAt(p)?(e=jc,p++):(e=l,0===B&&k(Ia)),e===l&&(37===f.charCodeAt(p)?(e=Va,p++):(e=l,0===B&&k(fb)),e===l&&(38===f.charCodeAt(p)?(e=ia,p++):(e=l,0===B&&k(ba)),e===l&&(40===f.charCodeAt(p)?(e=da,p++):(e=l,0===B&&k(Ba)),e===l&&(41===f.charCodeAt(p)?(e=Bb,p++):(e=l,0===B&&k(sb)),e===l&&(42===f.charCodeAt(p)?
(e=tb,p++):(e=l,0===B&&k(Ja)),e===l&&(43===f.charCodeAt(p)?(e=Cb,p++):(e=l,0===B&&k(ra)),e===l&&(44===f.charCodeAt(p)?(e=Oa,p++):(e=l,0===B&&k(ka)),e===l&&(45===f.charCodeAt(p)?(e=Wa,p++):(e=l,0===B&&k(ta)),e===l&&(46===f.charCodeAt(p)?(e=gb,p++):(e=l,0===B&&k(vc)),e===l&&(47===f.charCodeAt(p)?(e=wc,p++):(e=l,0===B&&k(Wb)),e===l&&(Ha.test(f.charAt(p))?(e=f.charAt(p),p++):(e=l,0===B&&k(Ub)),e===l&&(58===f.charCodeAt(p)?(e=wa,p++):(e=l,0===B&&k(la)),e===l&&(59===f.charCodeAt(p)?(e=db,p++):(e=l,0===
B&&k(pb)),e===l&&(60===f.charCodeAt(p)?(e=xa,p++):(e=l,0===B&&k(Lc)),e===l&&(61===f.charCodeAt(p)?(e=Ca,p++):(e=l,0===B&&k(Jb)),e===l&&(62===f.charCodeAt(p)?(e=Mc,p++):(e=l,0===B&&k(Nc)),e===l&&(63===f.charCodeAt(p)?(e=Xb,p++):(e=l,0===B&&k(Pa)),e===l&&(64===f.charCodeAt(p)?(e=Ka,p++):(e=l,0===B&&k(kc)),e===l&&(xc.test(f.charAt(p))?(e=f.charAt(p),p++):(e=l,0===B&&k(lc)),e===l&&(91===f.charCodeAt(p)?(e=hb,p++):(e=l,0===B&&k(Kb)),e===l&&(92===f.charCodeAt(p)?(e=Xa,p++):(e=l,0===B&&k(Lb)),e===l&&(93===
f.charCodeAt(p)?(e=mc,p++):(e=l,0===B&&k(Db)),e===l&&(94===f.charCodeAt(p)?(e=ua,p++):(e=l,0===B&&k(Qa)),e===l&&(95===f.charCodeAt(p)?(e=A,p++):(e=l,0===B&&k(ub)),e===l&&(96===f.charCodeAt(p)?(e=fa,p++):(e=l,0===B&&k(Yb)),e===l&&(J.test(f.charAt(p))?(e=f.charAt(p),p++):(e=l,0===B&&k(ya)),e===l&&(123===f.charCodeAt(p)?(e=za,p++):(e=l,0===B&&k(Ra)),e===l&&(47===f.charCodeAt(p)?(e=wc,p++):(e=l,0===B&&k(Wb)),e===l&&(125===f.charCodeAt(p)?(e=S,p++):(e=l,0===B&&k(Sa)),e===l&&(126===f.charCodeAt(p)?(e=Eb,
p++):(e=l,0===B&&k(hd)))))))))))))))))))))))))))))))))));return e}function w(){var e;44===f.charCodeAt(p)?(e=Oa,p++):(e=l,0===B&&k(ka));return e}function E(){var e,f,g,h,k;e=p;f=[];for(g=m();g!==l;)f.push(g),g=m();if(f!==l)if(g=w(),g!==l){h=[];for(k=m();k!==l;)h.push(k),k=m();h!==l?e=f=[f,g,h]:(p=e,e=l)}else p=e,e=l;else p=e,e=l;return e}function F(){var e,f;e=[];f=q();if(f!==l)for(;f!==l;)e.push(f),f=q();else e=l;e!==l&&(e=parseInt(e.join(""),10));return e}function G(){var e,g,h;e=p;43===f.charCodeAt(p)?
(g=Cb,p++):(g=l,0===B&&k(ra));g===l&&(45===f.charCodeAt(p)?(g=Wa,p++):(g=l,0===B&&k(ta)));g===l&&(g=null);g!==l?(h=F(),h!==l?e=g=parseInt(g+h,10):(p=e,e=l)):(p=e,e=l);return e}function I(){var e,g,h,m,n,r,w;e=p;g=G();g!==l?(h=t(),h!==l?e=g=parseFloat(g+h.join("")):(p=e,e=l)):(p=e,e=l);if(e===l)if(e=p,43===f.charCodeAt(p)?(g=Cb,p++):(g=l,0===B&&k(ra)),g===l&&(45===f.charCodeAt(p)?(g=Wa,p++):(g=l,0===B&&k(ta))),g===l&&(g=null),g!==l){m=h=p;n=[];for(r=q();r!==l;)n.push(r),r=q();n!==l?(46===f.charCodeAt(p)?
(r=gb,p++):(r=l,0===B&&k(vc)),r!==l?(w=F(),w!==l?m=n=[n,r,w]:(p=m,m=l)):(p=m,m=l)):(p=m,m=l);if(m===l){m=p;n=[];r=q();if(r!==l)for(;r!==l;)n.push(r),r=q();else n=l;n!==l?(46===f.charCodeAt(p)?(r=gb,p++):(r=l,0===B&&k(vc)),r!==l?m=n=[n,r]:(p=m,m=l)):(p=m,m=l)}h=m!==l?f.substring(h,p):m;h!==l?(m=t(),m===l&&(m=null),m!==l?e=g=parseFloat((g?g:"")+(h?h:"")+(m?m.join(""):"")):(p=e,e=l)):(p=e,e=l)}else p=e,e=l;return e}function C(){var e;e=I();e===l&&(e=G());return e}function K(){var e,g,h,n,q,r,t,w,y,x,
A,za,F,Ra,S,G,H,Sa,Eb;e=p;91===f.charCodeAt(p)?(g=hb,p++):(g=l,0===B&&k(Kb));if(g!==l){h=[];for(g=m();g!==l;)h.push(g),g=m();if(h!==l)if(g=C(),g!==l)if(h=E(),h!==l)if(h=C(),h!==l)if(n=E(),n!==l)if(n=C(),n!==l)if(q=E(),q!==l)if(q=C(),q!==l)if(r=E(),r!==l)if(r=C(),r!==l)if(t=E(),t!==l)if(t=C(),t!==l)if(w=E(),w!==l)if(w=C(),w!==l)if(y=E(),y!==l)if(y=C(),y!==l)if(x=E(),x!==l)if(x=C(),x!==l)if(A=E(),A!==l)if(A=C(),A!==l)if(za=E(),za!==l)if(za=C(),za!==l)if(F=E(),F!==l)if(F=C(),F!==l)if(Ra=E(),Ra!==l)if(Ra=
C(),Ra!==l)if(S=E(),S!==l)if(S=C(),S!==l)if(G=E(),G!==l)if(G=C(),G!==l)if(H=E(),H!==l)if(H=C(),H!==l){Sa=[];for(Eb=m();Eb!==l;)Sa.push(Eb),Eb=m();Sa!==l?(93===f.charCodeAt(p)?(Eb=mc,p++):(Eb=l,0===B&&k(Db)),Eb!==l?e=g=[g,h,n,q,r,t,w,y,x,A,za,F,Ra,S,G,H]:(p=e,e=l)):(p=e,e=l)}else p=e,e=l;else p=e,e=l;else p=e,e=l;else p=e,e=l;else p=e,e=l;else p=e,e=l;else p=e,e=l;else p=e,e=l;else p=e,e=l;else p=e,e=l;else p=e,e=l;else p=e,e=l;else p=e,e=l;else p=e,e=l;else p=e,e=l;else p=e,e=l;else p=e,e=l;else p=
e,e=l;else p=e,e=l;else p=e,e=l;else p=e,e=l;else p=e,e=l;else p=e,e=l;else p=e,e=l;else p=e,e=l;else p=e,e=l;else p=e,e=l;else p=e,e=l;else p=e,e=l;else p=e,e=l;else p=e,e=l;else p=e,e=l}else p=e,e=l;return e}function H(){var e,g;e=[];Oh.test(f.charAt(p))?(g=f.charAt(p),p++):(g=l,0===B&&k(Ph));if(g!==l)for(;g!==l;)e.push(g),Oh.test(f.charAt(p))?(g=f.charAt(p),p++):(g=l,0===B&&k(Ph));else e=l;e!==l&&(e=e.join(""));return e}function L(){var e,g,h,m;e=p;39===f.charCodeAt(p)?(g=Ma,p++):(g=l,0===B&&k(qb));
if(g!==l){h=[];f.substr(p,2)===zb?(m=zb,p+=2):(m=l,0===B&&k(Na));m===l&&(34===f.charCodeAt(p)?(m=pa,p++):(m=l,0===B&&k(N)),m===l&&(m=x()));for(;m!==l;)h.push(m),f.substr(p,2)===zb?(m=zb,p+=2):(m=l,0===B&&k(Na)),m===l&&(34===f.charCodeAt(p)?(m=pa,p++):(m=l,0===B&&k(N)),m===l&&(m=x()));h!==l?(39===f.charCodeAt(p)?(m=Ma,p++):(m=l,0===B&&k(qb)),m!==l?e=g=[g,h,m]:(p=e,e=l)):(p=e,e=l)}else p=e,e=l;if(e===l)if(e=p,34===f.charCodeAt(p)?(g=pa,p++):(g=l,0===B&&k(N)),g!==l){h=[];f.substr(p,2)===R?(m=R,p+=2):
(m=l,0===B&&k(rb));m===l&&(39===f.charCodeAt(p)?(m=Ma,p++):(m=l,0===B&&k(qb)),m===l&&(m=x()));for(;m!==l;)h.push(m),f.substr(p,2)===R?(m=R,p+=2):(m=l,0===B&&k(rb)),m===l&&(39===f.charCodeAt(p)?(m=Ma,p++):(m=l,0===B&&k(qb)),m===l&&(m=x()));h!==l?(34===f.charCodeAt(p)?(m=pa,p++):(m=l,0===B&&k(N)),m!==l?e=g=[g,h,m]:(p=e,e=l)):(p=e,e=l)}else p=e,e=l;return e}function P(){var e,g,h,n,q,t;g=p;var w,y,x;e=p;35===f.charCodeAt(p)?(h=qa,p++):(h=l,0===B&&k(eb));h===l&&(f.substr(p,2)===Qh?(h=Qh,p+=2):(h=l,0===
B&&k(Nj)));h!==l?(n=r(),n!==l?(q=r(),q!==l?(t=r(),t!==l?(w=r(),w!==l?(y=r(),y!==l?(x=r(),x!==l?e=h=[h,n,q,t,w,y,x]:(p=e,e=l)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l);h=e;e=g=h!==l?f.substring(g,p):h;if(e===l)if(e=p,f.substr(p,4)===Rh?(g=Rh,p+=4):(g=l,0===B&&k(Oj)),g!==l){h=[];for(g=m();g!==l;)h.push(g),g=m();if(h!==l)if(g=C(),g!==l)if(h=E(),h!==l)if(h=C(),h!==l)if(n=E(),n!==l)if(n=C(),n!==l){q=[];for(t=m();t!==l;)q.push(t),t=m();q!==l?(41===f.charCodeAt(p)?(t=Bb,p++):(t=l,
0===B&&k(sb)),t!==l?e=g="#"+("0"+g.toString(16)).slice(-2)+("0"+h.toString(16)).slice(-2)+("0"+n.toString(16)).slice(-2):(p=e,e=l)):(p=e,e=l)}else p=e,e=l;else p=e,e=l;else p=e,e=l;else p=e,e=l;else p=e,e=l;else p=e,e=l}else p=e,e=l;return e}function U(){var e;e=P();e===l&&(e=H());return e}function X(){var e,g;e=p;var h,m,n,q;g=p;84===f.charCodeAt(p)?(h=Zb,p++):(h=l,0===B&&k(Ob));h===l&&(116===f.charCodeAt(p)?(h=nc,p++):(h=l,0===B&&k(Aa)));h!==l?(82===f.charCodeAt(p)?(m=zc,p++):(m=l,0===B&&k(qg)),
m===l&&(114===f.charCodeAt(p)?(m=td,p++):(m=l,0===B&&k(Pb))),m!==l?(85===f.charCodeAt(p)?(n=Pj,p++):(n=l,0===B&&k(Qj)),n===l&&(117===f.charCodeAt(p)?(n=Rj,p++):(n=l,0===B&&k(Sj))),n!==l?(69===f.charCodeAt(p)?(q=Ac,p++):(q=l,0===B&&k(Qc)),q===l&&(101===f.charCodeAt(p)?(q=oc,p++):(q=l,0===B&&k(pc))),q!==l?g=h=[h,m,n,q]:(p=g,g=l)):(p=g,g=l)):(p=g,g=l)):(p=g,g=l);g===l&&(g=p,79===f.charCodeAt(p)?(h=Je,p++):(h=l,0===B&&k(Ke)),h===l&&(111===f.charCodeAt(p)?(h=Le,p++):(h=l,0===B&&k(Me))),h!==l?(78===f.charCodeAt(p)?
(m=Bc,p++):(m=l,0===B&&k(Qb)),m===l&&(110===f.charCodeAt(p)?(m=Cc,p++):(m=l,0===B&&k(Rb))),m!==l?g=h=[h,m]:(p=g,g=l)):(p=g,g=l));if(g===l){var r;g=p;70===f.charCodeAt(p)?(h=rg,p++):(h=l,0===B&&k(sg));h===l&&(102===f.charCodeAt(p)?(h=tg,p++):(h=l,0===B&&k(ug)));h!==l?(65===f.charCodeAt(p)?(m=Ne,p++):(m=l,0===B&&k(Oe)),m===l&&(97===f.charCodeAt(p)?(m=Pe,p++):(m=l,0===B&&k(Qe))),m!==l?(76===f.charCodeAt(p)?(n=Re,p++):(n=l,0===B&&k(Se)),n===l&&(108===f.charCodeAt(p)?(n=Te,p++):(n=l,0===B&&k(Ue))),n!==
l?(83===f.charCodeAt(p)?(q=vg,p++):(q=l,0===B&&k(wg)),q===l&&(115===f.charCodeAt(p)?(q=xg,p++):(q=l,0===B&&k(yg))),q!==l?(69===f.charCodeAt(p)?(r=Ac,p++):(r=l,0===B&&k(Qc)),r===l&&(101===f.charCodeAt(p)?(r=oc,p++):(r=l,0===B&&k(pc))),r!==l?g=h=[h,m,n,q,r]:(p=g,g=l)):(p=g,g=l)):(p=g,g=l)):(p=g,g=l)):(p=g,g=l);g===l&&(g=p,79===f.charCodeAt(p)?(h=Je,p++):(h=l,0===B&&k(Ke)),h===l&&(111===f.charCodeAt(p)?(h=Le,p++):(h=l,0===B&&k(Me))),h!==l?(70===f.charCodeAt(p)?(m=rg,p++):(m=l,0===B&&k(sg)),m===l&&(102===
f.charCodeAt(p)?(m=tg,p++):(m=l,0===B&&k(ug))),m!==l?(70===f.charCodeAt(p)?(n=rg,p++):(n=l,0===B&&k(sg)),n===l&&(102===f.charCodeAt(p)?(n=tg,p++):(n=l,0===B&&k(ug))),n!==l?g=h=[h,m,n]:(p=g,g=l)):(p=g,g=l)):(p=g,g=l))}e=g!==l?f.substring(e,p):g;e!==l&&(e="true"===e.toLowerCase()||"on"===e.toLowerCase());return e}function oa(){var e;e=P();if(e===l){var g,h;e=p;g=C();g!==l?(37===f.charCodeAt(p)?(h=Va,p++):(h=l,0===B&&k(fb)),h!==l?e=g=[g,h]:(p=e,e=l)):(p=e,e=l);e!==l&&(e=e.join(""));e===l&&(e=C(),e===
l&&(e=aa(),e===l&&(e=K(),e===l&&(e=L(),e===l&&(e=X(),e===l&&(e=H()))))))}return e}function ma(){var e,g,h,n;e=p;40===f.charCodeAt(p)?(g=da,p++):(g=l,0===B&&k(Ba));if(g!==l){var q,r;g=p;h=H();if(h!==l){n=[];for(q=m();q!==l;)n.push(q),q=m();if(n!==l)if(61===f.charCodeAt(p)?(q=Ca,p++):(q=l,0===B&&k(Jb)),q!==l){q=[];for(n=m();n!==l;)q.push(n),n=m();if(q!==l)if(n=oa(),n!==l){q=[];for(r=m();r!==l;)q.push(r),r=m();q!==l?g=h=[h,n]:(p=g,g=l)}else p=g,g=l;else p=g,g=l}else p=g,g=l;else p=g,g=l}else p=g,g=l;
h=g;if(h!==l){g=[];for(n=Gb();n!==l;)g.push(n),n=Gb();if(g!==l)if(41===f.charCodeAt(p)?(n=Bb,p++):(n=l,0===B&&k(sb)),n!==l){e=new Map;e.set(h[0],h[1]);for(var t in g)h=g[t],e.set(h[0],h[1])}else p=e,e=l;else p=e,e=l}else p=e,e=l}else p=e,e=l;return e}function Gb(){var e,g,h,n,q;e=p;g=[];for(h=m();h!==l;)g.push(h),h=m();if(g!==l)if(h=w(),h!==l){h=[];for(g=m();g!==l;)h.push(g),g=m();if(h!==l)if(g=H(),g!==l){h=[];for(n=m();n!==l;)h.push(n),n=m();if(h!==l)if(61===f.charCodeAt(p)?(n=Ca,p++):(n=l,0===B&&
k(Jb)),n!==l){n=[];for(h=m();h!==l;)n.push(h),h=m();if(n!==l)if(h=oa(),h!==l){n=[];for(q=m();q!==l;)n.push(q),q=m();n!==l?e=g=[g,h]:(p=e,e=l)}else p=e,e=l;else p=e,e=l}else p=e,e=l;else p=e,e=l}else p=e,e=l;else p=e,e=l}else p=e,e=l;else p=e,e=l;return e}function Sb(){var e,g,h,m,n,q,r,t;e=p;80===f.charCodeAt(p)?(g=zg,p++):(g=l,0===B&&k(Ag));g===l&&(112===f.charCodeAt(p)?(g=Bg,p++):(g=l,0===B&&k(Cg)));g!==l?(69===f.charCodeAt(p)?(h=Ac,p++):(h=l,0===B&&k(Qc)),h===l&&(101===f.charCodeAt(p)?(h=oc,p++):
(h=l,0===B&&k(pc))),h!==l?(80===f.charCodeAt(p)?(m=zg,p++):(m=l,0===B&&k(Ag)),m===l&&(112===f.charCodeAt(p)?(m=Bg,p++):(m=l,0===B&&k(Cg))),m!==l?(84===f.charCodeAt(p)?(n=Zb,p++):(n=l,0===B&&k(Ob)),n===l&&(116===f.charCodeAt(p)?(n=nc,p++):(n=l,0===B&&k(Aa))),n!==l?(73===f.charCodeAt(p)?(q=uf,p++):(q=l,0===B&&k(vf)),q===l&&(105===f.charCodeAt(p)?(q=wf,p++):(q=l,0===B&&k(xf))),q!==l?(68===f.charCodeAt(p)?(r=Dg,p++):(r=l,0===B&&k(Eg)),r===l&&(100===f.charCodeAt(p)?(r=Fg,p++):(r=l,0===B&&k(Gg))),r!==l?
(69===f.charCodeAt(p)?(t=Ac,p++):(t=l,0===B&&k(Qc)),t===l&&(101===f.charCodeAt(p)?(t=oc,p++):(t=l,0===B&&k(pc))),t!==l?e=g=[g,h,m,n,q,r,t]:(p=e,e=l)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l);return e}function ca(){var e,g,h,n,q,r,t,w;e=p;80===f.charCodeAt(p)?(g=zg,p++):(g=l,0===B&&k(Ag));g===l&&(112===f.charCodeAt(p)?(g=Bg,p++):(g=l,0===B&&k(Cg)));g!==l?(82===f.charCodeAt(p)?(h=zc,p++):(h=l,0===B&&k(qg)),h===l&&(114===f.charCodeAt(p)?(h=td,p++):(h=l,0===B&&k(Pb))),h!==l?(79===
f.charCodeAt(p)?(n=Je,p++):(n=l,0===B&&k(Ke)),n===l&&(111===f.charCodeAt(p)?(n=Le,p++):(n=l,0===B&&k(Me))),n!==l?(84===f.charCodeAt(p)?(q=Zb,p++):(q=l,0===B&&k(Ob)),q===l&&(116===f.charCodeAt(p)?(q=nc,p++):(q=l,0===B&&k(Aa))),q!==l?(69===f.charCodeAt(p)?(r=Ac,p++):(r=l,0===B&&k(Qc)),r===l&&(101===f.charCodeAt(p)?(r=oc,p++):(r=l,0===B&&k(pc))),r!==l?(73===f.charCodeAt(p)?(t=uf,p++):(t=l,0===B&&k(vf)),t===l&&(105===f.charCodeAt(p)?(t=wf,p++):(t=l,0===B&&k(xf))),t!==l?(78===f.charCodeAt(p)?(w=Bc,p++):
(w=l,0===B&&k(Qb)),w===l&&(110===f.charCodeAt(p)?(w=Cc,p++):(w=l,0===B&&k(Rb))),w!==l?e=g=[g,h,n,q,r,t,w]:(p=e,e=l)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l);e===l&&(e=Sb(),e===l&&(e=p,83===f.charCodeAt(p)?(g=vg,p++):(g=l,0===B&&k(wg)),g===l&&(115===f.charCodeAt(p)?(g=xg,p++):(g=l,0===B&&k(yg))),g!==l?(77===f.charCodeAt(p)?(h=Tj,p++):(h=l,0===B&&k(Uj)),h===l&&(109===f.charCodeAt(p)?(h=Vj,p++):(h=l,0===B&&k(Wj))),h!==l?(65===f.charCodeAt(p)?(n=Ne,p++):(n=l,0===B&&k(Oe)),n===
l&&(97===f.charCodeAt(p)?(n=Pe,p++):(n=l,0===B&&k(Qe))),n!==l?(76===f.charCodeAt(p)?(q=Re,p++):(q=l,0===B&&k(Se)),q===l&&(108===f.charCodeAt(p)?(q=Te,p++):(q=l,0===B&&k(Ue))),q!==l?(76===f.charCodeAt(p)?(r=Re,p++):(r=l,0===B&&k(Se)),r===l&&(108===f.charCodeAt(p)?(r=Te,p++):(r=l,0===B&&k(Ue))),r!==l?(t=m(),t!==l?(w=Sb(),w!==l?e=g=[g,h,n,q,r,t,w]:(p=e,e=l)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l),e===l&&(e=p,82===f.charCodeAt(p)?(g=zc,p++):(g=l,0===B&&k(qg)),g===l&&(114===f.charCodeAt(p)?
(g=td,p++):(g=l,0===B&&k(Pb))),g!==l?(78===f.charCodeAt(p)?(h=Bc,p++):(h=l,0===B&&k(Qb)),h===l&&(110===f.charCodeAt(p)?(h=Cc,p++):(h=l,0===B&&k(Rb))),h!==l?(65===f.charCodeAt(p)?(n=Ne,p++):(n=l,0===B&&k(Oe)),n===l&&(97===f.charCodeAt(p)?(n=Pe,p++):(n=l,0===B&&k(Qe))),n!==l?e=g=[g,h,n]:(p=e,e=l)):(p=e,e=l)):(p=e,e=l),e===l&&(e=p,68===f.charCodeAt(p)?(g=Dg,p++):(g=l,0===B&&k(Eg)),g===l&&(100===f.charCodeAt(p)?(g=Fg,p++):(g=l,0===B&&k(Gg))),g!==l?(78===f.charCodeAt(p)?(h=Bc,p++):(h=l,0===B&&k(Qb)),h===
l&&(110===f.charCodeAt(p)?(h=Cc,p++):(h=l,0===B&&k(Rb))),h!==l?(65===f.charCodeAt(p)?(n=Ne,p++):(n=l,0===B&&k(Oe)),n===l&&(97===f.charCodeAt(p)?(n=Pe,p++):(n=l,0===B&&k(Qe))),n!==l?e=g=[g,h,n]:(p=e,e=l)):(p=e,e=l)):(p=e,e=l),e===l&&(e=p,76===f.charCodeAt(p)?(g=Re,p++):(g=l,0===B&&k(Se)),g===l&&(108===f.charCodeAt(p)?(g=Te,p++):(g=l,0===B&&k(Ue))),g!==l?(73===f.charCodeAt(p)?(h=uf,p++):(h=l,0===B&&k(vf)),h===l&&(105===f.charCodeAt(p)?(h=wf,p++):(h=l,0===B&&k(xf))),h!==l?(71===f.charCodeAt(p)?(n=Xj,
p++):(n=l,0===B&&k(Yj)),n===l&&(103===f.charCodeAt(p)?(n=Zj,p++):(n=l,0===B&&k(ak))),n!==l?(65===f.charCodeAt(p)?(q=Ne,p++):(q=l,0===B&&k(Oe)),q===l&&(97===f.charCodeAt(p)?(q=Pe,p++):(q=l,0===B&&k(Qe))),q!==l?(78===f.charCodeAt(p)?(r=Bc,p++):(r=l,0===B&&k(Qb)),r===l&&(110===f.charCodeAt(p)?(r=Cc,p++):(r=l,0===B&&k(Rb))),r!==l?(68===f.charCodeAt(p)?(t=Dg,p++):(t=l,0===B&&k(Eg)),t===l&&(100===f.charCodeAt(p)?(t=Fg,p++):(t=l,0===B&&k(Gg))),t!==l?e=g=[g,h,n,q,r,t]:(p=e,e=l)):(p=e,e=l)):(p=e,e=l)):(p=
e,e=l)):(p=e,e=l)):(p=e,e=l),e===l&&(e=p,73===f.charCodeAt(p)?(g=uf,p++):(g=l,0===B&&k(vf)),g===l&&(105===f.charCodeAt(p)?(g=wf,p++):(g=l,0===B&&k(xf))),g!==l?(79===f.charCodeAt(p)?(h=Je,p++):(h=l,0===B&&k(Ke)),h===l&&(111===f.charCodeAt(p)?(h=Le,p++):(h=l,0===B&&k(Me))),h!==l?(78===f.charCodeAt(p)?(n=Bc,p++):(n=l,0===B&&k(Qb)),n===l&&(110===f.charCodeAt(p)?(n=Cc,p++):(n=l,0===B&&k(Rb))),n!==l?e=g=[g,h,n]:(p=e,e=l)):(p=e,e=l)):(p=e,e=l),e===l&&(e=p,83===f.charCodeAt(p)?(g=vg,p++):(g=l,0===B&&k(wg)),
g===l&&(115===f.charCodeAt(p)?(g=xg,p++):(g=l,0===B&&k(yg))),g!==l?(79===f.charCodeAt(p)?(h=Je,p++):(h=l,0===B&&k(Ke)),h===l&&(111===f.charCodeAt(p)?(h=Le,p++):(h=l,0===B&&k(Me))),h!==l?(76===f.charCodeAt(p)?(n=Re,p++):(n=l,0===B&&k(Se)),n===l&&(108===f.charCodeAt(p)?(n=Te,p++):(n=l,0===B&&k(Ue))),n!==l?(86===f.charCodeAt(p)?(q=bk,p++):(q=l,0===B&&k(ck)),q===l&&(118===f.charCodeAt(p)?(q=dk,p++):(q=l,0===B&&k(ek))),q!==l?(69===f.charCodeAt(p)?(r=Ac,p++):(r=l,0===B&&k(Qc)),r===l&&(101===f.charCodeAt(p)?
(r=oc,p++):(r=l,0===B&&k(pc))),r!==l?(78===f.charCodeAt(p)?(t=Bc,p++):(t=l,0===B&&k(Qb)),t===l&&(110===f.charCodeAt(p)?(t=Cc,p++):(t=l,0===B&&k(Rb))),t!==l?(84===f.charCodeAt(p)?(w=Zb,p++):(w=l,0===B&&k(Ob)),w===l&&(116===f.charCodeAt(p)?(w=nc,p++):(w=l,0===B&&k(Aa))),w!==l?e=g=[g,h,n,q,r,t,w]:(p=e,e=l)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l))))))));e!==l&&(e=e.join(""));return e}function aa(){var e;f.substr(p,5)===Sh?(e=Sh,p+=5):(e=l,0===B&&k(fk));e!==l&&(e=new qh,e.type=
"SCENE");if(e===l){var g,h;e=p;f.substr(p,9)===Th?(g=Th,p+=9):(g=l,0===B&&k(gk));if(g!==l){h=[];for(g=m();g!==l;)h.push(g),g=m();h!==l?(g=H(),g!==l?(e=new qh,e.type=lh,e.Qb=g.toUpperCase()):(p=e,e=l)):(p=e,e=l)}else p=e,e=l;if(e===l){e=p;f.substr(p,7)===Uh?(g=Uh,p+=7):(g=l,0===B&&k(hk));if(g!==l){h=[];for(g=m();g!==l;)h.push(g),g=m();h!==l?(g=H(),g!==l?(58===f.charCodeAt(p)?(h=wa,p++):(h=l,0===B&&k(la)),h!==l?(h=ca(),h!==l?(e=new qh,e.type=mh,e.tc=h.toUpperCase(),e.Qb=g.toUpperCase()):(p=e,e=l)):
(p=e,e=l)):(p=e,e=l)):(p=e,e=l)}else p=e,e=l;if(e===l){var n;e=p;f.substr(p,8)===Vh?(g=Vh,p+=8):(g=l,0===B&&k(ik));if(g!==l){h=[];for(g=m();g!==l;)h.push(g),g=m();h!==l?(g=H(),g!==l?(58===f.charCodeAt(p)?(h=wa,p++):(h=l,0===B&&k(la)),h!==l?(h=ca(),h!==l?(58===f.charCodeAt(p)?(n=wa,p++):(n=l,0===B&&k(la)),n!==l?(n=H(),n!==l?(e=new qh,e.type=nh,e.Qb=g.toUpperCase(),e.tc=h.toUpperCase(),e.Zc=n):(p=e,e=l)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l)}else p=e,e=l;if(e===l){var q,r,t,w;e=p;f.substr(p,
7)===Wh?(g=Wh,p+=7):(g=l,0===B&&k(jk));if(g!==l){h=[];for(g=m();g!==l;)h.push(g),g=m();h!==l?(g=H(),g!==l?(58===f.charCodeAt(p)?(h=wa,p++):(h=l,0===B&&k(la)),h!==l?(h=ca(),h!==l?(58===f.charCodeAt(p)?(n=wa,p++):(n=l,0===B&&k(la)),n!==l?(n=H(),n!==l?(58===f.charCodeAt(p)?(q=wa,p++):(q=l,0===B&&k(la)),q!==l?(q=r=p,t=H(),t!==l?(58===f.charCodeAt(p)?(w=wa,p++):(w=l,0===B&&k(la)),w!==l?q=t=[t,w]:(p=q,q=l)):(p=q,q=l),q===l&&(q=null),r=q!==l?f.substring(r,p):q,r!==l?(q=p,t=G(),q=t!==l?f.substring(q,p):t,
q!==l?(e=new qh,e.type=oh,e.Qb=g.toUpperCase(),e.tc=h.toUpperCase(),e.Zc=n,e.tb=parseInt(q)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l)}else p=e,e=l;if(e===l)if(e=p,f.substr(p,4)===Xh?(g=Xh,p+=4):(g=l,0===B&&k(kk)),g!==l){h=[];for(g=m();g!==l;)h.push(g),g=m();h!==l?(g=H(),g!==l?(58===f.charCodeAt(p)?(h=wa,p++):(h=l,0===B&&k(la)),h!==l?(h=ca(),h!==l?(58===f.charCodeAt(p)?(n=wa,p++):(n=l,0===B&&k(la)),n!==l?(n=H(),n!==l?(58===f.charCodeAt(p)?(q=
wa,p++):(q=l,0===B&&k(la)),q!==l?(q=r=p,t=H(),t!==l?(58===f.charCodeAt(p)?(w=wa,p++):(w=l,0===B&&k(la)),w!==l?q=t=[t,w]:(p=q,q=l)):(p=q,q=l),q===l&&(q=null),r=q!==l?f.substring(r,p):q,r!==l?(q=p,t=G(),q=t!==l?f.substring(q,p):t,q!==l?(e=new qh,e.type=ph,e.Qb=g.toUpperCase(),e.tc=h.toUpperCase(),e.Zc=n,e.Pg=parseInt(q)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l)):(p=e,e=l)}else p=e,e=l}}}}return e}function va(){var e,g,h,n,q;e=p;g=[];for(h=m();h!==l;)g.push(h),
h=m();if(g!==l){var r,t,w,y,x,A;r=p;f.substr(p,4)===Yh?(t=Yh,p+=4):(t=l,0===B&&k(lk));if(t!==l){w=[];for(y=m();y!==l;)w.push(y),y=m();if(w!==l)if(y=H(),y!==l){x=[];for(A=m();A!==l;)x.push(A),A=m();if(x!==l){var za,E,Ra,C;za=p;f.substr(p,2)===Zh?(E=Zh,p+=2):(E=l,0===B&&k(mk));if(E!==l){Ra=[];for(C=m();C!==l;)Ra.push(C),C=m();Ra!==l?(C=H(),C!==l?za=E=C:(p=za,za=l)):(p=za,za=l)}else p=za,za=l;A=za;A===l&&(A=null);A!==l?r=t=new Eh(y.toUpperCase(),A):(p=r,r=l)}else p=r,r=l}else p=r,r=l;else p=r,r=l}else p=
r,r=l;h=r;if(h===l){var S,G,Eb,Sa,hd,J,Zb;S=p;f.substr(p,7)===$h?(G=$h,p+=7):(G=l,0===B&&k(nk));if(G!==l){Eb=[];for(Sa=m();Sa!==l;)Eb.push(Sa),Sa=m();if(Eb!==l)if(Sa=ma(),Sa===l&&(Sa=null),Sa!==l){hd=[];for(J=m();J!==l;)hd.push(J),J=m();if(hd!==l)if(J=p,Zb=L(),J=Zb!==l?f.substring(J,p):Zb,J!==l){var N=J,N=N.substring(0).substring(N.length-1,1);S=G=new Ch(N,Sa)}else p=S,S=l;else p=S,S=l}else p=S,S=l;else p=S,S=l}else p=S,S=l;h=S;if(h===l){var Ob,R,W,nc;Ob=p;f.substr(p,6)===ai?(R=ai,p+=6):(R=l,0===
B&&k(ok));if(R!==l){W=[];for(nc=m();nc!==l;)W.push(nc),nc=m();W!==l?(nc=H(),nc!==l?Ob=R=new Gh(nc.toUpperCase()):(p=Ob,Ob=l)):(p=Ob,Ob=l)}else p=Ob,Ob=l;h=Ob;if(h===l){var Aa,zc,ia,da,na,ba,oa,ca;Aa=p;f.substr(p,3)===bi?(zc=bi,p+=3):(zc=l,0===B&&k(pk));if(zc!==l){ia=[];for(da=m();da!==l;)ia.push(da),da=m();if(ia!==l)if(da=H(),da!==l){na=[];for(ba=m();ba!==l;)na.push(ba),ba=m();if(na!==l)if(ba=ma(),ba===l&&(ba=null),ba!==l){oa=[];for(ca=m();ca!==l;)oa.push(ca),ca=m();if(oa!==l)if(ca=P(),ca===l&&(ca=
H()),ca!==l){var la=da,ua=ba,pa=ca;"background"===la?zc=new Jh(la,pa,ua):"quality"===la?(pa=pa.toUpperCase(),zc=new Jh(la,pa,ua)):zc=new Jh(la,pa);Aa=zc}else p=Aa,Aa=l;else p=Aa,Aa=l}else p=Aa,Aa=l;else p=Aa,Aa=l}else p=Aa,Aa=l;else p=Aa,Aa=l}else p=Aa,Aa=l;h=Aa;if(h===l){var fa,ka,wa,ra;fa=p;f.substr(p,4)===ci?(ka=ci,p+=4):(ka=l,0===B&&k(qk));ka===l&&(f.substr(p,4)===di?(ka=di,p+=4):(ka=l,0===B&&k(rk)));if(ka!==l){wa=[];for(ra=m();ra!==l;)wa.push(ra),ra=m();wa!==l?(ra=aa(),ra!==l?fa=ka=new Kh(ra,
"show"===ka):(p=fa,fa=l)):(p=fa,fa=l)}else p=fa,fa=l;h=fa;if(h===l){var jb,Ja,Oa,va,Wa,xa,Xa,ya;jb=p;f.substr(p,4)===ei?(Ja=ei,p+=4):(Ja=l,0===B&&k(sk));if(Ja!==l){Oa=[];for(va=m();va!==l;)Oa.push(va),va=m();if(Oa!==l)if(va=aa(),va!==l){Wa=[];for(xa=m();xa!==l;)Wa.push(xa),xa=m();if(Wa!==l)if(xa=H(),xa!==l){Xa=[];for(ya=m();ya!==l;)Xa.push(ya),ya=m();Xa!==l?(ya=X(),ya!==l?jb=Ja=new Hh(va,V.Tf(xa.toUpperCase()),ya):(p=jb,jb=l)):(p=jb,jb=l)}else p=jb,jb=l;else p=jb,jb=l}else p=jb,jb=l;else p=jb,jb=
l}else p=jb,jb=l;h=jb;if(h===l){var Ea,Va,fb,ta,gb,Ca,hb,Pb,$b,qa,Na,Ia,bb,Ma;Ea=p;f.substr(p,5)===fi?(Va=fi,p+=5):(Va=l,0===B&&k(tk));if(Va!==l){fb=[];for(ta=m();ta!==l;)fb.push(ta),ta=m();if(fb!==l)if(ta=ma(),ta===l&&(ta=null),ta!==l){gb=[];for(Ca=m();Ca!==l;)gb.push(Ca),Ca=m();if(gb!==l)if(Ca=aa(),Ca!==l){hb=[];for(Pb=m();Pb!==l;)hb.push(Pb),Pb=m();if(hb!==l){$b=Pb=p;qa=H();if(qa!==l){Na=p;B++;Ia=p;bb=[];for(Ma=m();Ma!==l;)bb.push(Ma),Ma=m();bb!==l?(Ma=U(),Ma!==l?Ia=bb=[bb,Ma]:(p=Ia,Ia=l)):(p=
Ia,Ia=l);B--;Ia!==l?(p=Na,Na=void 0):Na=l;Na!==l?$b=qa=[qa,Na]:(p=$b,$b=l)}else p=$b,$b=l;$b===l&&($b=null);Pb=$b!==l?f.substring(Pb,p):$b;if(Pb!==l){$b=[];for(qa=m();qa!==l;)$b.push(qa),qa=m();$b!==l?(qa=U(),qa!==l?Ea=Va=new Bh(Ca,qa,V.Tf((Pb?Pb.toUpperCase():"").toUpperCase()),ta):(p=Ea,Ea=l)):(p=Ea,Ea=l)}else p=Ea,Ea=l}else p=Ea,Ea=l}else p=Ea,Ea=l;else p=Ea,Ea=l}else p=Ea,Ea=l;else p=Ea,Ea=l}else p=Ea,Ea=l;h=Ea;if(h===l){var kb,qb,zb,Ba,Bb,Qa,Gb,Ha;kb=p;f.substr(p,4)===gi?(qb=gi,p+=4):(qb=l,0===
B&&k(uk));if(qb!==l){zb=[];for(Ba=m();Ba!==l;)zb.push(Ba),Ba=m();if(zb!==l)if(Ba=ma(),Ba===l&&(Ba=null),Ba!==l){Bb=[];for(Qa=m();Qa!==l;)Bb.push(Qa),Qa=m();if(Bb!==l)if(Qa=aa(),Qa!==l){Gb=[];for(Ha=m();Ha!==l;)Gb.push(Ha),Ha=m();if(Gb!==l){Ha=K();if(Ha===l){var sb;f.substr(p,6)===hi?(sb=hi,p+=6):(sb=l,0===B&&k(vk));sb!==l&&(sb=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);Ha=sb}Ha!==l?kb=qb=new Fh(Qa,Ha,Ba):(p=kb,kb=l)}else p=kb,kb=l}else p=kb,kb=l;else p=kb,kb=l}else p=kb,kb=l;else p=kb,kb=l}else p=kb,kb=l;
h=kb;if(h===l){var lb,Cb,Jb,Ka,Lb,Ya,Sb,eb;lb=p;f.substr(p,5)===ii?(Cb=ii,p+=5):(Cb=l,0===B&&k(wk));if(Cb!==l){Jb=[];for(Ka=m();Ka!==l;)Jb.push(Ka),Ka=m();if(Jb!==l)if(Ka=ma(),Ka===l&&(Ka=null),Ka!==l){Lb=[];for(Ya=m();Ya!==l;)Lb.push(Ya),Ya=m();if(Lb!==l)if(Ya=aa(),Ya!==l){Sb=[];for(eb=m();eb!==l;)Sb.push(eb),eb=m();Sb!==l?(eb=aa(),eb!==l?lb=Cb=new wh(Ya,eb,Ka):(p=lb,lb=l)):(p=lb,lb=l)}else p=lb,lb=l;else p=lb,lb=l}else p=lb,lb=l;else p=lb,lb=l}else p=lb,lb=l;h=lb;if(h===l){var Pa,Kb,Yb,rb;Pa=p;
f.substr(p,4)===ji?(Kb=ji,p+=4):(Kb=l,0===B&&k(xk));if(Kb!==l){Yb=[];for(rb=m();rb!==l;)Yb.push(rb),rb=m();Yb!==l?(rb=F(),rb!==l?Pa=Kb=new th(rb):(p=Pa,Pa=l)):(p=Pa,Pa=l)}else p=Pa,Pa=l;h=Pa;if(h===l){var ac,Ub,hc,Xc,ic,tb;ac=p;f.substr(p,4)===ki?(Ub=ki,p+=4):(Ub=l,0===B&&k(yk));if(Ub!==l){hc=[];for(Xc=m();Xc!==l;)hc.push(Xc),Xc=m();if(hc!==l)if(Xc=ma(),Xc===l&&(Xc=null),Xc!==l){ic=[];for(tb=m();tb!==l;)ic.push(tb),tb=m();ic!==l?(tb=aa(),tb!==l?ac=Ub=new zh(tb,Xc,!0):(p=ac,ac=l)):(p=ac,ac=l)}else p=
ac,ac=l;else p=ac,ac=l}else p=ac,ac=l;h=ac;if(h===l){var mb,Wb,mc,ub,td,Rc,bc,Dc,Ib,xb,Vb,Ab;mb=p;f.substr(p,9)===li?(Wb=li,p+=9):(Wb=l,0===B&&k(zk));if(Wb!==l){mc=[];for(ub=m();ub!==l;)mc.push(ub),ub=m();if(mc!==l)if(ub=aa(),ub!==l){td=[];for(Rc=m();Rc!==l;)td.push(Rc),Rc=m();if(td!==l){bc=Rc=p;Dc=H();if(Dc!==l){Ib=p;B++;xb=p;Vb=[];for(Ab=m();Ab!==l;)Vb.push(Ab),Ab=m();Vb!==l?(Ab=X(),Ab!==l?xb=Vb=[Vb,Ab]:(p=xb,xb=l)):(p=xb,xb=l);B--;xb!==l?(p=Ib,Ib=void 0):Ib=l;Ib!==l?bc=Dc=[Dc,Ib]:(p=bc,bc=l)}else p=
bc,bc=l;bc===l&&(bc=null);Rc=bc!==l?f.substring(Rc,p):bc;if(Rc!==l){bc=[];for(Dc=m();Dc!==l;)bc.push(Dc),Dc=m();bc!==l?(Dc=X(),Dc!==l?mb=Wb=new Dh(ub,V.Tf((Rc?Rc.toUpperCase():"").toUpperCase()),Dc):(p=mb,mb=l)):(p=mb,mb=l)}else p=mb,mb=l}else p=mb,mb=l}else p=mb,mb=l;else p=mb,mb=l}else p=mb,mb=l;h=mb;if(h===l){var Fa,jc,vc,Yc,xc,Db,Bc,Qb,Cc,Rb;Fa=p;f.substr(p,4)===mi?(jc=mi,p+=4):(jc=l,0===B&&k(Ak));if(jc!==l){vc=[];for(Yc=m();Yc!==l;)vc.push(Yc),Yc=m();if(vc!==l)if(Yc=ma(),Yc===l&&(Yc=null),Yc!==
l){xc=[];for(Db=m();Db!==l;)xc.push(Db),Db=m();if(xc!==l)if(Db=aa(),Db!==l){Bc=[];for(Qb=m();Qb!==l;)Bc.push(Qb),Qb=m();if(Bc!==l)if(Qb=I(),Qb!==l){Cc=[];for(Rb=m();Rb!==l;)Cc.push(Rb),Rb=m();Cc!==l?(Rb=I(),Rb!==l?Fa=jc=new Ah(Db,0,0,Yc):(p=Fa,Fa=l)):(p=Fa,Fa=l)}else p=Fa,Fa=l;else p=Fa,Fa=l}else p=Fa,Fa=l;else p=Fa,Fa=l}else p=Fa,Fa=l;else p=Fa,Fa=l}else p=Fa,Fa=l;h=Fa;if(h===l&&(h=Hb(),h===l)){var cc,uc,Jc,Zc,Kc,ud;cc=p;f.substr(p,6)===ni?(uc=ni,p+=6):(uc=l,0===B&&k(Bk));if(uc!==l){Jc=[];for(Zc=
m();Zc!==l;)Jc.push(Zc),Zc=m();if(Jc!==l)if(Zc=ma(),Zc===l&&(Zc=null),Zc!==l){Kc=[];for(ud=m();ud!==l;)Kc.push(ud),ud=m();Kc!==l?(ud=aa(),ud!==l?cc=uc=new zh(ud,Zc,!1):(p=cc,cc=l)):(p=cc,cc=l)}else p=cc,cc=l;else p=cc,cc=l}else p=cc,cc=l;h=cc;if(h===l){var Ga,wc,Lc,$c,Mc,vd,Nc,Sc,dc,Ec,Xb,wd,kc,xd;Ga=p;f.substr(p,7)===oi?(wc=oi,p+=7):(wc=l,0===B&&k(Ck));if(wc!==l){Lc=[];for($c=m();$c!==l;)Lc.push($c),$c=m();if(Lc!==l)if($c=ma(),$c===l&&($c=null),$c!==l){Mc=[];for(vd=m();vd!==l;)Mc.push(vd),vd=m();
if(Mc!==l)if(vd=aa(),vd!==l){Nc=[];for(Sc=m();Sc!==l;)Nc.push(Sc),Sc=m();if(Nc!==l){dc=Sc=p;Ec=H();if(Ec!==l){Xb=p;B++;wd=p;kc=[];for(xd=m();xd!==l;)kc.push(xd),xd=m();kc!==l?(xd=I(),xd!==l?wd=kc=[kc,xd]:(p=wd,wd=l)):(p=wd,wd=l);B--;wd!==l?(p=Xb,Xb=void 0):Xb=l;Xb!==l?dc=Ec=[Ec,Xb]:(p=dc,dc=l)}else p=dc,dc=l;dc===l&&(dc=null);Sc=dc!==l?f.substring(Sc,p):dc;if(Sc!==l){dc=[];for(Ec=m();Ec!==l;)dc.push(Ec),Ec=m();dc!==l?(Ec=I(),Ec!==l?Ga=wc=new yh(vd,Ec,$c,V.Tf((Sc?Sc.toUpperCase():"").toUpperCase())):
(p=Ga,Ga=l)):(p=Ga,Ga=l)}else p=Ga,Ga=l}else p=Ga,Ga=l}else p=Ga,Ga=l;else p=Ga,Ga=l}else p=Ga,Ga=l;else p=Ga,Ga=l}else p=Ga,Ga=l;h=Ga;if(h===l){var lc;f.substr(p,5)===pi?(lc=pi,p+=5):(lc=l,0===B&&k(Dk));lc!==l&&(lc=new Ih);h=lc;if(h===l&&(h=Hb(),h===l)){var ad,Ac,Qc,yd;ad=p;f.substr(p,6)===qi?(Ac=qi,p+=6):(Ac=l,0===B&&k(Ek));if(Ac!==l){Qc=[];for(yd=m();yd!==l;)Qc.push(yd),yd=m();Qc!==l?(yd=aa(),yd!==l?ad=Ac=yd:(p=ad,ad=l)):(p=ad,ad=l)}else p=ad,ad=l;h=ad}}}}}}}}}}}}}}}}if(h!==l){n=[];for(q=m();q!==
l;)n.push(q),q=m();if(n!==l){var zd,oc,pc;zd=p;59===f.charCodeAt(p)?(oc=db,p++):(oc=l,0===B&&k(pb));if(oc!==l){var bd;10===f.charCodeAt(p)?(bd=sa,p++):(bd=l,0===B&&k(yb));bd===l&&(13===f.charCodeAt(p)?(bd=gd,p++):(bd=l,0===B&&k(Tb)),bd===l&&(f.substr(p,2)===cb?(bd=cb,p+=2):(bd=l,0===B&&k(ob))));pc=bd;pc===l&&(pc=null);pc!==l?zd=oc=[oc,pc]:(p=zd,zd=l)}else p=zd,zd=l;q=zd;q!==l?e=g=h:(p=e,e=l)}else p=e,e=l}else p=e,e=l}else p=e,e=l;return e}function Hb(){var e,g,h;e=p;f.substr(p,6)===yf?(g=yf,p+=6):
(g=l,0===B&&k(ri));if(g!==l){g=[];for(h=m();h!==l;)g.push(h),h=m();g!==l?e=null:(p=e,e=l)}else p=e,e=l;return e}function Hb(){var e;f.substr(p,6)===yf?(e=yf,p+=6):(e=l,0===B&&k(ri));e!==l&&(e=!1);return e}var W=1<arguments.length?arguments[1]:{},l={},y={start:n},Ib=n,na=" ",xb={type:"literal",value:" ",description:'" "'},uc="\t",bb={type:"literal",value:"\t",description:'"\\t"'},sa="\n",yb={type:"literal",value:"\n",description:'"\\n"'},gd="\r",Tb={type:"literal",value:"\r",description:'"\\r"'},cb=
"\r\n",ob={type:"literal",value:"\r\n",description:'"\\r\\n"'},db=";",pb={type:"literal",value:";",description:'";"'},qa="#",eb={type:"literal",value:"#",description:'"#"'},Ma="'",qb={type:"literal",value:"'",description:'"\'"'},zb="\\'",Na={type:"literal",value:"\\'",description:'"\\\\\'"'},pa='"',N={type:"literal",value:'"',description:'"\\""'},R='\\"',rb={type:"literal",value:'\\"',description:'"\\\\\\""'},Ha=/^[0-9]/,Ub={type:"class",value:"[0-9]",description:"[0-9]"},Jc=/^[0-9, A-F, a-f]/,hc=
{type:"class",value:"[0-9, A-F, a-f]",description:"[0-9, A-F, a-f]"},Vb=/^["e" \/ "E"]/,Kc={type:"class",value:'["e" / "E"]',description:'["e" / "E"]'},ic="!",Ab={type:"literal",value:"!",description:'"!"'},jc="$",Ia={type:"literal",value:"$",description:'"$"'},Va="%",fb={type:"literal",value:"%",description:'"%"'},ia="&",ba={type:"literal",value:"&",description:'"&"'},da="(",Ba={type:"literal",value:"(",description:'"("'},Bb=")",sb={type:"literal",value:")",description:'")"'},tb="*",Ja={type:"literal",
value:"*",description:'"*"'},Cb="+",ra={type:"literal",value:"+",description:'"+"'},Oa=",",ka={type:"literal",value:",",description:'","'},Wa="-",ta={type:"literal",value:"-",description:'"-"'},gb=".",vc={type:"literal",value:".",description:'"."'},wc="/",Wb={type:"literal",value:"/",description:'"/"'},wa=":",la={type:"literal",value:":",description:'":"'},xa="<",Lc={type:"literal",value:"<",description:'"<"'},Ca="=",Jb={type:"literal",value:"=",description:'"="'},Mc=">",Nc={type:"literal",value:">",
description:'">"'},Xb="?",Pa={type:"literal",value:"?",description:'"?"'},Ka="@",kc={type:"literal",value:"@",description:'"@"'},xc=/^[A-Z]/,lc={type:"class",value:"[A-Z]",description:"[A-Z]"},hb="[",Kb={type:"literal",value:"[",description:'"["'},Xa="\\",Lb={type:"literal",value:"\\",description:'"\\\\"'},mc="]",Db={type:"literal",value:"]",description:'"]"'},ua="^",Qa={type:"literal",value:"^",description:'"^"'},A="_",ub={type:"literal",value:"_",description:'"_"'},fa="`",Yb={type:"literal",value:"`",
description:'"`"'},J=/^[a-z]/,ya={type:"class",value:"[a-z]",description:"[a-z]"},za="{",Ra={type:"literal",value:"{",description:'"{"'},S="}",Sa={type:"literal",value:"}",description:'"}"'},Eb="~",hd={type:"literal",value:"~",description:'"~"'},Zb="T",Ob={type:"literal",value:"T",description:'"T"'},nc="t",Aa={type:"literal",value:"t",description:'"t"'},zc="R",qg={type:"literal",value:"R",description:'"R"'},td="r",Pb={type:"literal",value:"r",description:'"r"'},Pj="U",Qj={type:"literal",value:"U",
description:'"U"'},Rj="u",Sj={type:"literal",value:"u",description:'"u"'},Ac="E",Qc={type:"literal",value:"E",description:'"E"'},oc="e",pc={type:"literal",value:"e",description:'"e"'},Je="O",Ke={type:"literal",value:"O",description:'"O"'},Le="o",Me={type:"literal",value:"o",description:'"o"'},Bc="N",Qb={type:"literal",value:"N",description:'"N"'},Cc="n",Rb={type:"literal",value:"n",description:'"n"'},rg="F",sg={type:"literal",value:"F",description:'"F"'},tg="f",ug={type:"literal",value:"f",description:'"f"'},
Ne="A",Oe={type:"literal",value:"A",description:'"A"'},Pe="a",Qe={type:"literal",value:"a",description:'"a"'},Re="L",Se={type:"literal",value:"L",description:'"L"'},Te="l",Ue={type:"literal",value:"l",description:'"l"'},vg="S",wg={type:"literal",value:"S",description:'"S"'},xg="s",yg={type:"literal",value:"s",description:'"s"'},Rh="rgb(",Oj={type:"literal",value:"rgb(",description:'"rgb("'},hi="origin",vk={type:"literal",value:"origin",description:'"origin"'},Oh=/^[0-9a-zA-Z_]/,Ph={type:"class",value:"[0-9a-zA-Z_]",
description:"[0-9a-zA-Z_]"},Zh="as",mk={type:"literal",value:"as",description:'"as"'},Qh="0x",Nj={type:"literal",value:"0x",description:'"0x"'},zg="P",Ag={type:"literal",value:"P",description:'"P"'},Bg="p",Cg={type:"literal",value:"p",description:'"p"'},uf="I",vf={type:"literal",value:"I",description:'"I"'},wf="i",xf={type:"literal",value:"i",description:'"i"'},Dg="D",Eg={type:"literal",value:"D",description:'"D"'},Fg="d",Gg={type:"literal",value:"d",description:'"d"'},Tj="M",Uj={type:"literal",value:"M",
description:'"M"'},Vj="m",Wj={type:"literal",value:"m",description:'"m"'},Xj="G",Yj={type:"literal",value:"G",description:'"G"'},Zj="g",ak={type:"literal",value:"g",description:'"g"'},bk="V",ck={type:"literal",value:"V",description:'"V"'},dk="v",ek={type:"literal",value:"v",description:'"v"'},Sh="scene",fk={type:"literal",value:"scene",description:'"scene"'},Th="structure",gk={type:"literal",value:"structure",description:'"structure"'},Uh="moltype",hk={type:"literal",value:"moltype",description:'"moltype"'},
Vh="molecule",ik={type:"literal",value:"molecule",description:'"molecule"'},Wh="residue",jk={type:"literal",value:"residue",description:'"residue"'},Xh="atom",kk={type:"literal",value:"atom",description:'"atom"'},$h="display",nk={type:"literal",value:"display",description:'"display"'},Yh="load",lk={type:"literal",value:"load",description:'"load"'},ai="remove",ok={type:"literal",value:"remove",description:'"remove"'},bi="set",pk={type:"literal",value:"set",description:'"set"'},ni="center",Bk={type:"literal",
value:"center",description:'"center"'},ci="show",qk={type:"literal",value:"show",description:'"show"'},di="hide",rk={type:"literal",value:"hide",description:'"hide"'},ei="repr",sk={type:"literal",value:"repr",description:'"repr"'},fi="color",tk={type:"literal",value:"color",description:'"color"'},gi="move",uk={type:"literal",value:"move",description:'"move"'},ii="align",wk={type:"literal",value:"align",description:'"align"'},ki="zoom",yk={type:"literal",value:"zoom",description:'"zoom"'},li="highlight",
zk={type:"literal",value:"highlight",description:'"highlight"'},mi="clip",Ak={type:"literal",value:"clip",description:'"clip"'},yf="finish",ri={type:"literal",value:"finish",description:'"finish"'},ji="wait",xk={type:"literal",value:"wait",description:'"wait"'},oi="opacity",Ck={type:"literal",value:"opacity",description:'"opacity"'},pi="reset",Dk={type:"literal",value:"reset",description:'"reset"'},qi="target",Ek={type:"literal",value:"target",description:'"target"'},p=0,tf=[{line:1,mb:1,bc:!1}],
Ya=0,pg=[],B=0,zf;if("startRule"in W){if(!(W.qf in y))throw Error("Can't start parsing from rule \""+W.qf+'".');Ib=y[W.qf]}zf=Ib();if(zf!==l&&p===f.length)return zf;zf!==l&&p<f.length&&k({type:"end",description:"end of input"});throw function(f,g,h,k){function l(e){var f=1;for(e.sort(function(e,f){return e.description<f.description?-1:e.description>f.description?1:0});f<e.length;)e[f-1]===e[f]?e.splice(f,1):f++}function m(e,f){function g(e){function f(e){return e.charCodeAt(0).toString(16).toUpperCase()}
return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+f(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+f(e)}).replace(/[\u0100-\u0FFF]/g,function(e){return"\\u0"+f(e)}).replace(/[\u1000-\uFFFF]/g,function(e){return"\\u"+f(e)})}var h=Array(e.length),k;for(k=0;k<e.length;k++)h[k]=e[k].description;h=1<e.length?h.slice(0,-1).join(", ")+
" or "+h[e.length-1]:h[0];k=f?'"'+g(f)+'"':"end of input";return"Expected "+h+" but "+k+" found."}null!==g&&l(g);return new e(null!==f?f:m(g,h),0,0,k)}(null,pg,Ya<f.length?f.charAt(Ya):null,Ya<f.length?h(Ya,Ya+1):h(Ya,Ya));}}}();function Lh(e){this.parent=e;this.content=null}Lh.prototype.show=function(){Mh(this.parent);this.content.show();var e=[];e.visible=!0;this.update(e)};Lh.prototype.hide=function(){this.content.hide();var e=[];e.visible=!1;this.update(e);this.parent.ba.ca.scene3D.Yd.gj()};
Lh.prototype.toggle=function(){this.content.is(":visible")?this.hide():this.show()};function Nh(e,f,g){$(g?'<option selected value="'+f+'">'+f+"</option>":'<option value="'+f+'">'+f+"</option>").appendTo(e)}function si(e,f){var g;return g=""+('<input type="checkbox" id="widget'+e+'" title="'+f+'">')+('<label class="hasMenu mapSelection" for="widget'+e+'" title="'+f+'">')+"</label>"}Lh.prototype.update=function(){};
function ti(e){Lh.call(this,e);this.ba=this.parent.ba;this.div=this.ba.canvas;this.time=0;this.lock=!1;this.content=$('<div id="slider-range" style="height:250px;"></div>').css({position:"absolute",top:"20%",width:"5px",height:"60%","margin-left":"5px","margin-right":"auto"}).appendTo(this.div);this.oc=$("#slider-range");ui(this)}ti.prototype=Object.create(Lh.prototype);ti.prototype.constructor=ti;ti.prototype.toggle=function(){this.oc.toggle()};
ti.prototype.show=function(){this.oc.stop().fadeTo(0,1);this.lock=!0};ti.prototype.hide=function(){this.oc.stop().fadeTo(0,0);this.lock=!1};
function ui(e){function f(){e.lock||e.oc.stop().fadeTo(500,0)}setTimeout(function(){e.oc.fadeTo(1E3,0)},1E3);var g=!1;e.oc.on("mouseenter",function(){e.oc.stop().fadeTo(500,1)});e.oc.on("mouseleave",function(){g||f()});e.oc.slider({orientation:"vertical",Sl:!0,step:.1,values:[0,100],slide:function(f,g){ef(e.ba.ca.scene3D,g.values[0],g.values[1])}});e.oc.on("slidestart",function(){g=!0});e.oc.on("slidestop",function(){g=!1;f()})}function vi(e){Lh.call(this,e);wi(this);xi(this)}vi.prototype=Object.create(Lh.prototype);
vi.prototype.constructor=vi;
function yi(e,f){$("#mapping").empty();void 0===f&&(f="Atoms");$("selectMap").text()!==f&&$("#selectMap").text(f);if("Atoms"===f||"Amino Acids"===f)zi(e,f,4);else if("Nucleic Acids"===f)zi(e,f,5);else if("Secondary Structure Type"===f)zi(e,f,2);else if("Molecules"===f)zi(e,f,4);else if("Rainbow"===f){$('<span class="gradientLabelLeft">First</span><span class="gradientLabelRight">Last</span></br><canvas id="gradient"></canvas><br/>').appendTo("#mapping");$("#gradient").css({width:"90%",height:"20px",
border:"1px solid #555"});for(var g=document.getElementById("gradient"),h=g.getContext("2d"),k=g.width,g=g.height,n=null,m=0;m<k;m++)for(var q=0;q<g;q++)n="hsl("+m+", 100%, 50%)",h.fillStyle=n,h.fillRect(m,q,1,1)}else"Hydrophobicity"===f?($('<span class="gradientLabelLeft">Hydrophilic</span><span class="gradientLabelRight">Hydrophobic</span></br><canvas id="gradient"></canvas><br/>').appendTo("#mapping"),$("#gradient").css({width:"90%",height:"20px",border:"1px solid #555"}),g=document.getElementById("gradient"),
h=g.getContext("2d"),k=g.width,g=g.height,n=h.createLinearGradient(0,0,k,0),n.addColorStop(0,e.Mb.Mc.Hydrophobicity.Hydrophobic),n.addColorStop(.5,"rgb(255,255,255)"),n.addColorStop(1,e.Mb.Mc.Hydrophobicity.Hydrophilic),h.fillStyle=n,h.fillRect(0,0,k,g)):console.warn("Unknown legend mapping name : ",f)}
function zi(e,f,g){var h=$('<table style="display: inline-block;">'),k,n=e.Mb.Mc[f],m=0,q;for(q in n){0===m%g&&(k=$("<tr></tr>"),k.appendTo(h));var r=$("<td></td>");r.appendTo(k);var t=$('<div class="legend-mapping"></div>');t.appendTo(r);$('<input type="text" value="'+q+'" readonly/>').appendTo(t);r='<div class="color-box" style="background-color:'+n[q]+';" data-mapping="'+f+'" data-mappingName="'+q+'" data-color="'+n[q]+'"></div>';r=$(r);r.click(function(){e.ng.map=$(this).attr("data-mapping");
e.ng.name=$(this).attr("data-mappingName");$.farbtastic($("#mcp")).setColor($(this).attr("data-color"));$.farbtastic($("#mcp")).ki=$(this);$("#mapColPick").show()});$(r).appendTo(t);m++}h.appendTo("#mapping")}
function wi(e){e.content=$('<div id="legend"></div>');var f;f='<button id="previousMapping" class="mapSelection">Previous</button><span id="selectMap" class="mapSelection"></span><button id="nextMapping" class="mapSelection">Next</button>';e.content.appendTo(e.parent.Qe);$('<button id="closeLegend" class="mapSelection">Close</button>').appendTo(e.content);$('<div id="mappingSelection" style="text-align: center;"></div><div id="mapping" style="text-align: center;"></div>').appendTo(e.content);$("#mappingSelection").css({color:"white",
display:"inline-flex","justify-content":"center",width:"100%"});$(f).appendTo($("#mappingSelection"));$("#selectMap").css({width:"63%"});e.toggle();e.Hj=$("#previousMapping");e.Gj=$("#nextMapping");e.Mb=xe();$('<div id="mapColPick"><div id="mcp"></div><button id="mapClPicker" class="mapSelection">Close</button></div>').appendTo(e.content);$("#mcp").farbtastic().click(function(){$("#mcp").farbtastic().on("mousemove",function(){var f=$.farbtastic($("#mcp")),g=f.color,n=e.Mb,m=e.ng.map,q=e.ng.name;if(void 0!==
n.Mc[m]&&void 0!==n.Mc[m][q]){n.Mc[m][q]=g;var r=m;"Amino Acids"===r||"Nucleic Acids"===r?r="Residues":"Secondary Structure Type"===r&&(r="SST");void 0!=n.fa[r]&&void 0!=n.fa[r][q]&&(n.fa[r][q]=n.fa[r][q].set(g),q=new Ce,q.Yh=!0,q.Wg=m,Be(n,q))}f.ki.css("background-color",g);f.ki.attr("data-color",g)});$("#mcp").farbtastic().on("mouseup",function(){$("#mcp").farbtastic().off("mousemove");$("#mcp").farbtastic().off("mouseup")})});$("#mapColPick").toggle();$("#mapColPick").hide();$("#mapClPicker").button({text:!1,
label:"Quit",icons:{primary:"ui-icon-check"}}).click(function(){$("#mapColPick").hide()});$("#mapColPick").css({"float":"right"});$("#previousMapping").css({width:"7%",right:"5px"});$("#nextMapping").css({width:"7%",left:"5px"});$("#closeLegend").button({text:!1,label:"Quit",icons:{primary:"ui-icon-close"}}).click(function(){e.hide()});$("#closeLegend").css({width:"15px",position:"absolute",right:"0px","margin-right":"10px"});e.Hj.button({text:!1,label:"Previous",icons:{primary:"ui-icon-triangle-1-w"}}).click(function(){void 0!=
this&&this.blur();var f=$("#selectMap").text(),g=null,n;for(n in e.Mb.Mc){if(null!=g&&n===f)break;g=n}$("#selectMap").text(g);yi(e,g);$("#mapColPick").hide()});e.Gj.button({text:!1,label:"Previous",icons:{primary:"ui-icon-triangle-1-e"}}).click(function(){void 0!=this&&this.blur();var f=!1,g=$("#selectMap").text(),n=null,m;for(m in e.Mb.Mc){if(f){n=m;break}m===g&&(f=!0)}if(null===n){for(var q in e.Mb.Mc)break;n=q}$("#selectMap").text(n);yi(e,n);$("#mapColPick").hide()});f=$(si("SaveButton","Save")).button({text:!1,
label:"Save",icons:{primary:"ui-icon-arrowstop-1-s"}}).click(function(){var f=e.Mb;window.localStorage.setItem("def",JSON.stringify(f.Zf));window.localStorage.setItem("moleculeColor",JSON.stringify(f.yd));window.localStorage.setItem("nucleicAcidColor",JSON.stringify(f.wd));window.localStorage.setItem("residueColor",JSON.stringify(f.xd));window.localStorage.setItem("atomColor",JSON.stringify(f.yb));window.localStorage.setItem("hydroColor",JSON.stringify(f.De));window.localStorage.setItem("rainbowColor",
JSON.stringify(f.Ee));window.localStorage.setItem("sstColor",JSON.stringify(f.Vd));window.localStorage.setItem("unsortedProperties",JSON.stringify(f.ej));this.blur()}).css({width:"10%"});var g=$(si("ResetButton","Reset")).button({text:!1,label:"Reset",icons:{primary:" ui-icon-arrowrefresh-1-e"}}).click(function(){var f=e.Mb;f.fa={Atoms:[],Residues:[],Molecules:[],SST:[]};window.localStorage.setItem("def",JSON.stringify(Id));window.localStorage.setItem("moleculeColor",JSON.stringify(Jd));window.localStorage.setItem("nucleicAcidColor",
JSON.stringify(Kd));window.localStorage.setItem("residueColor",JSON.stringify(Ld));window.localStorage.setItem("atomColor",JSON.stringify(Md));window.localStorage.setItem("hydroColor",JSON.stringify(Nd));window.localStorage.setItem("rainbowColor",JSON.stringify(Od));window.localStorage.setItem("sstColor",JSON.stringify(Pd));window.localStorage.setItem("unsortedProperties",JSON.stringify(Qd));Ae(f);var g=new Ce;g.Yh=!0;Be(f,g);$("#mapColPick").hide();yi(e);this.blur()}).css({width:"10%"});f.focus(function(){});
g.focus(function(){});f.appendTo("#legend");g.appendTo("#legend")}function xi(e){document.addEventListener("keypress",function(e,g){return function(){return e.apply(g,arguments)}}(function(e){108===e.which&&this.toggle()},e),!1);yi(e);e.ng={map:null,name:null,value:null}}function Ai(e){Lh.call(this,e);this.xl="Star selection";this.Wk="Pair selection";this.Tg=" Click to select an atom ";Bi(this);Ci(this)}Ai.prototype=Object.create(Lh.prototype);z=Ai.prototype;z.constructor=Ai;z.jg=function(e){this.parent.ba.ca.scene3D.jg(e)};
z.lg=function(){this.parent.ba.ca.scene3D.lg()};z.Vg=function(){this.parent.ba.ca.scene3D.Vg()};
function Bi(e){e.content=$('<div id="measureWidget"></div>');var f;f='<div><span id="measureTitle" class="mapSelection"> Measuring tool </span><button id="closeMeasurementButton" class="mapSelection">Close</button></div>';e.content.appendTo(e.parent.Qe);f=$(f);f.appendTo(e.content);f='<button id="clearMeasureButton"> Clear </button><div id="MeasurementTypeSelection"><input type="radio" id="starSelection" name="radioSelectionMeasure" checked="checked">'+('<label for="starSelection" title="starSelection">'+
e.xl+"</label>");f=f+'<input type="radio" id="pairSelection" name="radioSelectionMeasure">'+('<label for="pairSelection" title="pairSelection">'+e.Wk+"</label>");f+="</div>";var g=$("<div></div>").css({display:"flex","justify-content":"center"});$(f).appendTo(g);g.appendTo(e.content);$("#clearMeasureButton").button({text:!1,label:"Clear",icons:{primary:" ui-icon-arrowrefresh-1-e"}}).css({height:"20px","font-size":"0.7em"}).click(function(){e.Vg()});e.Sh=$('<div id="starMeasureWidget"><button id="objectMeasurementSelection">'+
e.Tg+"</button></div>");e.$f=$('<div id="pairMeasureWidget"></div>');e.Sh.appendTo(e.content);e.$f.appendTo(e.content);e.$f.hide();$("#MeasurementTypeSelection").change(function(){var f=$("input[type='radio'][name='radioSelectionMeasure']:checked").attr("id");"starSelection"===f?(f=[],f.visible=!0,e.update(f.visible),e.lg(),e.Sh.show(),e.$f.hide()):"pairSelection"===f&&(e.Sh.hide(),e.$f.show(),e.jg())});$("#objectMeasurementSelection").button().css({width:"70%",height:"20px","font-size":"0.7em"}).click(function(){var f=
[];f.visible=!0;e.update(f.visible)});$("#MeasurementTypeSelection").buttonset().css({"font-size":"0.7em","margin-right":"0px",height:"100%",border:"0px"});$("#measureTitle").css({color:"white"});$("#closeMeasurementButton").button({text:!1,label:"Quit",icons:{primary:"ui-icon-close"}}).click(function(){e.hide()});$("#closeMeasurementButton").css({width:"15px",position:"absolute",right:"0px","margin-right":"10px"})}
function Ci(e){document.addEventListener("keypress",function(e,g){return function(){return e.apply(g,arguments)}}(function(e){109===e.which&&this.toggle()},e),!1)}z.hide=function(){Lh.prototype.hide.call(this);this.lg()};z.update=function(e){var f=this;e.visible?($("#objectMeasurementSelection").text(this.Tg),f.parent.ba.ca.scene3D.Yd.Ki(function(e){null!=e&&(f.jg(e),$("#objectMeasurementSelection").text(e.Ic()));f.parent.ba.ca.scene3D.Yd.gj()})):!1===e.visible&&$("#objectMeasurementSelection").text(this.Tg)};
function Di(e){Lh.call(this,e);this.gb=this.Qd=this.vc=null;this.Ch=xe();this.pj=" (visible)";this.oi="All representations";this.Uk="Click to select an object";Ei(this);Fi(this);var f=this;this.parent.ba.addListener("requestWidgetUpdate",function(){var e=Gi(f),h=Hi(),k=$("#objectSelection").html();f.gb=biovizAPI.Hc(k,h)[0];Ii(f,h,e);Ji(f)})}Di.prototype=Object.create(Lh.prototype);Di.prototype.constructor=Di;
function Hi(){var e=$("input[type='radio'][name='radioSelectionLevel']:checked").attr("id"),e=e.replace("radioSelection","");return parseInt(e)}function Ki(e){0<e&&5>e&&(e="#radioSelection"+e,$(e)[0].checked=!0,$(e).button("refresh"))}Di.prototype.Ug=function(e){e instanceof Ua&&($("#objectSelection").text(e.Ic()),Ki(2),this.gb=void 0,Li(this))};
function Li(e){$("#reprcolorpicker").hide();var f=e.gb,g=Hi(),h=$("#objectSelection").html(),k=biovizAPI.Hc(h,g)[0];if(null!=f)if(f==k)4>g&&g++;else{for(var n=!1,m=g;f.parent!=k.parent&&0<g;)if(g--,f=f.parent,k=k.parent,null==f||null==f.parent){n=!0;break}n&&(g=m)}Ki(g);k=biovizAPI.Hc(h,g)[0];e.gb=k;Mi(e);Ii(e,g)}
function Ii(e,f,g){var h;1===f||2===f?h="molecule":3===f?h="residue":4===f&&(h="atom");if(void 0!=e.gb){var k=$("#objectSelection").html();e.gb=biovizAPI.Hc(k,f)[0];f=[];h=h.toLowerCase();h="structure"===h||"molecule"===h?bh.map[Kf]:"residue"===h?bh.map[Lf]:"atom"===h?bh.map[Of]:void 0;for(k=0;k<h.length;k++)f.push(h[k].name);e.vc.html("<option selected>"+e.oi+"</option>");for(var n in f)biovizAPI.mf([e.gb],f[n])?(k=f[n]+e.pj,g===f[n]?Nh(e.vc,k,!0):Nh(e.vc,k,!1)):g===f[n]?Nh(e.vc,f[n],!0):Nh(e.vc,
f[n],!1)}}function Gi(e){return null!=e.vc.val()&&e.vc.val()!==e.oi?e.vc.val().replace(e.pj,""):null}
function Ji(e){var f=Hi(),g=$("#objectSelection").html(),f=biovizAPI.Hc(g,f)[0];e=Gi(e);null==f||null==e?$("#showhideRep").button({icons:{primary:" ui-icon-plus"},label:"Hide the representation"}):biovizAPI.mf([f],e)?$("#showhideRep").button({icons:{primary:" ui-icon-minus"},label:"Hide the representation"}):$("#showhideRep").button({icons:{primary:" ui-icon-plus"},label:"Show the representation"})}
function Mi(e){var f=Hi();1===f?$.farbtastic($("#colPicker")).setColor("#D3D3D3"):2===f?$.farbtastic($("#colPicker")).setColor("#"+De(e.Ch,e.gb.ta.id,"M").getHexString()):3===f?$.farbtastic($("#colPicker")).setColor("#"+De(e.Ch,e.gb.Eb.Wc(),"R").getHexString()):4===f&&(f=e.gb.se,f=f.symbol.charAt(0).toUpperCase()+f.symbol.slice(1).toLowerCase(),$.farbtastic($("#colPicker")).setColor("#"+De(e.Ch,f,"A").getHexString()))}
function Ei(e){e.content=$('<div id="reprManagement"></div>');var f;f='<span id="managementTitle" class="mapSelection">Representation management</span><button id="closeManagementButton" class="mapSelection">Close</button>';var g;g=$("<div></div>");e.content.appendTo(e.parent.Qe);f=$(f);f.appendTo(g);f=$("<div></div>");var h='<button id="objectSelection"> '+e.Uk+" </button> ",k;k='<div id="selectionLevel"><input type="radio" id="radioSelection1" name="radioSelectionLevel"><label for="radioSelection1" title="Structure">S</label><input type="radio" id="radioSelection2" name="radioSelectionLevel" checked="checked"><label for="radioSelection2" title="Molecule">M</label>';
k+='<input type="radio" id="radioSelection3" name="radioSelectionLevel">';k+='<label for="radioSelection3" title="Residue">R</label>';k+='<input type="radio" id="radioSelection4" name="radioSelectionLevel">';k+='<label for="radioSelection4" title="Atom">A</label>';k+="</div>";var n=$('<div id="selection"></div>');$(h).appendTo($(n));$(k).appendTo($(n));$(n).appendTo(f);h=$('<div id="selectDiv"></div>');$('<button id="showhideRep" class="mapSelection">Close</button>').appendTo(h);e.vc=$('<select name="repType" id="repType" onfocus="this.selectedIndex = -1;"><option selected disabled>Representation</option></select>');
e.Qd=$('<select name="col" id="col" onfocus="this.selectedIndex = 0;"><option selected disabled value="Coloration">Coloration</option></select>');e.vc.appendTo(h);e.Qd.appendTo(h);h.appendTo(f);f.appendTo(g);g.appendTo(e.content);$('<div id="reprcolorpicker"><div id="colPicker"></div><button id="reprClosePicker" class="mapSelection">Close</button></div>').appendTo(e.content);$("#colPicker").farbtastic().mousemove(function(){biovizAPI.hf($.farbtastic($("#colPicker")).color,[m.gb],Gi(m))});$("#reprcolorpicker").toggle();
$("#reprcolorpicker").hide();$("#reprClosePicker").button({text:!1,label:"Quit",icons:{primary:"ui-icon-check"}}).click(function(){$("#reprcolorpicker").hide()});$("#reprcolorpicker").css({"align-self":"flex-end","float":"right"});$("#showhideRep").button({text:!1,label:"Show the representation",icons:{primary:"ui-icon-plus"}});$("#showhideRep").css({width:"5%",top:"3px"});e.toggle();var m=e;$("#managementTitle").css({color:"white"});$("#closeManagementButton").button({text:!1,label:"Quit",icons:{primary:"ui-icon-close"}}).click(function(){m.hide()});
$("#closeManagementButton").css({width:"15px",position:"absolute",right:"0px","margin-right":"10px"});$("#objectSelection").button().css({width:"63%",height:"20px"});$("#selectionLevel").buttonset().css({"margin-right":"0px",height:"100%",border:"0px"});$("#selection").css({"font-size":"0.7em",display:"flex","align-items":"stretch",width:"100%","margin-bottom":"2px"});$("#selectDiv").css({height:"20px",display:"flex","align-items":"stretch",width:"100%"});$("#repType").css({width:"60%"});e.vc.change(function(){var e=
Gi(m);null===e||biovizAPI.mf([m.gb],e)||biovizAPI.ig([m.gb],e);Ji(m);var f=Hi();Ii(m,f,e);$('#col option[value="Coloration"]').prop("selected",!0);biovizAPI.ab({type:"requestWidgetUpdate"})});e.Qd.change(function(){"Uniform color"===m.Qd.val()?(void 0!=m.gb&&biovizAPI.hf($.farbtastic($("#colPicker")).color,[m.gb],Gi(m)),$("#reprcolorpicker").show()):($("#reprcolorpicker").hide(),biovizAPI.hf(m.Qd.val(),[m.gb],Gi(m)))});$("#selectionLevel").change(function(){$("#reprcolorpicker").hide();var e=Gi(m),
f=Hi(),g=$("#objectSelection").html();m.gb=biovizAPI.Hc(g,f)[0];Mi(m);Ii(m,f,e);null!=m.gb&&Ji(m);$('#col option[value="Coloration"]').prop("selected",!0)});$("#showhideRep").click(function(){var e=Gi(m);if(null!=e){biovizAPI.mf([m.gb],e)?biovizAPI.Pi([m.gb],e):biovizAPI.ig([m.gb],e);Ji(m);var f=Hi();Ii(m,f,e);biovizAPI.ab({type:"requestWidgetUpdate"})}});g=Q.jk();for(var q in g)Nh(e.Qd,g[q],!1);Nh(e.Qd,"Uniform color",!1)}
function Fi(e){document.addEventListener("keypress",function(e,g){return function(){return e.apply(g,arguments)}}(function(e){114===e.which&&this.toggle()},e),!1)}Di.prototype.update=function(e){if(e.visible){var f=this;f.parent.ba.ca.scene3D.Yd.Ki(function(e){null!=e&&($("#objectSelection").text(e.Ic()),Li(f),$('#col option[value="Coloration"]').prop("selected",!0))})}};
function Ni(e){this.ba=e;this.div=this.ba.canvas;this.time=0;this.u=this.yf=this.ed=null;new EventTarget(Ni.prototype);this._listeners=[];this.Id()}
Ni.prototype.Id=function(){var e=this,f;f='<div id="scriptPlayerDiv"><table style="width:100%"><tr><td><button id="play">Play</button></td>';f+='<td><button id="stop">Stop</button></td>';f+='<td id="progressbar" style="width:90%"></td>';f+="</tr>";f+="</table>";f+="</div>";$(f).css({position:"relative",top:"-50px",width:"95%","margin-left":"auto","margin-right":"auto"}).appendTo(this.div);this.$c=$("#scriptPlayerDiv");this.ed=$("#progressbar");this.yf=$("#play");this.u=$("#stop");setTimeout(function(){e.$c.fadeTo(1E3,
0)},1E3);this.$c.on("mouseenter",function(){e.$c.stop().fadeTo(500,1)});this.$c.on("mouseleave",function(){e.$c.stop().fadeTo(500,0)});this.ed.progressbar({value:!1});this.ed.bind("click",function(f){f=(f.clientX-f.currentTarget.offsetLeft-f.currentTarget.offsetParent.offsetParent.offsetLeft)/f.currentTarget.clientWidth;e.ed.progressbar("option","value",100*f);e.ab({type:"update",value:f})});this.ed.bind("mousemove",function(f){1===f.buttons&&(f=(f.clientX-f.currentTarget.offsetLeft-f.currentTarget.offsetParent.offsetParent.offsetLeft)/
f.currentTarget.clientWidth,e.ed.progressbar("option","value",100*f),e.ab({type:"update",value:f}))});this.yf.button({text:!1,label:"play",icons:{primary:"ui-icon-play"}}).click(function(){var f;"play"===$(this).text()?(f={label:"pause",icons:{primary:"ui-icon-pause"}},e.ab("play")):(f={label:"play",icons:{primary:"ui-icon-play"}},e.ab("pause"));$(this).button("option",f)});this.u.button({text:!1,icons:{primary:"ui-icon-stop"}}).click(function(){e.yf.button("option",{label:"play",icons:{primary:"ui-icon-play"}});
e.ab("stop")});this.ed.find(".ui-progressbar-value")};Ni.prototype.toggle=function(){this.$c.toggle()};Ni.prototype.show=function(){this.$c.stop().fadeTo(0,1)};Ni.prototype.hide=function(){this.$c.stop().fadeTo(0,0)};
function Oi(e){this.ba=e;this.canvas=this.ba.canvas;this.Ue=[];this.Qe=$('<div id="widgets"></div>').css({position:"absolute",top:"10px",right:"0px","margin-left":"5px","margin-right":"5px","text-align":"center","flex-direction":"column","align-items":"stretch",opacity:"0.9",width:"300px"});this.Qe.appendTo(this.canvas);for(var f in Pi)this.Ue[f]=new Pi[f](this);this.yi=new ti(this);Mh(this);void 0==window.localStorage.getItem("infoDiv")&&$('<p id="pInformation"> Press I to see information </p>').css({position:"absolute",
top:"0",color:"white",width:"200px",right:"0",left:"0","margin-left":"auto","margin-right":"auto"}).appendTo($("#content"));Qi(this)}Oi.prototype.update=function(e){for(var f in Pi)this.Ue[f].update(e)};function Mh(e){for(var f in Pi)e.Ue[f].hide()}function ne(e,f){void 0!=e.Ue[f]&&e.Ue[f].show(!0)}
function Qi(e){function f(e,f){return function(){return e.apply(f,arguments)}}var g;g='<div id="biovizjsinfo" title="BiovizJS informations"><div id="keyboard" autofocus><div id="mouse"><label> Mouse </label>';g+='<div class="separator"></div>';g+="<table>";g+='<tr><td class="controlLine">Double click</td><td> Select an object</td></tr>';g+='<tr><td class="controlLine">Left-click</td><td> Rotate</td></tr>';g+='<tr><td class="controlLine">Right-click</td><td> Translate / Open context menu</td></tr>';
g+='<tr><td class="controlLine">Scroll</td><td> Move object backward or forward</td></tr>';g+='<tr><td class="controlLine">Ctrl + Scroll</td><td> Control eye separation for stereoscopy and anaglyph</td></tr>';g+="</table>";g+="</div>";g+="<br/>";g+="<label> Keyboard shortcut </label>";g+='<div class="separator"></div>';g+="<table>";g+="<tr><td>R</td><td>Show representation manager</td></tr>";g+="<tr><td>L</td><td>Show color mapping legend</td></tr>";g+="<tr><td>M</td><td>Show measuring tool</td></tr>";
g+="<tr><td>F</td><td>Enable / Disable BiovizJS full-screen</td></tr>";g+="</table>";g+="</div>";g+="</div>";e.info=$(g);e.info.appendTo(document.body);$("#keyboard").css({display:"flex","flex-direction":"column"});$(".keyboardItem").css({margin:"0"});$("#mouse").css({display:"flex","flex-direction":"column"});$(".mouseItem").css({margin:"0"});$(".separator").css({"border-style":"solid","border-width":"1px",width:"60%"});$(".controlLine").css({overflow:"hidden","white-space":"nowrap"});e.dialog=$("#biovizjsinfo").dialog({autoOpen:!1,
modal:!0,position:{my:"center",at:"center",of:$("#content")}});e.info.css({"font-size":"0.8em"});g=f(function(e){73===e.which&&(window.localStorage.setItem("infoDiv",!0),$("#pInformation").hide(),this.dialog.dialog("close"))},e);document.addEventListener("keydown",f(function(e){73===e.which&&(window.localStorage.setItem("infoDiv",!0),$("#pInformation").hide(),this.dialog.dialog("open"))},e),!1);document.addEventListener("keyup",g,!1)}Oi.prototype.show=function(){this.Qe.show()};
Oi.prototype.hide=function(){this.Qe.hide()};var Pi={Legend:vi,RepresentationManager:Di,MeasureWidget:Ai};function Ri(){this.canvas=null;this.Zh="http://ftp.rcsb.org/view/${id}.cif";this.load=this.Wd=!0;this.nj=!1;new EventTarget(Ri.prototype);this.Kh=this.ca=null;this.canvas=$('<div id="content"></div>').css({tabindex:"0","z-index":"0",width:"100%",height:"100%",overflow:"hidden"})}
Ri.prototype.Qh=function(e,f){"urlTemplate"===e?this.Zh=f:"loadPDBX"===e?this.Wd=f:console.warn("Can't change unexisting option : "+e)};
function Ye(e,f,g){e=e.Pf();var h=$("#loadBar"),k=$("#loadLabel"),n;g?n='<img src="img/loader.gif" id="imgLoader" alt="loader">':(h.remove(),h=$("#loadBar"),setTimeout(function(){$("#loadBar").remove()},6E3));void 0==f?h.remove():(0==h.length&&(g=$(n).css({display:"inline-block"}),k=$('<div id="loadLabel"> </div>').css({display:"inline-block",color:"white","font-size":"100%"}),h=$('<div id="loadBar" class="noselect"> </div>').css({position:"absolute",top:"2%",right:"0px"}),k.appendTo(h),g.appendTo(h),
h.appendTo(e)),k.text(f))}Ri.prototype.Qg=function(e){this.ab({type:"atomMouseOver",data:e})};function ve(e,f){var g=e.Kh;g.u=g.v.parse(f).slice(0);g.u[0]instanceof Ih||g.u.splice(0,0,new Ih);g.u.add=g.u.push;g.u.remove=g.u.shift;g.ab({type:"commandParsed",data:g.u})}Ri.prototype.Pf=function(){return this.canvas};function fd(e){e.contextMenu.div.contextmenu("close")}
Ri.prototype.Id=function(){if(!Detector.webgl)return Detector.addGetWebGLMessage({parent:this.canvas[0]}),!1;this.ca=new Ve(this);this.Kh=new rh(this.ca);this.contextMenu=new fe(this,$(document.body));this.Pj=$(".hasContextMenu:first");this.Yg=this.contextMenu.div;this.Di=this.Mf=null;this.Fb=this.ca.scene3D.Fb;this.uf=new Oi(this);$('<div id="bionextlogo" class="noselect"><img src="img/logo.png" alt="Bionext Logo" width="100%" /></div>').css({position:"absolute",top:"10px",width:"30%","margin-left":"10px",
"margin-right":"auto"}).appendTo(this.canvas);setTimeout(function(){$("#bionextlogo").fadeTo(2E3,.6)},4E3);Si(this);return!0};
function Si(e){e.bd=new Ni(e);e.Fb.addListener("timeChanged",function(f){e.bd.ed.progressbar("option","value",100*f.data.progress)});e.Fb.addListener("endScript",function(){e.bd.yf.button("option",{label:"play",icons:{primary:"ui-icon-play"}})});e.bd.addListener("play",function(){e.Fb.play()});e.bd.addListener("pause",function(){e.Fb.pause()});e.bd.addListener("stop",function(){e.Fb.stop()});e.bd.addListener("update",function(f){uh(e.Fb,f)});e.Kh.addListener("commandParsed",function(f){var g=e.Fb;
f=f.data;g.aa=0;g.fa=f.slice(0);vh(g);f=g.fa.length;for(var h=0;h<f;h++){var k=g.fa[h];k instanceof th&&(g.aa+=k.duration)}})}function Ff(e){e?$("#scriptPlayerDiv").css({top:"-50px"}):$("#scriptPlayerDiv").css({top:"50px"})}
var Ti=V.NONE.name,Ui=V.We.name,Vi=V.LINES.name,Wi=V.de.name,Xi=V.cc.name,Yi=V.Ed.name,Zi=V.wg.name,$i=V.xf.name,aj=V.qg.name,bj=V.vf.name,cj=V.Ve.name,dj=V.sg.name,ej=V.wf.name,fj=V.rg.name,gj={NONE:Ti,We:Ui,LINES:Vi,de:Wi,cc:Xi,Ed:Yi,wg:Zi,xf:$i,qg:aj,vf:bj,Ve:cj,sg:dj,wf:ej,rg:fj},hj=M.u.zf,ij=M.u.Wb,jj=M.u.Hb,kj=M.u.Wa,lj=M.u.yc,mj={zf:hj,Wb:ij,Hb:jj,Wa:kj,yc:lj},nj=Q.Wb.name,oj=Q.Hb.name,pj=Q.Wa.name,qj=Q.tg.name,rj=Q.ug.name,sj=Q.zg.name,tj=Q.xg.name,uj=Q.vg.name,vj={Wb:nj,Hb:oj,Wa:pj,tg:qj,
ug:rj,zg:sj,xg:tj,vg:uj};function Z(){}z=Z.prototype;z.Rj=function(){this.u=new Ri};z.Ck=function(){this.v=this.u.Id();this.ca=this.u.ca};z.Fk=function(){return this.v};z.jl=function(e){this.u.contextMenu.moveTo(e);this.u.Mf=e;this.u.Di=e.find("#biovizFrame")};z.Pf=function(){return this.u.Pf()};z.Aj=function(e){this.aa=e};z.ab=function(e){this.u.ab(e)};z.jd=function(e){a:{for(var f=this.ca.scene3D,g=0;g<f.ja.length;g++)if(f.ja[g].Vc().toUpperCase()===e.toUpperCase()){e=f.ja[g];break a}e=void 0}return e};
z.Ye=function(e,f){var g=this.jd(e);if(void 0!==g)if(f.includes("Proteinic"))for(var h=["Protein","Peptide","Small Peptide"],k=0,n=h.length;k<n;k++){var m=hh(g,f.replace("Proteinic",h[k]));if(null!=m)return m}else return hh(g,f)};z.Bf=function(e,f,g){e=this.Ye(e,f);if(void 0!==e)return e.pc(g,!0)};z.fi=function(e,f,g,h){e=this.Bf(e,f,g);if(void 0!==e)return e.pd(h,!0)};
z.hd=function(e){var f,g;for(g in V){var h=V[g];if(h.name===e){f=h;break}}if(!f)throw"Can't find RepresentationType corresponding to representationTypeID : "+e;return f};z.Fg=function(e){if(1<e.length)throw Error("Selection must contain a single object");e=e[0];if(e instanceof Kf)return e;throw Error("Selection must contain a only a molecule");};
z.Bg=function(e,f){var g=this,h=Ze(this.ca,e);eh(this.ca.scene3D,h);this.ca.scene3D.ca.Ia=h;return new Promise(function(e){cf(g.ca);oe(g.ca,h,!0);cf(g.ca);Ye(g.u);g.aa?$e(g.ca,h).then(function(){g.u.ab({type:"structureReady",data:f});e()}):(g.u.ab({type:"structureReady",data:f}),e())})};
z.Hc=function(e,f){var g=null,h=e.split(":"),k,n,m;5<h.length&&(m=h[5]+":"+h[6],null==f&&(f=4));3<h.length&&(n=h[3]+":"+h[4],null==f&&(f=3));1<h.length&&(k=h[1]+":"+h[2],null==f&&(f=2));h=h[0];null==f&&(f=1);switch(f){case 1:g=this.jd(h);break;case 2:g=this.Ye(h,k);break;case 3:g=this.Bf(h,k,n);break;case 4:g=this.fi(h,k,n,m)}return null!=g?[g]:[]};z.wj=function(e,f){this.Fg(e).ta.yj(f)};z.Ie=function(){this.ca.scene3D.Ie()};z.bl=function(){this.ca.scene3D.eg()};z.Hh=function(){this.ca.scene3D.Hh()};
z.cl=function(){this.ca.scene3D.reset()};z.ub=function(e,f,g,h,k){var n=this.Fg(e);null!=g?(g=this.hd(g),g=[jg(n,g)]):g=n.Kb();e=null;if(null!=h){e=[];for(var n=n.ta,m=n.ga,q=null,q=null,r=h[0]-1;r<h[1];r++)if(k?(q=pd(n.fa,r),q=m[q]):(q=r,q=n.pb(q)),null!=q)for(var q=q.xa(),t=0;t<=q.length;t++)e.push(q[t])}for(t=0;t<g.length;t++)g[t].ub(f,e)};z.Yj=function(e){ve(this.u,e)};z.zl=function(){this.u.Fb.play()};z.Bl=function(){this.u.Fb.stop()};z.Yk=function(){this.u.Fb.pause()};
z.xk=function(){this.u.bd.$c.css("visibility","hidden")};z.zk=function(){this.u.uf.hide()};z.addListener=function(e,f){this.u.addListener(e,f)};z.Wi=function(){return this.u.Wi()};z.Qh=function(e,f){this.u.Qh(e,f)};z.mf=function(e,f){if(1===e.length&&e[0]instanceof $g)var g=e[0],h=this.hd(f);else throw Error("Selection must contain a single object");return g.Xf(h)};
z.Jj=function(e,f,g){null==g&&(g=0);if(1===e.length)0<g?re(this.ca.scene3D,e[0],g,f):oe(this.ca,e[0],f);else throw Error("Selection must contain a single object");};z.Cj=function(e){if(1===e.length)this.ca.scene3D.ca.Ia=e[0];else throw Error("Selection must contain a single object");};
z.qk=function(e){var f;if(1!==e.length)throw Error("Selection must contain a single object");if(e[0]instanceof Kf){f=e[0].ta;e=e[0].cb();f=f.ga;for(var g=0;g<f.length;g++)if(void 0==e.Pc.get(f[g]))return!1;return!0}return e[0]instanceof Lf?(f=e[0].Eb,e=e[0].kb().cb(),void 0!=e.Pc.get(f)):!1};z.rk=function(){return 0!==this.ca.scene3D.ja.length};z.Uf=function(){for(var e=[],f=this.ca,g=f.scene3D.ja.length,h=0;h<g;h++){var k=f.scene3D.ja[h];k instanceof M&&e.push(k.Vc())}return e};
z.jh=function(e){var f=[];e=this.jd(e).va.keys();for(var g=0,h=e.length;g<h;g++){var k=e[g];f.push(k.type+":"+k.id)}return f};z.kk=function(e){var f=[];e=this.jd(e).va.keys();for(var g=0,h=e.length;g<h;g++){var k=e[g];"Protein"!==k.type&&"Peptide"!==k.type&&"Small Peptide"!==k.type||f.push(k.type+":"+k.id)}return f};z.lk=function(e,f){for(var g=this.Ye(e,f).ta.ga,h=[],k=0;k<g.length;k++)h.push(g[k].toString());return h};
z.Xc=function(e){var f=this;return this.ca.Xc(e).then(function(g){return new Promise(function(h,k){g instanceof Error?k(g):f.Bg(g,e).then(function(e){h(e)})})})};z.Yf=function(e){var f=this;return this.ca.Yf(e).then(function(e){return new Promise(function(h,k){e instanceof Error?k(e):f.Bg(e,e._id).then(function(e){h(e)})})})};z.Ci=function(e){var f=this.jd(e);if(null==f)throw Error("Structure with id: "+e+" not found");se(this.ca,f)};z.Tj=function(){for(var e=this.Uf(),f=0,g=e.length;f<g;f++)this.Ci(e[f])};
z.gg=function(e,f,g,h,k){this.ca.scene3D.gg(e,f,g,h,k)};z.ig=function(e,f){for(var g=this.hd(f),h=0,k=e.length;h<k;h++)e[h].show(g)};z.Pi=function(e,f){for(var g=this.hd(f),h=0,k=e.length;h<k;h++)e[h].hide(g)};z.show=function(e,f){for(var g=[],h=0,k=e.length;h<k;h++){var n=e[h];n.visible=!0;f&&n.traverseAncestors(function(e){(e instanceof M||e instanceof Kf||e instanceof Lf)&&g.push(e)})}0!=g.length&&this.show(g)};
z.hide=function(e,f){for(var g=[],h=0,k=e.length;h<k;h++){var n=e[h];n.visible=!1;f&&n.traverse(function(e){(e instanceof Kf||e instanceof Lf||e instanceof Of)&&g.push(e)})}0!=g.length&&this.hide(g)};z.Jk=function(e){if(1===e.length)return e[0].visible;throw Error("Selection must contain a single object");};
z.Ob=function(e,f){var g,h;if(1!==e.length)throw Error("Selection must contain a single object");if(e[0]instanceof Kf)g=e[0].ta,h=e[0].cb();else if(e[0]instanceof Lf)g=e[0].Eb,h=e[0].kb().cb();else throw Error("Selection item is not a Molecule or a Residue");h.Ob(g,f)};
z.wk=function(e){var f;if(1!==e.length)throw Error("Selection must contain a single object");if(e[0]instanceof Kf)f=e[0].ta.ga,e=e[0].cb();else if(e[0]instanceof Lf)f=e[0].Eb,e=e[0].kb().cb();else throw Error("Selection item is not a Molecule or a Residue");ue(e,f)};
z.hf=function(e,f,g){if(1!==f.length)throw Error("Selection must contain a single object");f[0]instanceof M&&(f=af(f[0]));var h=Q.ik(e);null==h&&(h=e);e=0;for(var k=f.length;e<k;e++)if(null!=f[e])for(var n=f[e].Kb(),m=0,q=n.length;m<q;m++){var r=n[m].ad;null!=g&&r!==g||n[m].color(h)}};
z.hg=function(e,f,g){if(1!==f.length)throw Error("Selection must contain a single object");f[0]instanceof M&&(f=af(f[0]));for(var h=0,k=f.length;h<k;h++)if(null!=f[h])for(var n=f[h].Kb(),m=0,q=n.length;m<q;m++){var r=n[m].ad;null!=g&&r!==g||n[m].hg(e)}};z.Ij=function(e){var f=this.ca;e=this.jd(e);f.u=new THREE.Matrix4;f.u.copy(e.matrix);var g;g="["+f.u.elements[0];for(var h=f.u.elements.length,k=1;k<h;k++)g+=","+f.u.elements[k];console.log(e+" : "+(g+"]"))};
z.hl=function(e){var f=this.ca;e=new THREE.Color(e);f.ra.Od(e)};z.kg=function(e){this.ca.kg(e)};z.rf=function(){this.ca.rf()};window.BiovizAPI=Z.prototype.constructor;Z.prototype.RepresentationTypeID=gj;Z.prototype.RepresentationTypeID.NONE=Ti;Z.prototype.RepresentationTypeID.SPHERES=Ui;Z.prototype.RepresentationTypeID.LINES=Vi;Z.prototype.RepresentationTypeID.BALL_AND_STICKS=Wi;Z.prototype.RepresentationTypeID.STICKS=Xi;Z.prototype.RepresentationTypeID.ATOMS=Yi;
Z.prototype.RepresentationTypeID.MOLECULAR_SURFACE_WIREFRAME=Zi;Z.prototype.RepresentationTypeID.MOLECULAR_SURFACE=$i;Z.prototype.RepresentationTypeID.ACCESSIBLE_SURFACE_WIREFRAME=aj;Z.prototype.RepresentationTypeID.ACCESSIBLE_SURFACE=bj;Z.prototype.RepresentationTypeID.CARTOON=cj;Z.prototype.RepresentationTypeID.CYLINDER=dj;Z.prototype.RepresentationTypeID.ALPHA_SHAPE=ej;Z.prototype.RepresentationTypeID.ALPHA_SHAPE_WIREFRAME=fj;Z.prototype.LabelTypeID=mj;Z.prototype.LabelTypeID.STRUCTURE=hj;
Z.prototype.LabelTypeID.MOLECULE=ij;Z.prototype.LabelTypeID.RESIDUE=jj;Z.prototype.LabelTypeID.ATOM=kj;Z.prototype.LabelTypeID.VDW=lj;Z.prototype.ColorMappingID=vj;Z.prototype.ColorMappingID.Molecule=nj;Z.prototype.ColorMappingID.Residue=oj;Z.prototype.ColorMappingID.Atom=pj;Z.prototype.ColorMappingID.CarbonAtom=qj;Z.prototype.ColorMappingID.HeteroAtom=rj;Z.prototype.ColorMappingID.SST=sj;Z.prototype.ColorMappingID.Rainbow=tj;Z.prototype.ColorMappingID.Hydrophobicity=uj;z=Z.prototype;
z.Rk=function(e,f,g,h){var k=this,n=new wj(e);new wj(f);for(var m=new xj(g,0,this.ca.scene3D),q=n.ia.keys().length,r=[],t=0;t<q;t++){var x=dd(n.ia)[t],x=this.ca.Xc(x);r.push(x);x.then(function(n){n=Ze(k.ca,n,g);m.Og(n);n=new yj(m,h,g);for(var q=k.Sf(g,e),r=0,t=q.length;r<t;r++)bf(q[r]);q=k.Sf(g,f);r=0;for(t=q.length;r<t;r++)q[r].show(V.cc).color("atom");oe(k.ca,n,!0);k.ca.scene3D.ca.Ia=n;cf(k.ca)})["catch"](function(e){console.warn("Error on loadStructure : ",e)})}return Promise.all(r).then(function(){return"Query loaded"})};
z.Vj=function(){this.je()["delete"]();cf(this.ca)};
z.Qk=function(e,f,g,h,k){var n=this,m=new wj(e),q=this.je();if(null==zj(q,f)){var r=new Aj(f,q),q=new THREE.Vector3(h[4],h[5],h[6]);h=new THREE.Quaternion(h[1],h[2],h[3],h[0]);h=(new THREE.Matrix4).compose(q,h,new THREE.Vector3(1,1,1));r.applyMatrix(h);r.updateMatrixWorld(!0);h=m.ia.keys().length;for(var q=[],t=0;t<h;t++){var x=dd(m.ia)[t],x=this.ca.Xc(x);q.push(x);x.then(function(h){var q=Ze(n.ca,h,f);r.Og(q);null!=g&&new yj(r,g,f);for(var q=0,t=dd(m.ia),x=t.length,I=0;I<x;I++)if(t[I].toUpperCase()===
h.Ig.toUpperCase()){q=h.Ig;break}if(null!=k)for(h=0,t=k.length;h<t;h++)x=k[h],I=new Bj(r.qb,r,x.qTips),r.Nc[x.type]=I,r.add(I);h=n.Sf(f,e);t=0;for(x=h.length;t<x;t++)bf(h[t]);q=m.ia.get(q).ia.keys();h=0;for(t=q.length;h<t;h++)x=n.Hc(f+":Ligand:"+q[h],2),n.ig(x,Xi),n.hf("atom",x,Xi);cf(n.ca)})["catch"](function(e){console.warn("Error on loadStructure : ",e)})}return Promise.all(q).then(function(){return"Hit loaded"})}};z.Uj=function(e){e=this.gd(e);null!=e&&(e["delete"](),cf(this.ca))};
z.Sf=function(e,f){for(var g=[],h=new wj(f),k=dd(h.ia),n=k.length,m=0;m<n;m++)for(var q=h.ia.get(k[m]),r=q.ia.keys(),t=r.length,x=0;x<t;x++)for(var w=r[x],E=q.ia.get(w),F=E.length,G=0;G<F;G++){var I=E[G],C;a:{switch(I.type){case Cj:C=["Protein","Small Peptide","Peptide","DNA","RNA"];break a;case Dj:C=["Solvent"];break a;case Ej:C=["Ligand"];break a}C=void 0}for(var K=null,H=0,L=C.length;H<L;H++)K=C[H],K=I.type==Ej?this.Bf(e,K+":"+w,I.Mh+":"+I.Lh):this.Ye(e,K+":"+w),null!=K&&g.push(K)}return g};
z.Kk=function(e,f){var g=this.ke(e),h=this.hd(f);return g.Xf(h)};z.rl=function(e,f){var g=this.ke(e),h=this.hd(f);g.show(h)};z.yk=function(e,f){var g=this.ke(e),h=this.hd(f);g.hide(h)};z.pl=function(e){e=zj(this.je(),e);null!=e&&e.show()};z.vk=function(e){e=zj(this.je(),e);null!=e&&e.hide()};z.ql=function(e){e=af(e[0]);for(var f in e){var g=e[f];g.visible="Ligand"!==g.pa.type?!1:!0}};
z.Lj=function(e,f,g,h){e=af(this.jd(e));for(var k in e){var n=e[k],m=n.pa.type;if("Protein"===m||"Peptide"===m||"Small Peptide"===m){var n=n.Kb(),q;for(q in n)n[q].color([f,g,h])}}};z.Nj=function(e,f,g){f=this.ke(f).Kb();for(var h in f){var k=f[h].ad;null!=g&&k!==g||f[h].color(e)}};z.Mj=function(e,f,g,h,k){h=this.ke(h).Kb();for(var n in h){var m=h[n].ad;null!=k&&m!==k||h[n].color([e,f,g])}};z.ml=function(e,f){var g=this.gd(e).Nc[f];g&&g.show()};z.sk=function(e,f){var g=this.gd(e).Nc[f];g&&g.hide()};
z.ol=function(e,f){var g=this.gd(e).Nc[f];g&&(g.te.visible=!1,g.Ke.visible=!0)};z.uk=function(e,f){var g=this.gd(e).Nc[f];g&&(g.Ke.visible=!1)};z.nl=function(e,f){var g=this.gd(e).Nc[f];g&&(g.Ke.visible=!1,g.te.visible=!0)};z.tk=function(e,f){var g=this.gd(e).Nc[f];g&&(g.te.visible=!1)};z.ke=function(e){var f=this.ca.scene3D,g;for(g in f.ja){var h=f.ja[g];if(h instanceof yj&&h.name===e)return f.ja[g]}return null};z.je=function(){return this.ca.scene3D.qb};z.gd=function(e){return zj(this.je(),e)};
function Fj(e){this.la=e;this.ia=new ja}Fj.prototype.wb=function(){return structure+"@"+chain};function Gj(e,f,g){this.type=e;this.Mh=f;this.Lh=g}Gj.prototype.toString=function(){var e="";switch(this.type){case Cj:e+="T";break;case Dj:e+="S";break;case Ej:e+="L"}null!=this.Mh&&null!=this.Lh&&(e+="."+this.Mh+"."+this.Lh);return e};var Cj="TARGET",Dj="SOLVENT",Ej="LIGAND";
function Hj(e){switch(e){case "Protein":case "Small Peptide":case "Peptide":case "DNA":case "RNA":return Cj;case "Solvent":return Dj;case "Ligand":return Ej;default:return null}}function Ij(e){switch(e.toUpperCase()){case "T":case "TAR":case "TARGET":return Cj;case "L":case "LIG":case "LIGAND":return Ej;case "S":case "SOL":case "SOLVENT":return Dj;default:return Cj}}
function wj(e){this.ia=new ja;if(null!=e){e=e.split("+");for(var f=0;f<e.length;f++){var g=e[f].split("/"),h=g[0].toUpperCase(),k=new Fj(h);this.ia.set(h,k);for(var h=g.slice(1),n=0;n<h.length;n++){var g=h[n].split(":"),m=g[0].toUpperCase();k.ia.set(m,[]);for(var g=g[1].split(","),q=0;q<g.length;q++){var r="",t=null,x=null,w=g[q].split("."),r=w[0].toUpperCase();3===w.length&&(t=w[1].toUpperCase(),x=parseFloat(w[2]));r=new Gj(Ij(r),t,x);k.ia.get(m).push(r)}}}}}
wj.prototype.toString=function(){for(var e="",f=dd(this.ia),g=0,h=f.length;g<h;g++){0<g&&(e+="+");for(var k=f[g],e=e+(k+"/"),k=this.ia.get(k),n=k.ia.keys(),m=0,q=n.length;m<q;m++){0<m&&(e+="/");for(var r=n[m],t=k.ia.get(r),e=e+(r+":"),r=0,x=t.length;r<x;r++)e+=t[r].toString()}}return e};function Jj(e){O.call(this,e);this.qb=e.qb;this.Gl=e.kh}Jj.prototype=Object.create(O.prototype);Jj.prototype.constructor=Jj;V.$h=new Pf("BVS Matching","BVSMatching",Jj);
Jj.prototype.Qa=function(){var e=new THREE.CylinderGeometry(.1,.1,1),f=(new THREE.BufferGeometry).fromGeometry(e),g=this.oa.length/2,h=f.attributes.position.array.length/f.attributes.position.itemSize,k=g*h,e=new THREE.BufferGeometry,n=new Float32Array(3*k),m=new Float32Array(3*k),q=new Float32Array(3*k),r=new Float32Array(2*k),k=new Float32Array(k),t=new THREE.Matrix4;t.makeRotationX(.5*Math.PI);for(var x=0;x<g;x++){var w=this.oa[2*x+1],E=this.Aa.kj[x],F=this.oa[2*x].pos.clone(),G=w.pos.clone(),
w=(new THREE.Matrix4).getInverse(this.Gl.matrix);F.applyMatrix4(w);var I=(new THREE.Vector3).addVectors(F,G).multiplyScalar(.5),w=(new THREE.Vector3).subVectors(F,G),C=new THREE.Vector3(1,w.length(),1),K=new THREE.Matrix4;K.lookAt(G,F,new THREE.Vector3(0,1,0));K.multiply(t);K.setPosition(I);K.scale(C);I=f.clone();I.applyMatrix(K);F=I.attributes.position.array;G=I.attributes.normal.array;K=I.attributes.color.array;I=I.attributes.uv.array;E=Jj.Zf(w.length(),E);w=F.length/3;for(C=0;C<w;C++){for(var H=
0;3>H;H++)n[x*F.length+3*C+H]=F[3*C+H],m[x*G.length+3*C+H]=G[3*C+H],q[x*K.length+3*C+H]=E[H];for(H=0;2>H;H++)r[x*I.length+2*C+H]=I[2*C+H];k[x*h+C]=x}}e.addAttribute("position",new THREE.BufferAttribute(n,3));e.addAttribute("normal",new THREE.BufferAttribute(m,3));K=new THREE.BufferAttribute(q,3);K.dynamic=!0;e.addAttribute("color",K);e.addAttribute("uv",new THREE.BufferAttribute(r,2));e.addAttribute("atomIndex",new THREE.BufferAttribute(k,1));e.ud();f=Ie();e=new THREE.Mesh(e,f);e.Ja=this;this.parent.add(e);
this.ea=e};Jj.prototype.update=function(){};Jj.Ee=[new THREE.Color(.7,.7,.7),new THREE.Color(0,1,0)];Jj.Xd=[new THREE.Color(1,0,0),new THREE.Color(.9,.5,.1)];Jj.De=[.5,1];Jj.Vd=[.25,.75];Jj.Zf=function(e,f){var g=null,g=5<e||.5>f||.7>f&&4<e?Jj.xd(Jj.Xd,Jj.Vd,f):Jj.xd(Jj.Ee,Jj.De,f);return g.toArray()};
Jj.xd=function(e,f,g){var h=f[0],k=f[1];f=null;if(g>=h&&g<=k){var n=e.length-1;f=(k-h)/n;k=Math.ceil((g-h)/(k-h)*n)-1;n=h+k*f;g=(g-n)/(h+(k+1)*f-n);h=e[k].clone();e=e[k+1].clone();h.lerp(e,g);f=h}else f=g<h?e[0]:e[e.length-1];return f};function Kj(e){Jg.call(this,e);this.Td=e.Td;e=this.oa.length;for(var f=[],g=[],h=0;h<e;h++){var k=this.oa[h].pb();if(!(0<=f.indexOf(k))){var n=k.xa(),g=g.concat(n);f.push(k)}}this.oa=g}Kj.prototype=Object.create(Jg.prototype);Kj.prototype.constructor=Kj;
V.vj=new Pf("BVS Residues","BVSResidues",Kj);function Lj(e){O.call(this,e);this.Td=e.Td}Lj.prototype=Object.create(O.prototype);Lj.prototype.constructor=Lj;V.ai=new Pf("BVS Surface","BVSSurface",Lj);
Lj.prototype.Qa=function(){for(var e=new Vd(!0),f=[],g=this.Td.ne.values(),h=g.length,k=0;k<h;k++)f.push(g[k]);for(g=0;g<f.length;g++)h=f[g].Fd,Wd(e,h.pos.x,h.pos.y,h.pos.z,new THREE.Color("#AAAA00")),e.Qc.push(this.Aa.oa.indexOf(h));for(g=0;g<f.length;g++)if(h=f[g],k=h.qd())for(var n=0;n<k.length;n++)for(var m=kd(k[n],h),q=m.qd(),r=0;r<q.length;r++){var t=kd(q[r],m);t!==h&&t.Oi(h)&&Xd(e,h._id,m._id,t._id)}e=Yd(e);f=Ie();f.shading=THREE.FlatShading;f.vertexColors=THREE.FaceColors;f.side=THREE.DoubleSide;
e=new THREE.Mesh(e,f);e.pa=this.za;e.Ja=this;this.parent.add(e);this.ea=e};Lj.prototype.update=function(){};function Mj(e){Jg.call(this,e);this.dc=e.Td}Mj.prototype=Object.create(Jg.prototype);Mj.prototype.constructor=Mj;V.uj=new Pf("BVS Mesh","BVSMesh",Mj);Mj.prototype.Qa=function(){Jg.prototype.Qa.call(this);this.color(Q.ih("residue"))};function Aj(e,f){$g.call(this);this.Mb=xe();this._id=e;this.hc=[];this.be=null;var g=this.qb=f;g.td.push(this);g.add(this);this.Nc={}}Aj.prototype=Object.create($g.prototype);
z=Aj.prototype;z.constructor=Aj;
z["delete"]=function(){$g.prototype["delete"].call(this);var e=this;this.traverse(function(f){f===e.qb.scene3D.ca.Ia&&(e.qb.scene3D.ca.Ia=null);f===e.qb.scene3D.ca.Ya&&(e.qb.scene3D.ca.Ya=e.qb.scene3D)});for(var f=this.qb.parent.ja,g=0,h=this.hc.length;g<h;g++)f.splice(f.indexOf(this.hc[g]),1),this.hc[g]["delete"]();f.splice(f.indexOf(this.be),1);for(var k in this.Nc)this.remove(this.Nc[k]),this.Nc[k]["delete"]();this.be["delete"]();this.parent.remove(this);this.qb.td.splice(this.qb.td.indexOf(this),1)};
z.Og=function(e){this.hc.push(e);this.qb.scene3D.ja.push(e);this.add(e);var f=this;e.sb=function(){var e=null,h;for(h in this.va.keys()){var k=this.va.get(this.va.keys()[h]),n=k.sb().clone();n.applyMatrix4(k.matrix);e=null===e?n:e.merge(n)}e.applyMatrix4(f.matrix);return e};e.updateMatrixWorld(!0)};z.mi=function(e){this.be=e;this.qb.scene3D.ja.push(e);this.add(e)};z.show=function(){this.visible=!0};z.hide=function(){this.visible=!1};
function Bj(e,f,g){$g.call(this);this.qb=e;this.kh=f;this.bg=g;this.Mb=xe();this.Ke=new THREE.Object3D;this.add(this.Ke);this.Ke.visible=!1;this.te=new THREE.Object3D;this.add(this.te);this.te.visible=!1;this.oa=Array(2*this.bg.length);this.kj=Array(this.bg.length);e=this.qb.hc[0].la.Qf().xa();f=this.kh.hc[0].la.Qf().xa();g=0;for(var h=this.bg.length;g<h;g++){var k=this.bg[g],n=Fk(e,k.queryAtom),m=Fk(f,k.targetAtom),k=parseFloat(k.value);this.oa[2*g]=n;this.oa[2*g+1]=m;this.kj[g]=k;var n=n.pos.clone(),
m=m.pos.clone(),q=(new THREE.Matrix4).getInverse(this.kh.matrix);n.applyMatrix4(q);q=(new THREE.Vector3).addVectors(n,m).multiplyScalar(.5);n=(new THREE.Vector3).subVectors(n,m).length();this.Ke.add(Gk(k.toFixed(2),q));this.te.add(Gk(n.toFixed(2),q))}e=jg(this,V.$h);null!==e&&void 0!==e&&e.show();this.visible=!1}Bj.prototype=Object.create($g.prototype);Bj.prototype.constructor=Bj;bh.add(Bj,[V.$h]);Bj.prototype["delete"]=function(){$g.prototype["delete"].call(this)};
Bj.prototype.show=function(){this.visible=!0};Bj.prototype.hide=function(){this.visible=!1};function Fk(e,f){for(var g=null,h=0,k=e.length;h<k;h++){var n=e[h];n.name+"."+n.id===f.split(".",2).join(".")&&(g=n)}return g}function Gk(e,f){var g=Fe(e,15);return Ud(g,f)}function xj(e,f,g){$g.call(this);this.Mb=xe();this._id=e;this.hc=[];this.be=null;this.td=[];this.scene3D=g;this.scene3D.qb=this;this.scene3D.add(this)}xj.prototype=Object.create($g.prototype);xj.prototype.constructor=xj;
xj.prototype["delete"]=function(){$g.prototype["delete"].call(this);var e=this;this.traverse(function(f){f===e.scene3D.ca.Ia&&(console.log("hasAnchor"),e.scene3D.ca.Ia=null);f===e.scene3D.ca.Ya&&(console.log("hasTarget"),e.scene3D.ca.Ya=e.scene3D)});for(var f=this.parent.ja,g=0,h=this.hc.length;g<h;g++)f.splice(f.indexOf(this.hc[g]),1),this.hc[g]["delete"]();this.be["delete"]();f.splice(f.indexOf(this.be),1);g=0;for(h=this.td.length;g<h;g++)this.td[0]["delete"]();this.td=null;this.scene3D.qb=null;
this.parent.remove(this)};xj.prototype.Og=function(e){this.hc.push(e);this.scene3D.ja.push(e);e.scene3D=this.scene3D;this.add(e);var f=this;e.sb=function(){var e=null,h;for(h in this.va.keys()){var k=this.va.get(this.va.keys()[h]),n=k.sb().clone();n.applyMatrix4(k.matrix);e=null===e?n:e.merge(n)}e.applyMatrix4(f.matrix);return e}};xj.prototype.mi=function(e){this.be=e;this.scene3D.ja.push(e);this.add(e)};
function zj(e,f){for(var g=0,h=e.td.length;g<h;g++){var k=e.td[g];if(k._id===f)return k}return null}
function yj(e,f,g){$g.call(this);this.Mb=xe();this.ij=e;this.ij.mi(this);this.name=g;this.sf=this.ij.hc[0];this.pa=this.sf.la.Qf();e=new vb;g=this.pa.xa();for(var h=f.isolated,k=0;k<h.length;k++){for(var n=h[k].value,m=null,q=0;q<g.length&&(null==x||null==w);q++){var r=g[q],t=r.name+"."+r.id;t===n.split(".",2).join(".")&&(m=r)}null==e.findNode(m)&&e.Gf(m)}f=f.edges;for(k=0;k<f.length;k++){for(var h=f[k].v1,n=f[k].v2,x=null,w=null,q=0;q<g.length&&(null==x||null==w);q++)r=g[q],t=r.name+"."+r.id,t===
h.split(".",2).join(".")&&(x=r),t===n.split(".",2).join(".")&&(w=r);q=e.findNode(x);null==q&&(q=e.Gf(x));x=e.findNode(w);null==x&&(x=e.Gf(w));w=!1;if(r=e.fd.get(q))for(t=0,h=r.length;t<h;t++)if(kd(r[t],q)===x){w=!0;break}w||e.Lg(q,x)}this.Td=e;this.oa=this.Td.values();this.updateMatrixWorld(!0);jg(this,V.ai).show()}yj.prototype=Object.create($g.prototype);yj.prototype.constructor=yj;bh.add(yj,[V.ai,V.uj,V.vj,V.tj]);z=yj.prototype;z["delete"]=function(){$g.prototype["delete"].call(this)};z.Vc=function(){return this.name};
z.reset=function(){};z.$d=function(){};z.Uc=function(){return ld(this.sb())};z.sb=function(){for(var e=new THREE.Vector3(Infinity,Infinity,Infinity),f=new THREE.Vector3(-Infinity,-Infinity,-Infinity),g=0,h=this.oa.length;g<h;g++){var k=this.oa[g].pos;e.x=Math.min(e.x,k.x);e.y=Math.min(e.y,k.y);e.z=Math.min(e.z,k.z);f.x=Math.max(f.x,k.x);f.y=Math.max(f.y,k.y);f.z=Math.max(f.z,k.z)}e=new ab(e,f);e.applyMatrix4(this.parent.matrix);return e};z=Z.prototype;
z.Wj=function(e,f,g){var h=new ja,k=this.Hc(e)[0],n=[];e=0;for(var m=f.length;e<m;e++)n.push(this.Hc(f[e])[0]);var q=[],r=new THREE.Vector3(Infinity,Infinity,Infinity),t=new THREE.Vector3(-Infinity,-Infinity,-Infinity);e=0;for(m=n.length;e<m;e++)if(f=n[e],f!==k){var x=f.oa;f=0;for(var w=x.length;f<w;f++){var E=x[f];r.min(E.pos);t.max(E.pos);q.push(new Nb(E))}}n=new Mb(r,t);n.add(q);n.optimize();k=k.oa;e=0;for(m=k.length;e<m;e++)for(E=k[e],q=E.radius(),r=n.fh(E.pos,2*g),f=0,t=r.length;f<t;f++){var x=
r[f].getPoint(),F=x.pb(),G=F.Ea,w=G.qc().toString()+":"+G.toString();G.Zi()&&(w+=":"+F.kc+":"+F._id);F=x.distanceTo(E);G=x.radius();F/(q+G)<=g&&(F=h.get(w),null==F&&(F=[],h.set(w,F)),F.push([E,x]))}return h};z.fk=function(e){var f=new wj,g=e.split(":"),h=g[0],k=g[1];e=g[2];var n=null,m=null;3<g.length&&(n=g[3],m=g[4]);g=new Fj(h);g.ia.set(e,[]);f.ia.set(h,g);h=new Gj(Hj(k),n,m);g.ia.get(e).push(h);return f.toString()};
z.ek=function(){for(var e=[],f=this.Uf(),g=f.length,h=0;h<g;h++)for(var k=f[h],n=this.jh(k),m=0,q=n.length;m<q;m++){var r=n[m];r.$i()&&e.push(k+":"+r.toString())}return e};z.dk=function(){for(var e=[],f=this.Uf(),g=f.length,h=0;h<g;h++)for(var k=f[h],n=this.jh(k),m=0,q=n.length;m<q;m++){var r=n[m];if(r.$i())e.push(k+":"+r.toString());else if(r.Zi())for(var t=r.ga,x=0,w=t.length;x<w;x++)e.push(k+":"+r.toString()+":"+t[x].toString())}return e};
z.mk=function(e,f){for(var g=[],h=0,k=e.length;h<k;h++){var n=e[h][f].pb(),n=n.Ea.qc().toString()+":"+n.Ea.toString()+":"+n.toString();0>g.indexOf(n)&&g.push(n)}return g};z.hk=function(e){return e.la.blob};
(function(e){e.widget("bionext.bvsjobswidget",{options:{ba:null},Dh:[],Wf:null,ag:null,_create:function(){this.element.addClass("bionext.bvsjobswidget");this.ba=this.options.ba;if(null==this.ba)throw new Exception("You must set bioviz option when using this widget");this.Id()},_destroy:function(){this.element.removeClass("bionext.bvsjobswidget")},Id:function(){var f=this,g;g='<label for="target">Select a target : </label><select name="target" id="target"><option disabled>No target available</option></select><br><label for="dist">Interaction distance : </label>';
g+='<input type="text" id="dist" readonly>';g+='<div id="distSlider"></div>';g+="<br>";g+='<button id="detect">Detect</button>';g+="<br>";g+='<label for="detected">Detected Ligand : </label>';g+='<select name="detected" id="detected"><option disabled>No compound available</option></select>';g+='<input type="checkbox" id ="focus">autoFocus</input>';g+="<br>";g+='<input id="title" placeholder="Title">';g+='<select name="db" id="db"><option>crystal</option><option>small-mq</option></select>';g+="<br>";
g+='<input id="compoundStr" placeholder="Compound selection">';g+='<input id="siteStr" placeholder="Site selection">';g+='<button id="submit">Submit</button>';g=e('<div id="bvsjobswidget" class="ui-widget-header ui-corner-all">'+g+"</div>");this.element.empty();g.appendTo(this.element);e("#target").selectmenu().addClass("disabled");e("#detected").selectmenu().addClass("disabled");e("#db").selectmenu();e("#distSlider").slider({value:20,min:1,max:80,step:1,slide:function(f,g){e("#dist").val(g.value/
10+"A")}}).each(function(){for(var f=e(this).data()["ui-slider"].options,g=f.max-f.min,n=0;n<=g;n++)if(0===(n+f.min)%20){var m=e("<label>"+(n+f.min)/10+"</label>").css("left",n/g*100+"%");e("#distSlider").append(m)}});e("#dist").val(e("#distSlider").slider("value")/10+"A");e("#detect").button().attr("disabled",!0);e("#submit").button().attr("disabled",!0);e("#target").css("color","black").css("font-weight","normal");e("#detected").css("color","black").css("font-weight","normal");e("#db").css("color",
"black").css("font-weight","normal");e("#title").css("color","black").css("font-weight","normal");e("#compoundStr").css("color","black").css("font-weight","normal");e("#siteStr").css("color","black").css("font-weight","normal");e("#dist").css("color","black").css("font-weight","normal");e("#distSlider label").css("position","absolute").css("width","20px").css("margin-top","10px").css("margin-left","-10px").css("text-align","center");e("#detect").click(function(){e("#detected").empty();f.Wf=f.ba.ba("detectLigands",
e("#target").val(),f.Dh,e("#distSlider").slider("value")/10);var g=f.Wf.keys();if(0<g.length){for(var k=0,n=g.length;k<n;k++)e("#detected").append(e("<option></option>").attr("value",g[k]).text(g[k]));e("#detected").selectmenu().removeClass("disabled");e("#submit").button().removeAttr("disabled")}else e("#detected").append(e("<option disabled></option>").attr("value","No compound available").text("No compound available")),e("#detected").selectmenu().addClass("disabled");e("#detected").selectmenu("refresh",
!0);f.pi();e("#focus").is(":checked")&&setTimeout(function(){var g=f.ba.ba("getObjects3DFromSelection",e("#detected").val());f.ba.ba("centerOnSelection",g,!1);f.ba.ba("anchorOnSelection",g)},200)});e("#target").on("selectmenuselect",function(){var g=f.ba.ba("getObjects3DFromSelection",e("#target").val(),1);f.ba.ba("centerOnSelection",g)});e("#detected").on("selectmenuchange",function(){null!=f.Wf&&(f.pi(),e("#focus").is(":checked")&&setTimeout(function(){var g=f.ba.ba("getObjects3DFromSelection",
e("#detected").val());f.ba.ba("centerOnSelection",g,!1);f.ba.ba("anchorOnSelection",g)},200))});e("#focus").change(function(){if(!e("#submit").button().attr("disabled"))if(e(this).is(":checked"))g=f.ba.ba("getObjects3DFromSelection",e("#detected").val()),f.ba.ba("centerOnSelection",g,!1);else{var g=f.ba.ba("getObjects3DFromSelection",e("#target").val(),1);f.ba.ba("centerOnSelection",g)}});e("#submit").click(function(){f.gl()});this.ba.ba("addListener","requestWidgetUpdate",function(){f.Jl()})},Jl:function(){var f=
e("#target").val();e("#target").empty();this.Dh=[];if(this.ba.ba("hasObject3D")){e("#target").selectmenu().removeClass("disabled");e("#detect").button().removeAttr("disabled");for(var g=this.ba.ba("getAvailableTargets"),h=0,k=g.length;h<k;h++){var n=g[h];e("#target").append(e("<option></option>").attr("value",n).text(n))}this.Dh=this.ba.ba("getAvailableCompounds")}else e("#target").append(e("<option disabled></option>").attr("value","No target available").text("No target available")),e("#target").selectmenu().addClass("disabled"),
e("#detect").button().attr("disabled",!0);e("#target").selectmenu("refresh",!0);g=e("#selectBox option");0>e.map(g,function(e){return e.value===f}).indexOf(!0)&&this.Hl()},Hl:function(){e("#detected").empty();e("#detected").append(e("<option></option>").attr("value","No compound available").text("No compound available"));e("#detected").selectmenu("refresh",!0);e("#submit").button().attr("disabled",!0);e("#compoundStr").val("");e("#siteStr").val("")},pi:function(){this.Il();this.dl();this.ag=e("#detected").val();
for(var f=this.Wf.get(e("#detected").val()),g=this.ba.ba("getSelectionFromInteraction",f,0),f=this.ba.ba("getSelectionFromInteraction",f,1),h=0,k=g.length;h<k;h++){var n=this.ba.ba("getObjects3DFromSelection",g[h]);this.ba.ba("showRepresentation",n,e.u.yg.cc);this.ba.ba("colorBy",[255,0,0],n,e.u.yg.cc);this.ba.ba("showLabel",n,e.u.xj.Hb)}h=0;for(k=f.length;h<k;h++)n=this.ba.ba("getObjects3DFromSelection",f[h]),this.ba.ba("showRepresentation",n,e.u.yg.cc),this.ba.ba("colorBy",[0,255,0],n,e.u.yg.cc),
this.ba.ba("showLabel",n,e.u.xj.Hb)},dl:function(){var f=this.ba.ba("getObjects3DFromSelection",e("#target").val());this.ba.ba("removeResidues3D",f);this.ba.ba("hideLabel",f);null!=this.ag&&(f=this.ba.ba("getObjects3DFromSelection",this.ag,2),0===f.length?this.ag=null:(this.ba.ba("removeResidues3D",f),this.ba.ba("hideLabel",f)))},Il:function(){var f=this.ba.ba("getBVSSelectionFromBiovizSelection",e("#target").val()),g=this.ba.ba("getBVSSelectionFromBiovizSelection",e("#detected").val());e("#compoundStr").val(g);
e("#siteStr").val(f)},gl:function(){var f={title:e("#title").val(),Kf:e("#db").val(),Rl:e("#compoundStr").val(),Ul:e("#siteStr").val()},g=this.ba.ba("getObjects3DFromSelection",e("#target").val(),1),g=this.ba.ba("getFileFromStructureSelection",g[0]);console.log(g);console.log(JSON.stringify(f))}})})(jQuery);Z.prototype.createBioviz=Z.prototype.Rj;Z.prototype.initBioviz=Z.prototype.Ck;Z.prototype.isAvailable=Z.prototype.Fk;Z.prototype.setExternalContextMenuDiv=Z.prototype.jl;
Z.prototype.getCanvas=Z.prototype.Pf;Z.prototype._setDefaultRepresentations=Z.prototype.Aj;Z.prototype._notify=Z.prototype.ab;Z.prototype._getStructure=Z.prototype.jd;Z.prototype._getMolecule=Z.prototype.Ye;Z.prototype._getResidue=Z.prototype.Bf;Z.prototype._getAtom=Z.prototype.fi;Z.prototype._getRepresentationType=Z.prototype.hd;Z.prototype._checkSingleMolecule3DFromSelection=Z.prototype.Fg;Z.prototype._afterLoaded=Z.prototype.Bg;Z.prototype.getObjects3DFromSelection=Z.prototype.Hc;
Z.prototype.linkWithExternalSequence=Z.prototype.wj;Z.prototype.resetRepresentations=Z.prototype.Ie;Z.prototype.resetHighlights=Z.prototype.bl;Z.prototype.resetPositions=Z.prototype.Hh;Z.prototype.resetScene=Z.prototype.cl;Z.prototype.highlight=Z.prototype.ub;Z.prototype.executeScript=Z.prototype.Yj;Z.prototype.startScript=Z.prototype.zl;Z.prototype.stopScript=Z.prototype.Bl;Z.prototype.pauseScript=Z.prototype.Yk;Z.prototype.hideScriptPlayer=Z.prototype.xk;Z.prototype.hideWidgetManager=Z.prototype.zk;
Z.prototype.addListener=Z.prototype.addListener;Z.prototype.isDebug=Z.prototype.Wi;Z.prototype.setOption=Z.prototype.Qh;Z.prototype.isRepresentationActive=Z.prototype.mf;Z.prototype.centerOnSelection=Z.prototype.Jj;Z.prototype.anchorOnSelection=Z.prototype.Cj;Z.prototype.hasLabels=Z.prototype.qk;Z.prototype.hasObject3D=Z.prototype.rk;Z.prototype.getStructuresByPDBID=Z.prototype.Uf;Z.prototype.getMoleculesFromStructure=Z.prototype.jh;Z.prototype.getProteinicMoleculesFromStructure=Z.prototype.kk;
Z.prototype.getResiduesFromMolecule=Z.prototype.lk;Z.prototype.loadStructure=Z.prototype.Xc;Z.prototype.loadLocalStructure=Z.prototype.Yf;Z.prototype.deleteStructure=Z.prototype.Ci;Z.prototype.deleteAllStructures=Z.prototype.Tj;Z.prototype.say=Z.prototype.gg;Z.prototype.showRepresentation=Z.prototype.ig;Z.prototype.hideRepresentation=Z.prototype.Pi;Z.prototype.show=Z.prototype.show;Z.prototype.hide=Z.prototype.hide;Z.prototype.isShowed=Z.prototype.Jk;Z.prototype.showLabel=Z.prototype.Ob;
Z.prototype.hideLabel=Z.prototype.wk;Z.prototype.colorBy=Z.prototype.hf;Z.prototype.setAlpha=Z.prototype.hg;Z.prototype.capturePosition=Z.prototype.Ij;Z.prototype.setBackground=Z.prototype.hl;Z.prototype.startSpin=Z.prototype.kg;Z.prototype.stopSpin=Z.prototype.rf;Z.prototype.loadBvsQuery=Z.prototype.Rk;Z.prototype.deleteBvsQuery=Z.prototype.Vj;Z.prototype.loadBvsHit=Z.prototype.Qk;Z.prototype.deleteBvsHit=Z.prototype.Uj;Z.prototype.getObjects3DFromBVSSelection=Z.prototype.Sf;
Z.prototype.isSiteRepresentationActive=Z.prototype.Kk;Z.prototype.showSiteRepresentation=Z.prototype.rl;Z.prototype.hideSiteRepresentation=Z.prototype.yk;Z.prototype.showHit=Z.prototype.pl;Z.prototype.hideHit=Z.prototype.vk;Z.prototype.showLigandOnly=Z.prototype.ql;Z.prototype.colorMolecules=Z.prototype.Lj;Z.prototype.colorSiteBy=Z.prototype.Nj;Z.prototype.colorSite=Z.prototype.Mj;Z.prototype.showBvsHitMatching=Z.prototype.ml;Z.prototype.hideBvsHitMatching=Z.prototype.sk;
Z.prototype.showBvsHitMatchingLabels=Z.prototype.ol;Z.prototype.hideBvsHitMatchingLabels=Z.prototype.uk;Z.prototype.showBvsHitMatchingDistanceLabels=Z.prototype.nl;Z.prototype.hideBvsHitMatchingDistanceLabels=Z.prototype.tk;Z.prototype._getSite=Z.prototype.ke;Z.prototype._getQuery=Z.prototype.je;Z.prototype._getHit=Z.prototype.gd;Z.prototype.detectLigands=Z.prototype.Wj;Z.prototype.getBVSSelectionFromBiovizSelection=Z.prototype.fk;Z.prototype.getAvailableTargets=Z.prototype.ek;
Z.prototype.getAvailableCompounds=Z.prototype.dk;Z.prototype.getSelectionFromInteraction=Z.prototype.mk;Z.prototype.getFileFromStructureSelection=Z.prototype.hk;
}(biovizNamespace));