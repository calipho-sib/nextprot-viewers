/*! sequence-viewer 2015-04-21 */
function Sequence(a){function b(b,c){if(f=b,"undefined"==typeof c)var c={showLineNumbers:!0,wrapAminoAcids:!0,charsPerLine:30};h="undefined"==typeof c.charsPerLine?30:c.charsPerLine;var d='<div id="sequenceHeader" style="border-bottom: 1px solid #E7EAEC;padding-bottom:5px;margin-bottom: 15px;"><div style="display:inline-block;"><span class="badge" style="background:#C50063;color:white;padding:8px 5px;border-radius:70%;margin-right:10px;vertical-align:middle;">{{sequenceLength}}</span></div><h4 style="display:inline-block;vertical-align:middle;">Protein Sequence</h4></div><div style="margin-top: 5px;"><div id="scroller" style="max-height:150px;overflow:auto;white-space: nowrap;padding-right:20px;margin-right:10px;s"><div id="charNumbers" style="font-family: monospace;font-size: 10px;display:inline-block;text-align:right; padding-right:5px; border-right:1px solid LightGray;"></div><div id="fastaSeq" display-option="'+h+'" style="font-family: monospace;font-size: 10px;display:inline-block;padding:5px;">{{{sequence}}}</div></div><div id="coverageLegend" style="margin-top: 10px;margin-left:15px;"></div></div>',e=Handlebars.compile(d),k=e({sequence:a,sequenceLength:a.length});$(b).html(k),c.wrapAminoAcids!==!1?j(b+" #fastaSeq"):$(b+" #scroller").css("overflow-x","auto"),c.showLineNumbers!==!1&&i(b+" #fastaSeq",b+" #charNumbers"),g=$(b+" #fastaSeq").html()}function c(a,b,c){var d=[a,b],e=g;d[0]=d[0]+~~(d[0]/10)+4*~~(d[0]/h),d[1]=d[1]+~~(d[1]/10)+4*~~(d[1]/h);e=e.substring(0,d[0])+'<span style="background:'+c+';color:white;">'+e.substring(d[0],d[1])+"</span>"+e.substring(d[1],e.length),$(f+" #fastaSeq").html(e)}function d(a){for(var b=0;b<a.length;b++)a[b].underscore===!0?($(f+" #coverageLegend").append('<div style="display:inline-block;background:'+a[b].color+';width:20px;height:20px;vertical-align:middle;margin:0px 5px 0px 10px;border-radius:50%; border: 1px solid grey;text-align:center; line-height:0.8;">_</div><p style="display:inline-block;font-weight:bold;font-size:11px;font-style:italic;margin:0;padding-top:3px;vertical-align:top;">'+a[b].name+"</p></div>"),console.log("duh !")):($(f+" #coverageLegend").append('<div style="display:inline-block;background:'+a[b].color+';width:20px;height:20px;vertical-align:middle;margin:0px 5px 0px 10px;border-radius:50%;"></div><p style="display:inline-block;font-weight:bold;font-size:11px;font-style:italic;margin:0;padding-top:3px;vertical-align:top;">'+a[b].name+"</p>"),console.log("dah !"))}function e(a,b,c,d){a.sort(function(a,b){return a.start-b.start});var e=function(a){var b=a+~~(a/10)+4*~~(a/h);return b},i=(new Date).getTime();if(!b)var b=0;if(!c)var c=0;if(!d)var d="#FFE5A3";for(var j="",k="",l=0;l<a.length;l++)a[l].underscore?(k='<span style="text-decoration:underline;color:'+a[l].color+';">',j+=k):(k='<span style="color:'+a[l].color+';">',j+=k),c?b>=a[l].start&&b<a[l].end&&c>=a[l].start&&c<a[l].end?(j+=g.substring(e(a[l].start),e(b))+'<span id="peptideHighlighted" style="background:'+d+';">'+g.substring(e(b),e(c+1)),j+="</span>"+g.substring(e(c+1),e(a[l].end))+"</span>"):j+=b>=a[l].start&&b<a[l].end?g.substring(e(a[l].start),e(b))+'</span><span id="peptideHighlighted" style="background:'+d+';">'+k+g.substring(e(b),e(a[l].end))+"</span>":c>=a[l].start&&c<a[l].end?g.substring(e(a[l].start),e(c+1))+"</span></span>"+k+g.substring(e(c+1),e(a[l].end))+"</span>":g.substring(e(a[l].start),e(a[l].end))+"</span>":j+=g.substring(e(a[l].start),e(a[l].end))+"</span>";$(f+" #fastaSeq").html(j);var m=(new Date).getTime();console.log("Time to execute all: ",m-i)}var f,a=a,g="",h=0,i=function(a,b){for(var c=$(a).html().split("<br>"),d=parseInt($(a).attr("display-option")),e=[],f=0,g=0;g<c.length;g++)e.push(f+1+"<br>"),f+=d;$(b).html(e.join(""))},j=function(a){var b=parseInt($(a).attr("display-option"));b=(b+b/10).toString();var c=$(a).html();c=c.toString().match(/.{1,10}/g).join(" ").match(new RegExp(".{1,"+b+"}","g")).join("<br>"),$(a).html(c)};return{render:b,selection:c,coverage:e,addLegend:d}}